{"level":"error","message":"Webhook signature validation failed: No stripe-signature header value was provided.","payload":{"api_version":"2020-08-27","created":1677649200,"data":{"object":{"amount":29900000,"created":1677649200,"currency":"vnd","id":"pi_test_success_12345","metadata":{"orderId":"ORD-TEST-001","userId":"60f7b3b3b3b3b3b3b3b3b3b3"},"object":"payment_intent","status":"succeeded"}},"id":"evt_test_payment_success","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":"req_test_12345","idempotency_key":null},"type":"payment_intent.succeeded"},"raw":{"message":"No stripe-signature header value was provided."},"stack":"Error: No stripe-signature header value was provided.\n    at parseEventDetails (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:104:19)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:66:102)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-12T18:18:50.313Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-12T18:18:50.315Z"}
{"_message":"PurchaseHistory validation failed","errors":{"items.0.totalPrice":{"kind":"required","message":"Path `totalPrice` is required.","name":"ValidatorError","path":"totalPrice","properties":{"message":"Path `totalPrice` is required.","path":"totalPrice","type":"required"}}},"level":"error","message":"Create test order error: PurchaseHistory validation failed: items.0.totalPrice: Path `totalPrice` is required.","stack":"ValidationError: PurchaseHistory validation failed: items.0.totalPrice: Path `totalPrice` is required.\n    at Document.invalidate (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\mongoose\\lib\\document.js:3352:32)\n    at Subdocument.invalidate (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\mongoose\\lib\\types\\subdocument.js:229:12)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\mongoose\\lib\\document.js:3113:17\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\mongoose\\lib\\schemaType.js:1407:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)","timestamp":"2025-07-13T04:47:30.708Z"}
{"_message":"PurchaseHistory validation failed","errors":{"items.0.totalPrice":{"kind":"required","message":"Path `totalPrice` is required.","name":"ValidatorError","path":"totalPrice","properties":{"message":"Path `totalPrice` is required.","path":"totalPrice","type":"required"}}},"level":"error","message":"Create test order error: PurchaseHistory validation failed: items.0.totalPrice: Path `totalPrice` is required.","stack":"ValidationError: PurchaseHistory validation failed: items.0.totalPrice: Path `totalPrice` is required.\n    at Document.invalidate (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\mongoose\\lib\\document.js:3352:32)\n    at Subdocument.invalidate (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\mongoose\\lib\\types\\subdocument.js:229:12)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\mongoose\\lib\\document.js:3113:17\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\mongoose\\lib\\schemaType.js:1407:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)","timestamp":"2025-07-13T04:49:25.457Z"}
{"level":"error","message":"Webhook signature validation failed: No stripe-signature header value was provided.","payload":{"data":{"object":{"id":"pi_test_12345","metadata":{"orderId":"ORD-TEST-1705123456789"},"status":"succeeded"}},"id":"evt_test_webhook","type":"payment_intent.succeeded"},"raw":{"message":"No stripe-signature header value was provided."},"stack":"Error: No stripe-signature header value was provided.\n    at parseEventDetails (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:104:19)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:66:102)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T06:35:12.781Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T06:35:12.782Z"}
{"header":"t=1752389714,v1=153534146d20b99263b1d1aea95e6c7c3e2e6d767f3fa647b325fba93024aadb,v0=17fd39c21925b407279e2ced916a32a9a59341717ccacf5f8c3ae6e47c1d4e80","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389714,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":32900000,"amount_total":32900000,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"https://28bc8c954193.ngrok-free.app/api/payment/cancel?order_id=ORD-TEST-1705123456781","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752389600,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752475999,"id":"cs_test_b1nrH9oLBoI3E21AtiRRbgPNnNK8lkMiqqCXk3wg11U9B9zVYHZ9UjUs26","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-TEST-1705123456781","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkJobBopfvfSoZm2IA8nTOk","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"https://28bc8c954193.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-TEST-1705123456781","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkJocBopfvfSoZmKTkpJD72","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T06:55:15.640Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T06:55:15.646Z"}
{"header":"t=1752389714,v1=679a0dd4c304193487f98eef67de1d038246e416259e85390263bcc51826d05e,v0=27de7ae9ef04eacd198c4edd3a12859292941a26f7a9d7aa740f5333bcc18913","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389714,"data":{"object":{"amount":32900000,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":32900000,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkJobBopfvfSoZm2IA8nTOk_secret_Kuo7jTpZYKEoHqJB4p6iY2G9l","confirmation_method":"automatic","created":1752389713,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkJobBopfvfSoZm2IA8nTOk","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkJobBopfvfSoZm2NAcR4Mq","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkJobBopfvfSoZmWwngUPKv","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkJobBopfvfSoZm23vDoMOk","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"a1abce98-d185-49d8-ab0a-3bb1c42ed4cd"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T06:55:15.773Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T06:55:15.775Z"}
{"header":"t=1752392012,v1=83c58feda9905397f3e277c952a4af8434643cc513456b5c3b119353a01b2a80,v0=4600745b988a9bca1fc10c0f7cdec9f89ab24cdd33f45b4e1af3805509bf6d4e","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752388347,"data":{"object":{"amount":32900000,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":32900000,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkJSYBopfvfSoZm0FIM7MVv_secret_hY3XepNkGcgr5PjqCHTuHF8H6","confirmation_method":"automatic","created":1752388346,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkJSYBopfvfSoZm0FIM7MVv","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkJSYBopfvfSoZm0Z3Ulh3g","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkJSXBopfvfSoZmh4EByfor","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"Hà Nội","country":"VN","line1":"Tố Hữu","line2":null,"postal_code":"11517","state":null},"carrier":null,"name":"Nguyễn Bá Đạo","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkJSYBopfvfSoZm0VS0ENR5","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"7c9933a3-6790-40e8-8865-d0f71e8b5f7d"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T07:33:33.206Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T07:33:33.208Z"}
{"header":"t=1752392022,v1=5d03f22d0cb9c428602f14d763acf9dc6af37106f3042f1a9aee5e0098a1a2a4,v0=0a7a1f6e448029749c8b9e39dab4e6743bcdb6a1cda58fae11d1ca0646e80663","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752388347,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":32900000,"amount_total":32900000,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"https://28bc8c954193.ngrok-free.app/api/payment/cancel?order_id=ORD-TEST-1705123456789","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"Hà Nội","country":"VN","line1":"Tố Hữu","line2":null,"postal_code":"11517","state":null},"name":"Nguyễn Bá Đạo"}},"consent":null,"consent_collection":null,"created":1752388273,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"Hà Nội","country":"VN","line1":"Tố Hữu","line2":null,"postal_code":"11517","state":null},"email":"nguyendao21012002@gmail.com","name":"Nguyễn Bá Đạo","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752474673,"id":"cs_test_b17G9824TkLGam69DO0yOZFpd83d8lvPtNvI1KTntgyUZD3aIvgT53Wztk","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-TEST-1705123456789","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkJSYBopfvfSoZm0FIM7MVv","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"Hà Nội","country":"VN","line1":"Tố Hữu","line2":null,"postal_code":"11517","state":null},"carrier":null,"name":"Nguyễn Bá Đạo","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"https://28bc8c954193.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-TEST-1705123456789","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkJSaBopfvfSoZmhWxr9Uzc","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T07:33:43.324Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T07:33:43.332Z"}
{"header":"t=1752392907,v1=a0b0d95a17b57e0cf2ead1077d9188be43bb0b9a78f36904878d84d00c2be666,v0=728da90892dd0a9622d9033327d20b1da90c4d50687bd5b47c295c4ce767b3dc","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389353,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":32900000,"amount_total":32900000,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"https://28bc8c954193.ngrok-free.app/api/payment/cancel?order_id=ORD-TEST-1705123456789","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752389198,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752475598,"id":"cs_test_b197FMgamPWhf03ywjMiihS4x7G7fnFT3exFy2cUBny50y60obcwwbu3GZ","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-TEST-1705123456789","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkJimBopfvfSoZm0cJ3ohmz","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"https://28bc8c954193.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-TEST-1705123456789","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkJinBopfvfSoZm2xAEOyBl","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T07:48:28.200Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T07:48:28.204Z"}
{"header":"t=1752392969,v1=c7e81060cdacf0d56726a927fce05e7da9ff5f8c270014dc09e0dd564cb9d8e7,v0=25e546d5736fa06b6849dbcd9113696b4de783e0d9ba6e26f6a21169e1935595","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389353,"data":{"object":{"amount":32900000,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":32900000,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkJimBopfvfSoZm0cJ3ohmz_secret_VzqBSx7wybWW4xk3HGRxzgpcq","confirmation_method":"automatic","created":1752389352,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkJimBopfvfSoZm0cJ3ohmz","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkJimBopfvfSoZm02yHdzC3","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkJimBopfvfSoZmGZQpQTG8","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkJimBopfvfSoZm0PJDoO8j","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"a613428b-c37a-4a4f-bcc6-c4aa6b9b7f72"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T07:49:29.886Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T07:49:29.888Z"}
{"header":"t=1752393259,v1=e1a716fda259133551174a835b5bc8f1ac191a7e7411751e3399347dc19f387a,v0=28a86aa6e5ce0f7deb1a7a8e06d96192c11d567382b8c565c5d621bf694f8ba4","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389714,"data":{"object":{"amount":32900000,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":32900000,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkJobBopfvfSoZm2IA8nTOk_secret_Kuo7jTpZYKEoHqJB4p6iY2G9l","confirmation_method":"automatic","created":1752389713,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkJobBopfvfSoZm2IA8nTOk","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkJobBopfvfSoZm2NAcR4Mq","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkJobBopfvfSoZmWwngUPKv","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkJobBopfvfSoZm23vDoMOk","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"a1abce98-d185-49d8-ab0a-3bb1c42ed4cd"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T07:54:20.642Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T07:54:20.644Z"}
{"header":"t=1752393302,v1=1c39ad22d32f65ad515dbc5fb46aa09f602a4c9dd03c5cebf78dca2ef9a76c32,v0=a8bfe3282d1a32042b176a1e756c1276749cdd39435336eb904422a573783734","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389714,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":32900000,"amount_total":32900000,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"https://28bc8c954193.ngrok-free.app/api/payment/cancel?order_id=ORD-TEST-1705123456781","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752389600,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752475999,"id":"cs_test_b1nrH9oLBoI3E21AtiRRbgPNnNK8lkMiqqCXk3wg11U9B9zVYHZ9UjUs26","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-TEST-1705123456781","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkJobBopfvfSoZm2IA8nTOk","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"https://28bc8c954193.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-TEST-1705123456781","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkJocBopfvfSoZmKTkpJD72","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T07:55:03.410Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T07:55:03.415Z"}
{"header":"t=1752400084,v1=33d73ba88c426606ac7a5626ad78d1bea2fafe0eea72d3c5dcfbaa1cdc5b0710,v0=bfce7b47c0f3a2301384f71b310da010c0bcfe6aa9c8ba579ad97bf11a268ca2","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389353,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":32900000,"amount_total":32900000,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"https://28bc8c954193.ngrok-free.app/api/payment/cancel?order_id=ORD-TEST-1705123456789","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752389198,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752475598,"id":"cs_test_b197FMgamPWhf03ywjMiihS4x7G7fnFT3exFy2cUBny50y60obcwwbu3GZ","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-TEST-1705123456789","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkJimBopfvfSoZm0cJ3ohmz","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"https://28bc8c954193.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-TEST-1705123456789","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkJinBopfvfSoZm2xAEOyBl","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T09:48:04.941Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T09:48:04.945Z"}
{"header":"t=1752400256,v1=da875ba21ad8db41866c41a979de7adf6f9b9d4135231938049473d81d3f77a4,v0=83c0ad020cfd866d34b15b7262f5d2ac5443f890e9760b576198d8f98b21b252","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389353,"data":{"object":{"amount":32900000,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":32900000,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkJimBopfvfSoZm0cJ3ohmz_secret_VzqBSx7wybWW4xk3HGRxzgpcq","confirmation_method":"automatic","created":1752389352,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkJimBopfvfSoZm0cJ3ohmz","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkJimBopfvfSoZm02yHdzC3","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkJimBopfvfSoZmGZQpQTG8","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkJimBopfvfSoZm0PJDoO8j","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"a613428b-c37a-4a4f-bcc6-c4aa6b9b7f72"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T09:50:56.680Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T09:50:56.682Z"}
{"header":"t=1752400558,v1=35bb6a7d21aa1bf149ab164e8225454aba41348890d991854f42dffcf54412af,v0=226768292ad2fd0c2c05754cb48ae3bae30626dd46fee595a0508d547da11a89","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389714,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":32900000,"amount_total":32900000,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"https://28bc8c954193.ngrok-free.app/api/payment/cancel?order_id=ORD-TEST-1705123456781","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752389600,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752475999,"id":"cs_test_b1nrH9oLBoI3E21AtiRRbgPNnNK8lkMiqqCXk3wg11U9B9zVYHZ9UjUs26","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-TEST-1705123456781","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkJobBopfvfSoZm2IA8nTOk","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"https://28bc8c954193.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-TEST-1705123456781","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkJocBopfvfSoZmKTkpJD72","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T09:55:59.104Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T09:55:59.109Z"}
{"header":"t=1752400561,v1=af3628a9abf71566e11185b41b92e8d7ed037d604d4155186cf896a9fc4e5810,v0=6661926f5ec0f34f8ddf5a5a49deed8612496e7bf5d73d1093e2d50cdea71853","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389714,"data":{"object":{"amount":32900000,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":32900000,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkJobBopfvfSoZm2IA8nTOk_secret_Kuo7jTpZYKEoHqJB4p6iY2G9l","confirmation_method":"automatic","created":1752389713,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkJobBopfvfSoZm2IA8nTOk","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkJobBopfvfSoZm2NAcR4Mq","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkJobBopfvfSoZmWwngUPKv","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkJobBopfvfSoZm23vDoMOk","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"a1abce98-d185-49d8-ab0a-3bb1c42ed4cd"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T09:56:02.387Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T09:56:02.389Z"}
{"code":"url_invalid","doc_url":"https://stripe.com/docs/error-codes/url-invalid","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"432","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=_wkF5oKZjBrJ6UYdatwxROtBqi4UYBEC2t5297KYIs9K8V3BQ7Cas-20AHmxTp6s72wcnvf1qg8boNvv","content-type":"application/json","date":"Sun, 13 Jul 2025 10:47:11 GMT","idempotency-key":"stripe-node-retry-f1768e5f-8691-4d75-ae97-b2af1ee2cc4f","original-request":"req_nkZk5Ve7Avcv23","request-id":"req_nkZk5Ve7Avcv23","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Stripe createCheckoutSession error: Invalid URL: Non-ASCII characters in URLs must be percent-encoded in order for the URL to be valid.","param":"line_items[0][price_data][product_data][images][0]","raw":{"code":"url_invalid","doc_url":"https://stripe.com/docs/error-codes/url-invalid","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"432","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=_wkF5oKZjBrJ6UYdatwxROtBqi4UYBEC2t5297KYIs9K8V3BQ7Cas-20AHmxTp6s72wcnvf1qg8boNvv","content-type":"application/json","date":"Sun, 13 Jul 2025 10:47:11 GMT","idempotency-key":"stripe-node-retry-f1768e5f-8691-4d75-ae97-b2af1ee2cc4f","original-request":"req_nkZk5Ve7Avcv23","request-id":"req_nkZk5Ve7Avcv23","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"Invalid URL: Non-ASCII characters in URLs must be percent-encoded in order for the URL to be valid.","param":"line_items[0][price_data][product_data][images][0]","requestId":"req_nkZk5Ve7Avcv23","request_log_url":"https://dashboard.stripe.com/test/logs/req_nkZk5Ve7Avcv23?t=1752403631","statusCode":400,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_nkZk5Ve7Avcv23","stack":"Error: Invalid URL: Non-ASCII characters in URLs must be percent-encoded in order for the URL to be valid.\n    at generateV1Error (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Error.js:11:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\RequestSender.js:108:62)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","statusCode":400,"timestamp":"2025-07-13T10:47:11.330Z","type":"StripeInvalidRequestError"}
{"level":"error","message":"Create checkout session error: Failed to create checkout session: Invalid URL: Non-ASCII characters in URLs must be percent-encoded in order for the URL to be valid.","stack":"Error: Failed to create checkout session: Invalid URL: Non-ASCII characters in URLs must be percent-encoded in order for the URL to be valid.\n    at StripeService.createCheckoutSession (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:118:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async createCheckoutSession (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:68:28)","timestamp":"2025-07-13T10:47:11.334Z"}
{"header":"t=1752404088,v1=da4a349bd52c94c3accf946bb57b9b8a472e641effdceb549097de5ad28019f6,v0=8d9c6055d02b5fa498eac305ddd3a4025aa9f9d113000535e5444f4809e119c1","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752404087,"data":{"object":{"amount":61950000,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":61950000,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkNYRBopfvfSoZm2mMrZzFv_secret_gTZW9PGzeTNIF2Cy4IrdXOafL","confirmation_method":"automatic","created":1752404087,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkNYRBopfvfSoZm2mMrZzFv","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkNYRBopfvfSoZm2QNzg21m","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkNYQBopfvfSoZmcA9ymSZ6","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkNYRBopfvfSoZm20Awuqym","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"99eb4967-176f-44c2-912e-f083fbd67e8b"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T10:54:48.900Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T10:54:48.903Z"}
{"header":"t=1752404088,v1=4522c6fc70f57700fc0a8875f8dd1ee0b8c26800c48776119b453a4c90051ebf,v0=a21801b0bc59df822f8f58ccfe1dc7de40e2806224354a437628891aff1da68f","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752404088,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":61950000,"amount_total":61950000,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"https://2a2b1fb33e48.ngrok-free.app/api/payment/cancel?order_id=ORD-2025-939","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752404072,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752490471,"id":"cs_test_b1rYKhdejpr6EMoPEbqVLx74vsRoWLKBiu7ZQy0uWBxQzShG49Sd6OvWGC","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-939","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkNYRBopfvfSoZm2mMrZzFv","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"https://2a2b1fb33e48.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-939","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkNYSBopfvfSoZmtcCIh3AA","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T10:54:49.377Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T10:54:49.384Z"}
{"header":"t=1752405196,v1=1703a9372974c5189269f9753c3341e6224263b45078833a36fcf9efeb2279a0,v0=cdc92d5a3ed486fed0747d817ac088dda8bd2eb1ccecaf51f76d3c9aa0764a37","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752405196,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":56550000,"amount_total":56550000,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-853","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752405178,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752491578,"id":"cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-853","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkNqJBopfvfSoZm2LjhVAB1","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-853","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkNqKBopfvfSoZmTFHUFmHZ","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T11:13:17.213Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T11:13:17.221Z"}
{"header":"t=1752405196,v1=6bd9ea7f739f0f3f78ce36ecb4447c9357c0558e899dddd6651b751b005ec96c,v0=d4a65adee2fb24f766aaee35efd71311665e8c6505d3f5c6353615105e2c6ce8","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752405196,"data":{"object":{"amount":56550000,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":56550000,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkNqJBopfvfSoZm2LjhVAB1_secret_bKHMksfJlZl0IvolkJJsth5zw","confirmation_method":"automatic","created":1752405195,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkNqJBopfvfSoZm2LjhVAB1","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkNqJBopfvfSoZm2pujGJBO","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkNqIBopfvfSoZmEsDr19Is","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkNqJBopfvfSoZm2D936yCM","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"3a1b9f43-82ac-42a2-9114-812c11032858"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T11:13:17.267Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T11:13:17.290Z"}
{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"391","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=ZZD2r4FgBToLcq51CsyExJ-obFNCNtz2Puqhsj9N4nAsHG0SiAj5TuO00lNelLTW7LoPbJuCjdv7e2uL","content-type":"application/json","date":"Sun, 13 Jul 2025 11:16:34 GMT","request-id":"req_32kRcImx0Lcv5Z","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Stripe getPaymentStatus error: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","param":"intent","raw":{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"391","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=ZZD2r4FgBToLcq51CsyExJ-obFNCNtz2Puqhsj9N4nAsHG0SiAj5TuO00lNelLTW7LoPbJuCjdv7e2uL","content-type":"application/json","date":"Sun, 13 Jul 2025 11:16:34 GMT","request-id":"req_32kRcImx0Lcv5Z","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","param":"intent","requestId":"req_32kRcImx0Lcv5Z","request_log_url":"https://dashboard.stripe.com/test/logs/req_32kRcImx0Lcv5Z?t=1752405394","statusCode":404,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_32kRcImx0Lcv5Z","stack":"Error: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'\n    at generateV1Error (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Error.js:11:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\RequestSender.js:108:62)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","statusCode":404,"timestamp":"2025-07-13T11:16:34.523Z","type":"StripeInvalidRequestError"}
{"level":"error","message":"Get payment status error: Failed to get payment status: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","stack":"Error: Failed to get payment status: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'\n    at StripeService.getPaymentStatus (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:180:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async getPaymentStatus (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:141:28)","timestamp":"2025-07-13T11:16:34.526Z"}
{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"391","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=ZZD2r4FgBToLcq51CsyExJ-obFNCNtz2Puqhsj9N4nAsHG0SiAj5TuO00lNelLTW7LoPbJuCjdv7e2uL","content-type":"application/json","date":"Sun, 13 Jul 2025 11:16:34 GMT","request-id":"req_Fl3psqSTQB8VKe","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Stripe getPaymentStatus error: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","param":"intent","raw":{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"391","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=ZZD2r4FgBToLcq51CsyExJ-obFNCNtz2Puqhsj9N4nAsHG0SiAj5TuO00lNelLTW7LoPbJuCjdv7e2uL","content-type":"application/json","date":"Sun, 13 Jul 2025 11:16:34 GMT","request-id":"req_Fl3psqSTQB8VKe","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","param":"intent","requestId":"req_Fl3psqSTQB8VKe","request_log_url":"https://dashboard.stripe.com/test/logs/req_Fl3psqSTQB8VKe?t=1752405394","statusCode":404,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_Fl3psqSTQB8VKe","stack":"Error: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'\n    at generateV1Error (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Error.js:11:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\RequestSender.js:108:62)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","statusCode":404,"timestamp":"2025-07-13T11:16:34.810Z","type":"StripeInvalidRequestError"}
{"level":"error","message":"Get payment status error: Failed to get payment status: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","stack":"Error: Failed to get payment status: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'\n    at StripeService.getPaymentStatus (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:180:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async getPaymentStatus (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:141:28)","timestamp":"2025-07-13T11:16:34.813Z"}
{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"391","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=NMEEuZMObAPmuzuZcyp-akrrM1Hjgeg0SFgrHwNHOVS-T6QKtqmT5fIccDHaFYpo7ECNJ6PjFSAEyDKs","content-type":"application/json","date":"Sun, 13 Jul 2025 11:20:37 GMT","request-id":"req_RZtia9pqbBx8Yj","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Stripe getPaymentStatus error: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","param":"intent","raw":{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"391","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=NMEEuZMObAPmuzuZcyp-akrrM1Hjgeg0SFgrHwNHOVS-T6QKtqmT5fIccDHaFYpo7ECNJ6PjFSAEyDKs","content-type":"application/json","date":"Sun, 13 Jul 2025 11:20:37 GMT","request-id":"req_RZtia9pqbBx8Yj","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","param":"intent","requestId":"req_RZtia9pqbBx8Yj","request_log_url":"https://dashboard.stripe.com/test/logs/req_RZtia9pqbBx8Yj?t=1752405637","statusCode":404,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_RZtia9pqbBx8Yj","stack":"Error: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'\n    at generateV1Error (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Error.js:11:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\RequestSender.js:108:62)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","statusCode":404,"timestamp":"2025-07-13T11:20:37.701Z","type":"StripeInvalidRequestError"}
{"level":"error","message":"Get payment status error: Failed to get payment status: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","stack":"Error: Failed to get payment status: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'\n    at StripeService.getPaymentStatus (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:180:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async getPaymentStatus (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:141:28)","timestamp":"2025-07-13T11:20:37.704Z"}
{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"391","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=NMEEuZMObAPmuzuZcyp-akrrM1Hjgeg0SFgrHwNHOVS-T6QKtqmT5fIccDHaFYpo7ECNJ6PjFSAEyDKs","content-type":"application/json","date":"Sun, 13 Jul 2025 11:20:37 GMT","request-id":"req_f11ewxpxwTU8lW","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Stripe getPaymentStatus error: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","param":"intent","raw":{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"391","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=NMEEuZMObAPmuzuZcyp-akrrM1Hjgeg0SFgrHwNHOVS-T6QKtqmT5fIccDHaFYpo7ECNJ6PjFSAEyDKs","content-type":"application/json","date":"Sun, 13 Jul 2025 11:20:37 GMT","request-id":"req_f11ewxpxwTU8lW","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","param":"intent","requestId":"req_f11ewxpxwTU8lW","request_log_url":"https://dashboard.stripe.com/test/logs/req_f11ewxpxwTU8lW?t=1752405637","statusCode":404,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_f11ewxpxwTU8lW","stack":"Error: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'\n    at generateV1Error (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Error.js:11:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\RequestSender.js:108:62)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","statusCode":404,"timestamp":"2025-07-13T11:20:37.979Z","type":"StripeInvalidRequestError"}
{"level":"error","message":"Get payment status error: Failed to get payment status: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","stack":"Error: Failed to get payment status: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'\n    at StripeService.getPaymentStatus (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:180:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async getPaymentStatus (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:141:28)","timestamp":"2025-07-13T11:20:37.980Z"}
{"code":"amount_too_large","doc_url":"https://stripe.com/docs/error-codes/amount-too-large","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"351","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=NC9b6AGAtx6pwZYTGiY_rxBHf3kZwXE9_cIeBiHvGJv-Zglrw2rC5g2PE7lA3jepCr8tUQ9VrQVT0fw7","content-type":"application/json","date":"Sun, 13 Jul 2025 11:22:59 GMT","idempotency-key":"stripe-node-retry-30de7082-20d4-4c8c-b17d-63f32c0b29f4","original-request":"req_Pyga1moRIjJvWm","request-id":"req_Pyga1moRIjJvWm","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-should-retry":"false","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Stripe createCheckoutSession error: The Checkout Session's total amount due must be no more than ₫99,999,999.","raw":{"code":"amount_too_large","doc_url":"https://stripe.com/docs/error-codes/amount-too-large","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"351","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=NC9b6AGAtx6pwZYTGiY_rxBHf3kZwXE9_cIeBiHvGJv-Zglrw2rC5g2PE7lA3jepCr8tUQ9VrQVT0fw7","content-type":"application/json","date":"Sun, 13 Jul 2025 11:22:59 GMT","idempotency-key":"stripe-node-retry-30de7082-20d4-4c8c-b17d-63f32c0b29f4","original-request":"req_Pyga1moRIjJvWm","request-id":"req_Pyga1moRIjJvWm","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-should-retry":"false","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"The Checkout Session's total amount due must be no more than ₫99,999,999.","requestId":"req_Pyga1moRIjJvWm","request_log_url":"https://dashboard.stripe.com/test/logs/req_Pyga1moRIjJvWm?t=1752405778","statusCode":400,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_Pyga1moRIjJvWm","stack":"Error: The Checkout Session's total amount due must be no more than ₫99,999,999.\n    at generateV1Error (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Error.js:11:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\RequestSender.js:108:62)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","statusCode":400,"timestamp":"2025-07-13T11:22:59.250Z","type":"StripeInvalidRequestError"}
{"level":"error","message":"Create checkout session error: Failed to create checkout session: The Checkout Session's total amount due must be no more than ₫99,999,999.","stack":"Error: Failed to create checkout session: The Checkout Session's total amount due must be no more than ₫99,999,999.\n    at StripeService.createCheckoutSession (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:118:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async createCheckoutSession (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:68:28)","timestamp":"2025-07-13T11:22:59.251Z"}
{"code":"amount_too_large","doc_url":"https://stripe.com/docs/error-codes/amount-too-large","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"351","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=NC9b6AGAtx6pwZYTGiY_rxBHf3kZwXE9_cIeBiHvGJv-Zglrw2rC5g2PE7lA3jepCr8tUQ9VrQVT0fw7","content-type":"application/json","date":"Sun, 13 Jul 2025 11:23:14 GMT","idempotency-key":"stripe-node-retry-6e7fb3ec-3702-4dcd-a5cb-7bfd9b018833","original-request":"req_biMn2I44m2XI1w","request-id":"req_biMn2I44m2XI1w","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-should-retry":"false","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Stripe createCheckoutSession error: The Checkout Session's total amount due must be no more than ₫99,999,999.","raw":{"code":"amount_too_large","doc_url":"https://stripe.com/docs/error-codes/amount-too-large","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"351","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=NC9b6AGAtx6pwZYTGiY_rxBHf3kZwXE9_cIeBiHvGJv-Zglrw2rC5g2PE7lA3jepCr8tUQ9VrQVT0fw7","content-type":"application/json","date":"Sun, 13 Jul 2025 11:23:14 GMT","idempotency-key":"stripe-node-retry-6e7fb3ec-3702-4dcd-a5cb-7bfd9b018833","original-request":"req_biMn2I44m2XI1w","request-id":"req_biMn2I44m2XI1w","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-should-retry":"false","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"The Checkout Session's total amount due must be no more than ₫99,999,999.","requestId":"req_biMn2I44m2XI1w","request_log_url":"https://dashboard.stripe.com/test/logs/req_biMn2I44m2XI1w?t=1752405794","statusCode":400,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_biMn2I44m2XI1w","stack":"Error: The Checkout Session's total amount due must be no more than ₫99,999,999.\n    at generateV1Error (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Error.js:11:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\RequestSender.js:108:62)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","statusCode":400,"timestamp":"2025-07-13T11:23:15.070Z","type":"StripeInvalidRequestError"}
{"level":"error","message":"Create checkout session error: Failed to create checkout session: The Checkout Session's total amount due must be no more than ₫99,999,999.","stack":"Error: Failed to create checkout session: The Checkout Session's total amount due must be no more than ₫99,999,999.\n    at StripeService.createCheckoutSession (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:118:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async createCheckoutSession (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:68:28)","timestamp":"2025-07-13T11:23:15.071Z"}
{"code":"amount_too_large","doc_url":"https://stripe.com/docs/error-codes/amount-too-large","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"351","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=bevj7UQ7HjIf2A0Rh3D8WVsHdJZi-5u-r-M3FVHEroNKFgRPKXo5jJp4NLfUhewyW32TCMHZdGvXpbhW","content-type":"application/json","date":"Sun, 13 Jul 2025 11:26:15 GMT","idempotency-key":"stripe-node-retry-6940007b-bbf5-47c7-ad72-3caed6d64d7b","original-request":"req_ltOeMUPaRmGkfQ","request-id":"req_ltOeMUPaRmGkfQ","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-should-retry":"false","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Stripe createCheckoutSession error: The Checkout Session's total amount due must be no more than ₫99,999,999.","raw":{"code":"amount_too_large","doc_url":"https://stripe.com/docs/error-codes/amount-too-large","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"351","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=bevj7UQ7HjIf2A0Rh3D8WVsHdJZi-5u-r-M3FVHEroNKFgRPKXo5jJp4NLfUhewyW32TCMHZdGvXpbhW","content-type":"application/json","date":"Sun, 13 Jul 2025 11:26:15 GMT","idempotency-key":"stripe-node-retry-6940007b-bbf5-47c7-ad72-3caed6d64d7b","original-request":"req_ltOeMUPaRmGkfQ","request-id":"req_ltOeMUPaRmGkfQ","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-should-retry":"false","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"The Checkout Session's total amount due must be no more than ₫99,999,999.","requestId":"req_ltOeMUPaRmGkfQ","request_log_url":"https://dashboard.stripe.com/test/logs/req_ltOeMUPaRmGkfQ?t=1752405974","statusCode":400,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_ltOeMUPaRmGkfQ","stack":"Error: The Checkout Session's total amount due must be no more than ₫99,999,999.\n    at generateV1Error (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Error.js:11:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\RequestSender.js:108:62)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","statusCode":400,"timestamp":"2025-07-13T11:26:15.155Z","type":"StripeInvalidRequestError"}
{"level":"error","message":"Create checkout session error: Failed to create checkout session: The Checkout Session's total amount due must be no more than ₫99,999,999.","stack":"Error: Failed to create checkout session: The Checkout Session's total amount due must be no more than ₫99,999,999.\n    at StripeService.createCheckoutSession (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:118:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async createCheckoutSession (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:68:28)","timestamp":"2025-07-13T11:26:15.157Z"}
{"header":"t=1752406638,v1=2813cd850ac90dc5022d51fb5b336c06321ddd20276a34a8764856af18845c4a,v0=6ea4ad597d32cfdb200e1ef3b7471f7c0a3d7e7d8fe826d085ec341defd3ed11","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752406638,"data":{"object":{"amount":6921300,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":6921300,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkODZBopfvfSoZm0eRaOnxm_secret_gFpGVASyp4bgRNOxOHbJUe7aY","confirmation_method":"automatic","created":1752406637,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkODZBopfvfSoZm0eRaOnxm","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkODZBopfvfSoZm0DTEBpyX","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkODXBopfvfSoZmeKTfKsGQ","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkODZBopfvfSoZm0bJsvgMM","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"d12e26fc-2a02-4cc0-b774-d07718b2fa05"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T11:37:19.207Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T11:37:19.211Z"}
{"header":"t=1752406638,v1=7224f735ca429aa7910dcd36f5f4cc4f629d201b71c301bf6ebd16f16e9dd87e,v0=e46d7a19b9472c499b236bc0567798157c36da55ad9d287a087736715dd371ee","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752406638,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":6921300,"amount_total":6921300,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-337","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752406632,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752493031,"id":"cs_test_b1HgoWT8nGF88DWAyab6JmEa1H34wL9eIj0pxG6aYQgFHzmZxIwLuG7EDG","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-337","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkODZBopfvfSoZm0eRaOnxm","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-337","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkODaBopfvfSoZmbgyMzxFM","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T11:37:19.253Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T11:37:19.285Z"}
{"header":"t=1752407073,v1=98fa3048dc98c8e368a05ddb4f821152676ea03d0943531067d833328a8a6aff,v0=8bf5b2d69614562892a454f4301b2176b42c1067c26bb6aaf9a3a4a1090f5429","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752407072,"data":{"object":{"amount":7646700,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":7646700,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkOKaBopfvfSoZm1Q9Vu1qk_secret_gLYbohI4rba6yjkn2oqgrQXca","confirmation_method":"automatic","created":1752407072,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkOKaBopfvfSoZm1Q9Vu1qk","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkOKaBopfvfSoZm1r5ahCYj","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkOKYBopfvfSoZmmyrgC5Xu","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkOKaBopfvfSoZm1bezWWJ8","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"1413cf07-7743-49b8-a925-4e0dbe576cb7"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T11:44:33.658Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T11:44:33.665Z"}
{"header":"t=1752407073,v1=5b497fe612ef81635790517950e36ce3ed42116a4c9529b15e782d3aeebfa0aa,v0=57060ebdda30015e78671aca7f725017ce3519fab0384747738311024c7111a3","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752407073,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":7646700,"amount_total":7646700,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-634","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752407065,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752493465,"id":"cs_test_b1uKGwc8kWJOpAiQjG2BP8gum27urD8kD8hYTYb6FYgQwmTxkHlvP1GZ9C","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-634","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkOKaBopfvfSoZm1Q9Vu1qk","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-634","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkOKbBopfvfSoZmU4zbio8d","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T11:44:33.727Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T11:44:33.735Z"}
{"header":"t=1752417533,v1=a8e4835e025edd79376e1c3b0cce374a12c9dd19fe20e2ab23368c9b145d46fa,v0=af2a3c0429b38ecbc56a4564b8b4a8f43ebc3b7e063fef3bd1b97c1696e5e802","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752417532,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":19448760,"amount_total":19448760,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-926","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752417524,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752503924,"id":"cs_test_b12HSD0ZaCHp9TL9zDFCDrdsshoPGh0o4rxeekPWbbCZBw6Pd48WSrOt2s","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-926","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkR3HBopfvfSoZm11LW98Mu","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-926","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkR3IBopfvfSoZmQ3ES406q","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T14:38:53.898Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T14:38:53.933Z"}
{"header":"t=1752417533,v1=4264840ec685932502f417a515d20ce9bc54d9a50f0c831ebcd111b92520661e,v0=a2749b457ee7b621d45715a5cfba861486011c4c57b2ce259a68f1a7fddd3e82","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752417532,"data":{"object":{"amount":19448760,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":19448760,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkR3HBopfvfSoZm11LW98Mu_secret_1PaDW8yBE4MP7lTXSO64wxYSn","confirmation_method":"automatic","created":1752417531,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkR3HBopfvfSoZm11LW98Mu","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkR3HBopfvfSoZm1lRA7oIU","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkR3EBopfvfSoZmNgHhtiI1","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkR3HBopfvfSoZm1awmmhXz","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"5f6f287c-7cf7-4712-bcf2-989847203f5c"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T14:38:54.012Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T14:38:54.543Z"}
{"header":"t=1752417859,v1=d7cc323396e23360786a9c2a9c7ff32d87e14d898edc325052e18f7d663e78ce,v0=533e1861f8c27b091990f5a3178cedbaf7adce9c9e2ef34714e07a6f01a427b5","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752407072,"data":{"object":{"amount":7646700,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":7646700,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkOKaBopfvfSoZm1Q9Vu1qk_secret_gLYbohI4rba6yjkn2oqgrQXca","confirmation_method":"automatic","created":1752407072,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkOKaBopfvfSoZm1Q9Vu1qk","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkOKaBopfvfSoZm1r5ahCYj","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkOKYBopfvfSoZmmyrgC5Xu","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkOKaBopfvfSoZm1bezWWJ8","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"1413cf07-7743-49b8-a925-4e0dbe576cb7"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T14:44:20.196Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T14:44:20.329Z"}
{"header":"t=1752417888,v1=216e6ed3ac47415be217d101a9893ca842650e31b1ff44194491ab5b832c0b84,v0=fd332b86251dd89dea2cdfd9af52444f2a23d97cc29b03d7cfe04312002c7809","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752417887,"data":{"object":{"amount":619500,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":619500,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkR90BopfvfSoZm1B0um8m3_secret_IVuTGWHw6PrsgW1C0GdQnLxls","confirmation_method":"automatic","created":1752417886,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkR90BopfvfSoZm1B0um8m3","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkR90BopfvfSoZm1t2iW3IC","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkR8yBopfvfSoZmJBmfBfay","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkR90BopfvfSoZm1v5ua0E3","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"9ad04a45-f8c9-4672-8a16-5524b8f104ac"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T14:44:49.004Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T14:44:49.012Z"}
{"header":"t=1752417888,v1=b30f5b5370158774c81e23ee1dca55c57a9a7a551e75a4c0e27999e4aa9c0f34,v0=5fa524456f1c78c8653c5e50ba45189de96a605199444d7359faa65160d8ca02","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752417887,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":619500,"amount_total":619500,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-090","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752417880,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752504280,"id":"cs_test_b1KZf5on1picoiC7zFd6Bh7Olm7rYxFS8owFbcOOBuO9uffTwQQyh4fIi1","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-090","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkR90BopfvfSoZm1B0um8m3","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-090","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkR92BopfvfSoZmwUsXcXfL","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T14:44:49.130Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T14:44:49.139Z"}
{"header":"t=1752417941,v1=99b225b82f68357fbecec333686838d53a4dd591612aa4b3c12d76dc18605f49,v0=f8eedebdd1b547d7bd6beef5a1b62ca5a23e4ece5394c4c7aab161ea7a4b3a3b","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752407073,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":7646700,"amount_total":7646700,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-634","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752407065,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752493465,"id":"cs_test_b1uKGwc8kWJOpAiQjG2BP8gum27urD8kD8hYTYb6FYgQwmTxkHlvP1GZ9C","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-634","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkOKaBopfvfSoZm1Q9Vu1qk","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-634","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkOKbBopfvfSoZmU4zbio8d","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T14:45:42.217Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T14:45:42.250Z"}
{"header":"t=1752418022,v1=3c3546381cb47f10bdb39d0649c2fb85f6e22b8f55c61efb32bf324b3aa36257,v0=8a6020a5eef9dffc7bd7324235973b3d3f0871a5d289cd8b90e57cac6ecda24d","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752418022,"data":{"object":{"amount":1015500,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":1015500,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkRBBBopfvfSoZm3j7bNIlQ_secret_FNTut4SXaRtxMVQ62QT7nTJco","confirmation_method":"automatic","created":1752418021,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkRBBBopfvfSoZm3j7bNIlQ","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkRBBBopfvfSoZm3GSva9l4","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkRB8BopfvfSoZmh3N0hE7R","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkRBBBopfvfSoZm3X9aYe8y","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"cc9ba5b3-5b4c-4cf2-a579-180c6a6932a9"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T14:47:03.929Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T14:47:03.936Z"}
{"header":"t=1752418022,v1=3f00afc211c3e4b86b2fdc190dbe796d53af1cdd1b39ed0254f820b40b4a0824,v0=102b1aba7e314cd13fc0f66ea3d8f6716d9418a21a0263b8145c71168b8ea462","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752418022,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":1015500,"amount_total":1015500,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-696","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752418015,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752504415,"id":"cs_test_b1SxPniaIZeD7McSo35XUzo4iPmthZ3c2q5bRwDrZK4l5QM5lJUtqKAp82","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-696","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkRBBBopfvfSoZm3j7bNIlQ","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-696","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkRBCBopfvfSoZm3Be7PnHc","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T14:47:03.953Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T14:47:03.994Z"}
{"header":"t=1752421078,v1=da8b7b2c9e288fa9e4018e839e2ca70fe161078de163babfafb24ffe20ade865,v0=c03eee2236da5ba74efcef7e3ccf09d34df4a6a1f9154198758d54c856ac098d","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752417532,"data":{"object":{"amount":19448760,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":19448760,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkR3HBopfvfSoZm11LW98Mu_secret_1PaDW8yBE4MP7lTXSO64wxYSn","confirmation_method":"automatic","created":1752417531,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkR3HBopfvfSoZm11LW98Mu","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkR3HBopfvfSoZm1lRA7oIU","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkR3EBopfvfSoZmNgHhtiI1","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkR3HBopfvfSoZm1awmmhXz","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"5f6f287c-7cf7-4712-bcf2-989847203f5c"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T15:37:59.284Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T15:37:59.287Z"}
{"header":"t=1752421169,v1=061e684ef021560a06763faed0fe6f3c15d0b12c442fa0aa60daef1122b71bc9,v0=4e63aa34ea1ed23378421f886be3b78b11e0d4a36f158167bc63c8e1c241fbbc","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752417532,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":19448760,"amount_total":19448760,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-926","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752417524,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752503924,"id":"cs_test_b12HSD0ZaCHp9TL9zDFCDrdsshoPGh0o4rxeekPWbbCZBw6Pd48WSrOt2s","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-926","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkR3HBopfvfSoZm11LW98Mu","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-926","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkR3IBopfvfSoZmQ3ES406q","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T15:39:30.785Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T15:39:30.792Z"}
{"header":"t=1752421454,v1=68445669358ccbd875daab29075b201b824be93c99560d2c575dc9f11e7272e7,v0=8a8e76a0c248b56ed59086dc8b406c67f2742420672148c3bc4272e614212ec9","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752417887,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":619500,"amount_total":619500,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-090","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752417880,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752504280,"id":"cs_test_b1KZf5on1picoiC7zFd6Bh7Olm7rYxFS8owFbcOOBuO9uffTwQQyh4fIi1","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-090","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkR90BopfvfSoZm1B0um8m3","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-090","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkR92BopfvfSoZmwUsXcXfL","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T15:44:15.021Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T15:44:15.027Z"}
{"header":"t=1752421461,v1=684da4ea4511aa9e326264c96e4be72588a55aaee30dcde35c7c922a6d3dd135,v0=018d9925f0a0871ea9cc02ea57c48e03b0a55b7dd6813fca10ee754a901919e0","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752417887,"data":{"object":{"amount":619500,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":619500,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkR90BopfvfSoZm1B0um8m3_secret_IVuTGWHw6PrsgW1C0GdQnLxls","confirmation_method":"automatic","created":1752417886,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkR90BopfvfSoZm1B0um8m3","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkR90BopfvfSoZm1t2iW3IC","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkR8yBopfvfSoZmJBmfBfay","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkR90BopfvfSoZm1v5ua0E3","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"9ad04a45-f8c9-4672-8a16-5524b8f104ac"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T15:44:22.872Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T15:44:22.879Z"}
{"header":"t=1752421623,v1=8660fb7cbdac50031abb819c56a50e0acd59f5a2dc8f85cf55a2fc405fc9c67d,v0=ffec5116140aeb46a003a7df844fed616536db3fd5378e3ee93b71930194bfc4","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752418022,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":1015500,"amount_total":1015500,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-696","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752418015,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752504415,"id":"cs_test_b1SxPniaIZeD7McSo35XUzo4iPmthZ3c2q5bRwDrZK4l5QM5lJUtqKAp82","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-696","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkRBBBopfvfSoZm3j7bNIlQ","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-696","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkRBCBopfvfSoZm3Be7PnHc","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T15:47:03.977Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T15:47:03.986Z"}
{"header":"t=1752421692,v1=c3e662cfb43ac287f0a813744013dc3c58148a698ea3ed986d173e3bfe7b2866,v0=3fdc931835644e40e8a3cb38fd8bf694610532db1c340f76f9e9d84ae5ccb2d2","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752418022,"data":{"object":{"amount":1015500,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":1015500,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkRBBBopfvfSoZm3j7bNIlQ_secret_FNTut4SXaRtxMVQ62QT7nTJco","confirmation_method":"automatic","created":1752418021,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkRBBBopfvfSoZm3j7bNIlQ","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkRBBBopfvfSoZm3GSva9l4","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkRB8BopfvfSoZmh3N0hE7R","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkRBBBopfvfSoZm3X9aYe8y","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"cc9ba5b3-5b4c-4cf2-a579-180c6a6932a9"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T15:48:13.603Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T15:48:13.605Z"}
{"header":"t=1752424098,v1=e91313fd42b5b4885bb4b9ffc7097fbbae504a920d132572a2cd969eca45e5a6,v0=1923b26b3cce355db48d14cae85cd8d7f21005591e7e7d6065fe183f3f30de57","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752424097,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":19448760,"amount_total":19448760,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-170","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752424038,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752510438,"id":"cs_test_b1b9MWEuWfrGd11sFLzb56BquplvI1YT73kBdDL2vccoBS6Phhaz3Qvcs5","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-170","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkSlABopfvfSoZm2vRYeChJ","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-170","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkSlBBopfvfSoZmAh534wy0","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T16:28:18.761Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T16:28:18.763Z"}
{"header":"t=1752424098,v1=f227baadce928a731eff3e0b0ee3fb6928a8eb0bcbae7f16b3000b2a7b58f362,v0=541569d40f9517dcfb7409b5033de5804222ce60d76498520a9db6268735d2a9","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752424097,"data":{"object":{"amount":19448760,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":19448760,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkSlABopfvfSoZm2vRYeChJ_secret_7GYoRCEZqJHZnniEaP7HTUlmF","confirmation_method":"automatic","created":1752424096,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkSlABopfvfSoZm2vRYeChJ","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkSlABopfvfSoZm2oKN4JKH","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkSlABopfvfSoZmDhZYUTF7","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkSlABopfvfSoZm2gMD9bfo","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"6fd3b15e-7328-4e81-b87b-dbdf15ae4ac5"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T16:28:18.867Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T16:28:18.868Z"}
{"header":"t=1752424398,v1=ff5c927f3858b1c2c739e5320e7d384a473a36ba07d1338c4cee5f193af2e074,v0=60a9727cafddc1a60a7c7b5134c682ea79a72430b105c4a55c1d006e2f1187e6","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752424398,"data":{"object":{"amount":1015500,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":1015500,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkSq1BopfvfSoZm2BxP1HUj_secret_NH8g2yDh3QoZ29AbVD1BlPNtO","confirmation_method":"automatic","created":1752424397,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkSq1BopfvfSoZm2BxP1HUj","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkSq1BopfvfSoZm28zLuL7s","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkSpzBopfvfSoZm5XYNpqQs","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkSq1BopfvfSoZm2QZbVASq","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"0ec2cca1-3919-4425-8c68-17e19ed0d301"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T16:33:19.387Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T16:33:19.389Z"}
{"header":"t=1752424398,v1=643b3779f1782eb0ff59a70802d8214a6eb1b1f58c6925ebe3ee505747ebbe29,v0=c3dfc91529f898bad6432848c658930204acb09f85f0980182a1abb362f19a61","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752424398,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":1015500,"amount_total":1015500,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-960","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752424391,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752510791,"id":"cs_test_b1HzNivQoI697VaSukOQ2EDsMVmI9EhxJJc9OgNpeFIc0fcjU3Y47Cx3OQ","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-960","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkSq1BopfvfSoZm2BxP1HUj","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-960","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkSq2BopfvfSoZmmmnU9Xv8","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T16:33:19.435Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T16:33:19.437Z"}
{"level":"error","message":"Webhook handler error: Cannot read properties of undefined (reading 'handleCheckoutCompleted')","stack":"TypeError: Cannot read properties of undefined (reading 'handleCheckoutCompleted')\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:498:32)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\read.js:137:5\n    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\n    at invokeCallback (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\raw-body\\index.js:238:16)\n    at done (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\raw-body\\index.js:227:7)\n    at IncomingMessage.onEnd (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\raw-body\\index.js:287:7)\n    at IncomingMessage.emit (node:events:519:28)\n    at endReadableNT (node:internal/streams/readable:1696:12)","timestamp":"2025-07-13T16:39:19.627Z"}
{"level":"error","message":"Webhook handler error: Cannot read properties of undefined (reading 'handlePaymentSuccess')","stack":"TypeError: Cannot read properties of undefined (reading 'handlePaymentSuccess')\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:490:32)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\read.js:137:5\n    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\n    at invokeCallback (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\raw-body\\index.js:238:16)\n    at done (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\raw-body\\index.js:227:7)\n    at IncomingMessage.onEnd (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\raw-body\\index.js:287:7)\n    at IncomingMessage.emit (node:events:519:28)\n    at endReadableNT (node:internal/streams/readable:1696:12)","timestamp":"2025-07-13T16:39:19.649Z"}
{"level":"error","message":"Handle payment success error: Failed to update order status: Order not found","stack":"Error: Failed to update order status: Order not found\n    at PurchaseHistoryService.updateOrderStatus (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\purchase-history.service.js:356:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async PaymentController.handlePaymentSuccess (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:518:13)\n    at async handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:487:21)","timestamp":"2025-07-13T16:45:15.240Z"}
