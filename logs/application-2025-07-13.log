{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-12T18:09:51.586Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-12T18:09:51.589Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-12T18:09:51.590Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-12T18:09:51.590Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-12T18:09:51.796Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-12T18:09:51.800Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-12T18:09:51.978Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-12T18:09:51.980Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-12T18:09:51.981Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-12T18:09:51.982Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-12T18:09:51.983Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-12T18:09:51.983Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-12T18:09:51.983Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-12T18:09:51.984Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-12T18:09:51.984Z"}
{"level":"info","message":"findByEmailOrUsername called with:","timestamp":"2025-07-12T18:12:50.529Z"}
{"level":"info","message":"Searching with identifier:","timestamp":"2025-07-12T18:12:50.530Z"}
{"level":"http","message":"POST /api/auth/login 200 80.217 ms - {\"userName\":\"nguyendao21012002@gmail.com\",\"password\":\"[REDACTED]\"} - User: guest","timestamp":"2025-07-12T18:12:50.608Z"}
{"level":"http","message":"GET /api/payment/webhook 404 3.396 ms - {\"id\":\"evt_test_payment_success\",\"object\":\"event\",\"api_version\":\"2020-08-27\",\"created\":1677649200,\"data\":{\"object\":{\"id\":\"pi_test_success_12345\",\"object\":\"payment_intent\",\"amount\":29900000,\"currency\":\"vnd\",\"status\":\"succeeded\",\"metadata\":{\"orderId\":\"ORD-TEST-001\",\"userId\":\"60f7b3b3b3b3b3b3b3b3b3b3\"},\"created\":1677649200}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":\"req_test_12345\",\"idempotency_key\":null},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-12T18:14:51.352Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-12T18:17:14.887Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-12T18:17:14.890Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-12T18:17:14.890Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-12T18:17:14.891Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-12T18:17:15.109Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-12T18:17:15.114Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-12T18:17:15.373Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-12T18:17:15.377Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-12T18:17:15.377Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-12T18:17:15.378Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-12T18:17:15.379Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-12T18:17:15.380Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-12T18:17:15.381Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-12T18:17:15.382Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-12T18:17:15.382Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-12T18:17:25.724Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-12T18:17:25.727Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-12T18:17:25.727Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-12T18:17:25.728Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-12T18:17:25.990Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-12T18:17:25.994Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-12T18:17:26.198Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-12T18:17:26.202Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-12T18:17:26.202Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-12T18:17:26.203Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-12T18:17:26.203Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-12T18:17:26.203Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-12T18:17:26.203Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-12T18:17:26.204Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-12T18:17:26.204Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-12T18:18:34.217Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-12T18:18:34.219Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-12T18:18:34.220Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-12T18:18:34.220Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-12T18:18:34.424Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-12T18:18:34.429Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-12T18:18:34.617Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-12T18:18:34.619Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-12T18:18:34.620Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-12T18:18:34.620Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-12T18:18:34.621Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-12T18:18:34.621Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-12T18:18:34.621Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-12T18:18:34.621Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-12T18:18:34.621Z"}
{"level":"error","message":"Webhook signature validation failed: No stripe-signature header value was provided.","payload":{"api_version":"2020-08-27","created":1677649200,"data":{"object":{"amount":29900000,"created":1677649200,"currency":"vnd","id":"pi_test_success_12345","metadata":{"orderId":"ORD-TEST-001","userId":"60f7b3b3b3b3b3b3b3b3b3b3"},"object":"payment_intent","status":"succeeded"}},"id":"evt_test_payment_success","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":"req_test_12345","idempotency_key":null},"type":"payment_intent.succeeded"},"raw":{"message":"No stripe-signature header value was provided."},"stack":"Error: No stripe-signature header value was provided.\n    at parseEventDetails (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:104:19)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:66:102)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-12T18:18:50.313Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-12T18:18:50.315Z"}
{"level":"http","message":"POST /api/payment/webhook 400 8.416 ms - {\"id\":\"evt_test_payment_success\",\"object\":\"event\",\"api_version\":\"2020-08-27\",\"created\":1677649200,\"data\":{\"object\":{\"id\":\"pi_test_success_12345\",\"object\":\"payment_intent\",\"amount\":29900000,\"currency\":\"vnd\",\"status\":\"succeeded\",\"metadata\":{\"orderId\":\"ORD-TEST-001\",\"userId\":\"60f7b3b3b3b3b3b3b3b3b3b3\"},\"created\":1677649200}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":\"req_test_12345\",\"idempotency_key\":null},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-12T18:18:50.320Z"}
{"level":"http","message":"GET /api/payment/test-config 200 545.893 ms - {} - User: -","timestamp":"2025-07-12T18:20:34.756Z"}
{"level":"info","message":"🛑 SIGINT received, shutting down gracefully","timestamp":"2025-07-12T18:21:30.337Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T04:45:53.576Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T04:45:53.580Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T04:45:53.580Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T04:45:53.581Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T04:45:54.028Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T04:45:54.035Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T04:45:54.507Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T04:45:54.512Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T04:45:54.513Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T04:45:54.514Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T04:45:54.516Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T04:45:54.516Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T04:45:54.517Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T04:45:54.517Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T04:45:54.517Z"}
{"level":"info","message":"findByEmailOrUsername called with:","timestamp":"2025-07-13T04:45:57.459Z"}
{"level":"info","message":"Searching with identifier:","timestamp":"2025-07-13T04:45:57.460Z"}
{"level":"http","message":"POST /api/auth/login 200 102.891 ms - {\"userName\":\"nguyendao21012002@gmail.com\",\"password\":\"[REDACTED]\"} - User: guest","timestamp":"2025-07-13T04:45:57.560Z"}
{"_message":"PurchaseHistory validation failed","errors":{"items.0.totalPrice":{"kind":"required","message":"Path `totalPrice` is required.","name":"ValidatorError","path":"totalPrice","properties":{"message":"Path `totalPrice` is required.","path":"totalPrice","type":"required"}}},"level":"error","message":"Create test order error: PurchaseHistory validation failed: items.0.totalPrice: Path `totalPrice` is required.","stack":"ValidationError: PurchaseHistory validation failed: items.0.totalPrice: Path `totalPrice` is required.\n    at Document.invalidate (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\mongoose\\lib\\document.js:3352:32)\n    at Subdocument.invalidate (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\mongoose\\lib\\types\\subdocument.js:229:12)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\mongoose\\lib\\document.js:3113:17\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\mongoose\\lib\\schemaType.js:1407:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)","timestamp":"2025-07-13T04:47:30.708Z"}
{"level":"http","message":"POST /api/payment/create-test-order 400 69.699 ms - {} - User: -","timestamp":"2025-07-13T04:47:30.715Z"}
{"level":"http","message":"GET /api/payment/test-config 200 711.897 ms - {} - User: -","timestamp":"2025-07-13T04:49:15.765Z"}
{"_message":"PurchaseHistory validation failed","errors":{"items.0.totalPrice":{"kind":"required","message":"Path `totalPrice` is required.","name":"ValidatorError","path":"totalPrice","properties":{"message":"Path `totalPrice` is required.","path":"totalPrice","type":"required"}}},"level":"error","message":"Create test order error: PurchaseHistory validation failed: items.0.totalPrice: Path `totalPrice` is required.","stack":"ValidationError: PurchaseHistory validation failed: items.0.totalPrice: Path `totalPrice` is required.\n    at Document.invalidate (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\mongoose\\lib\\document.js:3352:32)\n    at Subdocument.invalidate (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\mongoose\\lib\\types\\subdocument.js:229:12)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\mongoose\\lib\\document.js:3113:17\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\mongoose\\lib\\schemaType.js:1407:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)","timestamp":"2025-07-13T04:49:25.457Z"}
{"level":"http","message":"POST /api/payment/create-test-order 400 19.444 ms - {} - User: -","timestamp":"2025-07-13T04:49:25.460Z"}
{"level":"http","message":"POST /api/payment/create-intent 200 641.516 ms - {\"orderId\":\"ORD-TEST-1705123456789\",\"totalAmount\":329000,\"items\":[{\"productId\":\"BT10\",\"nameProduct\":\"Test Product 1\",\"quantity\":0,\"unitPrice\":149500,\"size\":\"M\",\"productImage\":\"https://example.com/test-image.jpg\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T04:52:10.966Z"}
{"level":"info","message":"🛑 SIGINT received, shutting down gracefully","timestamp":"2025-07-13T04:52:42.619Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T06:28:12.382Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T06:28:12.385Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T06:28:12.385Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T06:28:12.386Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T06:28:12.732Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T06:28:12.737Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T06:28:13.030Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T06:28:13.033Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T06:28:13.034Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T06:28:13.034Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T06:28:13.035Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T06:28:13.035Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T06:28:13.035Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T06:28:13.035Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T06:28:13.035Z"}
{"level":"http","message":"POST /api/payment/create-intent 200 572.427 ms - {\"orderId\":\"ORD-TEST-1705123456789\",\"totalAmount\":329000,\"items\":[{\"productId\":\"BT10\",\"nameProduct\":\"Test Product 1\",\"quantity\":1,\"unitPrice\":149500,\"size\":\"M\",\"productImage\":\"https://example.com/test-image.jpg\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T06:28:14.968Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 1271.626 ms - {\"orderId\":\"ORD-TEST-1705123456789\",\"totalAmount\":329000,\"items\":[{\"productId\":\"test-product-1\",\"nameProduct\":\"Test Product 1\",\"quantity\":2,\"unitPrice\":149500,\"size\":\"M\",\"productImage\":\"https://example.com/test-image.jpg\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T06:31:14.435Z"}
{"level":"error","message":"Webhook signature validation failed: No stripe-signature header value was provided.","payload":{"data":{"object":{"id":"pi_test_12345","metadata":{"orderId":"ORD-TEST-1705123456789"},"status":"succeeded"}},"id":"evt_test_webhook","type":"payment_intent.succeeded"},"raw":{"message":"No stripe-signature header value was provided."},"stack":"Error: No stripe-signature header value was provided.\n    at parseEventDetails (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:104:19)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:66:102)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T06:35:12.781Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T06:35:12.782Z"}
{"level":"http","message":"POST /api/payment/webhook 400 4.393 ms - {\"id\":\"evt_test_webhook\",\"type\":\"payment_intent.succeeded\",\"data\":{\"object\":{\"id\":\"pi_test_12345\",\"status\":\"succeeded\",\"metadata\":{\"orderId\":\"ORD-TEST-1705123456789\"}}}} - User: guest","timestamp":"2025-07-13T06:35:12.784Z"}
{"level":"http","message":"POST /api/auth/logout 200 11.961 ms - {\"userName\":\"nguyendao21012002@gmail.com\",\"password\":\"[REDACTED]\"} - User: guest","timestamp":"2025-07-13T06:37:53.525Z"}
{"level":"info","message":"findByEmailOrUsername called with:","timestamp":"2025-07-13T06:37:57.880Z"}
{"level":"info","message":"Searching with identifier:","timestamp":"2025-07-13T06:37:57.880Z"}
{"level":"http","message":"POST /api/auth/login 200 70.304 ms - {\"userName\":\"nguyendao21012002@gmail.com\",\"password\":\"[REDACTED]\"} - User: guest","timestamp":"2025-07-13T06:37:57.949Z"}
{"level":"http","message":"POST /api/payment/create-intent 200 517.723 ms - {\"orderId\":\"ORD-TEST-1705123456789\",\"totalAmount\":229000,\"items\":[{\"productId\":\"BT10\",\"nameProduct\":\"Test Product 1\",\"quantity\":1,\"unitPrice\":149500,\"size\":\"M\",\"productImage\":\"https://example.com/test-image.jpg\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T06:45:49.583Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 580.762 ms - {\"orderId\":\"ORD-TEST-1705123456789\",\"totalAmount\":229000,\"items\":[{\"productId\":\"BT10\",\"nameProduct\":\"Test Product 1\",\"quantity\":2,\"unitPrice\":149500,\"size\":\"M\",\"productImage\":\"https://example.com/test-image.jpg\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T06:46:39.428Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 658.112 ms - {\"orderId\":\"ORD-TEST-1705123456781\",\"totalAmount\":229000,\"items\":[{\"productId\":\"BT10\",\"nameProduct\":\"Test Product 1\",\"quantity\":2,\"unitPrice\":149500,\"size\":\"M\",\"productImage\":\"https://example.com/test-image.jpg\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T06:53:20.476Z"}
{"header":"t=1752389714,v1=153534146d20b99263b1d1aea95e6c7c3e2e6d767f3fa647b325fba93024aadb,v0=17fd39c21925b407279e2ced916a32a9a59341717ccacf5f8c3ae6e47c1d4e80","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389714,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":32900000,"amount_total":32900000,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"https://28bc8c954193.ngrok-free.app/api/payment/cancel?order_id=ORD-TEST-1705123456781","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752389600,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752475999,"id":"cs_test_b1nrH9oLBoI3E21AtiRRbgPNnNK8lkMiqqCXk3wg11U9B9zVYHZ9UjUs26","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-TEST-1705123456781","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkJobBopfvfSoZm2IA8nTOk","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"https://28bc8c954193.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-TEST-1705123456781","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkJocBopfvfSoZmKTkpJD72","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T06:55:15.640Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T06:55:15.646Z"}
{"level":"http","message":"POST /api/payment/webhook 400 9.804 ms - {\"id\":\"evt_1RkJocBopfvfSoZmKTkpJD72\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752389714,\"data\":{\"object\":{\"id\":\"cs_test_b1nrH9oLBoI3E21AtiRRbgPNnNK8lkMiqqCXk3wg11U9B9zVYHZ9UjUs26\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":32900000,\"amount_total\":32900000,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"https://28bc8c954193.ngrok-free.app/api/payment/cancel?order_id=ORD-TEST-1705123456781\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"name\":\"Nguyen Dao\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752389600,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":null,\"state\":\"Hà Nội\"},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyen Dao\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752475999,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-TEST-1705123456781\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkJobBopfvfSoZm2IA8nTOk\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"https://28bc8c954193.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-TEST-1705123456781\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T06:55:15.650Z"}
{"header":"t=1752389714,v1=679a0dd4c304193487f98eef67de1d038246e416259e85390263bcc51826d05e,v0=27de7ae9ef04eacd198c4edd3a12859292941a26f7a9d7aa740f5333bcc18913","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389714,"data":{"object":{"amount":32900000,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":32900000,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkJobBopfvfSoZm2IA8nTOk_secret_Kuo7jTpZYKEoHqJB4p6iY2G9l","confirmation_method":"automatic","created":1752389713,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkJobBopfvfSoZm2IA8nTOk","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkJobBopfvfSoZm2NAcR4Mq","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkJobBopfvfSoZmWwngUPKv","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkJobBopfvfSoZm23vDoMOk","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"a1abce98-d185-49d8-ab0a-3bb1c42ed4cd"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T06:55:15.773Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T06:55:15.775Z"}
{"level":"http","message":"POST /api/payment/webhook 400 4.847 ms - {\"id\":\"evt_3RkJobBopfvfSoZm23vDoMOk\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752389714,\"data\":{\"object\":{\"id\":\"pi_3RkJobBopfvfSoZm2IA8nTOk\",\"object\":\"payment_intent\",\"amount\":32900000,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":32900000,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkJobBopfvfSoZm2IA8nTOk_secret_Kuo7jTpZYKEoHqJB4p6iY2G9l\",\"confirmation_method\":\"automatic\",\"created\":1752389713,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkJobBopfvfSoZm2NAcR4Mq\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkJobBopfvfSoZmWwngUPKv\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"a1abce98-d185-49d8-ab0a-3bb1c42ed4cd\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T06:55:15.777Z"}
{"level":"info","message":"🛑 SIGINT received, shutting down gracefully","timestamp":"2025-07-13T07:09:24.092Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T07:11:55.938Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T07:11:55.941Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T07:11:55.942Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T07:11:55.943Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T07:11:56.130Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T07:11:56.135Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T07:11:56.345Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T07:11:56.348Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T07:11:56.348Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T07:11:56.349Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T07:11:56.349Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T07:11:56.349Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T07:11:56.350Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T07:11:56.350Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T07:11:56.350Z"}
{"level":"http","message":"GET /api/purchase-history 401 9.491 ms - {} - User: guest","timestamp":"2025-07-13T07:20:22.390Z"}
{"level":"http","message":"GET /api/purchase-history 200 38.171 ms - {} - User: -","timestamp":"2025-07-13T07:20:45.944Z"}
{"header":"t=1752392012,v1=83c58feda9905397f3e277c952a4af8434643cc513456b5c3b119353a01b2a80,v0=4600745b988a9bca1fc10c0f7cdec9f89ab24cdd33f45b4e1af3805509bf6d4e","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752388347,"data":{"object":{"amount":32900000,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":32900000,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkJSYBopfvfSoZm0FIM7MVv_secret_hY3XepNkGcgr5PjqCHTuHF8H6","confirmation_method":"automatic","created":1752388346,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkJSYBopfvfSoZm0FIM7MVv","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkJSYBopfvfSoZm0Z3Ulh3g","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkJSXBopfvfSoZmh4EByfor","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"Hà Nội","country":"VN","line1":"Tố Hữu","line2":null,"postal_code":"11517","state":null},"carrier":null,"name":"Nguyễn Bá Đạo","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkJSYBopfvfSoZm0VS0ENR5","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"7c9933a3-6790-40e8-8865-d0f71e8b5f7d"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T07:33:33.206Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T07:33:33.208Z"}
{"level":"http","message":"POST /api/payment/webhook 400 4.613 ms - {\"id\":\"evt_3RkJSYBopfvfSoZm0VS0ENR5\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752388347,\"data\":{\"object\":{\"id\":\"pi_3RkJSYBopfvfSoZm0FIM7MVv\",\"object\":\"payment_intent\",\"amount\":32900000,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":32900000,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkJSYBopfvfSoZm0FIM7MVv_secret_hY3XepNkGcgr5PjqCHTuHF8H6\",\"confirmation_method\":\"automatic\",\"created\":1752388346,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkJSYBopfvfSoZm0Z3Ulh3g\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkJSXBopfvfSoZmh4EByfor\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"Hà Nội\",\"country\":\"VN\",\"line1\":\"Tố Hữu\",\"line2\":null,\"postal_code\":\"11517\",\"state\":null},\"carrier\":null,\"name\":\"Nguyễn Bá Đạo\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"7c9933a3-6790-40e8-8865-d0f71e8b5f7d\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T07:33:33.209Z"}
{"header":"t=1752392022,v1=5d03f22d0cb9c428602f14d763acf9dc6af37106f3042f1a9aee5e0098a1a2a4,v0=0a7a1f6e448029749c8b9e39dab4e6743bcdb6a1cda58fae11d1ca0646e80663","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752388347,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":32900000,"amount_total":32900000,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"https://28bc8c954193.ngrok-free.app/api/payment/cancel?order_id=ORD-TEST-1705123456789","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"Hà Nội","country":"VN","line1":"Tố Hữu","line2":null,"postal_code":"11517","state":null},"name":"Nguyễn Bá Đạo"}},"consent":null,"consent_collection":null,"created":1752388273,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"Hà Nội","country":"VN","line1":"Tố Hữu","line2":null,"postal_code":"11517","state":null},"email":"nguyendao21012002@gmail.com","name":"Nguyễn Bá Đạo","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752474673,"id":"cs_test_b17G9824TkLGam69DO0yOZFpd83d8lvPtNvI1KTntgyUZD3aIvgT53Wztk","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-TEST-1705123456789","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkJSYBopfvfSoZm0FIM7MVv","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"Hà Nội","country":"VN","line1":"Tố Hữu","line2":null,"postal_code":"11517","state":null},"carrier":null,"name":"Nguyễn Bá Đạo","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"https://28bc8c954193.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-TEST-1705123456789","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkJSaBopfvfSoZmhWxr9Uzc","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T07:33:43.324Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T07:33:43.332Z"}
{"level":"http","message":"POST /api/payment/webhook 400 10.113 ms - {\"id\":\"evt_1RkJSaBopfvfSoZmhWxr9Uzc\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752388347,\"data\":{\"object\":{\"id\":\"cs_test_b17G9824TkLGam69DO0yOZFpd83d8lvPtNvI1KTntgyUZD3aIvgT53Wztk\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":32900000,\"amount_total\":32900000,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"https://28bc8c954193.ngrok-free.app/api/payment/cancel?order_id=ORD-TEST-1705123456789\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"Hà Nội\",\"country\":\"VN\",\"line1\":\"Tố Hữu\",\"line2\":null,\"postal_code\":\"11517\",\"state\":null},\"name\":\"Nguyễn Bá Đạo\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752388273,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"Hà Nội\",\"country\":\"VN\",\"line1\":\"Tố Hữu\",\"line2\":null,\"postal_code\":\"11517\",\"state\":null},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyễn Bá Đạo\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752474673,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-TEST-1705123456789\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkJSYBopfvfSoZm0FIM7MVv\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"Hà Nội\",\"country\":\"VN\",\"line1\":\"Tố Hữu\",\"line2\":null,\"postal_code\":\"11517\",\"state\":null},\"carrier\":null,\"name\":\"Nguyễn Bá Đạo\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"https://28bc8c954193.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-TEST-1705123456789\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T07:33:43.333Z"}
{"level":"http","message":"GET /api/products?limit=100 304 49.604 ms - {} - User: guest","timestamp":"2025-07-13T07:38:18.997Z"}
{"level":"http","message":"GET /api/collections 304 46.630 ms - {} - User: guest","timestamp":"2025-07-13T07:38:19.001Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 47.246 ms - {} - User: guest","timestamp":"2025-07-13T07:38:19.006Z"}
{"level":"http","message":"GET /api/cart 304 43.637 ms - {} - User: -","timestamp":"2025-07-13T07:38:19.008Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.310 ms - {} - User: guest","timestamp":"2025-07-13T07:38:19.011Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 2.558 ms - {} - User: guest","timestamp":"2025-07-13T07:38:19.020Z"}
{"level":"http","message":"GET /api/collections 304 18.332 ms - {} - User: guest","timestamp":"2025-07-13T07:38:19.032Z"}
{"level":"http","message":"GET /api/cart 304 13.189 ms - {} - User: -","timestamp":"2025-07-13T07:38:19.035Z"}
{"level":"http","message":"GET /api/cart 304 8.161 ms - {} - User: -","timestamp":"2025-07-13T07:38:19.045Z"}
{"level":"http","message":"GET /api/cart 304 18.569 ms - {} - User: -","timestamp":"2025-07-13T07:38:19.065Z"}
{"level":"http","message":"GET /api/wishlist 304 16.369 ms - {} - User: -","timestamp":"2025-07-13T07:38:19.122Z"}
{"level":"http","message":"GET /api/wishlist 304 9.028 ms - {} - User: -","timestamp":"2025-07-13T07:38:19.132Z"}
{"level":"http","message":"GET /api/wishlist 304 11.936 ms - {} - User: -","timestamp":"2025-07-13T07:38:19.146Z"}
{"level":"http","message":"GET /api/wishlist 304 17.746 ms - {} - User: -","timestamp":"2025-07-13T07:38:19.165Z"}
{"level":"http","message":"GET /api/wishlist 304 9.731 ms - {} - User: -","timestamp":"2025-07-13T07:38:19.178Z"}
{"level":"http","message":"GET /api/wishlist 304 11.854 ms - {} - User: -","timestamp":"2025-07-13T07:38:19.192Z"}
{"level":"http","message":"GET /api/collections/ChotMe/products 304 7.137 ms - {} - User: guest","timestamp":"2025-07-13T07:38:26.201Z"}
{"level":"http","message":"GET /api/collections/ChotMe/products 304 5.497 ms - {} - User: guest","timestamp":"2025-07-13T07:38:26.208Z"}
{"level":"http","message":"GET /api/products/BT1 304 2.900 ms - {} - User: guest","timestamp":"2025-07-13T07:38:28.000Z"}
{"level":"http","message":"GET /api/products/BT1 304 0.734 ms - {} - User: guest","timestamp":"2025-07-13T07:38:28.002Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 12.318 ms - {} - User: guest","timestamp":"2025-07-13T07:38:28.026Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 0.944 ms - {} - User: guest","timestamp":"2025-07-13T07:38:28.028Z"}
{"level":"info","message":"findByEmailOrUsername called with:","timestamp":"2025-07-13T07:38:34.507Z"}
{"level":"info","message":"Searching with identifier:","timestamp":"2025-07-13T07:38:34.508Z"}
{"level":"http","message":"POST /api/auth/login 200 67.777 ms - {\"userName\":\"nguyendao21012002@gmail.com\",\"password\":\"[REDACTED]\"} - User: guest","timestamp":"2025-07-13T07:38:34.574Z"}
{"level":"http","message":"GET /api/products?limit=100 304 0.801 ms - {} - User: guest","timestamp":"2025-07-13T07:38:36.110Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 0.664 ms - {} - User: guest","timestamp":"2025-07-13T07:38:36.112Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.419 ms - {} - User: guest","timestamp":"2025-07-13T07:38:36.124Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.648 ms - {} - User: guest","timestamp":"2025-07-13T07:38:36.128Z"}
{"level":"http","message":"GET /api/cart 304 39.748 ms - {} - User: -","timestamp":"2025-07-13T07:38:36.147Z"}
{"level":"http","message":"GET /api/collections 304 36.359 ms - {} - User: guest","timestamp":"2025-07-13T07:38:36.149Z"}
{"level":"http","message":"GET /api/wishlist 304 50.849 ms - {} - User: -","timestamp":"2025-07-13T07:38:36.166Z"}
{"level":"http","message":"GET /api/cart 304 21.667 ms - {} - User: -","timestamp":"2025-07-13T07:38:36.176Z"}
{"level":"http","message":"GET /api/collections 304 16.798 ms - {} - User: guest","timestamp":"2025-07-13T07:38:36.179Z"}
{"level":"http","message":"GET /api/wishlist 304 38.057 ms - {} - User: -","timestamp":"2025-07-13T07:38:36.210Z"}
{"level":"http","message":"GET /api/cart 304 28.610 ms - {} - User: -","timestamp":"2025-07-13T07:38:36.214Z"}
{"level":"http","message":"GET /api/cart 304 11.484 ms - {} - User: -","timestamp":"2025-07-13T07:38:36.237Z"}
{"level":"http","message":"GET /api/wishlist 304 24.223 ms - {} - User: -","timestamp":"2025-07-13T07:38:36.241Z"}
{"level":"http","message":"GET /api/wishlist 304 13.543 ms - {} - User: -","timestamp":"2025-07-13T07:38:36.256Z"}
{"level":"http","message":"GET /api/wishlist 304 7.930 ms - {} - User: -","timestamp":"2025-07-13T07:38:36.266Z"}
{"level":"http","message":"GET /api/wishlist 304 8.342 ms - {} - User: -","timestamp":"2025-07-13T07:38:36.276Z"}
{"level":"http","message":"GET /api/wishlist 304 12.321 ms - {} - User: -","timestamp":"2025-07-13T07:38:36.290Z"}
{"level":"http","message":"GET /api/wishlist 304 8.583 ms - {} - User: -","timestamp":"2025-07-13T07:38:36.301Z"}
{"level":"http","message":"GET /api/wishlist 304 8.303 ms - {} - User: -","timestamp":"2025-07-13T07:38:36.310Z"}
{"level":"http","message":"GET /api/wishlist 304 9.114 ms - {} - User: -","timestamp":"2025-07-13T07:38:36.321Z"}
{"level":"http","message":"GET /api/wishlist 304 6.547 ms - {} - User: -","timestamp":"2025-07-13T07:38:36.328Z"}
{"level":"http","message":"GET /api/wishlist 304 11.463 ms - {} - User: -","timestamp":"2025-07-13T07:38:36.342Z"}
{"level":"http","message":"GET /api/cart 304 13.432 ms - {} - User: -","timestamp":"2025-07-13T07:38:40.170Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 200 20.099 ms - {} - User: -","timestamp":"2025-07-13T07:38:40.185Z"}
{"level":"http","message":"GET /api/cart 304 12.982 ms - {} - User: -","timestamp":"2025-07-13T07:38:40.188Z"}
{"level":"http","message":"GET /api/cart 304 12.370 ms - {} - User: -","timestamp":"2025-07-13T07:38:40.205Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 18.177 ms - {} - User: -","timestamp":"2025-07-13T07:38:40.207Z"}
{"level":"http","message":"GET /api/cart 304 5.442 ms - {} - User: -","timestamp":"2025-07-13T07:38:40.213Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 9.215 ms - {} - User: -","timestamp":"2025-07-13T07:38:42.648Z"}
{"level":"http","message":"GET /api/cart 304 12.122 ms - {} - User: -","timestamp":"2025-07-13T07:38:53.623Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 6.449 ms - {} - User: -","timestamp":"2025-07-13T07:39:00.827Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 8.973 ms - {} - User: -","timestamp":"2025-07-13T07:39:01.380Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 6.352 ms - {} - User: -","timestamp":"2025-07-13T07:39:01.526Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 6.253 ms - {} - User: -","timestamp":"2025-07-13T07:39:02.077Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 7.209 ms - {} - User: -","timestamp":"2025-07-13T07:39:02.412Z"}
{"level":"http","message":"GET /api/cart 304 10.887 ms - {} - User: -","timestamp":"2025-07-13T07:39:10.172Z"}
{"level":"http","message":"GET /api/cart 304 10.093 ms - {} - User: -","timestamp":"2025-07-13T07:39:16.670Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 8.623 ms - {} - User: -","timestamp":"2025-07-13T07:39:16.745Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 9.069 ms - {} - User: -","timestamp":"2025-07-13T07:39:17.191Z"}
{"level":"http","message":"GET /api/cart 304 11.564 ms - {} - User: -","timestamp":"2025-07-13T07:39:24.467Z"}
{"level":"http","message":"GET /api/cart 304 8.103 ms - {} - User: -","timestamp":"2025-07-13T07:39:40.187Z"}
{"level":"http","message":"GET /api/cart 304 15.136 ms - {} - User: -","timestamp":"2025-07-13T07:40:10.180Z"}
{"level":"http","message":"GET /api/cart 304 13.735 ms - {} - User: -","timestamp":"2025-07-13T07:40:40.185Z"}
{"level":"http","message":"GET /api/cart 304 11.509 ms - {} - User: -","timestamp":"2025-07-13T07:40:50.377Z"}
{"level":"http","message":"GET /api/cart 304 6.421 ms - {} - User: -","timestamp":"2025-07-13T07:41:10.180Z"}
{"level":"http","message":"GET /api/cart 304 6.029 ms - {} - User: -","timestamp":"2025-07-13T07:41:40.176Z"}
{"level":"http","message":"GET /api/cart 304 8.852 ms - {} - User: -","timestamp":"2025-07-13T07:41:56.624Z"}
{"level":"http","message":"GET /api/cart 304 7.531 ms - {} - User: -","timestamp":"2025-07-13T07:42:10.182Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 8.821 ms - {} - User: -","timestamp":"2025-07-13T07:42:20.671Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 6.335 ms - {} - User: -","timestamp":"2025-07-13T07:42:21.001Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 6.144 ms - {} - User: -","timestamp":"2025-07-13T07:42:21.142Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 7.760 ms - {} - User: -","timestamp":"2025-07-13T07:42:31.643Z"}
{"level":"http","message":"GET /api/cart 304 6.667 ms - {} - User: -","timestamp":"2025-07-13T07:42:40.177Z"}
{"level":"http","message":"GET /api/cart 304 12.119 ms - {} - User: -","timestamp":"2025-07-13T07:43:10.180Z"}
{"level":"http","message":"GET /api/cart 304 6.035 ms - {} - User: -","timestamp":"2025-07-13T07:43:40.180Z"}
{"level":"http","message":"GET /api/purchase-history 200 9.049 ms - {} - User: -","timestamp":"2025-07-13T07:43:58.434Z"}
{"level":"http","message":"GET /api/cart 304 6.781 ms - {} - User: -","timestamp":"2025-07-13T07:44:10.171Z"}
{"level":"http","message":"GET /api/cart 304 12.904 ms - {} - User: -","timestamp":"2025-07-13T07:44:26.896Z"}
{"level":"http","message":"GET /api/cart 304 10.394 ms - {} - User: -","timestamp":"2025-07-13T07:44:40.766Z"}
{"level":"http","message":"GET /api/cart 304 10.009 ms - {} - User: -","timestamp":"2025-07-13T07:45:10.757Z"}
{"level":"http","message":"GET /api/cart 304 10.355 ms - {} - User: -","timestamp":"2025-07-13T07:45:34.790Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 7.736 ms - {} - User: -","timestamp":"2025-07-13T07:45:35.961Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 6.624 ms - {} - User: -","timestamp":"2025-07-13T07:45:36.133Z"}
{"level":"http","message":"GET /api/cart 304 6.060 ms - {} - User: -","timestamp":"2025-07-13T07:45:40.760Z"}
{"level":"http","message":"GET /api/cart 304 6.837 ms - {} - User: -","timestamp":"2025-07-13T07:46:10.754Z"}
{"level":"http","message":"GET /api/cart 304 6.983 ms - {} - User: -","timestamp":"2025-07-13T07:47:20.755Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 200 10.616 ms - {} - User: -","timestamp":"2025-07-13T07:48:11.777Z"}
{"level":"http","message":"GET /api/cart 304 12.039 ms - {} - User: -","timestamp":"2025-07-13T07:48:20.760Z"}
{"header":"t=1752392907,v1=a0b0d95a17b57e0cf2ead1077d9188be43bb0b9a78f36904878d84d00c2be666,v0=728da90892dd0a9622d9033327d20b1da90c4d50687bd5b47c295c4ce767b3dc","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389353,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":32900000,"amount_total":32900000,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"https://28bc8c954193.ngrok-free.app/api/payment/cancel?order_id=ORD-TEST-1705123456789","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752389198,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752475598,"id":"cs_test_b197FMgamPWhf03ywjMiihS4x7G7fnFT3exFy2cUBny50y60obcwwbu3GZ","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-TEST-1705123456789","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkJimBopfvfSoZm0cJ3ohmz","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"https://28bc8c954193.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-TEST-1705123456789","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkJinBopfvfSoZm2xAEOyBl","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T07:48:28.200Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T07:48:28.204Z"}
{"level":"http","message":"POST /api/payment/webhook 400 6.629 ms - {\"id\":\"evt_1RkJinBopfvfSoZm2xAEOyBl\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752389353,\"data\":{\"object\":{\"id\":\"cs_test_b197FMgamPWhf03ywjMiihS4x7G7fnFT3exFy2cUBny50y60obcwwbu3GZ\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":32900000,\"amount_total\":32900000,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"https://28bc8c954193.ngrok-free.app/api/payment/cancel?order_id=ORD-TEST-1705123456789\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"name\":\"Nguyen Dao\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752389198,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":null,\"state\":\"Hà Nội\"},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyen Dao\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752475598,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-TEST-1705123456789\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkJimBopfvfSoZm0cJ3ohmz\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"https://28bc8c954193.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-TEST-1705123456789\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T07:48:28.206Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 13.957 ms - {} - User: -","timestamp":"2025-07-13T07:48:32.786Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 10.819 ms - {} - User: -","timestamp":"2025-07-13T07:48:42.768Z"}
{"level":"http","message":"GET /api/cart 304 17.729 ms - {} - User: -","timestamp":"2025-07-13T07:48:44.902Z"}
{"level":"http","message":"GET /api/cart 304 19.170 ms - {} - User: -","timestamp":"2025-07-13T07:48:44.923Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 6.674 ms - {} - User: -","timestamp":"2025-07-13T07:48:46.305Z"}
{"level":"http","message":"GET /api/cart 304 16.285 ms - {} - User: -","timestamp":"2025-07-13T07:48:48.222Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 25.756 ms - {} - User: -","timestamp":"2025-07-13T07:48:48.241Z"}
{"level":"http","message":"GET /api/cart 304 14.470 ms - {} - User: -","timestamp":"2025-07-13T07:48:48.242Z"}
{"level":"http","message":"GET /api/cart 304 12.726 ms - {} - User: -","timestamp":"2025-07-13T07:48:48.259Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 18.304 ms - {} - User: -","timestamp":"2025-07-13T07:48:48.261Z"}
{"level":"http","message":"GET /api/cart 304 8.373 ms - {} - User: -","timestamp":"2025-07-13T07:48:48.271Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 13.410 ms - {} - User: -","timestamp":"2025-07-13T07:48:54.774Z"}
{"level":"http","message":"GET /api/cart 304 10.901 ms - {} - User: -","timestamp":"2025-07-13T07:48:55.220Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 7.825 ms - {} - User: -","timestamp":"2025-07-13T07:48:55.940Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 8.773 ms - {} - User: -","timestamp":"2025-07-13T07:48:56.255Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 7.257 ms - {} - User: -","timestamp":"2025-07-13T07:48:56.419Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 6.357 ms - {} - User: -","timestamp":"2025-07-13T07:48:56.549Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 8.960 ms - {} - User: -","timestamp":"2025-07-13T07:48:57.331Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 7.219 ms - {} - User: -","timestamp":"2025-07-13T07:48:58.021Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 6.461 ms - {} - User: -","timestamp":"2025-07-13T07:48:58.176Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 5.913 ms - {} - User: -","timestamp":"2025-07-13T07:48:58.324Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 7.938 ms - {} - User: -","timestamp":"2025-07-13T07:48:58.642Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 6.595 ms - {} - User: -","timestamp":"2025-07-13T07:48:58.790Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 5.490 ms - {} - User: -","timestamp":"2025-07-13T07:48:58.963Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 6.006 ms - {} - User: -","timestamp":"2025-07-13T07:48:59.105Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 6.261 ms - {} - User: -","timestamp":"2025-07-13T07:49:02.737Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 7.980 ms - {} - User: -","timestamp":"2025-07-13T07:49:03.175Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 7.708 ms - {} - User: -","timestamp":"2025-07-13T07:49:03.324Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 8.329 ms - {} - User: -","timestamp":"2025-07-13T07:49:03.481Z"}
{"level":"http","message":"GET /api/products?limit=100 304 45.469 ms - {} - User: guest","timestamp":"2025-07-13T07:49:06.029Z"}
{"level":"http","message":"GET /api/cart 304 45.731 ms - {} - User: -","timestamp":"2025-07-13T07:49:06.034Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 52.139 ms - {} - User: guest","timestamp":"2025-07-13T07:49:06.044Z"}
{"level":"http","message":"GET /api/collections 304 50.690 ms - {} - User: guest","timestamp":"2025-07-13T07:49:06.047Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.538 ms - {} - User: guest","timestamp":"2025-07-13T07:49:06.049Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 0.945 ms - {} - User: guest","timestamp":"2025-07-13T07:49:06.060Z"}
{"level":"http","message":"GET /api/cart 304 27.040 ms - {} - User: -","timestamp":"2025-07-13T07:49:06.080Z"}
{"level":"http","message":"GET /api/collections 304 21.419 ms - {} - User: guest","timestamp":"2025-07-13T07:49:06.083Z"}
{"level":"http","message":"GET /api/wishlist 304 21.815 ms - {} - User: -","timestamp":"2025-07-13T07:49:06.100Z"}
{"level":"http","message":"GET /api/cart 304 15.964 ms - {} - User: -","timestamp":"2025-07-13T07:49:06.105Z"}
{"level":"http","message":"GET /api/cart 304 13.113 ms - {} - User: -","timestamp":"2025-07-13T07:49:06.123Z"}
{"level":"http","message":"GET /api/wishlist 304 20.802 ms - {} - User: -","timestamp":"2025-07-13T07:49:06.127Z"}
{"level":"http","message":"GET /api/wishlist 304 11.822 ms - {} - User: -","timestamp":"2025-07-13T07:49:06.141Z"}
{"level":"http","message":"GET /api/wishlist 304 10.525 ms - {} - User: -","timestamp":"2025-07-13T07:49:06.153Z"}
{"level":"http","message":"GET /api/wishlist 304 7.602 ms - {} - User: -","timestamp":"2025-07-13T07:49:06.161Z"}
{"level":"http","message":"GET /api/wishlist 304 7.915 ms - {} - User: -","timestamp":"2025-07-13T07:49:06.171Z"}
{"level":"http","message":"GET /api/cart 304 9.607 ms - {} - User: -","timestamp":"2025-07-13T07:49:09.296Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 19.274 ms - {} - User: -","timestamp":"2025-07-13T07:49:09.311Z"}
{"level":"http","message":"GET /api/cart 304 9.408 ms - {} - User: -","timestamp":"2025-07-13T07:49:09.313Z"}
{"level":"http","message":"GET /api/cart 304 10.793 ms - {} - User: -","timestamp":"2025-07-13T07:49:09.331Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 21.770 ms - {} - User: -","timestamp":"2025-07-13T07:49:09.336Z"}
{"level":"http","message":"GET /api/cart 304 6.299 ms - {} - User: -","timestamp":"2025-07-13T07:49:09.344Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 6.262 ms - {} - User: -","timestamp":"2025-07-13T07:49:10.087Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 5.676 ms - {} - User: -","timestamp":"2025-07-13T07:49:10.312Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 7.294 ms - {} - User: -","timestamp":"2025-07-13T07:49:10.471Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 6.160 ms - {} - User: -","timestamp":"2025-07-13T07:49:11.083Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 5.869 ms - {} - User: -","timestamp":"2025-07-13T07:49:11.232Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 5.523 ms - {} - User: -","timestamp":"2025-07-13T07:49:11.389Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 5.085 ms - {} - User: -","timestamp":"2025-07-13T07:49:17.531Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 7.826 ms - {} - User: -","timestamp":"2025-07-13T07:49:17.700Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 8.383 ms - {} - User: -","timestamp":"2025-07-13T07:49:17.858Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 9.011 ms - {} - User: -","timestamp":"2025-07-13T07:49:18.296Z"}
{"header":"t=1752392969,v1=c7e81060cdacf0d56726a927fce05e7da9ff5f8c270014dc09e0dd564cb9d8e7,v0=25e546d5736fa06b6849dbcd9113696b4de783e0d9ba6e26f6a21169e1935595","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389353,"data":{"object":{"amount":32900000,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":32900000,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkJimBopfvfSoZm0cJ3ohmz_secret_VzqBSx7wybWW4xk3HGRxzgpcq","confirmation_method":"automatic","created":1752389352,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkJimBopfvfSoZm0cJ3ohmz","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkJimBopfvfSoZm02yHdzC3","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkJimBopfvfSoZmGZQpQTG8","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkJimBopfvfSoZm0PJDoO8j","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"a613428b-c37a-4a4f-bcc6-c4aa6b9b7f72"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T07:49:29.886Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T07:49:29.888Z"}
{"level":"http","message":"POST /api/payment/webhook 400 3.459 ms - {\"id\":\"evt_3RkJimBopfvfSoZm0PJDoO8j\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752389353,\"data\":{\"object\":{\"id\":\"pi_3RkJimBopfvfSoZm0cJ3ohmz\",\"object\":\"payment_intent\",\"amount\":32900000,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":32900000,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkJimBopfvfSoZm0cJ3ohmz_secret_VzqBSx7wybWW4xk3HGRxzgpcq\",\"confirmation_method\":\"automatic\",\"created\":1752389352,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkJimBopfvfSoZm02yHdzC3\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkJimBopfvfSoZmGZQpQTG8\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"a613428b-c37a-4a4f-bcc6-c4aa6b9b7f72\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T07:49:29.889Z"}
{"level":"http","message":"GET /api/cart 304 47.597 ms - {} - User: -","timestamp":"2025-07-13T07:49:31.119Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 6.922 ms - {} - User: -","timestamp":"2025-07-13T07:49:31.918Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 7.318 ms - {} - User: -","timestamp":"2025-07-13T07:49:32.242Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 9.345 ms - {} - User: -","timestamp":"2025-07-13T07:49:32.410Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 7.816 ms - {} - User: -","timestamp":"2025-07-13T07:49:33.054Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 5.657 ms - {} - User: -","timestamp":"2025-07-13T07:49:33.238Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 8.214 ms - {} - User: -","timestamp":"2025-07-13T07:49:33.415Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 8.753 ms - {} - User: -","timestamp":"2025-07-13T07:49:33.581Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 5.775 ms - {} - User: -","timestamp":"2025-07-13T07:49:33.727Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 5.563 ms - {} - User: -","timestamp":"2025-07-13T07:49:34.444Z"}
{"level":"http","message":"GET /api/cart 304 14.070 ms - {} - User: -","timestamp":"2025-07-13T07:49:37.994Z"}
{"level":"http","message":"GET /api/cart 304 4.903 ms - {} - User: -","timestamp":"2025-07-13T07:49:39.746Z"}
{"level":"http","message":"GET /api/cart 304 14.144 ms - {} - User: -","timestamp":"2025-07-13T07:50:09.765Z"}
{"level":"http","message":"GET /api/cart 304 20.124 ms - {} - User: -","timestamp":"2025-07-13T07:50:16.383Z"}
{"level":"http","message":"GET /api/cart 304 12.277 ms - {} - User: -","timestamp":"2025-07-13T07:50:17.689Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 27.489 ms - {} - User: -","timestamp":"2025-07-13T07:50:17.711Z"}
{"level":"http","message":"GET /api/cart 304 14.360 ms - {} - User: -","timestamp":"2025-07-13T07:50:17.712Z"}
{"level":"http","message":"GET /api/cart 304 9.886 ms - {} - User: -","timestamp":"2025-07-13T07:50:17.728Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 17.637 ms - {} - User: -","timestamp":"2025-07-13T07:50:17.732Z"}
{"level":"http","message":"GET /api/cart 304 6.328 ms - {} - User: -","timestamp":"2025-07-13T07:50:17.741Z"}
{"level":"http","message":"GET /api/cart 304 8.112 ms - {} - User: -","timestamp":"2025-07-13T07:50:25.893Z"}
{"level":"http","message":"GET /api/cart 304 9.802 ms - {} - User: -","timestamp":"2025-07-13T07:50:26.141Z"}
{"level":"http","message":"GET /api/cart 304 13.678 ms - {} - User: -","timestamp":"2025-07-13T07:50:26.170Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 33.424 ms - {} - User: -","timestamp":"2025-07-13T07:50:26.176Z"}
{"level":"http","message":"GET /api/cart 304 15.135 ms - {} - User: -","timestamp":"2025-07-13T07:50:26.194Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 22.623 ms - {} - User: -","timestamp":"2025-07-13T07:50:26.209Z"}
{"level":"http","message":"GET /api/cart 304 11.026 ms - {} - User: -","timestamp":"2025-07-13T07:50:26.214Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 9.589 ms - {} - User: -","timestamp":"2025-07-13T07:50:26.829Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 9.301 ms - {} - User: -","timestamp":"2025-07-13T07:50:27.229Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 8.296 ms - {} - User: -","timestamp":"2025-07-13T07:50:27.367Z"}
{"level":"http","message":"GET /api/cart 304 10.165 ms - {} - User: -","timestamp":"2025-07-13T07:50:35.495Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 9.035 ms - {} - User: -","timestamp":"2025-07-13T07:50:35.577Z"}
{"level":"http","message":"GET /api/cart 304 8.020 ms - {} - User: -","timestamp":"2025-07-13T07:50:56.758Z"}
{"level":"http","message":"GET /api/cart 304 6.736 ms - {} - User: -","timestamp":"2025-07-13T07:51:13.105Z"}
{"level":"http","message":"GET /api/cart 304 10.653 ms - {} - User: -","timestamp":"2025-07-13T07:51:19.507Z"}
{"level":"http","message":"GET /api/cart 304 7.712 ms - {} - User: -","timestamp":"2025-07-13T07:51:26.159Z"}
{"level":"http","message":"GET /api/cart 304 8.393 ms - {} - User: -","timestamp":"2025-07-13T07:51:56.159Z"}
{"level":"http","message":"GET /api/cart 304 8.201 ms - {} - User: -","timestamp":"2025-07-13T07:52:26.167Z"}
{"level":"http","message":"GET /api/cart 304 8.584 ms - {} - User: -","timestamp":"2025-07-13T07:52:56.160Z"}
{"level":"http","message":"GET /api/cart 304 7.691 ms - {} - User: -","timestamp":"2025-07-13T07:53:26.161Z"}
{"level":"http","message":"GET /api/cart 304 8.866 ms - {} - User: -","timestamp":"2025-07-13T07:53:56.165Z"}
{"header":"t=1752393259,v1=e1a716fda259133551174a835b5bc8f1ac191a7e7411751e3399347dc19f387a,v0=28a86aa6e5ce0f7deb1a7a8e06d96192c11d567382b8c565c5d621bf694f8ba4","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389714,"data":{"object":{"amount":32900000,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":32900000,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkJobBopfvfSoZm2IA8nTOk_secret_Kuo7jTpZYKEoHqJB4p6iY2G9l","confirmation_method":"automatic","created":1752389713,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkJobBopfvfSoZm2IA8nTOk","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkJobBopfvfSoZm2NAcR4Mq","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkJobBopfvfSoZmWwngUPKv","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkJobBopfvfSoZm23vDoMOk","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"a1abce98-d185-49d8-ab0a-3bb1c42ed4cd"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T07:54:20.642Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T07:54:20.644Z"}
{"level":"http","message":"POST /api/payment/webhook 400 3.943 ms - {\"id\":\"evt_3RkJobBopfvfSoZm23vDoMOk\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752389714,\"data\":{\"object\":{\"id\":\"pi_3RkJobBopfvfSoZm2IA8nTOk\",\"object\":\"payment_intent\",\"amount\":32900000,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":32900000,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkJobBopfvfSoZm2IA8nTOk_secret_Kuo7jTpZYKEoHqJB4p6iY2G9l\",\"confirmation_method\":\"automatic\",\"created\":1752389713,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkJobBopfvfSoZm2NAcR4Mq\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkJobBopfvfSoZmWwngUPKv\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"a1abce98-d185-49d8-ab0a-3bb1c42ed4cd\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T07:54:20.645Z"}
{"level":"http","message":"GET /api/cart 304 7.605 ms - {} - User: -","timestamp":"2025-07-13T07:54:26.160Z"}
{"level":"http","message":"GET /api/cart 304 7.314 ms - {} - User: -","timestamp":"2025-07-13T07:54:56.158Z"}
{"header":"t=1752393302,v1=1c39ad22d32f65ad515dbc5fb46aa09f602a4c9dd03c5cebf78dca2ef9a76c32,v0=a8bfe3282d1a32042b176a1e756c1276749cdd39435336eb904422a573783734","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389714,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":32900000,"amount_total":32900000,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"https://28bc8c954193.ngrok-free.app/api/payment/cancel?order_id=ORD-TEST-1705123456781","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752389600,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752475999,"id":"cs_test_b1nrH9oLBoI3E21AtiRRbgPNnNK8lkMiqqCXk3wg11U9B9zVYHZ9UjUs26","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-TEST-1705123456781","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkJobBopfvfSoZm2IA8nTOk","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"https://28bc8c954193.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-TEST-1705123456781","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkJocBopfvfSoZmKTkpJD72","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T07:55:03.410Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T07:55:03.415Z"}
{"level":"http","message":"POST /api/payment/webhook 400 7.173 ms - {\"id\":\"evt_1RkJocBopfvfSoZmKTkpJD72\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752389714,\"data\":{\"object\":{\"id\":\"cs_test_b1nrH9oLBoI3E21AtiRRbgPNnNK8lkMiqqCXk3wg11U9B9zVYHZ9UjUs26\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":32900000,\"amount_total\":32900000,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"https://28bc8c954193.ngrok-free.app/api/payment/cancel?order_id=ORD-TEST-1705123456781\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"name\":\"Nguyen Dao\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752389600,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":null,\"state\":\"Hà Nội\"},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyen Dao\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752475999,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-TEST-1705123456781\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkJobBopfvfSoZm2IA8nTOk\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"https://28bc8c954193.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-TEST-1705123456781\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T07:55:03.417Z"}
{"level":"http","message":"GET /api/cart 304 8.703 ms - {} - User: -","timestamp":"2025-07-13T07:55:26.160Z"}
{"level":"http","message":"GET /api/cart 304 7.625 ms - {} - User: -","timestamp":"2025-07-13T07:55:56.161Z"}
{"level":"http","message":"GET /api/cart 304 7.918 ms - {} - User: -","timestamp":"2025-07-13T07:56:26.159Z"}
{"level":"http","message":"GET /api/cart 304 10.823 ms - {} - User: -","timestamp":"2025-07-13T07:56:56.171Z"}
{"level":"http","message":"GET /api/cart 304 7.842 ms - {} - User: -","timestamp":"2025-07-13T07:57:26.163Z"}
{"level":"http","message":"GET /api/cart 304 7.915 ms - {} - User: -","timestamp":"2025-07-13T07:57:56.157Z"}
{"level":"http","message":"GET /api/cart 304 7.603 ms - {} - User: -","timestamp":"2025-07-13T07:58:26.155Z"}
{"level":"http","message":"GET /api/cart 304 8.330 ms - {} - User: -","timestamp":"2025-07-13T07:58:56.159Z"}
{"level":"http","message":"GET /api/cart 304 6.634 ms - {} - User: -","timestamp":"2025-07-13T07:59:26.153Z"}
{"level":"http","message":"GET /api/cart 304 8.763 ms - {} - User: -","timestamp":"2025-07-13T07:59:56.170Z"}
{"level":"http","message":"GET /api/cart 304 9.499 ms - {} - User: -","timestamp":"2025-07-13T08:00:26.164Z"}
{"level":"http","message":"GET /api/cart 304 12.122 ms - {} - User: -","timestamp":"2025-07-13T08:00:56.162Z"}
{"level":"http","message":"GET /api/cart 304 8.449 ms - {} - User: -","timestamp":"2025-07-13T08:01:26.167Z"}
{"level":"http","message":"GET /api/cart 304 7.267 ms - {} - User: -","timestamp":"2025-07-13T08:01:56.168Z"}
{"level":"http","message":"GET /api/cart 304 8.462 ms - {} - User: -","timestamp":"2025-07-13T08:02:26.765Z"}
{"level":"http","message":"GET /api/cart 304 7.086 ms - {} - User: -","timestamp":"2025-07-13T08:02:56.749Z"}
{"level":"http","message":"GET /api/cart 304 7.881 ms - {} - User: -","timestamp":"2025-07-13T08:03:57.753Z"}
{"level":"http","message":"GET /api/cart 304 7.530 ms - {} - User: -","timestamp":"2025-07-13T08:04:58.763Z"}
{"level":"http","message":"GET /api/cart 304 15.000 ms - {} - User: -","timestamp":"2025-07-13T08:05:42.374Z"}
{"level":"http","message":"GET /api/cart 304 12.147 ms - {} - User: -","timestamp":"2025-07-13T08:05:42.395Z"}
{"level":"http","message":"GET /api/cart 304 17.538 ms - {} - User: -","timestamp":"2025-07-13T08:05:42.415Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 25.791 ms - {} - User: -","timestamp":"2025-07-13T08:05:42.437Z"}
{"level":"http","message":"GET /api/cart 304 17.809 ms - {} - User: -","timestamp":"2025-07-13T08:05:42.440Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 14.652 ms - {} - User: -","timestamp":"2025-07-13T08:05:42.456Z"}
{"level":"http","message":"GET /api/cart 304 9.035 ms - {} - User: -","timestamp":"2025-07-13T08:06:04.230Z"}
{"level":"http","message":"GET /api/cart 304 13.093 ms - {} - User: -","timestamp":"2025-07-13T08:06:04.248Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 20.872 ms - {} - User: -","timestamp":"2025-07-13T08:06:04.253Z"}
{"level":"http","message":"GET /api/cart 304 12.565 ms - {} - User: -","timestamp":"2025-07-13T08:06:04.267Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 18.838 ms - {} - User: -","timestamp":"2025-07-13T08:06:04.278Z"}
{"level":"http","message":"GET /api/cart 304 10.591 ms - {} - User: -","timestamp":"2025-07-13T08:06:04.284Z"}
{"level":"http","message":"GET /api/cart 304 9.328 ms - {} - User: -","timestamp":"2025-07-13T08:06:18.144Z"}
{"level":"http","message":"GET /api/cart 304 12.142 ms - {} - User: -","timestamp":"2025-07-13T08:06:18.161Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 20.162 ms - {} - User: -","timestamp":"2025-07-13T08:06:18.172Z"}
{"level":"http","message":"GET /api/cart 304 13.820 ms - {} - User: -","timestamp":"2025-07-13T08:06:18.181Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 20.073 ms - {} - User: -","timestamp":"2025-07-13T08:06:18.195Z"}
{"level":"http","message":"GET /api/cart 304 13.197 ms - {} - User: -","timestamp":"2025-07-13T08:06:18.198Z"}
{"level":"http","message":"GET /api/cart 304 9.321 ms - {} - User: -","timestamp":"2025-07-13T08:06:20.251Z"}
{"level":"http","message":"GET /api/cart 304 14.468 ms - {} - User: -","timestamp":"2025-07-13T08:06:20.267Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 21.141 ms - {} - User: -","timestamp":"2025-07-13T08:06:20.277Z"}
{"level":"http","message":"GET /api/cart 304 16.640 ms - {} - User: -","timestamp":"2025-07-13T08:06:20.288Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 23.295 ms - {} - User: -","timestamp":"2025-07-13T08:06:20.307Z"}
{"level":"http","message":"GET /api/cart 304 16.329 ms - {} - User: -","timestamp":"2025-07-13T08:06:20.309Z"}
{"level":"http","message":"GET /api/cart 304 22.494 ms - {} - User: -","timestamp":"2025-07-13T08:06:50.058Z"}
{"level":"http","message":"GET /api/cart 304 7.639 ms - {} - User: -","timestamp":"2025-07-13T08:06:50.283Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 10.367 ms - {} - User: -","timestamp":"2025-07-13T08:06:52.407Z"}
{"level":"http","message":"GET /api/cart 304 6.501 ms - {} - User: -","timestamp":"2025-07-13T08:07:20.755Z"}
{"level":"http","message":"GET /api/cart 304 8.191 ms - {} - User: -","timestamp":"2025-07-13T08:07:50.760Z"}
{"level":"http","message":"GET /api/cart 304 8.360 ms - {} - User: -","timestamp":"2025-07-13T08:08:20.283Z"}
{"level":"http","message":"GET /api/cart 304 7.403 ms - {} - User: -","timestamp":"2025-07-13T08:08:50.760Z"}
{"level":"http","message":"GET /api/cart 304 8.169 ms - {} - User: -","timestamp":"2025-07-13T08:09:20.768Z"}
{"level":"http","message":"GET /api/cart 304 8.633 ms - {} - User: -","timestamp":"2025-07-13T08:09:50.764Z"}
{"level":"http","message":"GET /api/cart 304 8.903 ms - {} - User: -","timestamp":"2025-07-13T08:10:20.764Z"}
{"level":"http","message":"GET /api/cart 304 6.712 ms - {} - User: -","timestamp":"2025-07-13T08:11:20.747Z"}
{"level":"http","message":"GET /api/cart 304 10.389 ms - {} - User: -","timestamp":"2025-07-13T08:12:02.872Z"}
{"level":"http","message":"GET /api/cart 304 8.418 ms - {} - User: -","timestamp":"2025-07-13T08:12:20.754Z"}
{"level":"http","message":"GET /api/cart 304 11.012 ms - {} - User: -","timestamp":"2025-07-13T08:12:41.628Z"}
{"level":"http","message":"GET /api/cart 304 13.308 ms - {} - User: -","timestamp":"2025-07-13T08:12:41.648Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 20.035 ms - {} - User: -","timestamp":"2025-07-13T08:12:41.650Z"}
{"level":"http","message":"GET /api/cart 304 19.219 ms - {} - User: -","timestamp":"2025-07-13T08:12:41.671Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 27.653 ms - {} - User: -","timestamp":"2025-07-13T08:12:41.686Z"}
{"level":"http","message":"GET /api/cart 304 14.537 ms - {} - User: -","timestamp":"2025-07-13T08:12:41.692Z"}
{"level":"http","message":"GET /api/cart 304 10.059 ms - {} - User: -","timestamp":"2025-07-13T08:12:43.233Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 7.302 ms - {} - User: -","timestamp":"2025-07-13T08:12:43.346Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 18.046 ms - {} - User: -","timestamp":"2025-07-13T08:12:44.607Z"}
{"level":"http","message":"GET /api/cart 304 9.410 ms - {} - User: -","timestamp":"2025-07-13T08:12:53.421Z"}
{"level":"http","message":"GET /api/cart 304 8.440 ms - {} - User: -","timestamp":"2025-07-13T08:12:53.694Z"}
{"level":"http","message":"GET /api/cart 304 15.097 ms - {} - User: -","timestamp":"2025-07-13T08:12:53.716Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 22.504 ms - {} - User: -","timestamp":"2025-07-13T08:12:53.718Z"}
{"level":"http","message":"GET /api/cart 304 22.319 ms - {} - User: -","timestamp":"2025-07-13T08:12:53.743Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 30.964 ms - {} - User: -","timestamp":"2025-07-13T08:12:53.758Z"}
{"level":"http","message":"GET /api/cart 304 11.305 ms - {} - User: -","timestamp":"2025-07-13T08:12:53.762Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 8.257 ms - {} - User: -","timestamp":"2025-07-13T08:12:55.003Z"}
{"level":"http","message":"GET /api/cart 304 6.529 ms - {} - User: -","timestamp":"2025-07-13T08:13:23.722Z"}
{"level":"http","message":"GET /api/cart 304 7.956 ms - {} - User: -","timestamp":"2025-07-13T08:13:53.719Z"}
{"level":"http","message":"GET /api/cart 304 16.770 ms - {} - User: -","timestamp":"2025-07-13T08:13:58.447Z"}
{"level":"http","message":"GET /api/cart 304 15.492 ms - {} - User: -","timestamp":"2025-07-13T08:14:08.453Z"}
{"level":"http","message":"GET /api/cart 304 17.916 ms - {} - User: -","timestamp":"2025-07-13T08:14:23.725Z"}
{"level":"http","message":"GET /api/purchase-history/ORD-2025-001 401 1.448 ms - {} - User: guest","timestamp":"2025-07-13T08:14:24.514Z"}
{"level":"http","message":"GET /api/cart 304 10.213 ms - {} - User: -","timestamp":"2025-07-13T08:14:24.525Z"}
{"level":"http","message":"GET /favicon.ico 404 0.780 ms - {} - User: guest","timestamp":"2025-07-13T08:14:24.569Z"}
{"level":"http","message":"GET /.well-known/appspecific/com.chrome.devtools.json 404 0.768 ms - {} - User: guest","timestamp":"2025-07-13T08:14:24.595Z"}
{"level":"http","message":"GET /api/purchase-history/ORD-2025-001 401 2.195 ms - {} - User: guest","timestamp":"2025-07-13T08:22:53.789Z"}
{"level":"http","message":"GET /.well-known/appspecific/com.chrome.devtools.json 404 0.570 ms - {} - User: guest","timestamp":"2025-07-13T08:22:53.828Z"}
{"level":"http","message":"GET /api/purchase-history/ORD-2025-001 401 1.735 ms - {} - User: guest","timestamp":"2025-07-13T08:22:54.988Z"}
{"level":"http","message":"GET /.well-known/appspecific/com.chrome.devtools.json 404 1.586 ms - {} - User: guest","timestamp":"2025-07-13T08:22:55.020Z"}
{"level":"http","message":"GET /api/cart 304 15.651 ms - {} - User: -","timestamp":"2025-07-13T08:22:57.137Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 30.097 ms - {} - User: -","timestamp":"2025-07-13T08:22:57.161Z"}
{"level":"http","message":"GET /api/cart 304 22.733 ms - {} - User: -","timestamp":"2025-07-13T08:22:57.168Z"}
{"level":"http","message":"GET /api/cart 304 35.125 ms - {} - User: -","timestamp":"2025-07-13T08:22:57.214Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 46.930 ms - {} - User: -","timestamp":"2025-07-13T08:22:57.220Z"}
{"level":"http","message":"GET /api/cart 304 16.986 ms - {} - User: -","timestamp":"2025-07-13T08:22:57.239Z"}
{"level":"http","message":"GET /api/purchase-history/68712454f8448f7905940cbc 400 8.901 ms - {} - User: -","timestamp":"2025-07-13T08:22:58.332Z"}
{"level":"http","message":"GET /api/cart 304 9.451 ms - {} - User: -","timestamp":"2025-07-13T08:23:08.011Z"}
{"level":"http","message":"GET /api/cart 304 8.055 ms - {} - User: -","timestamp":"2025-07-13T08:23:08.305Z"}
{"level":"http","message":"GET /api/cart 304 26.776 ms - {} - User: -","timestamp":"2025-07-13T08:23:08.339Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 41.994 ms - {} - User: -","timestamp":"2025-07-13T08:23:08.348Z"}
{"level":"http","message":"GET /api/cart 304 23.449 ms - {} - User: -","timestamp":"2025-07-13T08:23:08.378Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 27.195 ms - {} - User: -","timestamp":"2025-07-13T08:23:08.390Z"}
{"level":"http","message":"GET /api/cart 304 14.682 ms - {} - User: -","timestamp":"2025-07-13T08:23:08.399Z"}
{"level":"http","message":"GET /api/purchase-history/ORD-2025-001 200 12.185 ms - {} - User: -","timestamp":"2025-07-13T08:23:09.850Z"}
{"level":"http","message":"GET /api/cart 304 12.544 ms - {} - User: -","timestamp":"2025-07-13T08:25:28.989Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 19.937 ms - {} - User: -","timestamp":"2025-07-13T08:25:29.005Z"}
{"level":"http","message":"GET /api/cart 304 11.614 ms - {} - User: -","timestamp":"2025-07-13T08:25:29.006Z"}
{"level":"http","message":"GET /api/cart 304 19.915 ms - {} - User: -","timestamp":"2025-07-13T08:25:29.040Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 36.429 ms - {} - User: -","timestamp":"2025-07-13T08:25:29.045Z"}
{"level":"http","message":"GET /api/cart 304 7.039 ms - {} - User: -","timestamp":"2025-07-13T08:25:29.053Z"}
{"level":"http","message":"GET /api/purchase-history/ORD-2025-001 304 10.167 ms - {} - User: -","timestamp":"2025-07-13T08:25:30.792Z"}
{"level":"http","message":"GET /api/cart 304 8.017 ms - {} - User: -","timestamp":"2025-07-13T08:25:59.004Z"}
{"level":"http","message":"GET /api/cart 304 8.104 ms - {} - User: -","timestamp":"2025-07-13T08:26:04.877Z"}
{"level":"http","message":"GET /api/cart 304 8.333 ms - {} - User: -","timestamp":"2025-07-13T08:26:29.760Z"}
{"level":"http","message":"GET /api/cart 304 7.254 ms - {} - User: -","timestamp":"2025-07-13T08:26:59.760Z"}
{"level":"http","message":"GET /api/cart 304 6.851 ms - {} - User: -","timestamp":"2025-07-13T08:27:29.750Z"}
{"level":"http","message":"GET /api/cart 304 6.834 ms - {} - User: -","timestamp":"2025-07-13T08:27:59.749Z"}
{"level":"http","message":"GET /api/cart 304 7.106 ms - {} - User: -","timestamp":"2025-07-13T08:28:29.758Z"}
{"level":"http","message":"GET /api/cart 304 8.603 ms - {} - User: -","timestamp":"2025-07-13T08:28:59.752Z"}
{"level":"http","message":"GET /api/cart 304 7.668 ms - {} - User: -","timestamp":"2025-07-13T08:30:00.760Z"}
{"level":"http","message":"GET /api/cart 304 12.694 ms - {} - User: -","timestamp":"2025-07-13T08:30:45.102Z"}
{"level":"http","message":"GET /api/cart 304 15.468 ms - {} - User: -","timestamp":"2025-07-13T08:30:45.129Z"}
{"level":"http","message":"GET /api/cart 304 7.907 ms - {} - User: -","timestamp":"2025-07-13T08:30:59.008Z"}
{"level":"http","message":"GET /api/cart 304 17.046 ms - {} - User: -","timestamp":"2025-07-13T08:31:17.769Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 26.651 ms - {} - User: -","timestamp":"2025-07-13T08:31:17.790Z"}
{"level":"http","message":"GET /api/cart 304 16.735 ms - {} - User: -","timestamp":"2025-07-13T08:31:17.794Z"}
{"level":"http","message":"GET /api/cart 304 21.564 ms - {} - User: -","timestamp":"2025-07-13T08:31:17.823Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 31.507 ms - {} - User: -","timestamp":"2025-07-13T08:31:17.828Z"}
{"level":"http","message":"GET /api/cart 304 9.460 ms - {} - User: -","timestamp":"2025-07-13T08:31:17.840Z"}
{"level":"http","message":"GET /api/cart 304 13.699 ms - {} - User: -","timestamp":"2025-07-13T08:31:20.526Z"}
{"level":"http","message":"GET /api/cart 304 30.040 ms - {} - User: -","timestamp":"2025-07-13T08:31:30.860Z"}
{"level":"http","message":"GET /api/products?limit=100 304 63.678 ms - {} - User: guest","timestamp":"2025-07-13T08:31:30.899Z"}
{"level":"http","message":"GET /api/collections 304 66.292 ms - {} - User: guest","timestamp":"2025-07-13T08:31:30.914Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 77.827 ms - {} - User: guest","timestamp":"2025-07-13T08:31:30.922Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.219 ms - {} - User: guest","timestamp":"2025-07-13T08:31:30.924Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.370 ms - {} - User: guest","timestamp":"2025-07-13T08:31:30.943Z"}
{"level":"http","message":"GET /api/cart 304 53.300 ms - {} - User: -","timestamp":"2025-07-13T08:31:30.953Z"}
{"level":"http","message":"GET /api/collections 304 32.800 ms - {} - User: guest","timestamp":"2025-07-13T08:31:30.967Z"}
{"level":"http","message":"GET /api/cart 304 13.223 ms - {} - User: -","timestamp":"2025-07-13T08:31:30.976Z"}
{"level":"http","message":"GET /api/cart 304 7.571 ms - {} - User: -","timestamp":"2025-07-13T08:31:30.986Z"}
{"level":"http","message":"GET /api/wishlist 304 16.212 ms - {} - User: -","timestamp":"2025-07-13T08:31:31.012Z"}
{"level":"http","message":"GET /api/wishlist 304 10.828 ms - {} - User: -","timestamp":"2025-07-13T08:31:31.024Z"}
{"level":"http","message":"GET /api/wishlist 304 9.615 ms - {} - User: -","timestamp":"2025-07-13T08:31:31.036Z"}
{"level":"http","message":"GET /api/wishlist 304 12.738 ms - {} - User: -","timestamp":"2025-07-13T08:31:31.053Z"}
{"level":"http","message":"GET /api/wishlist 304 15.818 ms - {} - User: -","timestamp":"2025-07-13T08:31:31.072Z"}
{"level":"http","message":"GET /api/wishlist 304 13.095 ms - {} - User: -","timestamp":"2025-07-13T08:31:31.086Z"}
{"level":"http","message":"GET /api/cart 304 8.718 ms - {} - User: -","timestamp":"2025-07-13T08:31:33.921Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 6.008 ms - {} - User: guest","timestamp":"2025-07-13T08:31:33.925Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.766 ms - {} - User: guest","timestamp":"2025-07-13T08:31:33.931Z"}
{"level":"http","message":"GET /api/cart 304 8.190 ms - {} - User: -","timestamp":"2025-07-13T08:31:33.934Z"}
{"level":"http","message":"GET /api/cart 304 7.964 ms - {} - User: -","timestamp":"2025-07-13T08:31:33.944Z"}
{"level":"http","message":"GET /api/cart 304 8.902 ms - {} - User: -","timestamp":"2025-07-13T08:31:33.955Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 14.560 ms - {} - User: guest","timestamp":"2025-07-13T08:31:33.995Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 1.485 ms - {} - User: guest","timestamp":"2025-07-13T08:31:34.022Z"}
{"level":"http","message":"POST /api/cart/add 200 22.836 ms - {\"productId\":\"NC10VNA1\",\"sizeIndex\":0,\"quantity\":1} - User: -","timestamp":"2025-07-13T08:31:36.192Z"}
{"level":"http","message":"GET /api/cart 200 10.254 ms - {} - User: -","timestamp":"2025-07-13T08:31:38.935Z"}
{"level":"http","message":"GET /api/products/K18K 200 3.377 ms - {} - User: guest","timestamp":"2025-07-13T08:31:44.745Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 0.640 ms - {} - User: guest","timestamp":"2025-07-13T08:31:44.785Z"}
{"level":"http","message":"POST /api/cart/add 200 17.574 ms - {\"productId\":\"K18K\",\"sizeIndex\":0,\"quantity\":1} - User: -","timestamp":"2025-07-13T08:31:47.509Z"}
{"level":"http","message":"GET /api/cart 200 9.183 ms - {} - User: -","timestamp":"2025-07-13T08:31:48.712Z"}
{"level":"http","message":"GET /api/cart 304 7.904 ms - {} - User: -","timestamp":"2025-07-13T08:31:51.027Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.817 ms - {} - User: guest","timestamp":"2025-07-13T08:31:51.030Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.561 ms - {} - User: guest","timestamp":"2025-07-13T08:31:51.037Z"}
{"level":"http","message":"GET /api/cart 304 10.877 ms - {} - User: -","timestamp":"2025-07-13T08:31:51.042Z"}
{"level":"http","message":"GET /api/cart 304 7.942 ms - {} - User: -","timestamp":"2025-07-13T08:31:51.052Z"}
{"level":"http","message":"GET /api/cart 304 7.944 ms - {} - User: -","timestamp":"2025-07-13T08:31:51.062Z"}
{"level":"http","message":"GET /api/cart 304 6.512 ms - {} - User: -","timestamp":"2025-07-13T08:31:51.070Z"}
{"level":"http","message":"GET /api/cart 304 7.973 ms - {} - User: -","timestamp":"2025-07-13T08:31:51.080Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.708 ms - {} - User: guest","timestamp":"2025-07-13T08:31:51.118Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.719 ms - {} - User: guest","timestamp":"2025-07-13T08:31:51.120Z"}
{"level":"http","message":"GET /api/products/K18K 304 2.285 ms - {} - User: guest","timestamp":"2025-07-13T08:31:51.126Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.605 ms - {} - User: guest","timestamp":"2025-07-13T08:31:51.150Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.724 ms - {} - User: guest","timestamp":"2025-07-13T08:31:51.175Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.702 ms - {} - User: guest","timestamp":"2025-07-13T08:31:51.207Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.719 ms - {} - User: guest","timestamp":"2025-07-13T08:31:51.236Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.649 ms - {} - User: guest","timestamp":"2025-07-13T08:31:51.285Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.783 ms - {} - User: guest","timestamp":"2025-07-13T08:31:51.319Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.764 ms - {} - User: guest","timestamp":"2025-07-13T08:31:51.323Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.660 ms - {} - User: guest","timestamp":"2025-07-13T08:31:51.327Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.950 ms - {} - User: guest","timestamp":"2025-07-13T08:31:51.333Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.799 ms - {} - User: guest","timestamp":"2025-07-13T08:31:51.336Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.896 ms - {} - User: guest","timestamp":"2025-07-13T08:31:51.364Z"}
{"level":"http","message":"GET /api/cart 304 17.607 ms - {} - User: -","timestamp":"2025-07-13T08:32:21.059Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.727 ms - {} - User: guest","timestamp":"2025-07-13T08:32:21.125Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.569 ms - {} - User: guest","timestamp":"2025-07-13T08:32:21.156Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.371 ms - {} - User: guest","timestamp":"2025-07-13T08:32:32.408Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.037 ms - {} - User: guest","timestamp":"2025-07-13T08:32:32.414Z"}
{"level":"http","message":"GET /api/cart 304 16.920 ms - {} - User: -","timestamp":"2025-07-13T08:32:32.419Z"}
{"level":"http","message":"GET /api/products?limit=100 304 2.203 ms - {} - User: guest","timestamp":"2025-07-13T08:32:32.423Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 0.919 ms - {} - User: guest","timestamp":"2025-07-13T08:32:32.426Z"}
{"level":"http","message":"GET /api/collections 304 19.938 ms - {} - User: guest","timestamp":"2025-07-13T08:32:32.435Z"}
{"level":"http","message":"GET /api/cart 304 14.680 ms - {} - User: -","timestamp":"2025-07-13T08:32:32.445Z"}
{"level":"http","message":"GET /api/collections 304 19.880 ms - {} - User: guest","timestamp":"2025-07-13T08:32:32.460Z"}
{"level":"http","message":"GET /api/cart 304 15.895 ms - {} - User: -","timestamp":"2025-07-13T08:32:32.465Z"}
{"level":"http","message":"GET /api/cart 304 8.296 ms - {} - User: -","timestamp":"2025-07-13T08:32:32.476Z"}
{"level":"http","message":"GET /api/wishlist 304 13.841 ms - {} - User: -","timestamp":"2025-07-13T08:32:32.572Z"}
{"level":"http","message":"GET /api/wishlist 304 10.788 ms - {} - User: -","timestamp":"2025-07-13T08:32:32.585Z"}
{"level":"http","message":"GET /api/wishlist 304 10.082 ms - {} - User: -","timestamp":"2025-07-13T08:32:32.596Z"}
{"level":"http","message":"GET /api/wishlist 304 10.771 ms - {} - User: -","timestamp":"2025-07-13T08:32:32.608Z"}
{"level":"http","message":"GET /api/wishlist 304 9.704 ms - {} - User: -","timestamp":"2025-07-13T08:32:32.620Z"}
{"level":"http","message":"GET /api/wishlist 304 13.860 ms - {} - User: -","timestamp":"2025-07-13T08:32:32.637Z"}
{"level":"http","message":"GET /api/cart 304 9.276 ms - {} - User: -","timestamp":"2025-07-13T08:33:02.432Z"}
{"level":"http","message":"GET /api/cart 304 18.264 ms - {} - User: -","timestamp":"2025-07-13T08:33:29.930Z"}
{"level":"http","message":"GET /api/auth/profile 200 20.183 ms - {} - User: -","timestamp":"2025-07-13T08:33:29.945Z"}
{"level":"http","message":"GET /api/cart 304 27.619 ms - {} - User: -","timestamp":"2025-07-13T08:33:29.965Z"}
{"level":"http","message":"GET /api/auth/profile 304 18.642 ms - {} - User: -","timestamp":"2025-07-13T08:33:29.977Z"}
{"level":"http","message":"GET /api/cart 304 11.413 ms - {} - User: -","timestamp":"2025-07-13T08:33:29.984Z"}
{"level":"http","message":"GET /api/cart 304 8.751 ms - {} - User: -","timestamp":"2025-07-13T08:33:29.996Z"}
{"level":"http","message":"GET /api/cart 304 8.041 ms - {} - User: -","timestamp":"2025-07-13T08:33:59.949Z"}
{"level":"http","message":"GET /api/cart 304 7.824 ms - {} - User: -","timestamp":"2025-07-13T08:34:29.935Z"}
{"level":"http","message":"GET /api/cart 304 9.333 ms - {} - User: -","timestamp":"2025-07-13T08:34:59.951Z"}
{"level":"http","message":"GET /api/cart 304 7.722 ms - {} - User: -","timestamp":"2025-07-13T08:35:29.937Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.837 ms - {} - User: guest","timestamp":"2025-07-13T08:35:54.025Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.258 ms - {} - User: guest","timestamp":"2025-07-13T08:35:54.031Z"}
{"level":"http","message":"GET /api/cart 304 16.707 ms - {} - User: -","timestamp":"2025-07-13T08:35:54.036Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.120 ms - {} - User: guest","timestamp":"2025-07-13T08:35:54.039Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 0.963 ms - {} - User: guest","timestamp":"2025-07-13T08:35:54.041Z"}
{"level":"http","message":"GET /api/collections 304 16.351 ms - {} - User: guest","timestamp":"2025-07-13T08:35:54.049Z"}
{"level":"http","message":"GET /api/cart 304 11.193 ms - {} - User: -","timestamp":"2025-07-13T08:35:54.056Z"}
{"level":"http","message":"GET /api/collections 304 18.111 ms - {} - User: guest","timestamp":"2025-07-13T08:35:54.071Z"}
{"level":"http","message":"GET /api/cart 304 19.295 ms - {} - User: -","timestamp":"2025-07-13T08:35:54.079Z"}
{"level":"http","message":"GET /api/cart 304 12.253 ms - {} - User: -","timestamp":"2025-07-13T08:35:54.093Z"}
{"level":"http","message":"GET /api/wishlist 304 12.735 ms - {} - User: -","timestamp":"2025-07-13T08:35:54.170Z"}
{"level":"http","message":"GET /api/wishlist 304 12.556 ms - {} - User: -","timestamp":"2025-07-13T08:35:54.185Z"}
{"level":"http","message":"GET /api/wishlist 304 11.087 ms - {} - User: -","timestamp":"2025-07-13T08:35:54.200Z"}
{"level":"http","message":"GET /api/wishlist 304 11.697 ms - {} - User: -","timestamp":"2025-07-13T08:35:54.213Z"}
{"level":"http","message":"GET /api/wishlist 304 12.283 ms - {} - User: -","timestamp":"2025-07-13T08:35:54.227Z"}
{"level":"http","message":"GET /api/wishlist 304 16.855 ms - {} - User: -","timestamp":"2025-07-13T08:35:54.246Z"}
{"level":"http","message":"GET /api/cart 304 8.595 ms - {} - User: -","timestamp":"2025-07-13T08:36:24.752Z"}
{"level":"http","message":"GET /api/cart 304 50.736 ms - {} - User: -","timestamp":"2025-07-13T08:36:36.748Z"}
{"level":"http","message":"GET /api/cart 304 8.250 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.334Z"}
{"level":"http","message":"GET /api/cart 304 12.130 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.353Z"}
{"level":"http","message":"GET /api/wishlist 304 21.816 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.358Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 34.043 ms - {} - User: guest","timestamp":"2025-07-13T08:36:38.399Z"}
{"level":"http","message":"GET /api/products?limit=1000 304 33.934 ms - {} - User: guest","timestamp":"2025-07-13T08:36:38.406Z"}
{"level":"http","message":"GET /api/wishlist 304 49.369 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.409Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.215 ms - {} - User: guest","timestamp":"2025-07-13T08:36:38.412Z"}
{"level":"http","message":"GET /api/cart 304 30.016 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.414Z"}
{"level":"http","message":"GET /api/products?limit=1000 304 0.749 ms - {} - User: guest","timestamp":"2025-07-13T08:36:38.416Z"}
{"level":"http","message":"GET /api/cart 304 61.820 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.483Z"}
{"level":"http","message":"GET /api/wishlist 304 70.816 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.488Z"}
{"level":"http","message":"GET /api/wishlist 304 12.675 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.506Z"}
{"level":"http","message":"GET /api/wishlist 304 9.620 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.519Z"}
{"level":"http","message":"GET /api/wishlist 304 12.660 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.533Z"}
{"level":"http","message":"GET /api/wishlist 304 16.781 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.552Z"}
{"level":"http","message":"GET /api/wishlist 304 13.551 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.567Z"}
{"level":"http","message":"GET /api/wishlist 304 17.317 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.585Z"}
{"level":"http","message":"GET /api/wishlist 304 12.432 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.600Z"}
{"level":"http","message":"GET /api/wishlist 304 15.298 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.617Z"}
{"level":"http","message":"GET /api/wishlist 304 12.112 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.630Z"}
{"level":"http","message":"GET /api/wishlist 304 12.639 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.645Z"}
{"level":"http","message":"GET /api/wishlist 304 9.988 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.657Z"}
{"level":"http","message":"GET /api/wishlist 304 10.234 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.669Z"}
{"level":"http","message":"GET /api/wishlist 304 11.299 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.682Z"}
{"level":"http","message":"GET /api/wishlist 304 13.475 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.697Z"}
{"level":"http","message":"GET /api/wishlist 304 10.003 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.709Z"}
{"level":"http","message":"GET /api/wishlist 304 12.282 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.724Z"}
{"level":"http","message":"GET /api/wishlist 304 12.769 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.741Z"}
{"level":"http","message":"GET /api/wishlist 304 11.800 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.756Z"}
{"level":"http","message":"GET /api/wishlist 304 11.186 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.771Z"}
{"level":"http","message":"GET /api/wishlist 304 23.755 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.799Z"}
{"level":"http","message":"GET /api/wishlist 304 22.675 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.824Z"}
{"level":"http","message":"GET /api/wishlist 304 10.617 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.837Z"}
{"level":"http","message":"GET /api/wishlist 304 11.598 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.853Z"}
{"level":"http","message":"GET /api/wishlist 304 11.655 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.867Z"}
{"level":"http","message":"GET /api/wishlist 304 15.008 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.884Z"}
{"level":"http","message":"GET /api/wishlist 304 18.439 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.904Z"}
{"level":"http","message":"GET /api/wishlist 304 24.004 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.933Z"}
{"level":"http","message":"GET /api/wishlist 304 11.039 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.945Z"}
{"level":"http","message":"GET /api/wishlist 304 8.927 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.956Z"}
{"level":"http","message":"GET /api/wishlist 304 8.474 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.969Z"}
{"level":"http","message":"GET /api/wishlist 304 10.189 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.981Z"}
{"level":"http","message":"GET /api/wishlist 304 8.365 ms - {} - User: -","timestamp":"2025-07-13T08:36:38.991Z"}
{"level":"http","message":"GET /api/wishlist 304 8.669 ms - {} - User: -","timestamp":"2025-07-13T08:36:39.002Z"}
{"level":"http","message":"GET /api/wishlist 304 13.790 ms - {} - User: -","timestamp":"2025-07-13T08:36:39.018Z"}
{"level":"http","message":"GET /api/wishlist 304 11.661 ms - {} - User: -","timestamp":"2025-07-13T08:36:39.031Z"}
{"level":"http","message":"GET /api/wishlist 304 13.461 ms - {} - User: -","timestamp":"2025-07-13T08:36:39.046Z"}
{"level":"http","message":"GET /api/wishlist 304 11.914 ms - {} - User: -","timestamp":"2025-07-13T08:36:39.060Z"}
{"level":"http","message":"GET /api/products/K24K 200 7.232 ms - {} - User: guest","timestamp":"2025-07-13T08:36:39.602Z"}
{"level":"http","message":"GET /api/cart 304 17.786 ms - {} - User: -","timestamp":"2025-07-13T08:36:39.609Z"}
{"level":"http","message":"GET /api/products/K24K 304 2.965 ms - {} - User: guest","timestamp":"2025-07-13T08:36:39.614Z"}
{"level":"http","message":"GET /api/cart 304 15.505 ms - {} - User: -","timestamp":"2025-07-13T08:36:39.632Z"}
{"level":"http","message":"GET /api/cart 304 7.330 ms - {} - User: -","timestamp":"2025-07-13T08:36:39.642Z"}
{"level":"http","message":"GET /api/cart 304 8.562 ms - {} - User: -","timestamp":"2025-07-13T08:36:39.652Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 20.599 ms - {} - User: guest","timestamp":"2025-07-13T08:36:39.680Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 0.851 ms - {} - User: guest","timestamp":"2025-07-13T08:36:39.739Z"}
{"level":"http","message":"GET /api/cart 304 7.700 ms - {} - User: -","timestamp":"2025-07-13T08:37:09.754Z"}
{"level":"http","message":"GET /api/cart 304 38.623 ms - {} - User: -","timestamp":"2025-07-13T08:37:14.863Z"}
{"level":"http","message":"GET /api/cart 304 8.418 ms - {} - User: -","timestamp":"2025-07-13T08:37:16.524Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.836 ms - {} - User: guest","timestamp":"2025-07-13T08:37:16.526Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.669 ms - {} - User: guest","timestamp":"2025-07-13T08:37:16.534Z"}
{"level":"http","message":"GET /api/cart 304 11.351 ms - {} - User: -","timestamp":"2025-07-13T08:37:16.539Z"}
{"level":"http","message":"GET /api/cart 304 7.646 ms - {} - User: -","timestamp":"2025-07-13T08:37:16.548Z"}
{"level":"http","message":"GET /api/cart 304 7.206 ms - {} - User: -","timestamp":"2025-07-13T08:37:16.557Z"}
{"level":"http","message":"GET /api/cart 304 9.832 ms - {} - User: -","timestamp":"2025-07-13T08:37:16.568Z"}
{"level":"http","message":"GET /api/cart 304 8.962 ms - {} - User: -","timestamp":"2025-07-13T08:37:16.579Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.668 ms - {} - User: guest","timestamp":"2025-07-13T08:37:16.607Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.867 ms - {} - User: guest","timestamp":"2025-07-13T08:37:16.610Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.489 ms - {} - User: guest","timestamp":"2025-07-13T08:37:16.611Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.569 ms - {} - User: guest","timestamp":"2025-07-13T08:37:16.634Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.755 ms - {} - User: guest","timestamp":"2025-07-13T08:37:16.660Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.616 ms - {} - User: guest","timestamp":"2025-07-13T08:37:16.690Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.575 ms - {} - User: guest","timestamp":"2025-07-13T08:37:16.719Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.751 ms - {} - User: guest","timestamp":"2025-07-13T08:37:16.782Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.956 ms - {} - User: guest","timestamp":"2025-07-13T08:37:16.785Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.886 ms - {} - User: guest","timestamp":"2025-07-13T08:37:16.788Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.545 ms - {} - User: guest","timestamp":"2025-07-13T08:37:16.790Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.674 ms - {} - User: guest","timestamp":"2025-07-13T08:37:16.792Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.571 ms - {} - User: guest","timestamp":"2025-07-13T08:37:16.818Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.385 ms - {} - User: guest","timestamp":"2025-07-13T08:37:16.827Z"}
{"level":"http","message":"GET /api/cart 304 9.290 ms - {} - User: -","timestamp":"2025-07-13T08:37:46.765Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.632 ms - {} - User: guest","timestamp":"2025-07-13T08:37:46.898Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.960 ms - {} - User: guest","timestamp":"2025-07-13T08:37:46.971Z"}
{"level":"http","message":"GET /api/cart 304 8.439 ms - {} - User: -","timestamp":"2025-07-13T08:38:16.755Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.011 ms - {} - User: guest","timestamp":"2025-07-13T08:38:16.903Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.589 ms - {} - User: guest","timestamp":"2025-07-13T08:38:16.967Z"}
{"level":"http","message":"GET /api/cart 304 9.211 ms - {} - User: -","timestamp":"2025-07-13T08:38:46.754Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.887 ms - {} - User: guest","timestamp":"2025-07-13T08:38:46.901Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.800 ms - {} - User: guest","timestamp":"2025-07-13T08:38:46.997Z"}
{"level":"http","message":"GET /api/cart 304 7.666 ms - {} - User: -","timestamp":"2025-07-13T08:39:16.762Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.526 ms - {} - User: guest","timestamp":"2025-07-13T08:39:16.930Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.809 ms - {} - User: guest","timestamp":"2025-07-13T08:39:17.012Z"}
{"level":"http","message":"GET /api/cart 304 9.532 ms - {} - User: -","timestamp":"2025-07-13T08:39:46.759Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.854 ms - {} - User: guest","timestamp":"2025-07-13T08:39:46.907Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.491 ms - {} - User: guest","timestamp":"2025-07-13T08:39:46.985Z"}
{"level":"http","message":"GET /api/cart 304 7.496 ms - {} - User: -","timestamp":"2025-07-13T08:40:07.344Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.001 ms - {} - User: guest","timestamp":"2025-07-13T08:40:07.444Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.758 ms - {} - User: guest","timestamp":"2025-07-13T08:40:07.481Z"}
{"level":"http","message":"GET /api/cart 304 8.090 ms - {} - User: -","timestamp":"2025-07-13T08:40:16.757Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.648 ms - {} - User: guest","timestamp":"2025-07-13T08:40:16.912Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.702 ms - {} - User: guest","timestamp":"2025-07-13T08:40:16.992Z"}
{"level":"http","message":"GET /api/cart 304 7.963 ms - {} - User: -","timestamp":"2025-07-13T08:40:46.762Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.872 ms - {} - User: guest","timestamp":"2025-07-13T08:40:46.903Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.594 ms - {} - User: guest","timestamp":"2025-07-13T08:40:46.987Z"}
{"level":"http","message":"GET /api/cart 304 7.410 ms - {} - User: -","timestamp":"2025-07-13T08:41:20.756Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.742 ms - {} - User: guest","timestamp":"2025-07-13T08:41:20.889Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.599 ms - {} - User: guest","timestamp":"2025-07-13T08:41:20.955Z"}
{"level":"http","message":"GET /api/cart 304 8.447 ms - {} - User: -","timestamp":"2025-07-13T08:42:20.760Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 3.982 ms - {} - User: guest","timestamp":"2025-07-13T08:42:20.910Z"}
{"level":"http","message":"GET /api/products/K18K 304 2.780 ms - {} - User: guest","timestamp":"2025-07-13T08:42:20.982Z"}
{"level":"http","message":"GET /api/cart 304 7.844 ms - {} - User: -","timestamp":"2025-07-13T08:43:20.759Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.761 ms - {} - User: guest","timestamp":"2025-07-13T08:43:20.902Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.475 ms - {} - User: guest","timestamp":"2025-07-13T08:43:20.989Z"}
{"level":"http","message":"GET /api/cart 304 8.634 ms - {} - User: -","timestamp":"2025-07-13T08:44:20.757Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.747 ms - {} - User: guest","timestamp":"2025-07-13T08:44:20.899Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.781 ms - {} - User: guest","timestamp":"2025-07-13T08:44:20.967Z"}
{"level":"http","message":"GET /api/cart 304 9.549 ms - {} - User: -","timestamp":"2025-07-13T08:45:20.759Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.662 ms - {} - User: guest","timestamp":"2025-07-13T08:45:20.897Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.730 ms - {} - User: guest","timestamp":"2025-07-13T08:45:20.954Z"}
{"level":"http","message":"GET /api/cart 304 7.580 ms - {} - User: -","timestamp":"2025-07-13T08:46:20.763Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.865 ms - {} - User: guest","timestamp":"2025-07-13T08:46:20.951Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.965 ms - {} - User: guest","timestamp":"2025-07-13T08:46:21.044Z"}
{"level":"http","message":"GET /api/cart 304 8.338 ms - {} - User: -","timestamp":"2025-07-13T08:47:20.751Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.797 ms - {} - User: guest","timestamp":"2025-07-13T08:47:20.877Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.976 ms - {} - User: guest","timestamp":"2025-07-13T08:47:20.942Z"}
{"level":"http","message":"GET /api/cart 304 7.131 ms - {} - User: -","timestamp":"2025-07-13T08:48:20.747Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.044 ms - {} - User: guest","timestamp":"2025-07-13T08:48:20.892Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.482 ms - {} - User: guest","timestamp":"2025-07-13T08:48:20.959Z"}
{"level":"http","message":"GET /api/cart 304 8.030 ms - {} - User: -","timestamp":"2025-07-13T08:49:20.762Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.660 ms - {} - User: guest","timestamp":"2025-07-13T08:49:20.906Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.637 ms - {} - User: guest","timestamp":"2025-07-13T08:49:20.986Z"}
{"level":"http","message":"GET /api/cart 304 7.730 ms - {} - User: -","timestamp":"2025-07-13T08:50:20.760Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.755 ms - {} - User: guest","timestamp":"2025-07-13T08:50:20.896Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.930 ms - {} - User: guest","timestamp":"2025-07-13T08:50:20.967Z"}
{"level":"http","message":"GET /api/cart 304 9.120 ms - {} - User: -","timestamp":"2025-07-13T08:51:20.752Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.680 ms - {} - User: guest","timestamp":"2025-07-13T08:51:20.888Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.479 ms - {} - User: guest","timestamp":"2025-07-13T08:51:20.959Z"}
{"level":"http","message":"GET /api/cart 304 94.161 ms - {} - User: -","timestamp":"2025-07-13T08:51:36.017Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.748 ms - {} - User: guest","timestamp":"2025-07-13T08:51:36.086Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.644 ms - {} - User: guest","timestamp":"2025-07-13T08:51:36.128Z"}
{"level":"http","message":"GET /api/cart 304 8.166 ms - {} - User: -","timestamp":"2025-07-13T08:51:46.756Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.618 ms - {} - User: guest","timestamp":"2025-07-13T08:51:46.892Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.589 ms - {} - User: guest","timestamp":"2025-07-13T08:51:46.970Z"}
{"level":"http","message":"GET /api/cart 304 7.608 ms - {} - User: -","timestamp":"2025-07-13T08:52:16.758Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.608 ms - {} - User: guest","timestamp":"2025-07-13T08:52:16.905Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.900 ms - {} - User: guest","timestamp":"2025-07-13T08:52:16.980Z"}
{"level":"http","message":"GET /api/cart 304 8.788 ms - {} - User: -","timestamp":"2025-07-13T08:53:20.764Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 2.983 ms - {} - User: guest","timestamp":"2025-07-13T08:53:20.904Z"}
{"level":"http","message":"GET /api/products/K18K 304 2.715 ms - {} - User: guest","timestamp":"2025-07-13T08:53:20.975Z"}
{"level":"http","message":"GET /api/cart 304 9.631 ms - {} - User: -","timestamp":"2025-07-13T08:54:20.764Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.630 ms - {} - User: guest","timestamp":"2025-07-13T08:54:20.919Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.851 ms - {} - User: guest","timestamp":"2025-07-13T08:54:20.996Z"}
{"level":"http","message":"GET /api/cart 304 9.385 ms - {} - User: -","timestamp":"2025-07-13T08:55:20.763Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.477 ms - {} - User: guest","timestamp":"2025-07-13T08:55:20.931Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.903 ms - {} - User: guest","timestamp":"2025-07-13T08:55:21.007Z"}
{"level":"http","message":"GET /api/cart 304 30.858 ms - {} - User: -","timestamp":"2025-07-13T08:55:59.712Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 3.184 ms - {} - User: guest","timestamp":"2025-07-13T08:55:59.848Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.514 ms - {} - User: guest","timestamp":"2025-07-13T08:55:59.870Z"}
{"level":"http","message":"GET /api/cart 304 91.805 ms - {} - User: -","timestamp":"2025-07-13T08:55:59.872Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.805 ms - {} - User: guest","timestamp":"2025-07-13T08:55:59.953Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.450 ms - {} - User: guest","timestamp":"2025-07-13T08:55:59.992Z"}
{"level":"http","message":"GET /api/cart 304 8.214 ms - {} - User: -","timestamp":"2025-07-13T08:56:06.122Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.770 ms - {} - User: guest","timestamp":"2025-07-13T08:56:06.179Z"}
{"level":"http","message":"GET /api/cart 304 11.419 ms - {} - User: -","timestamp":"2025-07-13T08:56:06.454Z"}
{"level":"http","message":"GET /api/cart 304 10.403 ms - {} - User: -","timestamp":"2025-07-13T08:56:06.469Z"}
{"level":"http","message":"GET /api/cart 304 8.111 ms - {} - User: -","timestamp":"2025-07-13T08:56:06.479Z"}
{"level":"http","message":"GET /api/cart 304 10.482 ms - {} - User: -","timestamp":"2025-07-13T08:56:06.492Z"}
{"level":"http","message":"GET /api/cart 304 12.093 ms - {} - User: -","timestamp":"2025-07-13T08:56:06.506Z"}
{"level":"http","message":"GET /api/cart 304 8.454 ms - {} - User: -","timestamp":"2025-07-13T08:56:06.517Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.859 ms - {} - User: guest","timestamp":"2025-07-13T08:56:06.541Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.692 ms - {} - User: guest","timestamp":"2025-07-13T08:56:06.576Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.754 ms - {} - User: guest","timestamp":"2025-07-13T08:56:06.609Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.870 ms - {} - User: guest","timestamp":"2025-07-13T08:56:06.673Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.743 ms - {} - User: guest","timestamp":"2025-07-13T08:56:06.737Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.573 ms - {} - User: guest","timestamp":"2025-07-13T08:56:06.768Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.716 ms - {} - User: guest","timestamp":"2025-07-13T08:56:06.794Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.948 ms - {} - User: guest","timestamp":"2025-07-13T08:56:06.799Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.641 ms - {} - User: guest","timestamp":"2025-07-13T08:56:06.802Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.683 ms - {} - User: guest","timestamp":"2025-07-13T08:56:06.804Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.220 ms - {} - User: guest","timestamp":"2025-07-13T08:56:06.807Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.679 ms - {} - User: guest","timestamp":"2025-07-13T08:56:06.809Z"}
{"level":"http","message":"GET /api/cart 304 9.282 ms - {} - User: -","timestamp":"2025-07-13T08:56:23.908Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.681 ms - {} - User: guest","timestamp":"2025-07-13T08:56:23.969Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.677 ms - {} - User: guest","timestamp":"2025-07-13T08:56:24.031Z"}
{"level":"http","message":"GET /api/cart 304 23.291 ms - {} - User: -","timestamp":"2025-07-13T08:56:25.878Z"}
{"level":"http","message":"GET /api/products?limit=100 304 54.616 ms - {} - User: guest","timestamp":"2025-07-13T08:56:25.918Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 51.462 ms - {} - User: guest","timestamp":"2025-07-13T08:56:25.934Z"}
{"level":"http","message":"GET /api/collections 304 52.024 ms - {} - User: guest","timestamp":"2025-07-13T08:56:25.939Z"}
{"level":"http","message":"GET /api/products?limit=100 304 2.732 ms - {} - User: guest","timestamp":"2025-07-13T08:56:25.948Z"}
{"level":"http","message":"GET /api/cart 304 51.157 ms - {} - User: -","timestamp":"2025-07-13T08:56:25.951Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 0.918 ms - {} - User: guest","timestamp":"2025-07-13T08:56:25.953Z"}
{"level":"http","message":"GET /api/collections 304 33.769 ms - {} - User: guest","timestamp":"2025-07-13T08:56:25.989Z"}
{"level":"http","message":"GET /api/cart 304 29.197 ms - {} - User: -","timestamp":"2025-07-13T08:56:25.992Z"}
{"level":"http","message":"GET /api/cart 304 12.488 ms - {} - User: -","timestamp":"2025-07-13T08:56:26.007Z"}
{"level":"http","message":"GET /api/wishlist 304 14.060 ms - {} - User: -","timestamp":"2025-07-13T08:56:26.075Z"}
{"level":"http","message":"GET /api/wishlist 304 10.219 ms - {} - User: -","timestamp":"2025-07-13T08:56:26.088Z"}
{"level":"http","message":"GET /api/wishlist 304 14.930 ms - {} - User: -","timestamp":"2025-07-13T08:56:26.105Z"}
{"level":"http","message":"GET /api/wishlist 304 10.951 ms - {} - User: -","timestamp":"2025-07-13T08:56:26.117Z"}
{"level":"http","message":"GET /api/wishlist 304 9.867 ms - {} - User: -","timestamp":"2025-07-13T08:56:26.129Z"}
{"level":"http","message":"GET /api/wishlist 304 14.486 ms - {} - User: -","timestamp":"2025-07-13T08:56:26.147Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.816 ms - {} - User: guest","timestamp":"2025-07-13T08:56:28.956Z"}
{"level":"http","message":"GET /api/cart 304 10.968 ms - {} - User: -","timestamp":"2025-07-13T08:56:28.961Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.686 ms - {} - User: guest","timestamp":"2025-07-13T08:56:28.963Z"}
{"level":"http","message":"GET /api/cart 304 8.048 ms - {} - User: -","timestamp":"2025-07-13T08:56:28.973Z"}
{"level":"http","message":"GET /api/cart 304 22.229 ms - {} - User: -","timestamp":"2025-07-13T08:56:29.004Z"}
{"level":"http","message":"GET /api/cart 304 7.772 ms - {} - User: -","timestamp":"2025-07-13T08:56:29.013Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 13.348 ms - {} - User: guest","timestamp":"2025-07-13T08:56:29.032Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 1.054 ms - {} - User: guest","timestamp":"2025-07-13T08:56:29.105Z"}
{"level":"http","message":"GET /api/cart 304 10.945 ms - {} - User: -","timestamp":"2025-07-13T08:56:41.075Z"}
{"level":"http","message":"GET /api/cart 304 8.353 ms - {} - User: -","timestamp":"2025-07-13T08:56:59.762Z"}
{"level":"http","message":"GET /api/cart 304 27.427 ms - {} - User: -","timestamp":"2025-07-13T08:57:00.847Z"}
{"level":"http","message":"GET /api/cart 304 7.300 ms - {} - User: -","timestamp":"2025-07-13T08:57:29.764Z"}
{"level":"http","message":"GET /api/cart 304 90.458 ms - {} - User: -","timestamp":"2025-07-13T08:57:38.841Z"}
{"level":"http","message":"GET /api/cart 304 16.825 ms - {} - User: -","timestamp":"2025-07-13T08:57:43.004Z"}
{"level":"http","message":"GET /api/cart 304 14.111 ms - {} - User: -","timestamp":"2025-07-13T08:57:47.741Z"}
{"level":"http","message":"GET /api/cart 304 56.440 ms - {} - User: -","timestamp":"2025-07-13T08:57:56.600Z"}
{"level":"http","message":"GET /api/cart 304 8.710 ms - {} - User: -","timestamp":"2025-07-13T08:57:59.759Z"}
{"level":"http","message":"GET /api/cart 304 6.922 ms - {} - User: -","timestamp":"2025-07-13T08:58:29.748Z"}
{"level":"http","message":"GET /api/cart 304 8.065 ms - {} - User: -","timestamp":"2025-07-13T08:58:59.753Z"}
{"level":"http","message":"GET /api/cart 304 77.454 ms - {} - User: -","timestamp":"2025-07-13T08:59:13.164Z"}
{"level":"http","message":"GET /api/cart 304 8.756 ms - {} - User: -","timestamp":"2025-07-13T08:59:28.979Z"}
{"level":"http","message":"GET /api/cart 304 45.407 ms - {} - User: -","timestamp":"2025-07-13T08:59:31.349Z"}
{"level":"http","message":"GET /api/cart 304 24.243 ms - {} - User: -","timestamp":"2025-07-13T08:59:39.090Z"}
{"level":"http","message":"GET /api/cart 304 15.912 ms - {} - User: -","timestamp":"2025-07-13T08:59:42.738Z"}
{"level":"http","message":"GET /api/cart 304 6.609 ms - {} - User: -","timestamp":"2025-07-13T08:59:59.750Z"}
{"level":"http","message":"GET /api/cart 304 15.185 ms - {} - User: -","timestamp":"2025-07-13T09:00:07.392Z"}
{"level":"http","message":"GET /api/cart 304 75.601 ms - {} - User: -","timestamp":"2025-07-13T09:00:28.120Z"}
{"level":"http","message":"POST /api/cart/add 200 38.824 ms - {\"productId\":\"NC10VNA1\",\"sizeIndex\":0,\"quantity\":1} - User: -","timestamp":"2025-07-13T09:00:28.161Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.911 ms - {} - User: guest","timestamp":"2025-07-13T09:00:35.047Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 2.250 ms - {} - User: guest","timestamp":"2025-07-13T09:00:35.054Z"}
{"level":"http","message":"GET /api/cart 200 26.163 ms - {} - User: -","timestamp":"2025-07-13T09:00:35.060Z"}
{"level":"http","message":"GET /api/cart 304 14.952 ms - {} - User: -","timestamp":"2025-07-13T09:00:35.079Z"}
{"level":"http","message":"GET /api/cart 304 17.734 ms - {} - User: -","timestamp":"2025-07-13T09:00:35.103Z"}
{"level":"http","message":"GET /api/cart 304 10.295 ms - {} - User: -","timestamp":"2025-07-13T09:00:35.116Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 1.377 ms - {} - User: guest","timestamp":"2025-07-13T09:00:35.126Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 1.036 ms - {} - User: guest","timestamp":"2025-07-13T09:00:35.196Z"}
{"level":"http","message":"GET /api/cart 304 11.406 ms - {} - User: -","timestamp":"2025-07-13T09:01:05.064Z"}
{"level":"http","message":"GET /api/cart 304 6.640 ms - {} - User: -","timestamp":"2025-07-13T09:01:35.069Z"}
{"level":"http","message":"GET /api/cart 304 6.679 ms - {} - User: -","timestamp":"2025-07-13T09:02:05.759Z"}
{"level":"http","message":"GET /api/cart 304 9.072 ms - {} - User: -","timestamp":"2025-07-13T09:02:35.762Z"}
{"level":"http","message":"GET /api/cart 304 7.975 ms - {} - User: -","timestamp":"2025-07-13T09:03:05.762Z"}
{"level":"http","message":"GET /api/cart 304 6.128 ms - {} - User: -","timestamp":"2025-07-13T09:03:35.755Z"}
{"level":"http","message":"GET /api/cart 304 66.581 ms - {} - User: -","timestamp":"2025-07-13T09:03:56.155Z"}
{"level":"http","message":"GET /api/cart 304 8.920 ms - {} - User: -","timestamp":"2025-07-13T09:04:05.751Z"}
{"level":"http","message":"GET /api/cart 304 7.082 ms - {} - User: -","timestamp":"2025-07-13T09:04:35.758Z"}
{"level":"http","message":"GET /api/cart 304 8.897 ms - {} - User: -","timestamp":"2025-07-13T09:05:20.758Z"}
{"level":"http","message":"GET /api/cart 304 14.084 ms - {} - User: -","timestamp":"2025-07-13T09:05:42.968Z"}
{"level":"http","message":"GET /api/cart 304 13.704 ms - {} - User: -","timestamp":"2025-07-13T09:05:43.015Z"}
{"level":"http","message":"GET /api/cart 304 9.952 ms - {} - User: -","timestamp":"2025-07-13T09:05:44.352Z"}
{"level":"http","message":"GET /api/cart 304 8.191 ms - {} - User: -","timestamp":"2025-07-13T09:06:05.757Z"}
{"level":"http","message":"GET /api/cart 304 7.168 ms - {} - User: -","timestamp":"2025-07-13T09:06:35.760Z"}
{"level":"http","message":"GET /api/cart 304 48.165 ms - {} - User: -","timestamp":"2025-07-13T09:07:20.806Z"}
{"level":"http","message":"GET /api/cart 304 7.066 ms - {} - User: -","timestamp":"2025-07-13T09:08:20.755Z"}
{"level":"http","message":"GET /api/cart 304 90.423 ms - {} - User: -","timestamp":"2025-07-13T09:08:48.262Z"}
{"level":"http","message":"GET /api/cart 304 6.703 ms - {} - User: -","timestamp":"2025-07-13T09:08:48.271Z"}
{"level":"http","message":"GET /api/cart 304 16.353 ms - {} - User: -","timestamp":"2025-07-13T09:08:55.477Z"}
{"level":"http","message":"GET /api/products?limit=100 304 128.527 ms - {} - User: guest","timestamp":"2025-07-13T09:08:55.608Z"}
{"level":"http","message":"GET /api/cart 304 126.773 ms - {} - User: -","timestamp":"2025-07-13T09:08:55.619Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 85.984 ms - {} - User: guest","timestamp":"2025-07-13T09:08:55.628Z"}
{"level":"http","message":"GET /api/collections 304 81.212 ms - {} - User: guest","timestamp":"2025-07-13T09:08:55.632Z"}
{"level":"http","message":"GET /api/products?limit=100 304 2.218 ms - {} - User: guest","timestamp":"2025-07-13T09:08:55.637Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.316 ms - {} - User: guest","timestamp":"2025-07-13T09:08:55.650Z"}
{"level":"http","message":"GET /api/cart 304 23.667 ms - {} - User: -","timestamp":"2025-07-13T09:08:55.665Z"}
{"level":"http","message":"GET /api/collections 304 16.235 ms - {} - User: guest","timestamp":"2025-07-13T09:08:55.668Z"}
{"level":"http","message":"GET /api/wishlist 304 199.009 ms - {} - User: -","timestamp":"2025-07-13T09:08:55.670Z"}
{"level":"http","message":"GET /api/cart 304 24.711 ms - {} - User: -","timestamp":"2025-07-13T09:08:55.696Z"}
{"level":"http","message":"GET /api/wishlist 304 23.218 ms - {} - User: -","timestamp":"2025-07-13T09:08:55.702Z"}
{"level":"http","message":"GET /api/wishlist 304 15.675 ms - {} - User: -","timestamp":"2025-07-13T09:08:55.720Z"}
{"level":"http","message":"GET /api/wishlist 304 14.477 ms - {} - User: -","timestamp":"2025-07-13T09:08:55.739Z"}
{"level":"http","message":"GET /api/wishlist 304 13.108 ms - {} - User: -","timestamp":"2025-07-13T09:08:55.756Z"}
{"level":"http","message":"GET /api/wishlist 304 14.329 ms - {} - User: -","timestamp":"2025-07-13T09:08:55.772Z"}
{"level":"http","message":"GET /api/wishlist 304 15.147 ms - {} - User: -","timestamp":"2025-07-13T09:08:55.791Z"}
{"level":"http","message":"GET /api/wishlist 304 12.007 ms - {} - User: -","timestamp":"2025-07-13T09:08:55.804Z"}
{"level":"http","message":"GET /api/wishlist 304 11.542 ms - {} - User: -","timestamp":"2025-07-13T09:08:55.819Z"}
{"level":"http","message":"GET /api/wishlist 304 12.509 ms - {} - User: -","timestamp":"2025-07-13T09:08:55.834Z"}
{"level":"http","message":"GET /api/wishlist 304 15.804 ms - {} - User: -","timestamp":"2025-07-13T09:08:55.853Z"}
{"level":"http","message":"GET /api/wishlist 304 14.105 ms - {} - User: -","timestamp":"2025-07-13T09:08:55.870Z"}
{"level":"http","message":"GET /api/cart 304 22.549 ms - {} - User: -","timestamp":"2025-07-13T09:08:59.465Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.384 ms - {} - User: guest","timestamp":"2025-07-13T09:09:01.223Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.063 ms - {} - User: guest","timestamp":"2025-07-13T09:09:01.228Z"}
{"level":"http","message":"GET /api/cart 304 16.314 ms - {} - User: -","timestamp":"2025-07-13T09:09:01.234Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.264 ms - {} - User: guest","timestamp":"2025-07-13T09:09:01.239Z"}
{"level":"http","message":"GET /api/collections 304 15.964 ms - {} - User: guest","timestamp":"2025-07-13T09:09:01.246Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.303 ms - {} - User: guest","timestamp":"2025-07-13T09:09:01.248Z"}
{"level":"http","message":"GET /api/cart 304 16.665 ms - {} - User: -","timestamp":"2025-07-13T09:09:01.257Z"}
{"level":"http","message":"GET /api/collections 304 15.380 ms - {} - User: guest","timestamp":"2025-07-13T09:09:01.268Z"}
{"level":"http","message":"GET /api/cart 304 11.960 ms - {} - User: -","timestamp":"2025-07-13T09:09:01.274Z"}
{"level":"http","message":"GET /api/cart 304 10.911 ms - {} - User: -","timestamp":"2025-07-13T09:09:01.289Z"}
{"level":"http","message":"GET /api/wishlist 304 14.768 ms - {} - User: -","timestamp":"2025-07-13T09:09:01.388Z"}
{"level":"http","message":"GET /api/wishlist 304 12.523 ms - {} - User: -","timestamp":"2025-07-13T09:09:01.403Z"}
{"level":"http","message":"GET /api/wishlist 304 14.644 ms - {} - User: -","timestamp":"2025-07-13T09:09:01.420Z"}
{"level":"http","message":"GET /api/wishlist 304 14.219 ms - {} - User: -","timestamp":"2025-07-13T09:09:01.438Z"}
{"level":"http","message":"GET /api/wishlist 304 13.673 ms - {} - User: -","timestamp":"2025-07-13T09:09:01.454Z"}
{"level":"http","message":"GET /api/wishlist 304 13.941 ms - {} - User: -","timestamp":"2025-07-13T09:09:01.470Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 4.622 ms - {} - User: guest","timestamp":"2025-07-13T09:09:05.305Z"}
{"level":"http","message":"GET /api/cart 304 12.504 ms - {} - User: -","timestamp":"2025-07-13T09:09:05.308Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.884 ms - {} - User: guest","timestamp":"2025-07-13T09:09:05.315Z"}
{"level":"http","message":"GET /api/cart 304 8.889 ms - {} - User: -","timestamp":"2025-07-13T09:09:05.326Z"}
{"level":"http","message":"GET /api/cart 304 12.595 ms - {} - User: -","timestamp":"2025-07-13T09:09:05.341Z"}
{"level":"http","message":"GET /api/cart 304 9.367 ms - {} - User: -","timestamp":"2025-07-13T09:09:05.354Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 13.348 ms - {} - User: guest","timestamp":"2025-07-13T09:09:05.380Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 0.826 ms - {} - User: guest","timestamp":"2025-07-13T09:09:05.452Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.777 ms - {} - User: guest","timestamp":"2025-07-13T09:10:59.403Z"}
{"level":"http","message":"GET /api/cart 304 13.510 ms - {} - User: -","timestamp":"2025-07-13T09:10:59.409Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.094 ms - {} - User: guest","timestamp":"2025-07-13T09:10:59.411Z"}
{"level":"http","message":"GET /api/cart 304 6.995 ms - {} - User: -","timestamp":"2025-07-13T09:10:59.420Z"}
{"level":"http","message":"GET /api/cart 304 10.788 ms - {} - User: -","timestamp":"2025-07-13T09:10:59.432Z"}
{"level":"http","message":"GET /api/cart 304 8.811 ms - {} - User: -","timestamp":"2025-07-13T09:10:59.443Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 0.639 ms - {} - User: guest","timestamp":"2025-07-13T09:10:59.485Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 2.269 ms - {} - User: guest","timestamp":"2025-07-13T09:10:59.569Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.802 ms - {} - User: guest","timestamp":"2025-07-13T09:12:46.807Z"}
{"level":"http","message":"GET /api/cart 304 11.505 ms - {} - User: -","timestamp":"2025-07-13T09:12:46.810Z"}
{"level":"http","message":"GET /api/cart 304 9.002 ms - {} - User: -","timestamp":"2025-07-13T09:12:46.821Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 0.554 ms - {} - User: guest","timestamp":"2025-07-13T09:12:46.908Z"}
{"level":"http","message":"GET /api/cart 304 9.261 ms - {} - User: -","timestamp":"2025-07-13T09:13:10.342Z"}
{"level":"http","message":"GET /api/cart 304 6.709 ms - {} - User: -","timestamp":"2025-07-13T09:13:13.837Z"}
{"level":"http","message":"GET /api/cart 304 10.231 ms - {} - User: -","timestamp":"2025-07-13T09:13:16.815Z"}
{"level":"http","message":"GET /api/cart 304 5.919 ms - {} - User: -","timestamp":"2025-07-13T09:13:21.070Z"}
{"level":"http","message":"GET /api/cart 304 7.096 ms - {} - User: -","timestamp":"2025-07-13T09:13:46.814Z"}
{"level":"http","message":"GET /api/cart 304 22.467 ms - {} - User: -","timestamp":"2025-07-13T09:13:56.057Z"}
{"level":"http","message":"POST /api/purchase-history/create 400 7.767 ms - {\"items\":[{\"productId\":\"NC10VNA1\",\"quantity\":1,\"sizeIndex\":0,\"unitPrice\":19418760,\"nameProduct\":\"Nhẫn Kim cương Vàng 10K PNJ DDDDY000790\",\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FnewImage%2FNC-10VNA1.png?alt=media&token=46037aba-0dbf-4314-85d7-046276eab5f6\"}],\"totalAmount\":19448760,\"paymentMethod\":\"cod\",\"deliveryAddress\":{\"fullName\":\"Người dùng hiện tại\",\"phone\":\"0123456789\",\"street\":\"Địa chỉ mặc định\",\"ward\":\"Phường/Xã\",\"district\":\"Quận/Huyện\",\"city\":\"Thành phố\",\"zipCode\":\"10000\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"\"} - User: -","timestamp":"2025-07-13T09:14:00.221Z"}
{"level":"http","message":"GET /api/cart 304 7.069 ms - {} - User: -","timestamp":"2025-07-13T09:14:09.924Z"}
{"level":"http","message":"GET /api/cart 304 21.564 ms - {} - User: -","timestamp":"2025-07-13T09:14:17.776Z"}
{"level":"http","message":"GET /api/cart 304 53.400 ms - {} - User: -","timestamp":"2025-07-13T09:14:22.757Z"}
{"level":"http","message":"GET /api/cart 304 6.778 ms - {} - User: -","timestamp":"2025-07-13T09:14:47.797Z"}
{"level":"http","message":"GET /api/cart 304 8.545 ms - {} - User: -","timestamp":"2025-07-13T09:15:17.763Z"}
{"level":"http","message":"GET /api/cart 304 19.303 ms - {} - User: -","timestamp":"2025-07-13T09:15:29.624Z"}
{"level":"http","message":"GET /api/cart 304 8.037 ms - {} - User: -","timestamp":"2025-07-13T09:15:34.254Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.835 ms - {} - User: guest","timestamp":"2025-07-13T09:15:35.603Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.475 ms - {} - User: guest","timestamp":"2025-07-13T09:15:35.610Z"}
{"level":"http","message":"GET /api/cart 304 9.796 ms - {} - User: -","timestamp":"2025-07-13T09:15:35.614Z"}
{"level":"http","message":"GET /api/cart 304 13.683 ms - {} - User: -","timestamp":"2025-07-13T09:15:35.630Z"}
{"level":"http","message":"GET /api/cart 304 13.117 ms - {} - User: -","timestamp":"2025-07-13T09:15:35.645Z"}
{"level":"http","message":"GET /api/cart 304 23.074 ms - {} - User: -","timestamp":"2025-07-13T09:15:35.670Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 24.144 ms - {} - User: guest","timestamp":"2025-07-13T09:15:35.675Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 0.607 ms - {} - User: guest","timestamp":"2025-07-13T09:15:35.677Z"}
{"level":"http","message":"GET /api/cart 304 6.850 ms - {} - User: -","timestamp":"2025-07-13T09:15:48.941Z"}
{"level":"http","message":"GET /api/cart 304 6.415 ms - {} - User: -","timestamp":"2025-07-13T09:15:58.952Z"}
{"level":"http","message":"GET /api/cart 304 6.305 ms - {} - User: -","timestamp":"2025-07-13T09:16:05.613Z"}
{"level":"http","message":"POST /api/purchase-history/create 400 6.197 ms - {\"userId\":\"auto\",\"orderId\":\"auto\",\"items\":[{\"productId\":\"NC10VNA1\",\"quantity\":1,\"sizeIndex\":0,\"unitPrice\":19418760,\"nameProduct\":\"Nhẫn Kim cương Vàng 10K PNJ DDDDY000790\",\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FnewImage%2FNC-10VNA1.png?alt=media&token=46037aba-0dbf-4314-85d7-046276eab5f6\"}],\"totalAmount\":19448760,\"paymentMethod\":\"cod\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"bb\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"dd\"} - User: -","timestamp":"2025-07-13T09:16:17.620Z"}
{"level":"http","message":"GET /api/cart 304 8.968 ms - {} - User: -","timestamp":"2025-07-13T09:20:50.501Z"}
{"level":"http","message":"GET /api/cart 304 36.628 ms - {} - User: -","timestamp":"2025-07-13T09:20:50.558Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 4.234 ms - {} - User: guest","timestamp":"2025-07-13T09:20:53.946Z"}
{"level":"http","message":"GET /api/cart 304 11.204 ms - {} - User: -","timestamp":"2025-07-13T09:20:53.947Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.607 ms - {} - User: guest","timestamp":"2025-07-13T09:20:53.949Z"}
{"level":"http","message":"GET /api/cart 304 10.453 ms - {} - User: -","timestamp":"2025-07-13T09:20:53.961Z"}
{"level":"http","message":"GET /api/cart 304 6.049 ms - {} - User: -","timestamp":"2025-07-13T09:20:53.968Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 14.972 ms - {} - User: guest","timestamp":"2025-07-13T09:20:53.984Z"}
{"level":"http","message":"GET /api/cart 304 12.703 ms - {} - User: -","timestamp":"2025-07-13T09:20:53.986Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 0.641 ms - {} - User: guest","timestamp":"2025-07-13T09:20:53.998Z"}
{"level":"http","message":"GET /api/cart 304 10.911 ms - {} - User: -","timestamp":"2025-07-13T09:20:55.575Z"}
{"level":"http","message":"POST /api/purchase-history/create 400 7.050 ms - {\"items\":[{\"productId\":\"NC10VNA1\",\"quantity\":1,\"sizeIndex\":0,\"unitPrice\":19418760,\"nameProduct\":\"Nhẫn Kim cương Vàng 10K PNJ DDDDY000790\",\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FnewImage%2FNC-10VNA1.png?alt=media&token=46037aba-0dbf-4314-85d7-046276eab5f6\"}],\"totalAmount\":19448760,\"paymentMethod\":\"cod\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"b\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"d\"} - User: -","timestamp":"2025-07-13T09:21:09.798Z"}
{"level":"http","message":"POST /api/purchase-history/create 401 3.558 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-002\",\"items\":[{\"productId\":\"BT10\",\"quantity\":2,\"sizeIndex\":0,\"unitPrice\":150000},{\"productId\":\"DC11\",\"quantity\":1,\"sizeIndex\":1,\"unitPrice\":250000}],\"totalAmount\":550000,\"paymentMethod\":\"cod\",\"deliveryAddress\":{\"fullName\":\"Nguyen Dao\",\"phone\":\"0123456789\",\"street\":\"123 Main St\",\"ward\":\"Ward 1\",\"district\":\"District 1\",\"city\":\"Ho Chi Minh\",\"zipCode\":\"70000\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"Giao hàng giờ hành chính\"} - User: guest","timestamp":"2025-07-13T09:22:11.956Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 16.950 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-002\",\"items\":[{\"productId\":\"BT10\",\"quantity\":2,\"sizeIndex\":0,\"unitPrice\":150000},{\"productId\":\"DC11\",\"quantity\":1,\"sizeIndex\":1,\"unitPrice\":250000}],\"totalAmount\":550000,\"paymentMethod\":\"cod\",\"deliveryAddress\":{\"fullName\":\"Nguyen Dao\",\"phone\":\"0123456789\",\"street\":\"123 Main St\",\"ward\":\"Ward 1\",\"district\":\"District 1\",\"city\":\"Ho Chi Minh\",\"zipCode\":\"70000\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"Giao hàng giờ hành chính\"} - User: -","timestamp":"2025-07-13T09:22:42.973Z"}
{"level":"http","message":"GET /api/cart 304 8.393 ms - {} - User: -","timestamp":"2025-07-13T09:24:05.792Z"}
{"level":"http","message":"GET /api/cart 304 10.019 ms - {} - User: -","timestamp":"2025-07-13T09:24:05.823Z"}
{"level":"http","message":"GET /api/cart 304 7.018 ms - {} - User: -","timestamp":"2025-07-13T09:24:11.479Z"}
{"level":"http","message":"GET /api/cart 304 6.190 ms - {} - User: -","timestamp":"2025-07-13T09:24:16.819Z"}
{"level":"http","message":"GET /api/cart 304 85.587 ms - {} - User: -","timestamp":"2025-07-13T09:24:23.566Z"}
{"level":"http","message":"GET /api/cart 304 6.745 ms - {} - User: -","timestamp":"2025-07-13T09:24:23.946Z"}
{"level":"http","message":"GET /api/products?limit=100 304 38.122 ms - {} - User: guest","timestamp":"2025-07-13T09:25:16.820Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 41.715 ms - {} - User: guest","timestamp":"2025-07-13T09:25:16.826Z"}
{"level":"http","message":"GET /api/collections 304 40.735 ms - {} - User: guest","timestamp":"2025-07-13T09:25:16.828Z"}
{"level":"http","message":"GET /api/cart 304 39.241 ms - {} - User: -","timestamp":"2025-07-13T09:25:16.830Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.475 ms - {} - User: guest","timestamp":"2025-07-13T09:25:16.833Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.117 ms - {} - User: guest","timestamp":"2025-07-13T09:25:16.836Z"}
{"level":"http","message":"GET /api/collections 304 8.851 ms - {} - User: guest","timestamp":"2025-07-13T09:25:16.847Z"}
{"level":"http","message":"GET /api/cart 304 9.813 ms - {} - User: -","timestamp":"2025-07-13T09:25:16.850Z"}
{"level":"http","message":"GET /api/cart 304 7.604 ms - {} - User: -","timestamp":"2025-07-13T09:25:16.860Z"}
{"level":"http","message":"GET /api/cart 304 6.460 ms - {} - User: -","timestamp":"2025-07-13T09:25:16.867Z"}
{"level":"http","message":"GET /api/wishlist 304 16.776 ms - {} - User: -","timestamp":"2025-07-13T09:25:16.963Z"}
{"level":"http","message":"GET /api/wishlist 304 14.643 ms - {} - User: -","timestamp":"2025-07-13T09:25:16.980Z"}
{"level":"http","message":"GET /api/wishlist 304 10.880 ms - {} - User: -","timestamp":"2025-07-13T09:25:16.992Z"}
{"level":"http","message":"GET /api/wishlist 304 11.785 ms - {} - User: -","timestamp":"2025-07-13T09:25:17.005Z"}
{"level":"http","message":"GET /api/wishlist 304 10.945 ms - {} - User: -","timestamp":"2025-07-13T09:25:17.018Z"}
{"level":"http","message":"GET /api/wishlist 304 13.096 ms - {} - User: -","timestamp":"2025-07-13T09:25:17.033Z"}
{"level":"info","message":"findByEmailOrUsername called with:","timestamp":"2025-07-13T09:25:22.248Z"}
{"level":"info","message":"Searching with identifier:","timestamp":"2025-07-13T09:25:22.248Z"}
{"level":"http","message":"POST /api/auth/login 200 62.216 ms - {\"userName\":\"nguyendao21012002@gmail.com\",\"password\":\"[REDACTED]\"} - User: guest","timestamp":"2025-07-13T09:25:22.309Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.163 ms - {} - User: guest","timestamp":"2025-07-13T09:25:23.842Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 0.625 ms - {} - User: guest","timestamp":"2025-07-13T09:25:23.844Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.900 ms - {} - User: guest","timestamp":"2025-07-13T09:25:23.851Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 0.977 ms - {} - User: guest","timestamp":"2025-07-13T09:25:23.853Z"}
{"level":"http","message":"GET /api/collections 304 13.849 ms - {} - User: guest","timestamp":"2025-07-13T09:25:23.859Z"}
{"level":"http","message":"GET /api/cart 304 16.210 ms - {} - User: -","timestamp":"2025-07-13T09:25:23.863Z"}
{"level":"http","message":"GET /api/collections 304 11.945 ms - {} - User: guest","timestamp":"2025-07-13T09:25:23.877Z"}
{"level":"http","message":"GET /api/cart 304 11.570 ms - {} - User: -","timestamp":"2025-07-13T09:25:23.879Z"}
{"level":"http","message":"GET /api/cart 304 6.505 ms - {} - User: -","timestamp":"2025-07-13T09:25:23.887Z"}
{"level":"http","message":"GET /api/cart 304 8.521 ms - {} - User: -","timestamp":"2025-07-13T09:25:23.898Z"}
{"level":"http","message":"GET /api/wishlist 304 13.534 ms - {} - User: -","timestamp":"2025-07-13T09:25:23.930Z"}
{"level":"http","message":"GET /api/wishlist 304 10.625 ms - {} - User: -","timestamp":"2025-07-13T09:25:23.942Z"}
{"level":"http","message":"GET /api/wishlist 304 15.174 ms - {} - User: -","timestamp":"2025-07-13T09:25:23.959Z"}
{"level":"http","message":"GET /api/wishlist 304 11.573 ms - {} - User: -","timestamp":"2025-07-13T09:25:23.972Z"}
{"level":"http","message":"GET /api/wishlist 304 11.107 ms - {} - User: -","timestamp":"2025-07-13T09:25:23.986Z"}
{"level":"http","message":"GET /api/wishlist 304 10.728 ms - {} - User: -","timestamp":"2025-07-13T09:25:23.999Z"}
{"level":"http","message":"GET /api/collections/ChotMe/products 304 9.780 ms - {} - User: guest","timestamp":"2025-07-13T09:25:29.640Z"}
{"level":"http","message":"GET /api/cart 304 10.794 ms - {} - User: -","timestamp":"2025-07-13T09:25:29.642Z"}
{"level":"http","message":"GET /api/collections/ChotMe/products 304 7.570 ms - {} - User: guest","timestamp":"2025-07-13T09:25:29.651Z"}
{"level":"http","message":"GET /api/cart 304 8.259 ms - {} - User: -","timestamp":"2025-07-13T09:25:29.653Z"}
{"level":"http","message":"GET /api/cart 304 12.762 ms - {} - User: -","timestamp":"2025-07-13T09:25:29.669Z"}
{"level":"http","message":"GET /api/wishlist 304 17.697 ms - {} - User: -","timestamp":"2025-07-13T09:25:29.679Z"}
{"level":"http","message":"GET /api/cart 304 12.139 ms - {} - User: -","timestamp":"2025-07-13T09:25:29.685Z"}
{"level":"http","message":"GET /api/wishlist 304 13.524 ms - {} - User: -","timestamp":"2025-07-13T09:25:29.695Z"}
{"level":"http","message":"GET /api/products/BT1 304 3.811 ms - {} - User: guest","timestamp":"2025-07-13T09:25:31.052Z"}
{"level":"http","message":"GET /api/cart 304 9.193 ms - {} - User: -","timestamp":"2025-07-13T09:25:31.054Z"}
{"level":"http","message":"GET /api/products/BT1 304 0.785 ms - {} - User: guest","timestamp":"2025-07-13T09:25:31.057Z"}
{"level":"http","message":"GET /api/cart 304 7.511 ms - {} - User: -","timestamp":"2025-07-13T09:25:31.066Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 16.403 ms - {} - User: guest","timestamp":"2025-07-13T09:25:31.083Z"}
{"level":"http","message":"GET /api/cart 304 14.517 ms - {} - User: -","timestamp":"2025-07-13T09:25:31.084Z"}
{"level":"http","message":"GET /api/cart 304 6.794 ms - {} - User: -","timestamp":"2025-07-13T09:25:31.093Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 0.734 ms - {} - User: guest","timestamp":"2025-07-13T09:25:31.112Z"}
{"level":"http","message":"GET /api/cart 304 7.737 ms - {} - User: -","timestamp":"2025-07-13T09:25:40.665Z"}
{"level":"http","message":"GET /api/cart 304 27.968 ms - {} - User: -","timestamp":"2025-07-13T09:25:59.758Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 14.462 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-185\",\"items\":[{\"productId\":\"BT1\",\"quantity\":1,\"sizeIndex\":0,\"unitPrice\":8721000}],\"totalAmount\":8751000,\"paymentMethod\":\"cod\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"b\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T09:25:59.842Z"}
{"level":"http","message":"GET /api/cart 304 17.741 ms - {} - User: -","timestamp":"2025-07-13T09:26:08.590Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 200 28.420 ms - {} - User: -","timestamp":"2025-07-13T09:26:08.606Z"}
{"level":"http","message":"GET /api/cart 304 18.882 ms - {} - User: -","timestamp":"2025-07-13T09:26:08.615Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 25.639 ms - {} - User: -","timestamp":"2025-07-13T09:26:08.638Z"}
{"level":"http","message":"GET /api/cart 304 20.505 ms - {} - User: -","timestamp":"2025-07-13T09:26:08.643Z"}
{"level":"http","message":"GET /api/cart 304 5.414 ms - {} - User: -","timestamp":"2025-07-13T09:26:08.651Z"}
{"level":"http","message":"GET /api/cart 304 6.783 ms - {} - User: -","timestamp":"2025-07-13T09:26:08.659Z"}
{"level":"http","message":"GET /api/cart 304 10.210 ms - {} - User: -","timestamp":"2025-07-13T09:26:15.106Z"}
{"level":"http","message":"GET /api/purchase-history/ORD-2025-185 200 9.107 ms - {} - User: -","timestamp":"2025-07-13T09:26:21.954Z"}
{"level":"http","message":"GET /api/cart 304 20.047 ms - {} - User: -","timestamp":"2025-07-13T09:26:34.996Z"}
{"level":"http","message":"GET /api/cart 304 6.485 ms - {} - User: -","timestamp":"2025-07-13T09:26:38.744Z"}
{"level":"http","message":"GET /api/cart 304 7.383 ms - {} - User: -","timestamp":"2025-07-13T09:27:08.760Z"}
{"level":"http","message":"GET /api/cart 304 7.704 ms - {} - User: -","timestamp":"2025-07-13T09:27:38.755Z"}
{"level":"http","message":"GET /api/cart 304 9.247 ms - {} - User: -","timestamp":"2025-07-13T09:28:08.765Z"}
{"level":"http","message":"GET /api/cart 304 28.119 ms - {} - User: -","timestamp":"2025-07-13T09:28:09.437Z"}
{"header":"t=1752400084,v1=33d73ba88c426606ac7a5626ad78d1bea2fafe0eea72d3c5dcfbaa1cdc5b0710,v0=bfce7b47c0f3a2301384f71b310da010c0bcfe6aa9c8ba579ad97bf11a268ca2","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389353,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":32900000,"amount_total":32900000,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"https://28bc8c954193.ngrok-free.app/api/payment/cancel?order_id=ORD-TEST-1705123456789","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752389198,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752475598,"id":"cs_test_b197FMgamPWhf03ywjMiihS4x7G7fnFT3exFy2cUBny50y60obcwwbu3GZ","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-TEST-1705123456789","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkJimBopfvfSoZm0cJ3ohmz","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"https://28bc8c954193.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-TEST-1705123456789","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkJinBopfvfSoZm2xAEOyBl","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T09:48:04.941Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T09:48:04.945Z"}
{"level":"http","message":"POST /api/payment/webhook 400 6.579 ms - {\"id\":\"evt_1RkJinBopfvfSoZm2xAEOyBl\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752389353,\"data\":{\"object\":{\"id\":\"cs_test_b197FMgamPWhf03ywjMiihS4x7G7fnFT3exFy2cUBny50y60obcwwbu3GZ\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":32900000,\"amount_total\":32900000,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"https://28bc8c954193.ngrok-free.app/api/payment/cancel?order_id=ORD-TEST-1705123456789\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"name\":\"Nguyen Dao\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752389198,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":null,\"state\":\"Hà Nội\"},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyen Dao\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752475598,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-TEST-1705123456789\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkJimBopfvfSoZm0cJ3ohmz\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"https://28bc8c954193.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-TEST-1705123456789\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T09:48:04.946Z"}
{"header":"t=1752400256,v1=da875ba21ad8db41866c41a979de7adf6f9b9d4135231938049473d81d3f77a4,v0=83c0ad020cfd866d34b15b7262f5d2ac5443f890e9760b576198d8f98b21b252","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389353,"data":{"object":{"amount":32900000,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":32900000,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkJimBopfvfSoZm0cJ3ohmz_secret_VzqBSx7wybWW4xk3HGRxzgpcq","confirmation_method":"automatic","created":1752389352,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkJimBopfvfSoZm0cJ3ohmz","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkJimBopfvfSoZm02yHdzC3","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkJimBopfvfSoZmGZQpQTG8","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkJimBopfvfSoZm0PJDoO8j","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"a613428b-c37a-4a4f-bcc6-c4aa6b9b7f72"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T09:50:56.680Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T09:50:56.682Z"}
{"level":"http","message":"POST /api/payment/webhook 400 4.605 ms - {\"id\":\"evt_3RkJimBopfvfSoZm0PJDoO8j\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752389353,\"data\":{\"object\":{\"id\":\"pi_3RkJimBopfvfSoZm0cJ3ohmz\",\"object\":\"payment_intent\",\"amount\":32900000,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":32900000,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkJimBopfvfSoZm0cJ3ohmz_secret_VzqBSx7wybWW4xk3HGRxzgpcq\",\"confirmation_method\":\"automatic\",\"created\":1752389352,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkJimBopfvfSoZm02yHdzC3\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkJimBopfvfSoZmGZQpQTG8\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"a613428b-c37a-4a4f-bcc6-c4aa6b9b7f72\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T09:50:56.684Z"}
{"header":"t=1752400558,v1=35bb6a7d21aa1bf149ab164e8225454aba41348890d991854f42dffcf54412af,v0=226768292ad2fd0c2c05754cb48ae3bae30626dd46fee595a0508d547da11a89","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389714,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":32900000,"amount_total":32900000,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"https://28bc8c954193.ngrok-free.app/api/payment/cancel?order_id=ORD-TEST-1705123456781","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752389600,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752475999,"id":"cs_test_b1nrH9oLBoI3E21AtiRRbgPNnNK8lkMiqqCXk3wg11U9B9zVYHZ9UjUs26","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-TEST-1705123456781","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkJobBopfvfSoZm2IA8nTOk","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"https://28bc8c954193.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-TEST-1705123456781","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkJocBopfvfSoZmKTkpJD72","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T09:55:59.104Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T09:55:59.109Z"}
{"level":"http","message":"POST /api/payment/webhook 400 6.102 ms - {\"id\":\"evt_1RkJocBopfvfSoZmKTkpJD72\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752389714,\"data\":{\"object\":{\"id\":\"cs_test_b1nrH9oLBoI3E21AtiRRbgPNnNK8lkMiqqCXk3wg11U9B9zVYHZ9UjUs26\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":32900000,\"amount_total\":32900000,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"https://28bc8c954193.ngrok-free.app/api/payment/cancel?order_id=ORD-TEST-1705123456781\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"name\":\"Nguyen Dao\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752389600,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":null,\"state\":\"Hà Nội\"},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyen Dao\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752475999,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-TEST-1705123456781\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkJobBopfvfSoZm2IA8nTOk\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"https://28bc8c954193.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-TEST-1705123456781\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T09:55:59.110Z"}
{"header":"t=1752400561,v1=af3628a9abf71566e11185b41b92e8d7ed037d604d4155186cf896a9fc4e5810,v0=6661926f5ec0f34f8ddf5a5a49deed8612496e7bf5d73d1093e2d50cdea71853","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752389714,"data":{"object":{"amount":32900000,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":32900000,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkJobBopfvfSoZm2IA8nTOk_secret_Kuo7jTpZYKEoHqJB4p6iY2G9l","confirmation_method":"automatic","created":1752389713,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkJobBopfvfSoZm2IA8nTOk","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkJobBopfvfSoZm2NAcR4Mq","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkJobBopfvfSoZmWwngUPKv","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkJobBopfvfSoZm23vDoMOk","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"a1abce98-d185-49d8-ab0a-3bb1c42ed4cd"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T09:56:02.387Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T09:56:02.389Z"}
{"level":"http","message":"POST /api/payment/webhook 400 3.566 ms - {\"id\":\"evt_3RkJobBopfvfSoZm23vDoMOk\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752389714,\"data\":{\"object\":{\"id\":\"pi_3RkJobBopfvfSoZm2IA8nTOk\",\"object\":\"payment_intent\",\"amount\":32900000,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":32900000,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkJobBopfvfSoZm2IA8nTOk_secret_Kuo7jTpZYKEoHqJB4p6iY2G9l\",\"confirmation_method\":\"automatic\",\"created\":1752389713,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkJobBopfvfSoZm2NAcR4Mq\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkJobBopfvfSoZmWwngUPKv\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"a1abce98-d185-49d8-ab0a-3bb1c42ed4cd\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T09:56:02.390Z"}
{"level":"info","message":"🛑 SIGINT received, shutting down gracefully","timestamp":"2025-07-13T09:59:57.369Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T10:32:54.486Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T10:32:54.489Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T10:32:54.490Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T10:32:54.490Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T10:32:54.729Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T10:32:54.733Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T10:32:54.956Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T10:32:54.958Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T10:32:54.959Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T10:32:54.959Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T10:32:54.959Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T10:32:54.960Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T10:32:54.960Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T10:32:54.960Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T10:32:54.960Z"}
{"level":"info","message":"findByEmailOrUsername called with:","timestamp":"2025-07-13T10:32:57.414Z"}
{"level":"info","message":"Searching with identifier:","timestamp":"2025-07-13T10:32:57.414Z"}
{"level":"http","message":"POST /api/auth/login 200 76.140 ms - {\"userName\":\"nguyendao21012002@gmail.com\",\"password\":\"[REDACTED]\"} - User: guest","timestamp":"2025-07-13T10:32:57.487Z"}
{"level":"http","message":"GET /api/products?limit=100 304 48.483 ms - {} - User: guest","timestamp":"2025-07-13T10:32:59.073Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 46.059 ms - {} - User: guest","timestamp":"2025-07-13T10:32:59.078Z"}
{"level":"http","message":"GET /api/cart 304 45.496 ms - {} - User: -","timestamp":"2025-07-13T10:32:59.084Z"}
{"level":"http","message":"GET /api/collections 304 38.633 ms - {} - User: guest","timestamp":"2025-07-13T10:32:59.087Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.254 ms - {} - User: guest","timestamp":"2025-07-13T10:32:59.090Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 0.680 ms - {} - User: guest","timestamp":"2025-07-13T10:32:59.092Z"}
{"level":"http","message":"GET /api/cart 304 19.448 ms - {} - User: -","timestamp":"2025-07-13T10:32:59.114Z"}
{"level":"http","message":"GET /api/collections 304 17.990 ms - {} - User: guest","timestamp":"2025-07-13T10:32:59.117Z"}
{"level":"http","message":"GET /api/cart 304 13.041 ms - {} - User: -","timestamp":"2025-07-13T10:32:59.140Z"}
{"level":"http","message":"GET /api/wishlist 304 26.188 ms - {} - User: -","timestamp":"2025-07-13T10:32:59.146Z"}
{"level":"http","message":"GET /api/cart 304 13.350 ms - {} - User: -","timestamp":"2025-07-13T10:32:59.161Z"}
{"level":"http","message":"GET /api/wishlist 304 14.067 ms - {} - User: -","timestamp":"2025-07-13T10:32:59.165Z"}
{"level":"http","message":"GET /api/wishlist 304 7.781 ms - {} - User: -","timestamp":"2025-07-13T10:32:59.174Z"}
{"level":"http","message":"GET /api/wishlist 304 7.787 ms - {} - User: -","timestamp":"2025-07-13T10:32:59.184Z"}
{"level":"http","message":"GET /api/wishlist 304 8.220 ms - {} - User: -","timestamp":"2025-07-13T10:32:59.194Z"}
{"level":"http","message":"GET /api/wishlist 304 7.114 ms - {} - User: -","timestamp":"2025-07-13T10:32:59.202Z"}
{"level":"http","message":"GET /api/products?limit=100 304 0.875 ms - {} - User: guest","timestamp":"2025-07-13T10:33:02.018Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 0.874 ms - {} - User: guest","timestamp":"2025-07-13T10:33:02.020Z"}
{"level":"http","message":"GET /api/products?limit=100 304 0.863 ms - {} - User: guest","timestamp":"2025-07-13T10:33:02.027Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 0.750 ms - {} - User: guest","timestamp":"2025-07-13T10:33:02.029Z"}
{"level":"http","message":"GET /api/cart 304 19.715 ms - {} - User: -","timestamp":"2025-07-13T10:33:02.032Z"}
{"level":"http","message":"GET /api/collections 304 15.756 ms - {} - User: guest","timestamp":"2025-07-13T10:33:02.037Z"}
{"level":"http","message":"GET /api/cart 304 14.245 ms - {} - User: -","timestamp":"2025-07-13T10:33:02.052Z"}
{"level":"http","message":"GET /api/collections 304 12.601 ms - {} - User: guest","timestamp":"2025-07-13T10:33:02.055Z"}
{"level":"http","message":"GET /api/cart 304 7.946 ms - {} - User: -","timestamp":"2025-07-13T10:33:02.065Z"}
{"level":"http","message":"GET /api/cart 304 9.863 ms - {} - User: -","timestamp":"2025-07-13T10:33:02.077Z"}
{"level":"http","message":"GET /api/wishlist 304 9.774 ms - {} - User: -","timestamp":"2025-07-13T10:33:02.095Z"}
{"level":"http","message":"GET /api/wishlist 304 9.573 ms - {} - User: -","timestamp":"2025-07-13T10:33:02.107Z"}
{"level":"http","message":"GET /api/wishlist 304 12.683 ms - {} - User: -","timestamp":"2025-07-13T10:33:02.122Z"}
{"level":"http","message":"GET /api/wishlist 304 11.266 ms - {} - User: -","timestamp":"2025-07-13T10:33:02.137Z"}
{"level":"http","message":"GET /api/wishlist 304 12.364 ms - {} - User: -","timestamp":"2025-07-13T10:33:02.151Z"}
{"level":"http","message":"GET /api/wishlist 304 8.720 ms - {} - User: -","timestamp":"2025-07-13T10:33:02.161Z"}
{"level":"http","message":"GET /api/products/NB12 304 6.930 ms - {} - User: guest","timestamp":"2025-07-13T10:33:04.073Z"}
{"level":"http","message":"GET /api/products/NB12 304 1.038 ms - {} - User: guest","timestamp":"2025-07-13T10:33:04.078Z"}
{"level":"http","message":"GET /api/cart 304 13.230 ms - {} - User: -","timestamp":"2025-07-13T10:33:04.082Z"}
{"level":"http","message":"GET /api/cart 304 11.631 ms - {} - User: -","timestamp":"2025-07-13T10:33:04.095Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 17.058 ms - {} - User: guest","timestamp":"2025-07-13T10:33:04.107Z"}
{"level":"http","message":"GET /api/cart 304 10.145 ms - {} - User: -","timestamp":"2025-07-13T10:33:04.112Z"}
{"level":"http","message":"GET /api/cart 304 9.906 ms - {} - User: -","timestamp":"2025-07-13T10:33:04.124Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 2.393 ms - {} - User: guest","timestamp":"2025-07-13T10:33:04.164Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 17.857 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-961\",\"items\":[{\"productId\":\"NB12\",\"nameProduct\":\"Nhẫn Bạc đính đá STYLE By PNJ ZTXMW000032\",\"quantity\":1,\"sizeIndex\":0,\"unitPrice\":589500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-B1.2.1.png?alt=media&token=a9502595-0167-4a98-8f34-4eefd1f35ba8\"}],\"totalAmount\":619500,\"paymentMethod\":\"cod\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"b\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T10:33:17.402Z"}
{"level":"http","message":"GET /api/cart 304 14.797 ms - {} - User: -","timestamp":"2025-07-13T10:33:19.033Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 200 28.807 ms - {} - User: -","timestamp":"2025-07-13T10:33:19.051Z"}
{"level":"http","message":"GET /api/cart 304 20.839 ms - {} - User: -","timestamp":"2025-07-13T10:33:19.062Z"}
{"level":"http","message":"GET /api/cart 304 16.386 ms - {} - User: -","timestamp":"2025-07-13T10:33:19.082Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 40.161 ms - {} - User: -","timestamp":"2025-07-13T10:33:19.094Z"}
{"level":"http","message":"GET /api/cart 304 11.359 ms - {} - User: -","timestamp":"2025-07-13T10:33:19.097Z"}
{"level":"http","message":"GET /api/cart 304 5.727 ms - {} - User: -","timestamp":"2025-07-13T10:33:19.104Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.816 ms - {} - User: guest","timestamp":"2025-07-13T10:33:25.531Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 0.656 ms - {} - User: guest","timestamp":"2025-07-13T10:33:25.537Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.892 ms - {} - User: guest","timestamp":"2025-07-13T10:33:25.544Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.118 ms - {} - User: guest","timestamp":"2025-07-13T10:33:25.548Z"}
{"level":"http","message":"GET /api/cart 304 20.358 ms - {} - User: -","timestamp":"2025-07-13T10:33:25.553Z"}
{"level":"http","message":"GET /api/collections 304 20.413 ms - {} - User: guest","timestamp":"2025-07-13T10:33:25.559Z"}
{"level":"http","message":"GET /api/collections 304 17.155 ms - {} - User: guest","timestamp":"2025-07-13T10:33:25.584Z"}
{"level":"http","message":"GET /api/cart 304 25.967 ms - {} - User: -","timestamp":"2025-07-13T10:33:25.587Z"}
{"level":"http","message":"GET /api/cart 304 17.016 ms - {} - User: -","timestamp":"2025-07-13T10:33:25.606Z"}
{"level":"http","message":"GET /api/wishlist 304 19.599 ms - {} - User: -","timestamp":"2025-07-13T10:33:25.620Z"}
{"level":"http","message":"GET /api/cart 304 11.607 ms - {} - User: -","timestamp":"2025-07-13T10:33:25.623Z"}
{"level":"http","message":"GET /api/wishlist 304 12.852 ms - {} - User: -","timestamp":"2025-07-13T10:33:25.637Z"}
{"level":"http","message":"GET /api/wishlist 304 11.826 ms - {} - User: -","timestamp":"2025-07-13T10:33:25.651Z"}
{"level":"http","message":"GET /api/wishlist 304 11.639 ms - {} - User: -","timestamp":"2025-07-13T10:33:25.664Z"}
{"level":"http","message":"GET /api/wishlist 304 7.504 ms - {} - User: -","timestamp":"2025-07-13T10:33:25.673Z"}
{"level":"http","message":"GET /api/wishlist 304 9.254 ms - {} - User: -","timestamp":"2025-07-13T10:33:25.684Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 0.635 ms - {} - User: guest","timestamp":"2025-07-13T10:33:28.031Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 0.615 ms - {} - User: guest","timestamp":"2025-07-13T10:33:28.040Z"}
{"level":"http","message":"GET /api/cart 304 23.732 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.047Z"}
{"level":"http","message":"GET /api/products?limit=1000 304 24.965 ms - {} - User: guest","timestamp":"2025-07-13T10:33:28.057Z"}
{"level":"http","message":"GET /api/wishlist 304 36.410 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.064Z"}
{"level":"http","message":"GET /api/products?limit=1000 304 1.292 ms - {} - User: guest","timestamp":"2025-07-13T10:33:28.067Z"}
{"level":"http","message":"GET /api/cart 304 17.763 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.076Z"}
{"level":"http","message":"GET /api/wishlist 304 15.670 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.088Z"}
{"level":"http","message":"GET /api/cart 304 11.085 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.091Z"}
{"level":"http","message":"GET /api/cart 304 12.729 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.110Z"}
{"level":"http","message":"GET /api/wishlist 304 19.925 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.113Z"}
{"level":"http","message":"GET /api/wishlist 304 10.437 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.128Z"}
{"level":"http","message":"GET /api/wishlist 304 11.819 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.141Z"}
{"level":"http","message":"GET /api/wishlist 304 9.922 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.153Z"}
{"level":"http","message":"GET /api/wishlist 304 8.805 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.163Z"}
{"level":"http","message":"GET /api/wishlist 304 9.373 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.174Z"}
{"level":"http","message":"GET /api/wishlist 304 7.658 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.183Z"}
{"level":"http","message":"GET /api/wishlist 304 9.158 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.193Z"}
{"level":"http","message":"GET /api/wishlist 304 8.720 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.204Z"}
{"level":"http","message":"GET /api/wishlist 304 19.669 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.225Z"}
{"level":"http","message":"GET /api/wishlist 304 8.319 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.235Z"}
{"level":"http","message":"GET /api/wishlist 304 10.636 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.248Z"}
{"level":"http","message":"GET /api/wishlist 304 10.788 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.260Z"}
{"level":"http","message":"GET /api/wishlist 304 9.675 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.270Z"}
{"level":"http","message":"GET /api/wishlist 304 9.133 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.281Z"}
{"level":"http","message":"GET /api/wishlist 304 9.297 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.292Z"}
{"level":"http","message":"GET /api/wishlist 304 11.254 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.304Z"}
{"level":"http","message":"GET /api/wishlist 304 10.085 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.317Z"}
{"level":"http","message":"GET /api/wishlist 304 9.606 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.327Z"}
{"level":"http","message":"GET /api/wishlist 304 9.668 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.339Z"}
{"level":"http","message":"GET /api/wishlist 304 8.657 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.349Z"}
{"level":"http","message":"GET /api/wishlist 304 8.195 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.358Z"}
{"level":"http","message":"GET /api/wishlist 304 11.970 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.372Z"}
{"level":"http","message":"GET /api/wishlist 304 10.478 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.387Z"}
{"level":"http","message":"GET /api/wishlist 304 7.735 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.396Z"}
{"level":"http","message":"GET /api/wishlist 304 7.744 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.405Z"}
{"level":"http","message":"GET /api/wishlist 304 7.761 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.413Z"}
{"level":"http","message":"GET /api/wishlist 304 6.469 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.421Z"}
{"level":"http","message":"GET /api/wishlist 304 7.782 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.430Z"}
{"level":"http","message":"GET /api/wishlist 304 7.132 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.439Z"}
{"level":"http","message":"GET /api/wishlist 304 6.240 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.446Z"}
{"level":"http","message":"GET /api/wishlist 304 8.284 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.456Z"}
{"level":"http","message":"GET /api/wishlist 304 7.801 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.465Z"}
{"level":"http","message":"GET /api/wishlist 304 11.815 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.478Z"}
{"level":"http","message":"GET /api/wishlist 304 11.135 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.491Z"}
{"level":"http","message":"GET /api/wishlist 304 10.848 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.504Z"}
{"level":"http","message":"GET /api/wishlist 304 10.010 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.515Z"}
{"level":"http","message":"GET /api/wishlist 304 10.364 ms - {} - User: -","timestamp":"2025-07-13T10:33:28.527Z"}
{"level":"http","message":"GET /api/products/N10K2 200 5.554 ms - {} - User: guest","timestamp":"2025-07-13T10:33:29.525Z"}
{"level":"http","message":"GET /api/cart 304 13.214 ms - {} - User: -","timestamp":"2025-07-13T10:33:29.528Z"}
{"level":"http","message":"GET /api/products/N10K2 304 0.647 ms - {} - User: guest","timestamp":"2025-07-13T10:33:29.530Z"}
{"level":"http","message":"GET /api/cart 304 9.256 ms - {} - User: -","timestamp":"2025-07-13T10:33:29.540Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 1.144 ms - {} - User: guest","timestamp":"2025-07-13T10:33:29.543Z"}
{"level":"http","message":"GET /api/cart 304 7.511 ms - {} - User: -","timestamp":"2025-07-13T10:33:29.552Z"}
{"level":"http","message":"GET /api/cart 304 7.680 ms - {} - User: -","timestamp":"2025-07-13T10:33:29.562Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 1.082 ms - {} - User: guest","timestamp":"2025-07-13T10:33:29.573Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 13.675 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-125\",\"items\":[{\"productId\":\"N10K2\",\"nameProduct\":\"Nhẫn nam Vàng trắng 10K đính đá ECZ MANCODE by PNJ Vương Xà Trấn Bảo XMXMW005721\",\"quantity\":1,\"sizeIndex\":0,\"unitPrice\":17164800,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-10K2.1.png?alt=media&token=355d3335-f7a2-467a-8b0a-815a67ea4caf\"}],\"totalAmount\":17194800,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"b\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T10:33:46.252Z"}
{"level":"http","message":"POST /api/payment/create-checkout 403 2.770 ms - {\"orderId\":\"ORD-2025-125\",\"totalAmount\":17194800,\"items\":[{\"productId\":\"N10K2\",\"nameProduct\":\"Nhẫn nam Vàng trắng 10K đính đá ECZ MANCODE by PNJ Vương Xà Trấn Bảo XMXMW005721\",\"quantity\":1,\"unitPrice\":17164800,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-10K2.1.png?alt=media&token=355d3335-f7a2-467a-8b0a-815a67ea4caf\"}],\"shippingFee\":30000,\"discount\":0} - User: guest","timestamp":"2025-07-13T10:33:46.262Z"}
{"level":"info","message":"findByEmailOrUsername called with:","timestamp":"2025-07-13T10:46:54.545Z"}
{"level":"info","message":"Searching with identifier:","timestamp":"2025-07-13T10:46:54.545Z"}
{"level":"http","message":"POST /api/auth/login 200 60.223 ms - {\"userName\":\"nguyendao21012002@gmail.com\",\"password\":\"[REDACTED]\"} - User: guest","timestamp":"2025-07-13T10:46:54.605Z"}
{"level":"http","message":"GET /api/products?limit=100 304 53.990 ms - {} - User: guest","timestamp":"2025-07-13T10:46:56.185Z"}
{"level":"http","message":"GET /api/cart 304 52.958 ms - {} - User: -","timestamp":"2025-07-13T10:46:56.189Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 53.945 ms - {} - User: guest","timestamp":"2025-07-13T10:46:56.194Z"}
{"level":"http","message":"GET /api/collections 304 56.403 ms - {} - User: guest","timestamp":"2025-07-13T10:46:56.200Z"}
{"level":"http","message":"GET /api/products?limit=100 304 4.309 ms - {} - User: guest","timestamp":"2025-07-13T10:46:56.214Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.330 ms - {} - User: guest","timestamp":"2025-07-13T10:46:56.221Z"}
{"level":"http","message":"GET /api/cart 304 21.234 ms - {} - User: -","timestamp":"2025-07-13T10:46:56.237Z"}
{"level":"http","message":"GET /api/collections 304 21.490 ms - {} - User: guest","timestamp":"2025-07-13T10:46:56.245Z"}
{"level":"http","message":"GET /api/cart 304 11.562 ms - {} - User: -","timestamp":"2025-07-13T10:46:56.259Z"}
{"level":"http","message":"GET /api/wishlist 304 21.231 ms - {} - User: -","timestamp":"2025-07-13T10:46:56.261Z"}
{"level":"http","message":"GET /api/cart 304 11.861 ms - {} - User: -","timestamp":"2025-07-13T10:46:56.274Z"}
{"level":"http","message":"GET /api/wishlist 304 11.201 ms - {} - User: -","timestamp":"2025-07-13T10:46:56.279Z"}
{"level":"http","message":"GET /api/wishlist 304 6.808 ms - {} - User: -","timestamp":"2025-07-13T10:46:56.287Z"}
{"level":"http","message":"GET /api/wishlist 304 9.590 ms - {} - User: -","timestamp":"2025-07-13T10:46:56.298Z"}
{"level":"http","message":"GET /api/wishlist 304 7.283 ms - {} - User: -","timestamp":"2025-07-13T10:46:56.306Z"}
{"level":"http","message":"GET /api/wishlist 304 7.050 ms - {} - User: -","timestamp":"2025-07-13T10:46:56.314Z"}
{"level":"http","message":"GET /api/products/NB12 304 4.573 ms - {} - User: guest","timestamp":"2025-07-13T10:46:59.122Z"}
{"level":"http","message":"GET /api/cart 304 10.258 ms - {} - User: -","timestamp":"2025-07-13T10:46:59.124Z"}
{"level":"http","message":"GET /api/products/NB12 304 0.636 ms - {} - User: guest","timestamp":"2025-07-13T10:46:59.126Z"}
{"level":"http","message":"GET /api/cart 304 5.824 ms - {} - User: -","timestamp":"2025-07-13T10:46:59.132Z"}
{"level":"http","message":"GET /api/cart 304 12.189 ms - {} - User: -","timestamp":"2025-07-13T10:46:59.146Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 14.130 ms - {} - User: guest","timestamp":"2025-07-13T10:46:59.151Z"}
{"level":"http","message":"GET /api/cart 304 6.400 ms - {} - User: -","timestamp":"2025-07-13T10:46:59.158Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 0.766 ms - {} - User: guest","timestamp":"2025-07-13T10:46:59.162Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 9.143 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-139\",\"items\":[{\"productId\":\"NB12\",\"nameProduct\":\"Nhẫn Bạc đính đá STYLE By PNJ ZTXMW000032\",\"quantity\":1,\"sizeIndex\":2,\"unitPrice\":589500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-B1.2.1.png?alt=media&token=a9502595-0167-4a98-8f34-4eefd1f35ba8\"}],\"totalAmount\":619500,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"b\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T10:47:10.852Z"}
{"code":"url_invalid","doc_url":"https://stripe.com/docs/error-codes/url-invalid","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"432","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=_wkF5oKZjBrJ6UYdatwxROtBqi4UYBEC2t5297KYIs9K8V3BQ7Cas-20AHmxTp6s72wcnvf1qg8boNvv","content-type":"application/json","date":"Sun, 13 Jul 2025 10:47:11 GMT","idempotency-key":"stripe-node-retry-f1768e5f-8691-4d75-ae97-b2af1ee2cc4f","original-request":"req_nkZk5Ve7Avcv23","request-id":"req_nkZk5Ve7Avcv23","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Stripe createCheckoutSession error: Invalid URL: Non-ASCII characters in URLs must be percent-encoded in order for the URL to be valid.","param":"line_items[0][price_data][product_data][images][0]","raw":{"code":"url_invalid","doc_url":"https://stripe.com/docs/error-codes/url-invalid","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"432","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=_wkF5oKZjBrJ6UYdatwxROtBqi4UYBEC2t5297KYIs9K8V3BQ7Cas-20AHmxTp6s72wcnvf1qg8boNvv","content-type":"application/json","date":"Sun, 13 Jul 2025 10:47:11 GMT","idempotency-key":"stripe-node-retry-f1768e5f-8691-4d75-ae97-b2af1ee2cc4f","original-request":"req_nkZk5Ve7Avcv23","request-id":"req_nkZk5Ve7Avcv23","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"Invalid URL: Non-ASCII characters in URLs must be percent-encoded in order for the URL to be valid.","param":"line_items[0][price_data][product_data][images][0]","requestId":"req_nkZk5Ve7Avcv23","request_log_url":"https://dashboard.stripe.com/test/logs/req_nkZk5Ve7Avcv23?t=1752403631","statusCode":400,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_nkZk5Ve7Avcv23","stack":"Error: Invalid URL: Non-ASCII characters in URLs must be percent-encoded in order for the URL to be valid.\n    at generateV1Error (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Error.js:11:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\RequestSender.js:108:62)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","statusCode":400,"timestamp":"2025-07-13T10:47:11.330Z","type":"StripeInvalidRequestError"}
{"level":"error","message":"Create checkout session error: Failed to create checkout session: Invalid URL: Non-ASCII characters in URLs must be percent-encoded in order for the URL to be valid.","stack":"Error: Failed to create checkout session: Invalid URL: Non-ASCII characters in URLs must be percent-encoded in order for the URL to be valid.\n    at StripeService.createCheckoutSession (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:118:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async createCheckoutSession (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:68:28)","timestamp":"2025-07-13T10:47:11.334Z"}
{"level":"http","message":"POST /api/payment/create-checkout 400 472.360 ms - {\"orderId\":\"ORD-2025-139\",\"totalAmount\":619500,\"items\":[{\"productId\":\"NB12\",\"nameProduct\":\"Nhẫn Bạc đính đá STYLE By PNJ ZTXMW000032\",\"quantity\":1,\"unitPrice\":589500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-B1.2.1.png?alt=media&token=a9502595-0167-4a98-8f34-4eefd1f35ba8\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T10:47:11.336Z"}
{"level":"http","message":"GET /api/cart 304 8.528 ms - {} - User: -","timestamp":"2025-07-13T10:49:27.038Z"}
{"level":"http","message":"GET /api/cart 304 6.431 ms - {} - User: -","timestamp":"2025-07-13T10:49:27.060Z"}
{"level":"http","message":"GET /api/cart 304 5.833 ms - {} - User: -","timestamp":"2025-07-13T10:49:29.129Z"}
{"level":"http","message":"GET /api/cart 304 6.238 ms - {} - User: -","timestamp":"2025-07-13T10:49:59.138Z"}
{"level":"http","message":"GET /api/cart 304 10.898 ms - {} - User: -","timestamp":"2025-07-13T10:50:29.761Z"}
{"level":"http","message":"GET /api/cart 304 5.356 ms - {} - User: -","timestamp":"2025-07-13T10:50:59.757Z"}
{"level":"http","message":"GET /api/cart 304 11.075 ms - {} - User: -","timestamp":"2025-07-13T10:51:29.769Z"}
{"level":"http","message":"GET /api/cart 304 10.378 ms - {} - User: -","timestamp":"2025-07-13T10:51:37.104Z"}
{"level":"http","message":"GET /api/cart 304 12.464 ms - {} - User: -","timestamp":"2025-07-13T10:51:43.381Z"}
{"level":"http","message":"GET /api/cart 304 14.818 ms - {} - User: -","timestamp":"2025-07-13T10:51:45.911Z"}
{"level":"http","message":"GET /api/products/NB12 304 0.626 ms - {} - User: guest","timestamp":"2025-07-13T10:51:47.429Z"}
{"level":"http","message":"GET /api/products/NB12 304 0.774 ms - {} - User: guest","timestamp":"2025-07-13T10:51:47.432Z"}
{"level":"http","message":"GET /api/cart 304 11.175 ms - {} - User: -","timestamp":"2025-07-13T10:51:47.435Z"}
{"level":"http","message":"GET /api/cart 304 10.311 ms - {} - User: -","timestamp":"2025-07-13T10:51:47.446Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 1.259 ms - {} - User: guest","timestamp":"2025-07-13T10:51:47.454Z"}
{"level":"http","message":"GET /api/cart 304 9.165 ms - {} - User: -","timestamp":"2025-07-13T10:51:47.457Z"}
{"level":"http","message":"GET /api/cart 304 5.834 ms - {} - User: -","timestamp":"2025-07-13T10:51:47.464Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 1.777 ms - {} - User: guest","timestamp":"2025-07-13T10:51:47.473Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 8.153 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-513\",\"items\":[{\"productId\":\"NB12\",\"nameProduct\":\"Nhẫn Bạc đính đá STYLE By PNJ ZTXMW000032\",\"quantity\":1,\"sizeIndex\":2,\"unitPrice\":589500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-B1.2.1.png?alt=media&token=a9502595-0167-4a98-8f34-4eefd1f35ba8\"}],\"totalAmount\":619500,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"a\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T10:51:58.732Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 743.104 ms - {\"orderId\":\"ORD-2025-513\",\"totalAmount\":619500,\"items\":[{\"productId\":\"NB12\",\"nameProduct\":\"Nhn Bc nh  STYLE By PNJ ZTXMW000032\",\"quantity\":1,\"unitPrice\":589500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%252FTrang%2520s%E1%BB%A9c%252FNh%E1%BA%ABn%252FN-B1.2.1.png?alt=media&token=a9502595-0167-4a98-8f34-4eefd1f35ba8\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T10:51:59.484Z"}
{"level":"http","message":"GET /api/cart 304 9.099 ms - {} - User: -","timestamp":"2025-07-13T10:53:05.374Z"}
{"level":"http","message":"GET /api/cart 304 6.965 ms - {} - User: -","timestamp":"2025-07-13T10:53:05.400Z"}
{"level":"http","message":"GET /api/cart 304 8.004 ms - {} - User: -","timestamp":"2025-07-13T10:53:16.034Z"}
{"level":"http","message":"GET /api/cart 304 8.230 ms - {} - User: -","timestamp":"2025-07-13T10:53:17.434Z"}
{"level":"http","message":"GET /api/cart 304 9.825 ms - {} - User: -","timestamp":"2025-07-13T10:53:22.292Z"}
{"level":"http","message":"GET /api/cart 304 8.268 ms - {} - User: -","timestamp":"2025-07-13T10:53:26.744Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 9.456 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-383\",\"items\":[{\"productId\":\"NB12\",\"nameProduct\":\"Nhẫn Bạc đính đá STYLE By PNJ ZTXMW000032\",\"quantity\":1,\"sizeIndex\":2,\"unitPrice\":589500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-B1.2.1.png?alt=media&token=a9502595-0167-4a98-8f34-4eefd1f35ba8\"}],\"totalAmount\":619500,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"a\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T10:53:26.845Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 672.881 ms - {\"orderId\":\"ORD-2025-383\",\"totalAmount\":619500,\"items\":[{\"productId\":\"NB12\",\"nameProduct\":\"Nhn Bc nh  STYLE By PNJ ZTXMW000032\",\"quantity\":1,\"unitPrice\":589500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%252FTrang%2520s%E1%BB%A9c%252FNh%E1%BA%ABn%252FN-B1.2.1.png?alt=media&token=a9502595-0167-4a98-8f34-4eefd1f35ba8\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T10:53:27.550Z"}
{"level":"http","message":"GET /api/cart 304 6.828 ms - {} - User: -","timestamp":"2025-07-13T10:54:20.524Z"}
{"level":"http","message":"GET /api/cart 304 9.324 ms - {} - User: -","timestamp":"2025-07-13T10:54:20.575Z"}
{"level":"http","message":"GET /api/products/NB12 304 1.730 ms - {} - User: guest","timestamp":"2025-07-13T10:54:22.196Z"}
{"level":"http","message":"GET /api/cart 304 10.880 ms - {} - User: -","timestamp":"2025-07-13T10:54:22.198Z"}
{"level":"http","message":"GET /api/products/NB12 304 0.502 ms - {} - User: guest","timestamp":"2025-07-13T10:54:22.204Z"}
{"level":"http","message":"GET /api/cart 304 9.065 ms - {} - User: -","timestamp":"2025-07-13T10:54:22.209Z"}
{"level":"http","message":"GET /api/cart 304 8.795 ms - {} - User: -","timestamp":"2025-07-13T10:54:22.219Z"}
{"level":"http","message":"GET /api/cart 304 12.125 ms - {} - User: -","timestamp":"2025-07-13T10:54:22.233Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 12.010 ms - {} - User: guest","timestamp":"2025-07-13T10:54:22.272Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 1.065 ms - {} - User: guest","timestamp":"2025-07-13T10:54:22.321Z"}
{"level":"http","message":"GET /api/cart 304 8.024 ms - {} - User: -","timestamp":"2025-07-13T10:54:25.690Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 11.873 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-939\",\"items\":[{\"productId\":\"NB12\",\"nameProduct\":\"Nhẫn Bạc đính đá STYLE By PNJ ZTXMW000032\",\"quantity\":1,\"sizeIndex\":2,\"unitPrice\":589500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-B1.2.1.png?alt=media&token=a9502595-0167-4a98-8f34-4eefd1f35ba8\"}],\"totalAmount\":619500,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"a\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T10:54:31.687Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 516.692 ms - {\"orderId\":\"ORD-2025-939\",\"totalAmount\":619500,\"items\":[{\"productId\":\"NB12\",\"nameProduct\":\"Nhn Bc nh  STYLE By PNJ ZTXMW000032\",\"quantity\":1,\"unitPrice\":589500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%252FTrang%2520s%E1%BB%A9c%252FNh%E1%BA%ABn%252FN-B1.2.1.png?alt=media&token=a9502595-0167-4a98-8f34-4eefd1f35ba8\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T10:54:32.234Z"}
{"header":"t=1752404088,v1=da4a349bd52c94c3accf946bb57b9b8a472e641effdceb549097de5ad28019f6,v0=8d9c6055d02b5fa498eac305ddd3a4025aa9f9d113000535e5444f4809e119c1","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752404087,"data":{"object":{"amount":61950000,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":61950000,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkNYRBopfvfSoZm2mMrZzFv_secret_gTZW9PGzeTNIF2Cy4IrdXOafL","confirmation_method":"automatic","created":1752404087,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkNYRBopfvfSoZm2mMrZzFv","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkNYRBopfvfSoZm2QNzg21m","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkNYQBopfvfSoZmcA9ymSZ6","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkNYRBopfvfSoZm20Awuqym","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"99eb4967-176f-44c2-912e-f083fbd67e8b"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T10:54:48.900Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T10:54:48.903Z"}
{"level":"http","message":"POST /api/payment/webhook 400 8.295 ms - {\"id\":\"evt_3RkNYRBopfvfSoZm20Awuqym\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752404087,\"data\":{\"object\":{\"id\":\"pi_3RkNYRBopfvfSoZm2mMrZzFv\",\"object\":\"payment_intent\",\"amount\":61950000,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":61950000,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkNYRBopfvfSoZm2mMrZzFv_secret_gTZW9PGzeTNIF2Cy4IrdXOafL\",\"confirmation_method\":\"automatic\",\"created\":1752404087,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkNYRBopfvfSoZm2QNzg21m\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkNYQBopfvfSoZmcA9ymSZ6\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"99eb4967-176f-44c2-912e-f083fbd67e8b\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T10:54:48.906Z"}
{"header":"t=1752404088,v1=4522c6fc70f57700fc0a8875f8dd1ee0b8c26800c48776119b453a4c90051ebf,v0=a21801b0bc59df822f8f58ccfe1dc7de40e2806224354a437628891aff1da68f","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752404088,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":61950000,"amount_total":61950000,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"https://2a2b1fb33e48.ngrok-free.app/api/payment/cancel?order_id=ORD-2025-939","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752404072,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752490471,"id":"cs_test_b1rYKhdejpr6EMoPEbqVLx74vsRoWLKBiu7ZQy0uWBxQzShG49Sd6OvWGC","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-939","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkNYRBopfvfSoZm2mMrZzFv","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"https://2a2b1fb33e48.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-939","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkNYSBopfvfSoZmtcCIh3AA","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T10:54:49.377Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T10:54:49.384Z"}
{"level":"http","message":"POST /api/payment/webhook 400 10.282 ms - {\"id\":\"evt_1RkNYSBopfvfSoZmtcCIh3AA\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752404088,\"data\":{\"object\":{\"id\":\"cs_test_b1rYKhdejpr6EMoPEbqVLx74vsRoWLKBiu7ZQy0uWBxQzShG49Sd6OvWGC\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":61950000,\"amount_total\":61950000,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"https://2a2b1fb33e48.ngrok-free.app/api/payment/cancel?order_id=ORD-2025-939\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"name\":\"Nguyen Dao\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752404072,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":null,\"state\":\"Hà Nội\"},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyen Dao\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752490471,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-2025-939\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkNYRBopfvfSoZm2mMrZzFv\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"https://2a2b1fb33e48.ngrok-free.app/api/payment/success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-939\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T10:54:49.386Z"}
{"level":"info","message":"🛑 SIGINT received, shutting down gracefully","timestamp":"2025-07-13T10:58:52.692Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T11:10:58.443Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T11:10:58.446Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T11:10:58.446Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T11:10:58.447Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T11:10:58.658Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T11:10:58.663Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T11:10:58.882Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T11:10:58.885Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T11:10:58.886Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T11:10:58.886Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T11:10:58.887Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T11:10:58.887Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T11:10:58.887Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T11:10:58.887Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T11:10:58.887Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T11:11:02.586Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T11:11:02.588Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T11:11:02.589Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T11:11:02.589Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T11:11:02.773Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T11:11:02.778Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T11:11:02.956Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T11:11:02.959Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T11:11:02.960Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T11:11:02.961Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T11:11:02.962Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T11:11:02.963Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T11:11:02.963Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T11:11:02.963Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T11:11:02.964Z"}
{"level":"info","message":"🛑 SIGINT received, shutting down gracefully","timestamp":"2025-07-13T11:12:14.770Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T11:12:30.508Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T11:12:30.511Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T11:12:30.511Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T11:12:30.512Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T11:12:30.684Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T11:12:30.689Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T11:12:30.848Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T11:12:30.850Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T11:12:30.851Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T11:12:30.851Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T11:12:30.852Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T11:12:30.852Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T11:12:30.852Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T11:12:30.852Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T11:12:30.853Z"}
{"level":"http","message":"GET /api/cart 304 58.428 ms - {} - User: -","timestamp":"2025-07-13T11:12:42.386Z"}
{"level":"http","message":"GET /api/products?limit=100 304 45.991 ms - {} - User: guest","timestamp":"2025-07-13T11:12:42.391Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 43.182 ms - {} - User: guest","timestamp":"2025-07-13T11:12:42.394Z"}
{"level":"http","message":"GET /api/collections 304 42.028 ms - {} - User: guest","timestamp":"2025-07-13T11:12:42.398Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.211 ms - {} - User: guest","timestamp":"2025-07-13T11:12:42.406Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.691 ms - {} - User: guest","timestamp":"2025-07-13T11:12:42.410Z"}
{"level":"http","message":"GET /api/cart 304 36.268 ms - {} - User: -","timestamp":"2025-07-13T11:12:42.435Z"}
{"level":"http","message":"GET /api/collections 304 27.171 ms - {} - User: guest","timestamp":"2025-07-13T11:12:42.439Z"}
{"level":"http","message":"GET /api/cart 304 9.401 ms - {} - User: -","timestamp":"2025-07-13T11:12:42.450Z"}
{"level":"http","message":"GET /api/cart 304 9.089 ms - {} - User: -","timestamp":"2025-07-13T11:12:42.460Z"}
{"level":"http","message":"GET /api/wishlist 304 18.125 ms - {} - User: -","timestamp":"2025-07-13T11:12:42.485Z"}
{"level":"http","message":"GET /api/wishlist 304 12.518 ms - {} - User: -","timestamp":"2025-07-13T11:12:42.499Z"}
{"level":"http","message":"GET /api/wishlist 304 9.137 ms - {} - User: -","timestamp":"2025-07-13T11:12:42.510Z"}
{"level":"http","message":"GET /api/wishlist 304 11.284 ms - {} - User: -","timestamp":"2025-07-13T11:12:42.522Z"}
{"level":"http","message":"GET /api/wishlist 304 8.665 ms - {} - User: -","timestamp":"2025-07-13T11:12:42.532Z"}
{"level":"http","message":"GET /api/wishlist 304 7.868 ms - {} - User: -","timestamp":"2025-07-13T11:12:42.542Z"}
{"level":"http","message":"GET /api/products/NB2 304 4.443 ms - {} - User: guest","timestamp":"2025-07-13T11:12:45.662Z"}
{"level":"http","message":"GET /api/cart 304 13.184 ms - {} - User: -","timestamp":"2025-07-13T11:12:45.665Z"}
{"level":"http","message":"GET /api/products/NB2 304 0.790 ms - {} - User: guest","timestamp":"2025-07-13T11:12:45.667Z"}
{"level":"http","message":"GET /api/cart 304 8.549 ms - {} - User: -","timestamp":"2025-07-13T11:12:45.677Z"}
{"level":"http","message":"GET /api/cart 304 25.344 ms - {} - User: -","timestamp":"2025-07-13T11:12:45.704Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 23.534 ms - {} - User: guest","timestamp":"2025-07-13T11:12:45.708Z"}
{"level":"http","message":"GET /api/cart 304 10.452 ms - {} - User: -","timestamp":"2025-07-13T11:12:45.720Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 1.152 ms - {} - User: guest","timestamp":"2025-07-13T11:12:45.746Z"}
{"level":"http","message":"GET /api/products/NB1 200 2.717 ms - {} - User: guest","timestamp":"2025-07-13T11:12:48.200Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 0.822 ms - {} - User: guest","timestamp":"2025-07-13T11:12:48.214Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 20.645 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-853\",\"items\":[{\"productId\":\"NB1\",\"nameProduct\":\"Nhẫn Bạc đính đá PNJSilver XMXMW060204\",\"quantity\":1,\"sizeIndex\":2,\"unitPrice\":535500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-B1.1.png?alt=media&token=feabbd77-4376-4ac0-a8bf-a003fd65bf9e\"}],\"totalAmount\":565500,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"q\",\"district\":\"q\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"q\"} - User: -","timestamp":"2025-07-13T11:12:58.233Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 717.627 ms - {\"orderId\":\"ORD-2025-853\",\"totalAmount\":565500,\"items\":[{\"productId\":\"NB1\",\"nameProduct\":\"Nhn Bc nh  PNJSilver XMXMW060204\",\"quantity\":1,\"unitPrice\":535500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%252FTrang%2520s%E1%BB%A9c%252FNh%E1%BA%ABn%252FN-B1.1.png?alt=media&token=feabbd77-4376-4ac0-a8bf-a003fd65bf9e\"}],\"shippingFee\":30000,\"discount\":0,\"success_url\":\"http://localhost:3000/payment/result?status=success&order_id=ORD-2025-853\",\"cancel_url\":\"http://localhost:3000/payment/result?status=canceled&order_id=ORD-2025-853\"} - User: -","timestamp":"2025-07-13T11:12:58.958Z"}
{"header":"t=1752405196,v1=1703a9372974c5189269f9753c3341e6224263b45078833a36fcf9efeb2279a0,v0=cdc92d5a3ed486fed0747d817ac088dda8bd2eb1ccecaf51f76d3c9aa0764a37","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752405196,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":56550000,"amount_total":56550000,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-853","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752405178,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752491578,"id":"cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-853","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkNqJBopfvfSoZm2LjhVAB1","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-853","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkNqKBopfvfSoZmTFHUFmHZ","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T11:13:17.213Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T11:13:17.221Z"}
{"level":"http","message":"POST /api/payment/webhook 400 11.450 ms - {\"id\":\"evt_1RkNqKBopfvfSoZmTFHUFmHZ\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752405196,\"data\":{\"object\":{\"id\":\"cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":56550000,\"amount_total\":56550000,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-853\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"name\":\"Nguyen Dao\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752405178,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":null,\"state\":\"Hà Nội\"},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyen Dao\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752491578,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-2025-853\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkNqJBopfvfSoZm2LjhVAB1\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-853\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T11:13:17.222Z"}
{"header":"t=1752405196,v1=6bd9ea7f739f0f3f78ce36ecb4447c9357c0558e899dddd6651b751b005ec96c,v0=d4a65adee2fb24f766aaee35efd71311665e8c6505d3f5c6353615105e2c6ce8","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752405196,"data":{"object":{"amount":56550000,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":56550000,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkNqJBopfvfSoZm2LjhVAB1_secret_bKHMksfJlZl0IvolkJJsth5zw","confirmation_method":"automatic","created":1752405195,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkNqJBopfvfSoZm2LjhVAB1","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkNqJBopfvfSoZm2pujGJBO","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkNqIBopfvfSoZmEsDr19Is","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkNqJBopfvfSoZm2D936yCM","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"3a1b9f43-82ac-42a2-9114-812c11032858"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T11:13:17.267Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T11:13:17.290Z"}
{"level":"http","message":"POST /api/payment/webhook 400 25.152 ms - {\"id\":\"evt_3RkNqJBopfvfSoZm2D936yCM\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752405196,\"data\":{\"object\":{\"id\":\"pi_3RkNqJBopfvfSoZm2LjhVAB1\",\"object\":\"payment_intent\",\"amount\":56550000,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":56550000,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkNqJBopfvfSoZm2LjhVAB1_secret_bKHMksfJlZl0IvolkJJsth5zw\",\"confirmation_method\":\"automatic\",\"created\":1752405195,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkNqJBopfvfSoZm2pujGJBO\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkNqIBopfvfSoZmEsDr19Is\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"3a1b9f43-82ac-42a2-9114-812c11032858\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T11:13:17.291Z"}
{"level":"http","message":"GET /api/cart 304 13.489 ms - {} - User: -","timestamp":"2025-07-13T11:16:34.132Z"}
{"level":"http","message":"GET /api/cart 304 9.159 ms - {} - User: -","timestamp":"2025-07-13T11:16:34.148Z"}
{"level":"http","message":"GET /api/cart 304 10.914 ms - {} - User: -","timestamp":"2025-07-13T11:16:34.161Z"}
{"level":"http","message":"GET /api/cart 304 12.542 ms - {} - User: -","timestamp":"2025-07-13T11:16:34.175Z"}
{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"391","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=ZZD2r4FgBToLcq51CsyExJ-obFNCNtz2Puqhsj9N4nAsHG0SiAj5TuO00lNelLTW7LoPbJuCjdv7e2uL","content-type":"application/json","date":"Sun, 13 Jul 2025 11:16:34 GMT","request-id":"req_32kRcImx0Lcv5Z","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Stripe getPaymentStatus error: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","param":"intent","raw":{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"391","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=ZZD2r4FgBToLcq51CsyExJ-obFNCNtz2Puqhsj9N4nAsHG0SiAj5TuO00lNelLTW7LoPbJuCjdv7e2uL","content-type":"application/json","date":"Sun, 13 Jul 2025 11:16:34 GMT","request-id":"req_32kRcImx0Lcv5Z","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","param":"intent","requestId":"req_32kRcImx0Lcv5Z","request_log_url":"https://dashboard.stripe.com/test/logs/req_32kRcImx0Lcv5Z?t=1752405394","statusCode":404,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_32kRcImx0Lcv5Z","stack":"Error: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'\n    at generateV1Error (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Error.js:11:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\RequestSender.js:108:62)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","statusCode":404,"timestamp":"2025-07-13T11:16:34.523Z","type":"StripeInvalidRequestError"}
{"level":"error","message":"Get payment status error: Failed to get payment status: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","stack":"Error: Failed to get payment status: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'\n    at StripeService.getPaymentStatus (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:180:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async getPaymentStatus (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:141:28)","timestamp":"2025-07-13T11:16:34.526Z"}
{"level":"http","message":"GET /api/payment/status/cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD 400 401.108 ms - {} - User: -","timestamp":"2025-07-13T11:16:34.528Z"}
{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"391","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=ZZD2r4FgBToLcq51CsyExJ-obFNCNtz2Puqhsj9N4nAsHG0SiAj5TuO00lNelLTW7LoPbJuCjdv7e2uL","content-type":"application/json","date":"Sun, 13 Jul 2025 11:16:34 GMT","request-id":"req_Fl3psqSTQB8VKe","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Stripe getPaymentStatus error: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","param":"intent","raw":{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"391","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=ZZD2r4FgBToLcq51CsyExJ-obFNCNtz2Puqhsj9N4nAsHG0SiAj5TuO00lNelLTW7LoPbJuCjdv7e2uL","content-type":"application/json","date":"Sun, 13 Jul 2025 11:16:34 GMT","request-id":"req_Fl3psqSTQB8VKe","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","param":"intent","requestId":"req_Fl3psqSTQB8VKe","request_log_url":"https://dashboard.stripe.com/test/logs/req_Fl3psqSTQB8VKe?t=1752405394","statusCode":404,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_Fl3psqSTQB8VKe","stack":"Error: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'\n    at generateV1Error (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Error.js:11:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\RequestSender.js:108:62)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","statusCode":404,"timestamp":"2025-07-13T11:16:34.810Z","type":"StripeInvalidRequestError"}
{"level":"error","message":"Get payment status error: Failed to get payment status: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","stack":"Error: Failed to get payment status: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'\n    at StripeService.getPaymentStatus (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:180:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async getPaymentStatus (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:141:28)","timestamp":"2025-07-13T11:16:34.813Z"}
{"level":"http","message":"GET /api/payment/status/cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD 400 283.613 ms - {} - User: -","timestamp":"2025-07-13T11:16:34.815Z"}
{"level":"http","message":"GET /api/cart 304 7.638 ms - {} - User: -","timestamp":"2025-07-13T11:16:49.749Z"}
{"level":"http","message":"GET /api/cart 304 6.400 ms - {} - User: -","timestamp":"2025-07-13T11:16:55.848Z"}
{"level":"http","message":"GET /api/cart 304 8.662 ms - {} - User: -","timestamp":"2025-07-13T11:17:04.154Z"}
{"level":"http","message":"GET /api/cart 304 8.682 ms - {} - User: -","timestamp":"2025-07-13T11:17:34.764Z"}
{"level":"http","message":"GET /api/cart 304 7.276 ms - {} - User: -","timestamp":"2025-07-13T11:18:04.754Z"}
{"level":"http","message":"GET /api/cart 304 7.530 ms - {} - User: -","timestamp":"2025-07-13T11:18:34.764Z"}
{"level":"http","message":"GET /api/cart 304 7.706 ms - {} - User: -","timestamp":"2025-07-13T11:19:04.755Z"}
{"level":"http","message":"GET /api/cart 304 5.987 ms - {} - User: -","timestamp":"2025-07-13T11:19:34.755Z"}
{"level":"http","message":"GET /api/cart 304 9.418 ms - {} - User: -","timestamp":"2025-07-13T11:20:04.762Z"}
{"level":"http","message":"GET /api/cart 304 9.272 ms - {} - User: -","timestamp":"2025-07-13T11:20:37.288Z"}
{"level":"http","message":"GET /api/cart 304 18.342 ms - {} - User: -","timestamp":"2025-07-13T11:20:37.308Z"}
{"level":"http","message":"GET /api/cart 304 7.376 ms - {} - User: -","timestamp":"2025-07-13T11:20:37.318Z"}
{"level":"http","message":"GET /api/cart 304 10.995 ms - {} - User: -","timestamp":"2025-07-13T11:20:37.331Z"}
{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"391","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=NMEEuZMObAPmuzuZcyp-akrrM1Hjgeg0SFgrHwNHOVS-T6QKtqmT5fIccDHaFYpo7ECNJ6PjFSAEyDKs","content-type":"application/json","date":"Sun, 13 Jul 2025 11:20:37 GMT","request-id":"req_RZtia9pqbBx8Yj","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Stripe getPaymentStatus error: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","param":"intent","raw":{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"391","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=NMEEuZMObAPmuzuZcyp-akrrM1Hjgeg0SFgrHwNHOVS-T6QKtqmT5fIccDHaFYpo7ECNJ6PjFSAEyDKs","content-type":"application/json","date":"Sun, 13 Jul 2025 11:20:37 GMT","request-id":"req_RZtia9pqbBx8Yj","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","param":"intent","requestId":"req_RZtia9pqbBx8Yj","request_log_url":"https://dashboard.stripe.com/test/logs/req_RZtia9pqbBx8Yj?t=1752405637","statusCode":404,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_RZtia9pqbBx8Yj","stack":"Error: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'\n    at generateV1Error (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Error.js:11:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\RequestSender.js:108:62)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","statusCode":404,"timestamp":"2025-07-13T11:20:37.701Z","type":"StripeInvalidRequestError"}
{"level":"error","message":"Get payment status error: Failed to get payment status: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","stack":"Error: Failed to get payment status: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'\n    at StripeService.getPaymentStatus (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:180:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async getPaymentStatus (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:141:28)","timestamp":"2025-07-13T11:20:37.704Z"}
{"level":"http","message":"GET /api/payment/status/cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD 400 410.657 ms - {} - User: -","timestamp":"2025-07-13T11:20:37.705Z"}
{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"391","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=NMEEuZMObAPmuzuZcyp-akrrM1Hjgeg0SFgrHwNHOVS-T6QKtqmT5fIccDHaFYpo7ECNJ6PjFSAEyDKs","content-type":"application/json","date":"Sun, 13 Jul 2025 11:20:37 GMT","request-id":"req_f11ewxpxwTU8lW","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Stripe getPaymentStatus error: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","param":"intent","raw":{"code":"resource_missing","doc_url":"https://stripe.com/docs/error-codes/resource-missing","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"391","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=NMEEuZMObAPmuzuZcyp-akrrM1Hjgeg0SFgrHwNHOVS-T6QKtqmT5fIccDHaFYpo7ECNJ6PjFSAEyDKs","content-type":"application/json","date":"Sun, 13 Jul 2025 11:20:37 GMT","request-id":"req_f11ewxpxwTU8lW","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","param":"intent","requestId":"req_f11ewxpxwTU8lW","request_log_url":"https://dashboard.stripe.com/test/logs/req_f11ewxpxwTU8lW?t=1752405637","statusCode":404,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_f11ewxpxwTU8lW","stack":"Error: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'\n    at generateV1Error (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Error.js:11:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\RequestSender.js:108:62)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","statusCode":404,"timestamp":"2025-07-13T11:20:37.979Z","type":"StripeInvalidRequestError"}
{"level":"error","message":"Get payment status error: Failed to get payment status: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'","stack":"Error: Failed to get payment status: No such payment_intent: 'cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD'\n    at StripeService.getPaymentStatus (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:180:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async getPaymentStatus (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:141:28)","timestamp":"2025-07-13T11:20:37.980Z"}
{"level":"http","message":"GET /api/payment/status/cs_test_b12DSTTXYkQQFJA0G1282NcJ3SJRAkb3J3tbCviaMw4HEu3OWq3FsnGSsD 400 273.777 ms - {} - User: -","timestamp":"2025-07-13T11:20:37.981Z"}
{"level":"http","message":"GET /api/cart 304 9.956 ms - {} - User: -","timestamp":"2025-07-13T11:20:47.251Z"}
{"level":"http","message":"GET /api/cart 304 11.511 ms - {} - User: -","timestamp":"2025-07-13T11:20:47.563Z"}
{"level":"http","message":"GET /api/products?limit=100 304 34.825 ms - {} - User: guest","timestamp":"2025-07-13T11:20:47.591Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 38.445 ms - {} - User: guest","timestamp":"2025-07-13T11:20:47.603Z"}
{"level":"http","message":"GET /api/collections 304 38.798 ms - {} - User: guest","timestamp":"2025-07-13T11:20:47.608Z"}
{"level":"http","message":"GET /api/products?limit=100 304 2.093 ms - {} - User: guest","timestamp":"2025-07-13T11:20:47.612Z"}
{"level":"http","message":"GET /api/cart 304 39.589 ms - {} - User: -","timestamp":"2025-07-13T11:20:47.615Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.069 ms - {} - User: guest","timestamp":"2025-07-13T11:20:47.621Z"}
{"level":"http","message":"GET /api/collections 304 20.151 ms - {} - User: guest","timestamp":"2025-07-13T11:20:47.642Z"}
{"level":"http","message":"GET /api/cart 304 19.880 ms - {} - User: -","timestamp":"2025-07-13T11:20:47.645Z"}
{"level":"http","message":"GET /api/cart 304 7.275 ms - {} - User: -","timestamp":"2025-07-13T11:20:47.654Z"}
{"level":"http","message":"GET /api/wishlist 304 13.968 ms - {} - User: -","timestamp":"2025-07-13T11:20:47.752Z"}
{"level":"http","message":"GET /api/wishlist 304 11.578 ms - {} - User: -","timestamp":"2025-07-13T11:20:47.766Z"}
{"level":"http","message":"GET /api/wishlist 304 12.952 ms - {} - User: -","timestamp":"2025-07-13T11:20:47.781Z"}
{"level":"http","message":"GET /api/wishlist 304 12.762 ms - {} - User: -","timestamp":"2025-07-13T11:20:47.796Z"}
{"level":"http","message":"GET /api/wishlist 304 10.856 ms - {} - User: -","timestamp":"2025-07-13T11:20:47.809Z"}
{"level":"http","message":"GET /api/wishlist 304 13.845 ms - {} - User: -","timestamp":"2025-07-13T11:20:47.824Z"}
{"level":"http","message":"GET /api/cart 304 11.590 ms - {} - User: -","timestamp":"2025-07-13T11:20:55.025Z"}
{"level":"http","message":"GET /api/products?limit=100 304 0.934 ms - {} - User: guest","timestamp":"2025-07-13T11:20:59.715Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.051 ms - {} - User: guest","timestamp":"2025-07-13T11:20:59.720Z"}
{"level":"http","message":"GET /api/cart 304 14.281 ms - {} - User: -","timestamp":"2025-07-13T11:20:59.725Z"}
{"level":"http","message":"GET /api/products?limit=100 304 0.804 ms - {} - User: guest","timestamp":"2025-07-13T11:20:59.728Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 0.715 ms - {} - User: guest","timestamp":"2025-07-13T11:20:59.731Z"}
{"level":"http","message":"GET /api/collections 304 12.041 ms - {} - User: guest","timestamp":"2025-07-13T11:20:59.734Z"}
{"level":"http","message":"GET /api/cart 304 12.104 ms - {} - User: -","timestamp":"2025-07-13T11:20:59.748Z"}
{"level":"http","message":"GET /api/collections 304 9.903 ms - {} - User: guest","timestamp":"2025-07-13T11:20:59.750Z"}
{"level":"http","message":"GET /api/cart 304 8.538 ms - {} - User: -","timestamp":"2025-07-13T11:20:59.760Z"}
{"level":"http","message":"GET /api/cart 304 9.995 ms - {} - User: -","timestamp":"2025-07-13T11:20:59.773Z"}
{"level":"http","message":"GET /api/wishlist 304 9.353 ms - {} - User: -","timestamp":"2025-07-13T11:20:59.866Z"}
{"level":"http","message":"GET /api/wishlist 304 11.333 ms - {} - User: -","timestamp":"2025-07-13T11:20:59.879Z"}
{"level":"http","message":"GET /api/wishlist 304 10.578 ms - {} - User: -","timestamp":"2025-07-13T11:20:59.891Z"}
{"level":"http","message":"GET /api/wishlist 304 8.003 ms - {} - User: -","timestamp":"2025-07-13T11:20:59.901Z"}
{"level":"http","message":"GET /api/wishlist 304 10.314 ms - {} - User: -","timestamp":"2025-07-13T11:20:59.912Z"}
{"level":"http","message":"GET /api/wishlist 304 16.921 ms - {} - User: -","timestamp":"2025-07-13T11:20:59.931Z"}
{"level":"info","message":"findByEmailOrUsername called with:","timestamp":"2025-07-13T11:22:25.737Z"}
{"level":"info","message":"Searching with identifier:","timestamp":"2025-07-13T11:22:25.738Z"}
{"level":"http","message":"POST /api/auth/login 200 65.580 ms - {\"userName\":\"nguyendao21012002@gmail.com\",\"password\":\"[REDACTED]\"} - User: guest","timestamp":"2025-07-13T11:22:25.802Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.125 ms - {} - User: guest","timestamp":"2025-07-13T11:22:27.371Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.926 ms - {} - User: guest","timestamp":"2025-07-13T11:22:27.379Z"}
{"level":"http","message":"GET /api/cart 304 18.459 ms - {} - User: -","timestamp":"2025-07-13T11:22:27.383Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.074 ms - {} - User: guest","timestamp":"2025-07-13T11:22:27.386Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 2.380 ms - {} - User: guest","timestamp":"2025-07-13T11:22:27.392Z"}
{"level":"http","message":"GET /api/collections 304 17.876 ms - {} - User: guest","timestamp":"2025-07-13T11:22:27.398Z"}
{"level":"http","message":"GET /api/cart 304 10.793 ms - {} - User: -","timestamp":"2025-07-13T11:22:27.405Z"}
{"level":"http","message":"GET /api/collections 304 13.739 ms - {} - User: guest","timestamp":"2025-07-13T11:22:27.415Z"}
{"level":"http","message":"GET /api/cart 304 10.078 ms - {} - User: -","timestamp":"2025-07-13T11:22:27.420Z"}
{"level":"http","message":"GET /api/cart 304 15.263 ms - {} - User: -","timestamp":"2025-07-13T11:22:27.437Z"}
{"level":"http","message":"GET /api/wishlist 304 10.494 ms - {} - User: -","timestamp":"2025-07-13T11:22:27.493Z"}
{"level":"http","message":"GET /api/wishlist 304 10.255 ms - {} - User: -","timestamp":"2025-07-13T11:22:27.505Z"}
{"level":"http","message":"GET /api/wishlist 304 11.431 ms - {} - User: -","timestamp":"2025-07-13T11:22:27.519Z"}
{"level":"http","message":"GET /api/wishlist 304 12.052 ms - {} - User: -","timestamp":"2025-07-13T11:22:27.533Z"}
{"level":"http","message":"GET /api/wishlist 304 12.083 ms - {} - User: -","timestamp":"2025-07-13T11:22:27.546Z"}
{"level":"http","message":"GET /api/wishlist 304 14.371 ms - {} - User: -","timestamp":"2025-07-13T11:22:27.563Z"}
{"level":"http","message":"GET /api/cart 304 14.860 ms - {} - User: -","timestamp":"2025-07-13T11:22:34.231Z"}
{"level":"http","message":"GET /api/cart 304 8.605 ms - {} - User: -","timestamp":"2025-07-13T11:22:38.794Z"}
{"level":"http","message":"GET /api/products/NB2 304 1.228 ms - {} - User: guest","timestamp":"2025-07-13T11:22:38.916Z"}
{"level":"http","message":"GET /api/cart 304 9.248 ms - {} - User: -","timestamp":"2025-07-13T11:22:38.918Z"}
{"level":"http","message":"GET /api/products/NB2 304 0.652 ms - {} - User: guest","timestamp":"2025-07-13T11:22:38.924Z"}
{"level":"http","message":"GET /api/cart 304 7.377 ms - {} - User: -","timestamp":"2025-07-13T11:22:38.927Z"}
{"level":"http","message":"GET /api/cart 304 5.799 ms - {} - User: -","timestamp":"2025-07-13T11:22:38.934Z"}
{"level":"http","message":"GET /api/cart 304 7.621 ms - {} - User: -","timestamp":"2025-07-13T11:22:38.944Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 13.332 ms - {} - User: guest","timestamp":"2025-07-13T11:22:38.975Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 1.191 ms - {} - User: guest","timestamp":"2025-07-13T11:22:39.017Z"}
{"level":"http","message":"GET /api/cart 304 22.993 ms - {} - User: -","timestamp":"2025-07-13T11:22:48.131Z"}
{"level":"http","message":"GET /api/cart 304 6.488 ms - {} - User: -","timestamp":"2025-07-13T11:22:51.893Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 12.274 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-143\",\"items\":[{\"productId\":\"NB2\",\"nameProduct\":\"Nhẫn nam Bạc đính đá PNJSilver XMXMW060196\",\"quantity\":1,\"sizeIndex\":1,\"unitPrice\":985500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-B2.1.png?alt=media&token=8f99e041-4f97-4ee1-9cc3-bd5f48146e08\"}],\"totalAmount\":1015500,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"a\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T11:22:58.558Z"}
{"code":"amount_too_large","doc_url":"https://stripe.com/docs/error-codes/amount-too-large","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"351","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=NC9b6AGAtx6pwZYTGiY_rxBHf3kZwXE9_cIeBiHvGJv-Zglrw2rC5g2PE7lA3jepCr8tUQ9VrQVT0fw7","content-type":"application/json","date":"Sun, 13 Jul 2025 11:22:59 GMT","idempotency-key":"stripe-node-retry-30de7082-20d4-4c8c-b17d-63f32c0b29f4","original-request":"req_Pyga1moRIjJvWm","request-id":"req_Pyga1moRIjJvWm","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-should-retry":"false","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Stripe createCheckoutSession error: The Checkout Session's total amount due must be no more than ₫99,999,999.","raw":{"code":"amount_too_large","doc_url":"https://stripe.com/docs/error-codes/amount-too-large","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"351","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=NC9b6AGAtx6pwZYTGiY_rxBHf3kZwXE9_cIeBiHvGJv-Zglrw2rC5g2PE7lA3jepCr8tUQ9VrQVT0fw7","content-type":"application/json","date":"Sun, 13 Jul 2025 11:22:59 GMT","idempotency-key":"stripe-node-retry-30de7082-20d4-4c8c-b17d-63f32c0b29f4","original-request":"req_Pyga1moRIjJvWm","request-id":"req_Pyga1moRIjJvWm","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-should-retry":"false","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"The Checkout Session's total amount due must be no more than ₫99,999,999.","requestId":"req_Pyga1moRIjJvWm","request_log_url":"https://dashboard.stripe.com/test/logs/req_Pyga1moRIjJvWm?t=1752405778","statusCode":400,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_Pyga1moRIjJvWm","stack":"Error: The Checkout Session's total amount due must be no more than ₫99,999,999.\n    at generateV1Error (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Error.js:11:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\RequestSender.js:108:62)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","statusCode":400,"timestamp":"2025-07-13T11:22:59.250Z","type":"StripeInvalidRequestError"}
{"level":"error","message":"Create checkout session error: Failed to create checkout session: The Checkout Session's total amount due must be no more than ₫99,999,999.","stack":"Error: Failed to create checkout session: The Checkout Session's total amount due must be no more than ₫99,999,999.\n    at StripeService.createCheckoutSession (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:118:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async createCheckoutSession (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:68:28)","timestamp":"2025-07-13T11:22:59.251Z"}
{"level":"http","message":"POST /api/payment/create-checkout 400 662.752 ms - {\"orderId\":\"ORD-2025-143\",\"totalAmount\":1015500,\"items\":[{\"productId\":\"NB2\",\"nameProduct\":\"Nhn nam Bc nh  PNJSilver XMXMW060196\",\"quantity\":1,\"unitPrice\":985500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%252FTrang%2520s%E1%BB%A9c%252FNh%E1%BA%ABn%252FN-B2.1.png?alt=media&token=8f99e041-4f97-4ee1-9cc3-bd5f48146e08\"}],\"shippingFee\":30000,\"discount\":0,\"success_url\":\"http://localhost:3000/payment/result/success/ORD-2025-143\",\"cancel_url\":\"http://localhost:3000/payment/result/cancel/ORD-2025-143\"} - User: -","timestamp":"2025-07-13T11:22:59.253Z"}
{"level":"http","message":"GET /api/cart 304 5.662 ms - {} - User: -","timestamp":"2025-07-13T11:23:06.464Z"}
{"level":"http","message":"GET /api/cart 304 6.982 ms - {} - User: -","timestamp":"2025-07-13T11:23:08.941Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 10.160 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-338\",\"items\":[{\"productId\":\"NB2\",\"nameProduct\":\"Nhẫn nam Bạc đính đá PNJSilver XMXMW060196\",\"quantity\":1,\"sizeIndex\":1,\"unitPrice\":985500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-B2.1.png?alt=media&token=8f99e041-4f97-4ee1-9cc3-bd5f48146e08\"}],\"totalAmount\":1015500,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"a\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T11:23:14.571Z"}
{"code":"amount_too_large","doc_url":"https://stripe.com/docs/error-codes/amount-too-large","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"351","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=NC9b6AGAtx6pwZYTGiY_rxBHf3kZwXE9_cIeBiHvGJv-Zglrw2rC5g2PE7lA3jepCr8tUQ9VrQVT0fw7","content-type":"application/json","date":"Sun, 13 Jul 2025 11:23:14 GMT","idempotency-key":"stripe-node-retry-6e7fb3ec-3702-4dcd-a5cb-7bfd9b018833","original-request":"req_biMn2I44m2XI1w","request-id":"req_biMn2I44m2XI1w","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-should-retry":"false","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Stripe createCheckoutSession error: The Checkout Session's total amount due must be no more than ₫99,999,999.","raw":{"code":"amount_too_large","doc_url":"https://stripe.com/docs/error-codes/amount-too-large","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"351","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=NC9b6AGAtx6pwZYTGiY_rxBHf3kZwXE9_cIeBiHvGJv-Zglrw2rC5g2PE7lA3jepCr8tUQ9VrQVT0fw7","content-type":"application/json","date":"Sun, 13 Jul 2025 11:23:14 GMT","idempotency-key":"stripe-node-retry-6e7fb3ec-3702-4dcd-a5cb-7bfd9b018833","original-request":"req_biMn2I44m2XI1w","request-id":"req_biMn2I44m2XI1w","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-should-retry":"false","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"The Checkout Session's total amount due must be no more than ₫99,999,999.","requestId":"req_biMn2I44m2XI1w","request_log_url":"https://dashboard.stripe.com/test/logs/req_biMn2I44m2XI1w?t=1752405794","statusCode":400,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_biMn2I44m2XI1w","stack":"Error: The Checkout Session's total amount due must be no more than ₫99,999,999.\n    at generateV1Error (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Error.js:11:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\RequestSender.js:108:62)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","statusCode":400,"timestamp":"2025-07-13T11:23:15.070Z","type":"StripeInvalidRequestError"}
{"level":"error","message":"Create checkout session error: Failed to create checkout session: The Checkout Session's total amount due must be no more than ₫99,999,999.","stack":"Error: Failed to create checkout session: The Checkout Session's total amount due must be no more than ₫99,999,999.\n    at StripeService.createCheckoutSession (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:118:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async createCheckoutSession (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:68:28)","timestamp":"2025-07-13T11:23:15.071Z"}
{"level":"http","message":"POST /api/payment/create-checkout 400 470.284 ms - {\"orderId\":\"ORD-2025-338\",\"totalAmount\":1015500,\"items\":[{\"productId\":\"NB2\",\"nameProduct\":\"Nhn nam Bc nh  PNJSilver XMXMW060196\",\"quantity\":1,\"unitPrice\":985500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%252FTrang%2520s%E1%BB%A9c%252FNh%E1%BA%ABn%252FN-B2.1.png?alt=media&token=8f99e041-4f97-4ee1-9cc3-bd5f48146e08\"}],\"shippingFee\":30000,\"discount\":0,\"success_url\":\"http://localhost:3000/payment/result/success/ORD-2025-338\",\"cancel_url\":\"http://localhost:3000/payment/result/cancel/ORD-2025-338\"} - User: -","timestamp":"2025-07-13T11:23:15.072Z"}
{"level":"http","message":"GET /api/cart 304 7.580 ms - {} - User: -","timestamp":"2025-07-13T11:23:25.331Z"}
{"level":"http","message":"GET /api/cart 304 8.803 ms - {} - User: -","timestamp":"2025-07-13T11:23:39.766Z"}
{"level":"http","message":"GET /api/cart 304 20.639 ms - {} - User: -","timestamp":"2025-07-13T11:23:57.420Z"}
{"level":"http","message":"GET /api/cart 304 6.582 ms - {} - User: -","timestamp":"2025-07-13T11:24:09.754Z"}
{"level":"http","message":"GET /api/cart 304 8.043 ms - {} - User: -","timestamp":"2025-07-13T11:24:39.758Z"}
{"level":"http","message":"GET /api/cart 304 6.483 ms - {} - User: -","timestamp":"2025-07-13T11:25:09.762Z"}
{"level":"http","message":"GET /api/cart 304 8.787 ms - {} - User: -","timestamp":"2025-07-13T11:25:39.763Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T11:25:53.017Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T11:25:53.019Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T11:25:53.020Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T11:25:53.020Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T11:25:53.203Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T11:25:53.207Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T11:25:53.373Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T11:25:53.375Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T11:25:53.375Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T11:25:53.376Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T11:25:53.377Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T11:25:53.377Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T11:25:53.377Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T11:25:53.377Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T11:25:53.378Z"}
{"level":"http","message":"GET /api/cart 304 31.448 ms - {} - User: -","timestamp":"2025-07-13T11:26:00.912Z"}
{"level":"http","message":"GET /api/products/N10K12 200 6.116 ms - {} - User: guest","timestamp":"2025-07-13T11:26:05.970Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 27.094 ms - {} - User: guest","timestamp":"2025-07-13T11:26:06.047Z"}
{"level":"http","message":"GET /api/cart 304 7.307 ms - {} - User: -","timestamp":"2025-07-13T11:26:08.933Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 23.348 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-369\",\"items\":[{\"productId\":\"N10K12\",\"nameProduct\":\"Nhẫn Vàng trắng 10K đính đá ECZ PNJ Kim Bảo Như Ý XMXMW005672\",\"quantity\":1,\"sizeIndex\":1,\"unitPrice\":985500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-10K1.2.1.png?alt=media&token=53866139-0aab-485c-b383-6a1192411db9\"}],\"totalAmount\":1015500,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"a\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T11:26:14.464Z"}
{"code":"amount_too_large","doc_url":"https://stripe.com/docs/error-codes/amount-too-large","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"351","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=bevj7UQ7HjIf2A0Rh3D8WVsHdJZi-5u-r-M3FVHEroNKFgRPKXo5jJp4NLfUhewyW32TCMHZdGvXpbhW","content-type":"application/json","date":"Sun, 13 Jul 2025 11:26:15 GMT","idempotency-key":"stripe-node-retry-6940007b-bbf5-47c7-ad72-3caed6d64d7b","original-request":"req_ltOeMUPaRmGkfQ","request-id":"req_ltOeMUPaRmGkfQ","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-should-retry":"false","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Stripe createCheckoutSession error: The Checkout Session's total amount due must be no more than ₫99,999,999.","raw":{"code":"amount_too_large","doc_url":"https://stripe.com/docs/error-codes/amount-too-large","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"351","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=bevj7UQ7HjIf2A0Rh3D8WVsHdJZi-5u-r-M3FVHEroNKFgRPKXo5jJp4NLfUhewyW32TCMHZdGvXpbhW","content-type":"application/json","date":"Sun, 13 Jul 2025 11:26:15 GMT","idempotency-key":"stripe-node-retry-6940007b-bbf5-47c7-ad72-3caed6d64d7b","original-request":"req_ltOeMUPaRmGkfQ","request-id":"req_ltOeMUPaRmGkfQ","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-should-retry":"false","stripe-version":"2025-06-30.basil","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"The Checkout Session's total amount due must be no more than ₫99,999,999.","requestId":"req_ltOeMUPaRmGkfQ","request_log_url":"https://dashboard.stripe.com/test/logs/req_ltOeMUPaRmGkfQ?t=1752405974","statusCode":400,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_ltOeMUPaRmGkfQ","stack":"Error: The Checkout Session's total amount due must be no more than ₫99,999,999.\n    at generateV1Error (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Error.js:11:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\RequestSender.js:108:62)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","statusCode":400,"timestamp":"2025-07-13T11:26:15.155Z","type":"StripeInvalidRequestError"}
{"level":"error","message":"Create checkout session error: Failed to create checkout session: The Checkout Session's total amount due must be no more than ₫99,999,999.","stack":"Error: Failed to create checkout session: The Checkout Session's total amount due must be no more than ₫99,999,999.\n    at StripeService.createCheckoutSession (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:118:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async createCheckoutSession (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:68:28)","timestamp":"2025-07-13T11:26:15.157Z"}
{"level":"http","message":"POST /api/payment/create-checkout 400 684.319 ms - {\"orderId\":\"ORD-2025-369\",\"totalAmount\":1015500,\"items\":[{\"productId\":\"N10K12\",\"nameProduct\":\"Nhn Vng trng 10K nh  ECZ PNJ Kim Bo Nh  XMXMW005672\",\"quantity\":1,\"unitPrice\":985500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%252FTrang%2520s%E1%BB%A9c%252FNh%E1%BA%ABn%252FN-10K1.2.1.png?alt=media&token=53866139-0aab-485c-b383-6a1192411db9\"}],\"shippingFee\":30000,\"discount\":0,\"success_url\":\"http://localhost:3000/payment/result/success/ORD-2025-369\",\"cancel_url\":\"http://localhost:3000/payment/result/cancel/ORD-2025-369\"} - User: -","timestamp":"2025-07-13T11:26:15.158Z"}
{"level":"http","message":"GET /api/cart 304 9.239 ms - {} - User: -","timestamp":"2025-07-13T11:26:20.185Z"}
{"level":"http","message":"GET /api/cart 304 23.761 ms - {} - User: -","timestamp":"2025-07-13T11:26:39.769Z"}
{"level":"http","message":"GET /api/cart 304 11.881 ms - {} - User: -","timestamp":"2025-07-13T11:27:09.765Z"}
{"level":"http","message":"GET /api/cart 304 15.440 ms - {} - User: -","timestamp":"2025-07-13T11:28:10.775Z"}
{"level":"http","message":"GET /api/cart 304 9.513 ms - {} - User: -","timestamp":"2025-07-13T11:28:54.674Z"}
{"level":"http","message":"GET /api/cart 304 10.108 ms - {} - User: -","timestamp":"2025-07-13T11:28:54.733Z"}
{"level":"http","message":"GET /api/cart 304 8.184 ms - {} - User: -","timestamp":"2025-07-13T11:29:09.754Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T11:29:35.651Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T11:29:35.653Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T11:29:35.654Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T11:29:35.655Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T11:29:35.829Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T11:29:35.833Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T11:29:35.998Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T11:29:36.000Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T11:29:36.001Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T11:29:36.001Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T11:29:36.002Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T11:29:36.002Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T11:29:36.002Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T11:29:36.002Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T11:29:36.003Z"}
{"level":"http","message":"GET /api/cart 304 26.537 ms - {} - User: -","timestamp":"2025-07-13T11:29:39.784Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T11:30:11.821Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T11:30:11.824Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T11:30:11.824Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T11:30:11.825Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T11:30:12.000Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T11:30:12.005Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T11:30:12.160Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T11:30:12.162Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T11:30:12.163Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T11:30:12.163Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T11:30:12.164Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T11:30:12.164Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T11:30:12.164Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T11:30:12.164Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T11:30:12.165Z"}
{"level":"http","message":"GET /api/cart 304 48.433 ms - {} - User: -","timestamp":"2025-07-13T11:30:20.821Z"}
{"level":"http","message":"GET /api/cart 304 23.627 ms - {} - User: -","timestamp":"2025-07-13T11:31:20.787Z"}
{"level":"http","message":"GET /api/cart 304 13.229 ms - {} - User: -","timestamp":"2025-07-13T11:32:20.764Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T11:33:15.783Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T11:33:15.786Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T11:33:15.786Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T11:33:15.787Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T11:33:15.987Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T11:33:15.992Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T11:33:16.189Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T11:33:16.192Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T11:33:16.192Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T11:33:16.193Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T11:33:16.193Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T11:33:16.194Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T11:33:16.194Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T11:33:16.194Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T11:33:16.194Z"}
{"level":"http","message":"GET /api/cart 304 24.568 ms - {} - User: -","timestamp":"2025-07-13T11:33:20.790Z"}
{"level":"http","message":"GET /api/cart 304 10.757 ms - {} - User: -","timestamp":"2025-07-13T11:34:20.767Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T11:34:28.457Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T11:34:28.459Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T11:34:28.460Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T11:34:28.460Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T11:34:28.641Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T11:34:28.645Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T11:34:28.818Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T11:34:28.820Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T11:34:28.821Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T11:34:28.821Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T11:34:28.821Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T11:34:28.821Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T11:34:28.821Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T11:34:28.822Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T11:34:28.822Z"}
{"level":"http","message":"GET /api/cart 304 38.812 ms - {} - User: -","timestamp":"2025-07-13T11:35:20.804Z"}
{"level":"http","message":"GET /api/cart 304 12.441 ms - {} - User: -","timestamp":"2025-07-13T11:36:20.763Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T11:36:24.754Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T11:36:24.756Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T11:36:24.757Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T11:36:24.757Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T11:36:24.938Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T11:36:24.942Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T11:36:25.098Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T11:36:25.101Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T11:36:25.101Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T11:36:25.101Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T11:36:25.101Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T11:36:25.102Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T11:36:25.102Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T11:36:25.102Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T11:36:25.102Z"}
{"level":"http","message":"GET /api/cart 304 40.479 ms - {} - User: -","timestamp":"2025-07-13T11:36:30.493Z"}
{"level":"http","message":"GET /api/products/N10K12 304 7.729 ms - {} - User: guest","timestamp":"2025-07-13T11:36:38.434Z"}
{"level":"http","message":"GET /api/cart 304 17.877 ms - {} - User: -","timestamp":"2025-07-13T11:36:38.437Z"}
{"level":"http","message":"GET /api/products/N10K12 304 1.267 ms - {} - User: guest","timestamp":"2025-07-13T11:36:38.441Z"}
{"level":"http","message":"GET /api/cart 304 8.474 ms - {} - User: -","timestamp":"2025-07-13T11:36:38.452Z"}
{"level":"http","message":"GET /api/cart 304 11.402 ms - {} - User: -","timestamp":"2025-07-13T11:36:38.466Z"}
{"level":"http","message":"GET /api/cart 304 9.275 ms - {} - User: -","timestamp":"2025-07-13T11:36:38.478Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 19.071 ms - {} - User: guest","timestamp":"2025-07-13T11:36:38.501Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 2.033 ms - {} - User: guest","timestamp":"2025-07-13T11:36:38.532Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 31.067 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-494\",\"items\":[{\"productId\":\"N10K12\",\"nameProduct\":\"Nhẫn Vàng trắng 10K đính đá ECZ PNJ Kim Bảo Như Ý XMXMW005672\",\"quantity\":1,\"sizeIndex\":1,\"unitPrice\":6891300,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-10K1.2.1.png?alt=media&token=53866139-0aab-485c-b383-6a1192411db9\"}],\"totalAmount\":6921300,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"q\",\"district\":\"q\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"q\"} - User: -","timestamp":"2025-07-13T11:36:50.217Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 748.273 ms - {\"orderId\":\"ORD-2025-494\",\"totalAmount\":6921300,\"items\":[{\"productId\":\"N10K12\",\"nameProduct\":\"Nhn Vng trng 10K nh  ECZ PNJ Kim Bo Nh  XMXMW005672\",\"quantity\":1,\"unitPrice\":6891300,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%252FTrang%2520s%E1%BB%A9c%252FNh%E1%BA%ABn%252FN-10K1.2.1.png?alt=media&token=53866139-0aab-485c-b383-6a1192411db9\"}],\"shippingFee\":30000,\"discount\":0,\"success_url\":\"http://localhost:3000/payment/result/success/ORD-2025-494\",\"cancel_url\":\"http://localhost:3000/payment/result/cancel/ORD-2025-494\"} - User: -","timestamp":"2025-07-13T11:36:50.972Z"}
{"level":"http","message":"GET /api/products/N10K12 304 0.690 ms - {} - User: guest","timestamp":"2025-07-13T11:36:59.028Z"}
{"level":"http","message":"GET /api/cart 304 10.942 ms - {} - User: -","timestamp":"2025-07-13T11:36:59.033Z"}
{"level":"http","message":"GET /api/products/N10K12 304 0.944 ms - {} - User: guest","timestamp":"2025-07-13T11:36:59.035Z"}
{"level":"http","message":"GET /api/cart 304 9.111 ms - {} - User: -","timestamp":"2025-07-13T11:36:59.045Z"}
{"level":"http","message":"GET /api/cart 304 6.536 ms - {} - User: -","timestamp":"2025-07-13T11:36:59.053Z"}
{"level":"http","message":"GET /api/cart 304 6.966 ms - {} - User: -","timestamp":"2025-07-13T11:36:59.061Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 0.973 ms - {} - User: guest","timestamp":"2025-07-13T11:36:59.111Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 1.174 ms - {} - User: guest","timestamp":"2025-07-13T11:36:59.159Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 11.020 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-337\",\"items\":[{\"productId\":\"N10K12\",\"nameProduct\":\"Nhẫn Vàng trắng 10K đính đá ECZ PNJ Kim Bảo Như Ý XMXMW005672\",\"quantity\":1,\"sizeIndex\":1,\"unitPrice\":6891300,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-10K1.2.1.png?alt=media&token=53866139-0aab-485c-b383-6a1192411db9\"}],\"totalAmount\":6921300,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"b\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T11:37:11.751Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 538.505 ms - {\"orderId\":\"ORD-2025-337\",\"totalAmount\":6921300,\"items\":[{\"productId\":\"N10K12\",\"nameProduct\":\"Nhn Vng trng 10K nh  ECZ PNJ Kim Bo Nh  XMXMW005672\",\"quantity\":1,\"unitPrice\":6891300,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%252FTrang%2520s%E1%BB%A9c%252FNh%E1%BA%ABn%252FN-10K1.2.1.png?alt=media&token=53866139-0aab-485c-b383-6a1192411db9\"}],\"shippingFee\":30000,\"discount\":0,\"success_url\":\"http://localhost:3000/payment/result/success/ORD-2025-337\",\"cancel_url\":\"http://localhost:3000/payment/result/cancel/ORD-2025-337\"} - User: -","timestamp":"2025-07-13T11:37:12.320Z"}
{"header":"t=1752406638,v1=2813cd850ac90dc5022d51fb5b336c06321ddd20276a34a8764856af18845c4a,v0=6ea4ad597d32cfdb200e1ef3b7471f7c0a3d7e7d8fe826d085ec341defd3ed11","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752406638,"data":{"object":{"amount":6921300,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":6921300,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkODZBopfvfSoZm0eRaOnxm_secret_gFpGVASyp4bgRNOxOHbJUe7aY","confirmation_method":"automatic","created":1752406637,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkODZBopfvfSoZm0eRaOnxm","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkODZBopfvfSoZm0DTEBpyX","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkODXBopfvfSoZmeKTfKsGQ","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkODZBopfvfSoZm0bJsvgMM","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"d12e26fc-2a02-4cc0-b774-d07718b2fa05"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T11:37:19.207Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T11:37:19.211Z"}
{"level":"http","message":"POST /api/payment/webhook 400 9.521 ms - {\"id\":\"evt_3RkODZBopfvfSoZm0bJsvgMM\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752406638,\"data\":{\"object\":{\"id\":\"pi_3RkODZBopfvfSoZm0eRaOnxm\",\"object\":\"payment_intent\",\"amount\":6921300,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":6921300,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkODZBopfvfSoZm0eRaOnxm_secret_gFpGVASyp4bgRNOxOHbJUe7aY\",\"confirmation_method\":\"automatic\",\"created\":1752406637,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkODZBopfvfSoZm0DTEBpyX\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkODXBopfvfSoZmeKTfKsGQ\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"d12e26fc-2a02-4cc0-b774-d07718b2fa05\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T11:37:19.213Z"}
{"header":"t=1752406638,v1=7224f735ca429aa7910dcd36f5f4cc4f629d201b71c301bf6ebd16f16e9dd87e,v0=e46d7a19b9472c499b236bc0567798157c36da55ad9d287a087736715dd371ee","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752406638,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":6921300,"amount_total":6921300,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-337","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752406632,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752493031,"id":"cs_test_b1HgoWT8nGF88DWAyab6JmEa1H34wL9eIj0pxG6aYQgFHzmZxIwLuG7EDG","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-337","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkODZBopfvfSoZm0eRaOnxm","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-337","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkODaBopfvfSoZmbgyMzxFM","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T11:37:19.253Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T11:37:19.285Z"}
{"level":"http","message":"POST /api/payment/webhook 400 34.317 ms - {\"id\":\"evt_1RkODaBopfvfSoZmbgyMzxFM\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752406638,\"data\":{\"object\":{\"id\":\"cs_test_b1HgoWT8nGF88DWAyab6JmEa1H34wL9eIj0pxG6aYQgFHzmZxIwLuG7EDG\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":6921300,\"amount_total\":6921300,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-337\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"name\":\"Nguyen Dao\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752406632,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":null,\"state\":\"Hà Nội\"},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyen Dao\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752493031,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-2025-337\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkODZBopfvfSoZm0eRaOnxm\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-337\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T11:37:19.287Z"}
{"level":"http","message":"GET /api/products/N10K12 304 0.800 ms - {} - User: guest","timestamp":"2025-07-13T11:42:29.884Z"}
{"level":"http","message":"GET /api/products/N10K12 304 0.563 ms - {} - User: guest","timestamp":"2025-07-13T11:42:29.888Z"}
{"level":"http","message":"GET /api/cart 304 13.845 ms - {} - User: -","timestamp":"2025-07-13T11:42:29.890Z"}
{"level":"http","message":"GET /api/cart 304 9.264 ms - {} - User: -","timestamp":"2025-07-13T11:42:29.901Z"}
{"level":"http","message":"GET /api/cart 304 8.059 ms - {} - User: -","timestamp":"2025-07-13T11:42:29.911Z"}
{"level":"http","message":"GET /api/cart 304 7.460 ms - {} - User: -","timestamp":"2025-07-13T11:42:29.921Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 19.880 ms - {} - User: guest","timestamp":"2025-07-13T11:42:30.008Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 1.210 ms - {} - User: guest","timestamp":"2025-07-13T11:42:30.036Z"}
{"level":"http","message":"GET /api/cart 304 8.957 ms - {} - User: -","timestamp":"2025-07-13T11:42:33.804Z"}
{"level":"http","message":"GET /api/products/N10K12 304 0.945 ms - {} - User: guest","timestamp":"2025-07-13T11:42:35.927Z"}
{"level":"http","message":"GET /api/products/N10K12 304 0.984 ms - {} - User: guest","timestamp":"2025-07-13T11:42:35.932Z"}
{"level":"http","message":"GET /api/cart 304 18.015 ms - {} - User: -","timestamp":"2025-07-13T11:42:35.935Z"}
{"level":"http","message":"GET /api/cart 304 5.914 ms - {} - User: -","timestamp":"2025-07-13T11:42:35.944Z"}
{"level":"http","message":"GET /api/cart 304 11.884 ms - {} - User: -","timestamp":"2025-07-13T11:42:35.958Z"}
{"level":"http","message":"GET /api/cart 304 8.315 ms - {} - User: -","timestamp":"2025-07-13T11:42:35.968Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 0.932 ms - {} - User: guest","timestamp":"2025-07-13T11:42:35.984Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 1.211 ms - {} - User: guest","timestamp":"2025-07-13T11:42:36.018Z"}
{"level":"http","message":"GET /api/cart 304 8.546 ms - {} - User: -","timestamp":"2025-07-13T11:42:40.382Z"}
{"level":"http","message":"GET /api/cart 304 23.971 ms - {} - User: -","timestamp":"2025-07-13T11:42:40.412Z"}
{"level":"http","message":"GET /api/cart 304 11.301 ms - {} - User: -","timestamp":"2025-07-13T11:42:40.430Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 200 60.193 ms - {} - User: -","timestamp":"2025-07-13T11:42:40.444Z"}
{"level":"http","message":"GET /api/cart 304 21.895 ms - {} - User: -","timestamp":"2025-07-13T11:42:40.455Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 29.890 ms - {} - User: -","timestamp":"2025-07-13T11:42:40.480Z"}
{"level":"http","message":"GET /api/cart 304 8.279 ms - {} - User: -","timestamp":"2025-07-13T11:42:46.178Z"}
{"level":"http","message":"GET /api/purchase-history?page=2&limit=10 200 267.173 ms - {} - User: -","timestamp":"2025-07-13T11:42:46.561Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 18.685 ms - {} - User: -","timestamp":"2025-07-13T11:42:49.082Z"}
{"level":"http","message":"GET /api/purchase-history/ORD-2025-337 200 8.518 ms - {} - User: -","timestamp":"2025-07-13T11:42:52.080Z"}
{"level":"http","message":"GET /api/purchase-history/ORD-2025-494 200 11.434 ms - {} - User: -","timestamp":"2025-07-13T11:43:01.059Z"}
{"level":"http","message":"GET /api/purchase-history/ORD-2025-369 200 25.347 ms - {} - User: -","timestamp":"2025-07-13T11:43:01.703Z"}
{"level":"http","message":"GET /api/purchase-history/ORD-2025-338 200 8.679 ms - {} - User: -","timestamp":"2025-07-13T11:43:02.789Z"}
{"level":"http","message":"GET /api/purchase-history/ORD-2025-494 304 9.062 ms - {} - User: -","timestamp":"2025-07-13T11:43:06.561Z"}
{"level":"http","message":"GET /api/purchase-history/ORD-2025-337 304 11.053 ms - {} - User: -","timestamp":"2025-07-13T11:43:07.008Z"}
{"level":"http","message":"GET /api/cart 304 6.708 ms - {} - User: -","timestamp":"2025-07-13T11:43:10.397Z"}
{"level":"http","message":"GET /api/cart 304 8.365 ms - {} - User: -","timestamp":"2025-07-13T11:43:40.412Z"}
{"level":"http","message":"GET /api/cart 304 7.258 ms - {} - User: -","timestamp":"2025-07-13T11:44:10.749Z"}
{"level":"http","message":"GET /api/cart 304 84.657 ms - {} - User: -","timestamp":"2025-07-13T11:44:11.663Z"}
{"level":"http","message":"GET /api/cart 304 14.618 ms - {} - User: -","timestamp":"2025-07-13T11:44:14.698Z"}
{"level":"http","message":"GET /api/products?limit=100 304 69.673 ms - {} - User: guest","timestamp":"2025-07-13T11:44:14.762Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 69.121 ms - {} - User: guest","timestamp":"2025-07-13T11:44:14.769Z"}
{"level":"http","message":"GET /api/collections 304 47.914 ms - {} - User: guest","timestamp":"2025-07-13T11:44:14.773Z"}
{"level":"http","message":"GET /api/products?limit=100 304 0.985 ms - {} - User: guest","timestamp":"2025-07-13T11:44:14.775Z"}
{"level":"http","message":"GET /api/cart 304 33.463 ms - {} - User: -","timestamp":"2025-07-13T11:44:14.778Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 3.165 ms - {} - User: guest","timestamp":"2025-07-13T11:44:14.787Z"}
{"level":"http","message":"GET /api/collections 304 33.429 ms - {} - User: guest","timestamp":"2025-07-13T11:44:14.823Z"}
{"level":"http","message":"GET /api/cart 304 34.047 ms - {} - User: -","timestamp":"2025-07-13T11:44:14.826Z"}
{"level":"http","message":"GET /api/cart 304 10.722 ms - {} - User: -","timestamp":"2025-07-13T11:44:14.840Z"}
{"level":"http","message":"GET /api/wishlist 304 14.303 ms - {} - User: -","timestamp":"2025-07-13T11:44:14.881Z"}
{"level":"http","message":"GET /api/wishlist 304 11.252 ms - {} - User: -","timestamp":"2025-07-13T11:44:14.894Z"}
{"level":"http","message":"GET /api/wishlist 304 15.794 ms - {} - User: -","timestamp":"2025-07-13T11:44:14.912Z"}
{"level":"http","message":"GET /api/wishlist 304 14.307 ms - {} - User: -","timestamp":"2025-07-13T11:44:14.928Z"}
{"level":"http","message":"GET /api/wishlist 304 15.086 ms - {} - User: -","timestamp":"2025-07-13T11:44:14.946Z"}
{"level":"http","message":"GET /api/wishlist 304 10.534 ms - {} - User: -","timestamp":"2025-07-13T11:44:14.959Z"}
{"level":"http","message":"GET /api/cart 304 12.579 ms - {} - User: -","timestamp":"2025-07-13T11:44:16.695Z"}
{"level":"http","message":"GET /api/collections/Combo/products 304 14.644 ms - {} - User: guest","timestamp":"2025-07-13T11:44:16.704Z"}
{"level":"http","message":"GET /api/cart 304 12.263 ms - {} - User: -","timestamp":"2025-07-13T11:44:16.709Z"}
{"level":"http","message":"GET /api/collections/Combo/products 304 13.322 ms - {} - User: guest","timestamp":"2025-07-13T11:44:16.721Z"}
{"level":"http","message":"GET /api/cart 304 13.812 ms - {} - User: -","timestamp":"2025-07-13T11:44:16.726Z"}
{"level":"http","message":"GET /api/cart 304 8.216 ms - {} - User: -","timestamp":"2025-07-13T11:44:16.736Z"}
{"level":"http","message":"GET /api/wishlist 304 26.460 ms - {} - User: -","timestamp":"2025-07-13T11:44:16.793Z"}
{"level":"http","message":"GET /api/wishlist 304 15.848 ms - {} - User: -","timestamp":"2025-07-13T11:44:16.820Z"}
{"level":"http","message":"GET /api/wishlist 304 12.253 ms - {} - User: -","timestamp":"2025-07-13T11:44:16.834Z"}
{"level":"http","message":"GET /api/wishlist 304 8.014 ms - {} - User: -","timestamp":"2025-07-13T11:44:16.845Z"}
{"level":"http","message":"GET /api/wishlist 304 10.831 ms - {} - User: -","timestamp":"2025-07-13T11:44:16.857Z"}
{"level":"http","message":"GET /api/wishlist 304 9.494 ms - {} - User: -","timestamp":"2025-07-13T11:44:16.868Z"}
{"level":"http","message":"GET /api/products/BT14 200 4.577 ms - {} - User: guest","timestamp":"2025-07-13T11:44:17.435Z"}
{"level":"http","message":"GET /api/cart 304 10.069 ms - {} - User: -","timestamp":"2025-07-13T11:44:17.437Z"}
{"level":"http","message":"GET /api/products/BT14 304 0.514 ms - {} - User: guest","timestamp":"2025-07-13T11:44:17.439Z"}
{"level":"http","message":"GET /api/cart 304 6.053 ms - {} - User: -","timestamp":"2025-07-13T11:44:17.446Z"}
{"level":"http","message":"GET /api/cart 304 9.277 ms - {} - User: -","timestamp":"2025-07-13T11:44:17.457Z"}
{"level":"http","message":"GET /api/cart 304 8.410 ms - {} - User: -","timestamp":"2025-07-13T11:44:17.468Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 0.725 ms - {} - User: guest","timestamp":"2025-07-13T11:44:17.479Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 0.804 ms - {} - User: guest","timestamp":"2025-07-13T11:44:17.542Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 11.579 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-634\",\"items\":[{\"productId\":\"BT14\",\"nameProduct\":\"Bông tai Vàng 14K đính đá CZ PNJ XM00Y003352\",\"quantity\":1,\"sizeIndex\":0,\"unitPrice\":7616700,\"productImage\":\"https://storage.googleapis.com/duan-4904c.appspot.com/flutter_pnj/Trang%20s%E1%BB%A9c/B%C3%B4ng%20tai/14/on-gbxm00y003352-bong-tai-vang-14k-dinh-da-ecz-pnj-1.jpg?GoogleAccessId=firebase-adminsdk-v1s7v%40duan-4904c.iam.gserviceaccount.com&Expires=1893430800&Signature=OrbMNd4vP0SDpYHsI%2BOcFbfO45YfE71sk1BGm7xDd2xVp5DA27TYJ7gx6gsk0bHRfMeb9tVN3GfmWNvxAyj90vVTE70vkKvZIJUNI08UV0tIE3UN%2FrW6FjPxqsnZhLEtehd1Wj0D72JobZOzXQelVpv78IFXrlI%2F2nG9mLaw6xZR8bleOzuJPiqvz%2BAvdBefp6dh4mfPRL4A%2FXQOrQZ24aHOXgGrXh0OjqwNBZ0w2GxcJGRQO25c3UGBsSxsl5vLvk2Q4w5CM%2FNXph5gz52S9HUCSg4Ita0xZXxi7nMgmBXIOSvLN57bPtZvC%2B7Ff1Z2PYx0VKIZBFyGKhAYg2yoKQ%3D%3D\"}],\"totalAmount\":7646700,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"a\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T11:44:25.438Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 709.040 ms - {\"orderId\":\"ORD-2025-634\",\"totalAmount\":7646700,\"items\":[{\"productId\":\"BT14\",\"nameProduct\":\"Bng tai Vng 14K nh  CZ PNJ XM00Y003352\",\"quantity\":1,\"unitPrice\":7616700,\"productImage\":\"https://storage.googleapis.com/duan-4904c.appspot.com/flutter_pnj/Trang%2520s%25E1%25BB%25A9c/B%25C3%25B4ng%2520tai/14/on-gbxm00y003352-bong-tai-vang-14k-dinh-da-ecz-pnj-1.jpg?GoogleAccessId=firebase-adminsdk-v1s7v%2540duan-4904c.iam.gserviceaccount.com&Expires=1893430800&Signature=OrbMNd4vP0SDpYHsI%252BOcFbfO45YfE71sk1BGm7xDd2xVp5DA27TYJ7gx6gsk0bHRfMeb9tVN3GfmWNvxAyj90vVTE70vkKvZIJUNI08UV0tIE3UN%252FrW6FjPxqsnZhLEtehd1Wj0D72JobZOzXQelVpv78IFXrlI%252F2nG9mLaw6xZR8bleOzuJPiqvz%252BAvdBefp6dh4mfPRL4A%252FXQOrQZ24aHOXgGrXh0OjqwNBZ0w2GxcJGRQO25c3UGBsSxsl5vLvk2Q4w5CM%252FNXph5gz52S9HUCSg4Ita0xZXxi7nMgmBXIOSvLN57bPtZvC%252B7Ff1Z2PYx0VKIZBFyGKhAYg2yoKQ%253D%253D\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T11:44:26.174Z"}
{"header":"t=1752407073,v1=98fa3048dc98c8e368a05ddb4f821152676ea03d0943531067d833328a8a6aff,v0=8bf5b2d69614562892a454f4301b2176b42c1067c26bb6aaf9a3a4a1090f5429","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752407072,"data":{"object":{"amount":7646700,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":7646700,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkOKaBopfvfSoZm1Q9Vu1qk_secret_gLYbohI4rba6yjkn2oqgrQXca","confirmation_method":"automatic","created":1752407072,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkOKaBopfvfSoZm1Q9Vu1qk","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkOKaBopfvfSoZm1r5ahCYj","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkOKYBopfvfSoZmmyrgC5Xu","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkOKaBopfvfSoZm1bezWWJ8","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"1413cf07-7743-49b8-a925-4e0dbe576cb7"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T11:44:33.658Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T11:44:33.665Z"}
{"level":"http","message":"POST /api/payment/webhook 400 9.662 ms - {\"id\":\"evt_3RkOKaBopfvfSoZm1bezWWJ8\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752407072,\"data\":{\"object\":{\"id\":\"pi_3RkOKaBopfvfSoZm1Q9Vu1qk\",\"object\":\"payment_intent\",\"amount\":7646700,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":7646700,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkOKaBopfvfSoZm1Q9Vu1qk_secret_gLYbohI4rba6yjkn2oqgrQXca\",\"confirmation_method\":\"automatic\",\"created\":1752407072,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkOKaBopfvfSoZm1r5ahCYj\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkOKYBopfvfSoZmmyrgC5Xu\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"1413cf07-7743-49b8-a925-4e0dbe576cb7\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T11:44:33.666Z"}
{"header":"t=1752407073,v1=5b497fe612ef81635790517950e36ce3ed42116a4c9529b15e782d3aeebfa0aa,v0=57060ebdda30015e78671aca7f725017ce3519fab0384747738311024c7111a3","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752407073,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":7646700,"amount_total":7646700,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-634","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752407065,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752493465,"id":"cs_test_b1uKGwc8kWJOpAiQjG2BP8gum27urD8kD8hYTYb6FYgQwmTxkHlvP1GZ9C","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-634","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkOKaBopfvfSoZm1Q9Vu1qk","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-634","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkOKbBopfvfSoZmU4zbio8d","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T11:44:33.727Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T11:44:33.735Z"}
{"level":"http","message":"POST /api/payment/webhook 400 13.478 ms - {\"id\":\"evt_1RkOKbBopfvfSoZmU4zbio8d\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752407073,\"data\":{\"object\":{\"id\":\"cs_test_b1uKGwc8kWJOpAiQjG2BP8gum27urD8kD8hYTYb6FYgQwmTxkHlvP1GZ9C\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":7646700,\"amount_total\":7646700,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-634\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"name\":\"Nguyen Dao\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752407065,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":null,\"state\":\"Hà Nội\"},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyen Dao\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752493465,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-2025-634\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkOKaBopfvfSoZm1Q9Vu1qk\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-634\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T11:44:33.740Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T14:15:37.873Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T14:15:37.878Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T14:15:37.879Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T14:15:37.880Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T14:15:38.158Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T14:15:38.164Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T14:15:38.419Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T14:15:38.423Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T14:15:38.424Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T14:15:38.425Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T14:15:38.425Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T14:15:38.426Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T14:15:38.426Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T14:15:38.426Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T14:15:38.426Z"}
{"level":"info","message":"🛑 SIGINT received, shutting down gracefully","timestamp":"2025-07-13T14:16:01.121Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T14:16:18.718Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T14:16:18.723Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T14:16:18.724Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T14:16:18.726Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T14:16:19.124Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T14:16:19.130Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T14:16:19.383Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T14:16:19.387Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T14:16:19.388Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T14:16:19.389Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T14:16:19.389Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T14:16:19.390Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T14:16:19.390Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T14:16:19.390Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T14:16:19.390Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 303.802 ms - {} - User: guest","timestamp":"2025-07-13T14:23:14.786Z"}
{"level":"http","message":"GET /api/products?limit=100 304 255.046 ms - {} - User: guest","timestamp":"2025-07-13T14:23:14.822Z"}
{"level":"http","message":"GET /api/collections 304 304.373 ms - {} - User: guest","timestamp":"2025-07-13T14:23:14.838Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 5.018 ms - {} - User: guest","timestamp":"2025-07-13T14:23:14.862Z"}
{"level":"http","message":"GET /api/cart 304 231.308 ms - {} - User: -","timestamp":"2025-07-13T14:23:14.881Z"}
{"level":"http","message":"GET /api/products?limit=100 304 4.386 ms - {} - User: guest","timestamp":"2025-07-13T14:23:14.903Z"}
{"level":"http","message":"GET /api/collections 304 124.970 ms - {} - User: guest","timestamp":"2025-07-13T14:23:15.034Z"}
{"level":"http","message":"GET /api/cart 304 123.867 ms - {} - User: -","timestamp":"2025-07-13T14:23:15.046Z"}
{"level":"http","message":"GET /api/wishlist 304 116.070 ms - {} - User: -","timestamp":"2025-07-13T14:23:15.083Z"}
{"level":"http","message":"GET /api/cart 304 57.860 ms - {} - User: -","timestamp":"2025-07-13T14:23:15.115Z"}
{"level":"http","message":"GET /api/wishlist 304 81.577 ms - {} - User: -","timestamp":"2025-07-13T14:23:15.175Z"}
{"level":"http","message":"GET /api/cart 304 50.664 ms - {} - User: -","timestamp":"2025-07-13T14:23:15.180Z"}
{"level":"http","message":"GET /api/wishlist 304 38.333 ms - {} - User: -","timestamp":"2025-07-13T14:23:15.222Z"}
{"level":"http","message":"GET /api/wishlist 304 31.894 ms - {} - User: -","timestamp":"2025-07-13T14:23:15.256Z"}
{"level":"http","message":"GET /api/wishlist 304 42.371 ms - {} - User: -","timestamp":"2025-07-13T14:23:15.302Z"}
{"level":"http","message":"GET /api/wishlist 304 32.136 ms - {} - User: -","timestamp":"2025-07-13T14:23:15.337Z"}
{"level":"http","message":"GET /api/auth/google 302 4.074 ms - {} - User: guest","timestamp":"2025-07-13T14:25:31.511Z"}
{"email":"nguyendao2112kientruc@gmail.com","id":"113466190791653370426","level":"info","message":"oogle Profile received:","name":"Đạo Nguyễn","picture":"https://lh3.googleusercontent.com/a/ACg8ocJ313L5QMX5Yg6rnXtGWEo-KduxwDOEiR8VMr7BUfCsZesHRx4=s96-c","timestamp":"2025-07-13T14:25:33.169Z"}
{"level":"info","message":"Google OAuth success for user:","timestamp":"2025-07-13T14:25:33.178Z"}
{"level":"http","message":"GET /api/auth/google/callback?code=4%2F0AVMBsJi9xoiE9Rwka392Pz6wsrB8IkmN511Q76U0b6bNDYDkA0iY_SgLrYfIwbLTa_r2-w&scope=email+profile+openid+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.profile&authuser=0&prompt=none 302 1484.056 ms - {} - User: 686deee8ac71d612916479d3","timestamp":"2025-07-13T14:25:33.288Z"}
{"level":"http","message":"GET /api/products?limit=100 304 3.349 ms - {} - User: guest","timestamp":"2025-07-13T14:25:35.062Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 2.939 ms - {} - User: guest","timestamp":"2025-07-13T14:25:35.077Z"}
{"level":"http","message":"GET /api/products?limit=100 304 2.664 ms - {} - User: guest","timestamp":"2025-07-13T14:25:35.090Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 6.179 ms - {} - User: guest","timestamp":"2025-07-13T14:25:35.100Z"}
{"level":"http","message":"GET /api/collections 304 66.305 ms - {} - User: guest","timestamp":"2025-07-13T14:25:35.158Z"}
{"level":"http","message":"GET /api/cart 200 83.056 ms - {} - User: -","timestamp":"2025-07-13T14:25:35.165Z"}
{"level":"http","message":"GET /api/collections 304 52.444 ms - {} - User: guest","timestamp":"2025-07-13T14:25:35.220Z"}
{"level":"http","message":"GET /api/cart 304 109.048 ms - {} - User: -","timestamp":"2025-07-13T14:25:35.290Z"}
{"level":"http","message":"GET /api/wishlist 200 98.302 ms - {} - User: -","timestamp":"2025-07-13T14:25:35.329Z"}
{"level":"http","message":"GET /api/cart 304 45.678 ms - {} - User: -","timestamp":"2025-07-13T14:25:35.362Z"}
{"level":"http","message":"GET /api/wishlist 304 58.309 ms - {} - User: -","timestamp":"2025-07-13T14:25:35.395Z"}
{"level":"http","message":"GET /api/cart 304 55.947 ms - {} - User: -","timestamp":"2025-07-13T14:25:35.429Z"}
{"level":"http","message":"GET /api/wishlist 304 45.667 ms - {} - User: -","timestamp":"2025-07-13T14:25:35.452Z"}
{"level":"http","message":"GET /api/wishlist 304 25.489 ms - {} - User: -","timestamp":"2025-07-13T14:25:35.485Z"}
{"level":"http","message":"GET /api/wishlist 304 24.238 ms - {} - User: -","timestamp":"2025-07-13T14:25:35.522Z"}
{"level":"http","message":"GET /api/wishlist 304 18.671 ms - {} - User: -","timestamp":"2025-07-13T14:25:35.545Z"}
{"level":"info","message":"findByEmailOrUsername called with:","timestamp":"2025-07-13T14:25:59.481Z"}
{"level":"info","message":"Searching with identifier:","timestamp":"2025-07-13T14:25:59.483Z"}
{"level":"http","message":"POST /api/auth/login 200 246.596 ms - {\"userName\":\"nguyendao21012002@gmail.com\",\"password\":\"[REDACTED]\"} - User: guest","timestamp":"2025-07-13T14:25:59.725Z"}
{"level":"http","message":"GET /api/products?limit=100 304 3.446 ms - {} - User: guest","timestamp":"2025-07-13T14:26:01.286Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.703 ms - {} - User: guest","timestamp":"2025-07-13T14:26:01.297Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 2.228 ms - {} - User: guest","timestamp":"2025-07-13T14:26:01.301Z"}
{"level":"http","message":"GET /api/products?limit=100 304 2.353 ms - {} - User: guest","timestamp":"2025-07-13T14:26:01.333Z"}
{"level":"http","message":"GET /api/collections 304 43.269 ms - {} - User: guest","timestamp":"2025-07-13T14:26:01.347Z"}
{"level":"http","message":"GET /api/cart 200 44.148 ms - {} - User: -","timestamp":"2025-07-13T14:26:01.354Z"}
{"level":"http","message":"GET /api/collections 304 39.071 ms - {} - User: guest","timestamp":"2025-07-13T14:26:01.398Z"}
{"level":"http","message":"GET /api/cart 304 39.707 ms - {} - User: -","timestamp":"2025-07-13T14:26:01.404Z"}
{"level":"http","message":"GET /api/cart 304 28.359 ms - {} - User: -","timestamp":"2025-07-13T14:26:01.449Z"}
{"level":"http","message":"GET /api/wishlist 200 52.392 ms - {} - User: -","timestamp":"2025-07-13T14:26:01.462Z"}
{"level":"http","message":"GET /api/cart 304 43.665 ms - {} - User: -","timestamp":"2025-07-13T14:26:01.508Z"}
{"level":"http","message":"GET /api/wishlist 304 56.844 ms - {} - User: -","timestamp":"2025-07-13T14:26:01.534Z"}
{"level":"http","message":"GET /api/wishlist 304 45.706 ms - {} - User: -","timestamp":"2025-07-13T14:26:01.583Z"}
{"level":"http","message":"GET /api/wishlist 304 39.203 ms - {} - User: -","timestamp":"2025-07-13T14:26:01.627Z"}
{"level":"http","message":"GET /api/wishlist 304 39.129 ms - {} - User: -","timestamp":"2025-07-13T14:26:01.671Z"}
{"level":"http","message":"GET /api/wishlist 304 25.849 ms - {} - User: -","timestamp":"2025-07-13T14:26:01.700Z"}
{"level":"http","message":"GET /api/cart 304 21.177 ms - {} - User: -","timestamp":"2025-07-13T14:26:31.318Z"}
{"level":"http","message":"GET /api/cart 304 23.820 ms - {} - User: -","timestamp":"2025-07-13T14:26:36.791Z"}
{"level":"http","message":"GET /api/collections/ChotMe/products 304 23.377 ms - {} - User: guest","timestamp":"2025-07-13T14:26:36.799Z"}
{"level":"http","message":"GET /api/cart 304 27.530 ms - {} - User: -","timestamp":"2025-07-13T14:26:36.831Z"}
{"level":"http","message":"GET /api/collections/ChotMe/products 304 45.899 ms - {} - User: guest","timestamp":"2025-07-13T14:26:36.860Z"}
{"level":"http","message":"GET /api/cart 304 58.324 ms - {} - User: -","timestamp":"2025-07-13T14:26:36.904Z"}
{"level":"http","message":"GET /api/wishlist 304 94.582 ms - {} - User: -","timestamp":"2025-07-13T14:26:36.957Z"}
{"level":"http","message":"GET /api/cart 304 65.379 ms - {} - User: -","timestamp":"2025-07-13T14:26:36.990Z"}
{"level":"http","message":"GET /api/wishlist 304 56.069 ms - {} - User: -","timestamp":"2025-07-13T14:26:37.026Z"}
{"level":"http","message":"GET /api/products?limit=100 304 3.295 ms - {} - User: guest","timestamp":"2025-07-13T14:26:46.660Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 2.450 ms - {} - User: guest","timestamp":"2025-07-13T14:26:46.665Z"}
{"level":"http","message":"GET /api/products?limit=100 304 4.197 ms - {} - User: guest","timestamp":"2025-07-13T14:26:46.700Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 15.435 ms - {} - User: guest","timestamp":"2025-07-13T14:26:46.728Z"}
{"level":"http","message":"GET /api/collections 304 94.919 ms - {} - User: guest","timestamp":"2025-07-13T14:26:46.765Z"}
{"level":"http","message":"GET /api/cart 304 101.902 ms - {} - User: -","timestamp":"2025-07-13T14:26:46.778Z"}
{"level":"http","message":"GET /api/collections 304 74.211 ms - {} - User: guest","timestamp":"2025-07-13T14:26:46.881Z"}
{"level":"http","message":"GET /api/cart 304 60.898 ms - {} - User: -","timestamp":"2025-07-13T14:26:46.892Z"}
{"level":"http","message":"GET /api/wishlist 304 88.733 ms - {} - User: -","timestamp":"2025-07-13T14:26:46.901Z"}
{"level":"http","message":"GET /api/cart 304 58.957 ms - {} - User: -","timestamp":"2025-07-13T14:26:46.963Z"}
{"level":"http","message":"GET /api/wishlist 304 67.155 ms - {} - User: -","timestamp":"2025-07-13T14:26:47.002Z"}
{"level":"http","message":"GET /api/cart 304 46.875 ms - {} - User: -","timestamp":"2025-07-13T14:26:47.025Z"}
{"level":"http","message":"GET /api/wishlist 304 33.965 ms - {} - User: -","timestamp":"2025-07-13T14:26:47.046Z"}
{"level":"http","message":"GET /api/wishlist 304 32.832 ms - {} - User: -","timestamp":"2025-07-13T14:26:47.082Z"}
{"level":"http","message":"GET /api/wishlist 304 27.862 ms - {} - User: -","timestamp":"2025-07-13T14:26:47.112Z"}
{"level":"http","message":"GET /api/wishlist 304 26.310 ms - {} - User: -","timestamp":"2025-07-13T14:26:47.143Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.885 ms - {} - User: guest","timestamp":"2025-07-13T14:26:48.964Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 2.972 ms - {} - User: guest","timestamp":"2025-07-13T14:26:48.992Z"}
{"level":"http","message":"GET /api/cart 304 84.322 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.027Z"}
{"level":"http","message":"GET /api/products?limit=1000 304 77.108 ms - {} - User: guest","timestamp":"2025-07-13T14:26:49.044Z"}
{"level":"http","message":"GET /api/wishlist 304 122.706 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.077Z"}
{"level":"http","message":"GET /api/products?limit=1000 304 3.714 ms - {} - User: guest","timestamp":"2025-07-13T14:26:49.083Z"}
{"level":"http","message":"GET /api/cart 304 51.559 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.107Z"}
{"level":"http","message":"GET /api/wishlist 304 52.434 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.147Z"}
{"level":"http","message":"GET /api/cart 304 32.510 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.156Z"}
{"level":"http","message":"GET /api/cart 304 31.016 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.223Z"}
{"level":"http","message":"GET /api/wishlist 304 68.176 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.231Z"}
{"level":"http","message":"GET /api/wishlist 304 28.551 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.265Z"}
{"level":"http","message":"GET /api/wishlist 304 30.268 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.298Z"}
{"level":"http","message":"GET /api/wishlist 304 28.904 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.330Z"}
{"level":"http","message":"GET /api/wishlist 304 30.521 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.365Z"}
{"level":"http","message":"GET /api/wishlist 304 27.287 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.396Z"}
{"level":"http","message":"GET /api/wishlist 304 33.327 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.435Z"}
{"level":"http","message":"GET /api/wishlist 304 27.277 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.465Z"}
{"level":"http","message":"GET /api/wishlist 304 29.266 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.501Z"}
{"level":"http","message":"GET /api/wishlist 304 29.835 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.535Z"}
{"level":"http","message":"GET /api/wishlist 304 24.700 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.564Z"}
{"level":"http","message":"GET /api/wishlist 304 26.649 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.617Z"}
{"level":"http","message":"GET /api/wishlist 304 27.442 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.647Z"}
{"level":"http","message":"GET /api/wishlist 304 29.214 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.679Z"}
{"level":"http","message":"GET /api/wishlist 304 29.412 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.712Z"}
{"level":"http","message":"GET /api/wishlist 304 28.443 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.744Z"}
{"level":"http","message":"GET /api/wishlist 304 29.512 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.777Z"}
{"level":"http","message":"GET /api/wishlist 304 30.332 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.809Z"}
{"level":"http","message":"GET /api/wishlist 304 29.307 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.844Z"}
{"level":"http","message":"GET /api/wishlist 304 30.995 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.878Z"}
{"level":"http","message":"GET /api/wishlist 304 29.328 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.914Z"}
{"level":"http","message":"GET /api/wishlist 304 30.668 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.947Z"}
{"level":"http","message":"GET /api/wishlist 304 30.137 ms - {} - User: -","timestamp":"2025-07-13T14:26:49.980Z"}
{"level":"http","message":"GET /api/wishlist 304 30.942 ms - {} - User: -","timestamp":"2025-07-13T14:26:50.014Z"}
{"level":"http","message":"GET /api/wishlist 304 34.680 ms - {} - User: -","timestamp":"2025-07-13T14:26:50.052Z"}
{"level":"http","message":"GET /api/wishlist 304 27.348 ms - {} - User: -","timestamp":"2025-07-13T14:26:50.082Z"}
{"level":"http","message":"GET /api/wishlist 304 30.316 ms - {} - User: -","timestamp":"2025-07-13T14:26:50.115Z"}
{"level":"http","message":"GET /api/wishlist 304 30.537 ms - {} - User: -","timestamp":"2025-07-13T14:26:50.152Z"}
{"level":"http","message":"GET /api/wishlist 304 28.270 ms - {} - User: -","timestamp":"2025-07-13T14:26:50.185Z"}
{"level":"http","message":"GET /api/wishlist 304 38.410 ms - {} - User: -","timestamp":"2025-07-13T14:26:50.231Z"}
{"level":"http","message":"GET /api/wishlist 304 25.673 ms - {} - User: -","timestamp":"2025-07-13T14:26:50.259Z"}
{"level":"http","message":"GET /api/wishlist 304 31.814 ms - {} - User: -","timestamp":"2025-07-13T14:26:50.294Z"}
{"level":"http","message":"GET /api/wishlist 304 31.555 ms - {} - User: -","timestamp":"2025-07-13T14:26:50.329Z"}
{"level":"http","message":"GET /api/wishlist 304 39.048 ms - {} - User: -","timestamp":"2025-07-13T14:26:50.375Z"}
{"level":"http","message":"GET /api/wishlist 304 33.240 ms - {} - User: -","timestamp":"2025-07-13T14:26:50.417Z"}
{"level":"http","message":"GET /api/wishlist 304 39.306 ms - {} - User: -","timestamp":"2025-07-13T14:26:50.460Z"}
{"level":"http","message":"GET /api/wishlist 304 73.451 ms - {} - User: -","timestamp":"2025-07-13T14:26:50.564Z"}
{"level":"http","message":"GET /api/wishlist 304 36.099 ms - {} - User: -","timestamp":"2025-07-13T14:26:50.603Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 3.650 ms - {} - User: guest","timestamp":"2025-07-13T14:26:58.627Z"}
{"level":"http","message":"GET /api/wishlist 304 32.330 ms - {} - User: -","timestamp":"2025-07-13T14:26:58.663Z"}
{"level":"http","message":"GET /api/wishlist 304 31.050 ms - {} - User: -","timestamp":"2025-07-13T14:26:58.699Z"}
{"level":"http","message":"GET /api/wishlist 304 30.463 ms - {} - User: -","timestamp":"2025-07-13T14:26:58.732Z"}
{"level":"http","message":"GET /api/wishlist 304 31.849 ms - {} - User: -","timestamp":"2025-07-13T14:26:58.767Z"}
{"level":"http","message":"GET /api/wishlist 304 25.866 ms - {} - User: -","timestamp":"2025-07-13T14:26:58.796Z"}
{"level":"http","message":"GET /api/wishlist 304 26.895 ms - {} - User: -","timestamp":"2025-07-13T14:26:58.826Z"}
{"level":"http","message":"GET /api/wishlist 304 28.578 ms - {} - User: -","timestamp":"2025-07-13T14:26:58.858Z"}
{"level":"http","message":"GET /api/wishlist 304 31.864 ms - {} - User: -","timestamp":"2025-07-13T14:26:58.892Z"}
{"level":"http","message":"GET /api/wishlist 304 28.989 ms - {} - User: -","timestamp":"2025-07-13T14:26:58.925Z"}
{"level":"http","message":"GET /api/wishlist 304 27.495 ms - {} - User: -","timestamp":"2025-07-13T14:26:58.958Z"}
{"level":"http","message":"GET /api/wishlist 304 23.931 ms - {} - User: -","timestamp":"2025-07-13T14:26:58.986Z"}
{"level":"http","message":"GET /api/wishlist 304 30.438 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.019Z"}
{"level":"http","message":"GET /api/wishlist 304 27.455 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.050Z"}
{"level":"http","message":"GET /api/wishlist 304 28.075 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.085Z"}
{"level":"http","message":"GET /api/wishlist 304 27.102 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.116Z"}
{"level":"http","message":"GET /api/wishlist 304 28.266 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.148Z"}
{"level":"http","message":"GET /api/wishlist 304 26.355 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.178Z"}
{"level":"http","message":"GET /api/wishlist 304 25.518 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.206Z"}
{"level":"http","message":"GET /api/wishlist 304 26.621 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.236Z"}
{"level":"http","message":"GET /api/wishlist 304 25.846 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.266Z"}
{"level":"http","message":"GET /api/wishlist 304 29.436 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.300Z"}
{"level":"http","message":"GET /api/wishlist 304 26.526 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.329Z"}
{"level":"http","message":"GET /api/wishlist 304 29.234 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.372Z"}
{"level":"http","message":"GET /api/wishlist 304 29.739 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.405Z"}
{"level":"http","message":"GET /api/wishlist 304 28.961 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.440Z"}
{"level":"http","message":"GET /api/wishlist 304 26.695 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.469Z"}
{"level":"http","message":"GET /api/wishlist 304 29.913 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.503Z"}
{"level":"http","message":"GET /api/wishlist 304 25.217 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.536Z"}
{"level":"http","message":"GET /api/wishlist 304 26.083 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.565Z"}
{"level":"http","message":"GET /api/wishlist 304 26.464 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.595Z"}
{"level":"http","message":"GET /api/wishlist 304 25.665 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.624Z"}
{"level":"http","message":"GET /api/wishlist 304 36.988 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.665Z"}
{"level":"http","message":"GET /api/wishlist 304 30.401 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.699Z"}
{"level":"http","message":"GET /api/wishlist 304 26.790 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.730Z"}
{"level":"http","message":"GET /api/wishlist 304 30.655 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.764Z"}
{"level":"http","message":"GET /api/wishlist 304 27.814 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.795Z"}
{"level":"http","message":"GET /api/wishlist 304 28.412 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.827Z"}
{"level":"http","message":"GET /api/wishlist 304 27.247 ms - {} - User: -","timestamp":"2025-07-13T14:26:59.857Z"}
{"level":"http","message":"GET /api/wishlist 304 24.216 ms - {} - User: -","timestamp":"2025-07-13T14:27:05.599Z"}
{"level":"http","message":"GET /api/wishlist 304 29.777 ms - {} - User: -","timestamp":"2025-07-13T14:27:05.646Z"}
{"level":"http","message":"GET /api/products/BT13 200 15.101 ms - {} - User: guest","timestamp":"2025-07-13T14:27:08.920Z"}
{"level":"http","message":"GET /api/products/BT13 304 1.039 ms - {} - User: guest","timestamp":"2025-07-13T14:27:08.931Z"}
{"level":"http","message":"GET /api/cart 304 26.965 ms - {} - User: -","timestamp":"2025-07-13T14:27:08.937Z"}
{"level":"http","message":"GET /api/cart 304 48.146 ms - {} - User: -","timestamp":"2025-07-13T14:27:08.988Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 58.544 ms - {} - User: guest","timestamp":"2025-07-13T14:27:09.010Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 7.153 ms - {} - User: guest","timestamp":"2025-07-13T14:27:09.032Z"}
{"level":"http","message":"GET /api/cart 304 34.545 ms - {} - User: -","timestamp":"2025-07-13T14:27:09.046Z"}
{"level":"http","message":"GET /api/cart 304 48.005 ms - {} - User: -","timestamp":"2025-07-13T14:27:09.096Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.723 ms - {} - User: guest","timestamp":"2025-07-13T14:27:11.227Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 3.151 ms - {} - User: guest","timestamp":"2025-07-13T14:27:11.237Z"}
{"level":"http","message":"GET /api/cart 304 43.698 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.250Z"}
{"level":"http","message":"GET /api/wishlist 304 62.678 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.277Z"}
{"level":"http","message":"GET /api/cart 304 34.107 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.291Z"}
{"level":"http","message":"GET /api/wishlist 304 48.571 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.331Z"}
{"level":"http","message":"GET /api/cart 304 37.756 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.341Z"}
{"level":"http","message":"GET /api/cart 304 28.386 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.381Z"}
{"level":"http","message":"GET /api/wishlist 304 44.086 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.387Z"}
{"level":"http","message":"GET /api/wishlist 304 30.091 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.420Z"}
{"level":"http","message":"GET /api/wishlist 304 25.911 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.449Z"}
{"level":"http","message":"GET /api/wishlist 304 28.005 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.480Z"}
{"level":"http","message":"GET /api/wishlist 304 29.002 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.512Z"}
{"level":"http","message":"GET /api/wishlist 304 28.386 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.551Z"}
{"level":"http","message":"GET /api/wishlist 304 26.991 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.584Z"}
{"level":"http","message":"GET /api/wishlist 304 26.612 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.615Z"}
{"level":"http","message":"GET /api/wishlist 304 26.565 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.645Z"}
{"level":"http","message":"GET /api/wishlist 304 29.680 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.680Z"}
{"level":"http","message":"GET /api/wishlist 304 27.215 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.711Z"}
{"level":"http","message":"GET /api/wishlist 304 27.773 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.745Z"}
{"level":"http","message":"GET /api/wishlist 304 29.380 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.783Z"}
{"level":"http","message":"GET /api/wishlist 304 29.517 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.817Z"}
{"level":"http","message":"GET /api/wishlist 304 24.952 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.845Z"}
{"level":"http","message":"GET /api/wishlist 304 27.703 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.882Z"}
{"level":"http","message":"GET /api/wishlist 304 21.220 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.910Z"}
{"level":"http","message":"GET /api/wishlist 304 38.713 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.953Z"}
{"level":"http","message":"GET /api/wishlist 304 25.151 ms - {} - User: -","timestamp":"2025-07-13T14:27:11.982Z"}
{"level":"http","message":"GET /api/wishlist 304 29.519 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.014Z"}
{"level":"http","message":"GET /api/wishlist 304 27.475 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.047Z"}
{"level":"http","message":"GET /api/wishlist 304 35.031 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.085Z"}
{"level":"http","message":"GET /api/wishlist 304 25.379 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.113Z"}
{"level":"http","message":"GET /api/wishlist 304 29.273 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.145Z"}
{"level":"http","message":"GET /api/wishlist 304 27.898 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.176Z"}
{"level":"http","message":"GET /api/wishlist 304 27.160 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.206Z"}
{"level":"http","message":"GET /api/wishlist 304 28.747 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.237Z"}
{"level":"http","message":"GET /api/wishlist 304 26.820 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.266Z"}
{"level":"http","message":"GET /api/wishlist 304 24.874 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.294Z"}
{"level":"http","message":"GET /api/wishlist 304 28.622 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.326Z"}
{"level":"http","message":"GET /api/wishlist 304 23.881 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.353Z"}
{"level":"http","message":"GET /api/wishlist 304 25.404 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.382Z"}
{"level":"http","message":"GET /api/wishlist 304 24.637 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.411Z"}
{"level":"http","message":"GET /api/wishlist 304 25.793 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.439Z"}
{"level":"http","message":"GET /api/wishlist 304 27.350 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.469Z"}
{"level":"http","message":"GET /api/wishlist 304 21.005 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.493Z"}
{"level":"http","message":"GET /api/wishlist 304 27.241 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.523Z"}
{"level":"http","message":"GET /api/wishlist 304 23.227 ms - {} - User: -","timestamp":"2025-07-13T14:27:12.548Z"}
{"level":"http","message":"GET /api/wishlist 304 23.956 ms - {} - User: -","timestamp":"2025-07-13T14:27:19.767Z"}
{"level":"http","message":"GET /api/wishlist 304 25.403 ms - {} - User: -","timestamp":"2025-07-13T14:27:19.797Z"}
{"level":"http","message":"GET /api/wishlist 304 29.507 ms - {} - User: -","timestamp":"2025-07-13T14:27:19.829Z"}
{"level":"http","message":"GET /api/wishlist 304 28.449 ms - {} - User: -","timestamp":"2025-07-13T14:27:19.860Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 4.220 ms - {} - User: guest","timestamp":"2025-07-13T14:27:29.698Z"}
{"level":"http","message":"GET /api/wishlist 304 27.156 ms - {} - User: -","timestamp":"2025-07-13T14:27:29.728Z"}
{"level":"http","message":"GET /api/wishlist 304 30.896 ms - {} - User: -","timestamp":"2025-07-13T14:27:29.764Z"}
{"level":"http","message":"GET /api/wishlist 304 31.197 ms - {} - User: -","timestamp":"2025-07-13T14:27:29.798Z"}
{"level":"http","message":"GET /api/wishlist 304 28.271 ms - {} - User: -","timestamp":"2025-07-13T14:27:29.830Z"}
{"level":"http","message":"GET /api/wishlist 304 27.788 ms - {} - User: -","timestamp":"2025-07-13T14:27:29.863Z"}
{"level":"http","message":"GET /api/wishlist 304 27.707 ms - {} - User: -","timestamp":"2025-07-13T14:27:29.894Z"}
{"level":"http","message":"GET /api/wishlist 304 36.215 ms - {} - User: -","timestamp":"2025-07-13T14:27:29.936Z"}
{"level":"http","message":"GET /api/wishlist 304 32.917 ms - {} - User: -","timestamp":"2025-07-13T14:27:29.972Z"}
{"level":"http","message":"GET /api/wishlist 304 26.293 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.000Z"}
{"level":"http","message":"GET /api/wishlist 304 27.087 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.032Z"}
{"level":"http","message":"GET /api/wishlist 304 28.524 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.066Z"}
{"level":"http","message":"GET /api/wishlist 304 26.447 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.096Z"}
{"level":"http","message":"GET /api/wishlist 304 34.022 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.134Z"}
{"level":"http","message":"GET /api/wishlist 304 27.872 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.165Z"}
{"level":"http","message":"GET /api/wishlist 304 26.616 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.196Z"}
{"level":"http","message":"GET /api/wishlist 304 26.442 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.226Z"}
{"level":"http","message":"GET /api/wishlist 304 27.698 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.256Z"}
{"level":"http","message":"GET /api/wishlist 304 28.690 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.287Z"}
{"level":"http","message":"GET /api/wishlist 304 24.671 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.315Z"}
{"level":"http","message":"GET /api/wishlist 304 26.912 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.345Z"}
{"level":"http","message":"GET /api/wishlist 304 22.754 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.370Z"}
{"level":"http","message":"GET /api/wishlist 304 27.816 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.401Z"}
{"level":"http","message":"GET /api/wishlist 304 25.374 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.428Z"}
{"level":"http","message":"GET /api/wishlist 304 25.641 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.456Z"}
{"level":"http","message":"GET /api/wishlist 304 25.878 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.485Z"}
{"level":"http","message":"GET /api/wishlist 304 22.777 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.511Z"}
{"level":"http","message":"GET /api/wishlist 304 30.056 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.549Z"}
{"level":"http","message":"GET /api/wishlist 304 24.057 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.576Z"}
{"level":"http","message":"GET /api/wishlist 304 25.103 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.604Z"}
{"level":"http","message":"GET /api/wishlist 304 24.973 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.632Z"}
{"level":"http","message":"GET /api/wishlist 304 31.356 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.666Z"}
{"level":"http","message":"GET /api/wishlist 304 23.623 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.692Z"}
{"level":"http","message":"GET /api/wishlist 304 27.280 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.723Z"}
{"level":"http","message":"GET /api/wishlist 304 47.704 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.792Z"}
{"level":"http","message":"GET /api/wishlist 304 26.445 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.823Z"}
{"level":"http","message":"GET /api/wishlist 304 28.867 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.856Z"}
{"level":"http","message":"GET /api/wishlist 304 28.504 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.890Z"}
{"level":"http","message":"GET /api/wishlist 304 23.519 ms - {} - User: -","timestamp":"2025-07-13T14:27:30.916Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&category=TRANG+S%E1%BB%A8C&sortBy=createdAt&sortOrder=desc 200 31.356 ms - {} - User: guest","timestamp":"2025-07-13T14:27:31.480Z"}
{"level":"http","message":"GET /api/wishlist 304 25.269 ms - {} - User: -","timestamp":"2025-07-13T14:27:31.530Z"}
{"level":"http","message":"GET /api/wishlist 304 31.605 ms - {} - User: -","timestamp":"2025-07-13T14:27:31.586Z"}
{"level":"http","message":"GET /api/wishlist 304 27.655 ms - {} - User: -","timestamp":"2025-07-13T14:27:31.619Z"}
{"level":"http","message":"GET /api/wishlist 304 26.222 ms - {} - User: -","timestamp":"2025-07-13T14:27:31.648Z"}
{"level":"http","message":"GET /api/wishlist 304 28.909 ms - {} - User: -","timestamp":"2025-07-13T14:27:31.679Z"}
{"level":"http","message":"GET /api/wishlist 304 28.888 ms - {} - User: -","timestamp":"2025-07-13T14:27:31.711Z"}
{"level":"http","message":"GET /api/wishlist 304 24.882 ms - {} - User: -","timestamp":"2025-07-13T14:27:31.748Z"}
{"level":"http","message":"GET /api/wishlist 304 27.882 ms - {} - User: -","timestamp":"2025-07-13T14:27:31.781Z"}
{"level":"http","message":"GET /api/wishlist 304 24.448 ms - {} - User: -","timestamp":"2025-07-13T14:27:31.809Z"}
{"level":"http","message":"GET /api/wishlist 304 23.630 ms - {} - User: -","timestamp":"2025-07-13T14:27:31.864Z"}
{"level":"http","message":"GET /api/wishlist 304 37.493 ms - {} - User: -","timestamp":"2025-07-13T14:27:31.904Z"}
{"level":"http","message":"GET /api/wishlist 304 27.133 ms - {} - User: -","timestamp":"2025-07-13T14:27:31.937Z"}
{"level":"http","message":"GET /api/wishlist 304 25.298 ms - {} - User: -","timestamp":"2025-07-13T14:27:31.966Z"}
{"level":"http","message":"GET /api/wishlist 304 29.375 ms - {} - User: -","timestamp":"2025-07-13T14:27:31.998Z"}
{"level":"http","message":"GET /api/wishlist 304 25.261 ms - {} - User: -","timestamp":"2025-07-13T14:27:32.026Z"}
{"level":"http","message":"GET /api/wishlist 304 22.133 ms - {} - User: -","timestamp":"2025-07-13T14:27:32.051Z"}
{"level":"http","message":"GET /api/wishlist 304 24.983 ms - {} - User: -","timestamp":"2025-07-13T14:27:32.082Z"}
{"level":"http","message":"GET /api/wishlist 304 28.239 ms - {} - User: -","timestamp":"2025-07-13T14:27:32.113Z"}
{"level":"http","message":"GET /api/wishlist 304 26.112 ms - {} - User: -","timestamp":"2025-07-13T14:27:32.142Z"}
{"level":"http","message":"GET /api/wishlist 304 31.107 ms - {} - User: -","timestamp":"2025-07-13T14:27:32.175Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&category=TRANG+S%E1%BB%A8C+C%C6%AF%E1%BB%9AI&sortBy=createdAt&sortOrder=desc 200 30.667 ms - {} - User: guest","timestamp":"2025-07-13T14:27:34.187Z"}
{"level":"http","message":"GET /api/wishlist 304 26.961 ms - {} - User: -","timestamp":"2025-07-13T14:27:34.236Z"}
{"level":"http","message":"GET /api/wishlist 304 26.326 ms - {} - User: -","timestamp":"2025-07-13T14:27:34.265Z"}
{"level":"http","message":"GET /api/wishlist 304 31.293 ms - {} - User: -","timestamp":"2025-07-13T14:27:34.299Z"}
{"level":"http","message":"GET /api/wishlist 304 23.854 ms - {} - User: -","timestamp":"2025-07-13T14:27:34.326Z"}
{"level":"http","message":"GET /api/wishlist 304 29.859 ms - {} - User: -","timestamp":"2025-07-13T14:27:34.359Z"}
{"level":"http","message":"GET /api/wishlist 304 31.748 ms - {} - User: -","timestamp":"2025-07-13T14:27:34.394Z"}
{"level":"http","message":"GET /api/wishlist 304 25.754 ms - {} - User: -","timestamp":"2025-07-13T14:27:34.422Z"}
{"level":"http","message":"GET /api/wishlist 304 26.204 ms - {} - User: -","timestamp":"2025-07-13T14:27:34.451Z"}
{"level":"http","message":"GET /api/wishlist 304 26.017 ms - {} - User: -","timestamp":"2025-07-13T14:27:34.480Z"}
{"level":"http","message":"GET /api/wishlist 304 26.293 ms - {} - User: -","timestamp":"2025-07-13T14:27:34.509Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.995 ms - {} - User: guest","timestamp":"2025-07-13T14:27:35.316Z"}
{"level":"http","message":"GET /api/wishlist 304 26.112 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.387Z"}
{"level":"http","message":"GET /api/wishlist 304 26.176 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.416Z"}
{"level":"http","message":"GET /api/wishlist 304 27.652 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.446Z"}
{"level":"http","message":"GET /api/wishlist 304 26.825 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.475Z"}
{"level":"http","message":"GET /api/wishlist 304 28.630 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.507Z"}
{"level":"http","message":"GET /api/wishlist 304 21.666 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.531Z"}
{"level":"http","message":"GET /api/wishlist 304 23.521 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.557Z"}
{"level":"http","message":"GET /api/wishlist 304 24.924 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.585Z"}
{"level":"http","message":"GET /api/wishlist 304 25.157 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.612Z"}
{"level":"http","message":"GET /api/wishlist 304 27.195 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.643Z"}
{"level":"http","message":"GET /api/wishlist 304 22.749 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.670Z"}
{"level":"http","message":"GET /api/wishlist 304 23.364 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.697Z"}
{"level":"http","message":"GET /api/wishlist 304 25.616 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.726Z"}
{"level":"http","message":"GET /api/wishlist 304 24.723 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.753Z"}
{"level":"http","message":"GET /api/wishlist 304 24.930 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.781Z"}
{"level":"http","message":"GET /api/wishlist 304 26.564 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.810Z"}
{"level":"http","message":"GET /api/wishlist 304 25.721 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.839Z"}
{"level":"http","message":"GET /api/wishlist 304 29.111 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.871Z"}
{"level":"http","message":"GET /api/wishlist 304 26.112 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.899Z"}
{"level":"http","message":"GET /api/wishlist 304 28.532 ms - {} - User: -","timestamp":"2025-07-13T14:27:35.931Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&maxPrice=999999&sortBy=createdAt&sortOrder=desc 200 33.737 ms - {} - User: guest","timestamp":"2025-07-13T14:27:37.091Z"}
{"level":"http","message":"GET /api/wishlist 304 24.372 ms - {} - User: -","timestamp":"2025-07-13T14:27:37.136Z"}
{"level":"http","message":"GET /api/wishlist 304 29.747 ms - {} - User: -","timestamp":"2025-07-13T14:27:37.169Z"}
{"level":"http","message":"GET /api/wishlist 304 26.901 ms - {} - User: -","timestamp":"2025-07-13T14:27:37.198Z"}
{"level":"http","message":"GET /api/wishlist 304 25.529 ms - {} - User: -","timestamp":"2025-07-13T14:27:37.226Z"}
{"level":"http","message":"GET /api/wishlist 304 28.302 ms - {} - User: -","timestamp":"2025-07-13T14:27:37.258Z"}
{"level":"http","message":"GET /api/wishlist 304 25.020 ms - {} - User: -","timestamp":"2025-07-13T14:27:37.286Z"}
{"level":"http","message":"GET /api/wishlist 304 29.586 ms - {} - User: -","timestamp":"2025-07-13T14:27:37.319Z"}
{"level":"http","message":"GET /api/wishlist 304 27.264 ms - {} - User: -","timestamp":"2025-07-13T14:27:37.349Z"}
{"level":"http","message":"GET /api/cart 304 15.320 ms - {} - User: -","timestamp":"2025-07-13T14:27:41.224Z"}
{"level":"http","message":"GET /api/products?limit=100 304 4.200 ms - {} - User: guest","timestamp":"2025-07-13T14:27:42.668Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.674 ms - {} - User: guest","timestamp":"2025-07-13T14:27:42.673Z"}
{"level":"http","message":"GET /api/products?limit=100 304 7.141 ms - {} - User: guest","timestamp":"2025-07-13T14:27:42.696Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 2.304 ms - {} - User: guest","timestamp":"2025-07-13T14:27:42.707Z"}
{"level":"http","message":"GET /api/cart 304 80.432 ms - {} - User: -","timestamp":"2025-07-13T14:27:42.731Z"}
{"level":"http","message":"GET /api/collections 304 68.559 ms - {} - User: guest","timestamp":"2025-07-13T14:27:42.746Z"}
{"level":"http","message":"GET /api/cart 304 46.726 ms - {} - User: -","timestamp":"2025-07-13T14:27:42.794Z"}
{"level":"http","message":"GET /api/collections 304 36.979 ms - {} - User: guest","timestamp":"2025-07-13T14:27:42.798Z"}
{"level":"http","message":"GET /api/wishlist 304 51.795 ms - {} - User: -","timestamp":"2025-07-13T14:27:42.836Z"}
{"level":"http","message":"GET /api/cart 304 37.231 ms - {} - User: -","timestamp":"2025-07-13T14:27:42.842Z"}
{"level":"http","message":"GET /api/cart 304 32.474 ms - {} - User: -","timestamp":"2025-07-13T14:27:42.908Z"}
{"level":"http","message":"GET /api/wishlist 304 69.538 ms - {} - User: -","timestamp":"2025-07-13T14:27:42.914Z"}
{"level":"http","message":"GET /api/wishlist 304 22.656 ms - {} - User: -","timestamp":"2025-07-13T14:27:42.939Z"}
{"level":"http","message":"GET /api/wishlist 304 22.367 ms - {} - User: -","timestamp":"2025-07-13T14:27:42.965Z"}
{"level":"http","message":"GET /api/wishlist 304 24.384 ms - {} - User: -","timestamp":"2025-07-13T14:27:42.992Z"}
{"level":"http","message":"GET /api/wishlist 304 35.342 ms - {} - User: -","timestamp":"2025-07-13T14:27:43.032Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 2.037 ms - {} - User: guest","timestamp":"2025-07-13T14:27:44.614Z"}
{"level":"http","message":"GET /api/products?limit=1000 304 4.737 ms - {} - User: guest","timestamp":"2025-07-13T14:27:44.626Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 3.183 ms - {} - User: guest","timestamp":"2025-07-13T14:27:44.674Z"}
{"level":"http","message":"GET /api/products?limit=1000 304 1.981 ms - {} - User: guest","timestamp":"2025-07-13T14:27:44.679Z"}
{"level":"http","message":"GET /api/cart 304 92.563 ms - {} - User: -","timestamp":"2025-07-13T14:27:44.682Z"}
{"level":"http","message":"GET /api/wishlist 304 115.089 ms - {} - User: -","timestamp":"2025-07-13T14:27:44.717Z"}
{"level":"http","message":"GET /api/cart 304 62.661 ms - {} - User: -","timestamp":"2025-07-13T14:27:44.759Z"}
{"level":"http","message":"GET /api/wishlist 304 64.824 ms - {} - User: -","timestamp":"2025-07-13T14:27:44.794Z"}
{"level":"http","message":"GET /api/cart 304 33.674 ms - {} - User: -","timestamp":"2025-07-13T14:27:44.799Z"}
{"level":"http","message":"GET /api/cart 304 36.904 ms - {} - User: -","timestamp":"2025-07-13T14:27:44.847Z"}
{"level":"http","message":"GET /api/wishlist 304 55.163 ms - {} - User: -","timestamp":"2025-07-13T14:27:44.856Z"}
{"level":"http","message":"GET /api/wishlist 304 28.133 ms - {} - User: -","timestamp":"2025-07-13T14:27:44.888Z"}
{"level":"http","message":"GET /api/wishlist 304 19.572 ms - {} - User: -","timestamp":"2025-07-13T14:27:44.909Z"}
{"level":"http","message":"GET /api/wishlist 304 29.182 ms - {} - User: -","timestamp":"2025-07-13T14:27:44.943Z"}
{"level":"http","message":"GET /api/wishlist 304 23.787 ms - {} - User: -","timestamp":"2025-07-13T14:27:44.970Z"}
{"level":"http","message":"GET /api/wishlist 304 24.449 ms - {} - User: -","timestamp":"2025-07-13T14:27:44.997Z"}
{"level":"http","message":"GET /api/wishlist 304 26.668 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.026Z"}
{"level":"http","message":"GET /api/wishlist 304 26.044 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.054Z"}
{"level":"http","message":"GET /api/wishlist 304 25.295 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.085Z"}
{"level":"http","message":"GET /api/wishlist 304 24.709 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.113Z"}
{"level":"http","message":"GET /api/wishlist 304 25.243 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.142Z"}
{"level":"http","message":"GET /api/wishlist 304 26.898 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.172Z"}
{"level":"http","message":"GET /api/wishlist 304 25.099 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.199Z"}
{"level":"http","message":"GET /api/wishlist 304 27.800 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.230Z"}
{"level":"http","message":"GET /api/wishlist 304 30.225 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.263Z"}
{"level":"http","message":"GET /api/wishlist 304 23.671 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.290Z"}
{"level":"http","message":"GET /api/wishlist 304 28.792 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.324Z"}
{"level":"http","message":"GET /api/wishlist 304 24.554 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.352Z"}
{"level":"http","message":"GET /api/wishlist 304 30.438 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.404Z"}
{"level":"http","message":"GET /api/wishlist 304 29.317 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.447Z"}
{"level":"http","message":"GET /api/wishlist 304 26.362 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.476Z"}
{"level":"http","message":"GET /api/wishlist 304 25.348 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.503Z"}
{"level":"http","message":"GET /api/wishlist 304 26.584 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.533Z"}
{"level":"http","message":"GET /api/wishlist 304 22.622 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.558Z"}
{"level":"http","message":"GET /api/wishlist 304 22.369 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.583Z"}
{"level":"http","message":"GET /api/wishlist 304 25.449 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.612Z"}
{"level":"http","message":"GET /api/wishlist 304 25.333 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.641Z"}
{"level":"http","message":"GET /api/wishlist 304 29.988 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.679Z"}
{"level":"http","message":"GET /api/wishlist 304 29.946 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.712Z"}
{"level":"http","message":"GET /api/wishlist 304 27.626 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.744Z"}
{"level":"http","message":"GET /api/wishlist 304 25.446 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.773Z"}
{"level":"http","message":"GET /api/wishlist 304 24.409 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.808Z"}
{"level":"http","message":"GET /api/wishlist 304 25.914 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.837Z"}
{"level":"http","message":"GET /api/wishlist 304 20.866 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.861Z"}
{"level":"http","message":"GET /api/wishlist 304 26.041 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.890Z"}
{"level":"http","message":"GET /api/wishlist 304 25.551 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.918Z"}
{"level":"http","message":"GET /api/wishlist 304 29.161 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.951Z"}
{"level":"http","message":"GET /api/wishlist 304 31.579 ms - {} - User: -","timestamp":"2025-07-13T14:27:45.987Z"}
{"level":"http","message":"GET /api/products?page=2&limit=10&sortBy=createdAt&sortOrder=desc 200 29.922 ms - {} - User: guest","timestamp":"2025-07-13T14:27:47.213Z"}
{"level":"http","message":"GET /api/wishlist 304 21.457 ms - {} - User: -","timestamp":"2025-07-13T14:27:47.261Z"}
{"level":"http","message":"GET /api/wishlist 304 26.775 ms - {} - User: -","timestamp":"2025-07-13T14:27:47.290Z"}
{"level":"http","message":"GET /api/wishlist 304 27.798 ms - {} - User: -","timestamp":"2025-07-13T14:27:47.322Z"}
{"level":"http","message":"GET /api/wishlist 304 28.257 ms - {} - User: -","timestamp":"2025-07-13T14:27:47.354Z"}
{"level":"http","message":"GET /api/wishlist 304 21.586 ms - {} - User: -","timestamp":"2025-07-13T14:27:47.379Z"}
{"level":"http","message":"GET /api/wishlist 304 28.178 ms - {} - User: -","timestamp":"2025-07-13T14:27:47.410Z"}
{"level":"http","message":"GET /api/wishlist 304 28.001 ms - {} - User: -","timestamp":"2025-07-13T14:27:47.444Z"}
{"level":"http","message":"GET /api/wishlist 304 29.284 ms - {} - User: -","timestamp":"2025-07-13T14:27:47.477Z"}
{"level":"http","message":"GET /api/wishlist 304 23.545 ms - {} - User: -","timestamp":"2025-07-13T14:27:47.505Z"}
{"level":"http","message":"GET /api/wishlist 304 44.057 ms - {} - User: -","timestamp":"2025-07-13T14:27:47.554Z"}
{"level":"http","message":"GET /api/wishlist 304 24.291 ms - {} - User: -","timestamp":"2025-07-13T14:27:47.585Z"}
{"level":"http","message":"GET /api/wishlist 304 37.499 ms - {} - User: -","timestamp":"2025-07-13T14:27:47.627Z"}
{"level":"http","message":"GET /api/wishlist 304 21.982 ms - {} - User: -","timestamp":"2025-07-13T14:27:47.679Z"}
{"level":"http","message":"GET /api/wishlist 304 21.796 ms - {} - User: -","timestamp":"2025-07-13T14:27:47.703Z"}
{"level":"http","message":"GET /api/wishlist 304 25.407 ms - {} - User: -","timestamp":"2025-07-13T14:27:47.732Z"}
{"level":"http","message":"GET /api/wishlist 304 25.978 ms - {} - User: -","timestamp":"2025-07-13T14:27:47.761Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 2.007 ms - {} - User: guest","timestamp":"2025-07-13T14:27:49.023Z"}
{"level":"http","message":"GET /api/wishlist 304 27.729 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.099Z"}
{"level":"http","message":"GET /api/wishlist 304 25.516 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.128Z"}
{"level":"http","message":"GET /api/wishlist 304 28.813 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.160Z"}
{"level":"http","message":"GET /api/wishlist 304 24.705 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.188Z"}
{"level":"http","message":"GET /api/wishlist 304 22.973 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.214Z"}
{"level":"http","message":"GET /api/wishlist 304 23.304 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.241Z"}
{"level":"http","message":"GET /api/wishlist 304 24.335 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.268Z"}
{"level":"http","message":"GET /api/wishlist 304 21.282 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.293Z"}
{"level":"http","message":"GET /api/wishlist 304 26.300 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.322Z"}
{"level":"http","message":"GET /api/wishlist 304 22.935 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.347Z"}
{"level":"http","message":"GET /api/wishlist 304 31.444 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.382Z"}
{"level":"http","message":"GET /api/wishlist 304 24.031 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.411Z"}
{"level":"http","message":"GET /api/wishlist 304 32.276 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.446Z"}
{"level":"http","message":"GET /api/wishlist 304 24.391 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.473Z"}
{"level":"http","message":"GET /api/wishlist 304 27.505 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.503Z"}
{"level":"http","message":"GET /api/wishlist 304 37.986 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.545Z"}
{"level":"http","message":"GET /api/wishlist 304 23.559 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.571Z"}
{"level":"http","message":"GET /api/wishlist 304 27.089 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.603Z"}
{"level":"http","message":"GET /api/wishlist 304 23.766 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.629Z"}
{"level":"http","message":"GET /api/wishlist 304 36.381 ms - {} - User: -","timestamp":"2025-07-13T14:27:49.668Z"}
{"level":"http","message":"GET /api/products?page=2&limit=10&sortBy=createdAt&sortOrder=desc 304 2.533 ms - {} - User: guest","timestamp":"2025-07-13T14:27:50.635Z"}
{"level":"http","message":"GET /api/wishlist 304 34.715 ms - {} - User: -","timestamp":"2025-07-13T14:27:50.721Z"}
{"level":"http","message":"GET /api/wishlist 304 27.039 ms - {} - User: -","timestamp":"2025-07-13T14:27:50.751Z"}
{"level":"http","message":"GET /api/wishlist 304 26.407 ms - {} - User: -","timestamp":"2025-07-13T14:27:50.780Z"}
{"level":"http","message":"GET /api/wishlist 304 28.348 ms - {} - User: -","timestamp":"2025-07-13T14:27:50.811Z"}
{"level":"http","message":"GET /api/wishlist 304 43.243 ms - {} - User: -","timestamp":"2025-07-13T14:27:50.858Z"}
{"level":"http","message":"GET /api/wishlist 304 27.469 ms - {} - User: -","timestamp":"2025-07-13T14:27:50.903Z"}
{"level":"http","message":"GET /api/wishlist 304 33.571 ms - {} - User: -","timestamp":"2025-07-13T14:27:50.941Z"}
{"level":"http","message":"GET /api/wishlist 304 18.310 ms - {} - User: -","timestamp":"2025-07-13T14:27:50.963Z"}
{"level":"http","message":"GET /api/wishlist 304 28.751 ms - {} - User: -","timestamp":"2025-07-13T14:27:50.995Z"}
{"level":"http","message":"GET /api/wishlist 304 21.454 ms - {} - User: -","timestamp":"2025-07-13T14:27:51.019Z"}
{"level":"http","message":"GET /api/wishlist 304 22.613 ms - {} - User: -","timestamp":"2025-07-13T14:27:51.047Z"}
{"level":"http","message":"GET /api/wishlist 304 25.497 ms - {} - User: -","timestamp":"2025-07-13T14:27:51.076Z"}
{"level":"http","message":"GET /api/wishlist 304 29.965 ms - {} - User: -","timestamp":"2025-07-13T14:27:51.108Z"}
{"level":"http","message":"GET /api/wishlist 304 26.825 ms - {} - User: -","timestamp":"2025-07-13T14:27:51.137Z"}
{"level":"http","message":"GET /api/wishlist 304 27.952 ms - {} - User: -","timestamp":"2025-07-13T14:27:51.168Z"}
{"level":"http","message":"GET /api/wishlist 304 26.501 ms - {} - User: -","timestamp":"2025-07-13T14:27:51.197Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 2.197 ms - {} - User: guest","timestamp":"2025-07-13T14:27:51.932Z"}
{"level":"http","message":"GET /api/wishlist 304 25.637 ms - {} - User: -","timestamp":"2025-07-13T14:27:51.996Z"}
{"level":"http","message":"GET /api/wishlist 304 28.532 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.027Z"}
{"level":"http","message":"GET /api/wishlist 304 28.112 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.058Z"}
{"level":"http","message":"GET /api/wishlist 304 28.806 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.090Z"}
{"level":"http","message":"GET /api/wishlist 304 31.091 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.124Z"}
{"level":"http","message":"GET /api/wishlist 304 22.127 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.148Z"}
{"level":"http","message":"GET /api/wishlist 304 30.141 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.191Z"}
{"level":"http","message":"GET /api/wishlist 304 21.411 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.231Z"}
{"level":"http","message":"GET /api/wishlist 304 22.168 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.256Z"}
{"level":"http","message":"GET /api/wishlist 304 21.544 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.280Z"}
{"level":"http","message":"GET /api/wishlist 304 28.124 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.311Z"}
{"level":"http","message":"GET /api/wishlist 304 25.207 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.339Z"}
{"level":"http","message":"GET /api/wishlist 304 24.664 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.367Z"}
{"level":"http","message":"GET /api/wishlist 304 20.455 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.390Z"}
{"level":"http","message":"GET /api/wishlist 304 22.912 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.417Z"}
{"level":"http","message":"GET /api/wishlist 304 23.681 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.444Z"}
{"level":"http","message":"GET /api/wishlist 304 28.004 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.474Z"}
{"level":"http","message":"GET /api/wishlist 304 28.384 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.505Z"}
{"level":"http","message":"GET /api/wishlist 304 32.325 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.540Z"}
{"level":"http","message":"GET /api/wishlist 304 29.110 ms - {} - User: -","timestamp":"2025-07-13T14:27:52.572Z"}
{"level":"http","message":"GET /api/cart 304 20.349 ms - {} - User: -","timestamp":"2025-07-13T14:28:05.713Z"}
{"level":"http","message":"GET /api/wishlist 304 28.961 ms - {} - User: -","timestamp":"2025-07-13T14:28:05.729Z"}
{"level":"http","message":"GET /api/cart 304 26.619 ms - {} - User: -","timestamp":"2025-07-13T14:28:05.743Z"}
{"level":"http","message":"GET /api/wishlist 304 33.562 ms - {} - User: -","timestamp":"2025-07-13T14:28:05.767Z"}
{"level":"http","message":"GET /api/cart 304 21.920 ms - {} - User: -","timestamp":"2025-07-13T14:28:05.771Z"}
{"level":"http","message":"GET /api/cart 304 16.444 ms - {} - User: -","timestamp":"2025-07-13T14:28:05.790Z"}
{"level":"http","message":"GET /api/cart 304 14.103 ms - {} - User: -","timestamp":"2025-07-13T14:28:07.524Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 12.499 ms - {} - User: guest","timestamp":"2025-07-13T14:28:07.541Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.970 ms - {} - User: guest","timestamp":"2025-07-13T14:28:07.547Z"}
{"level":"http","message":"GET /api/cart 304 18.524 ms - {} - User: -","timestamp":"2025-07-13T14:28:07.551Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.587 ms - {} - User: guest","timestamp":"2025-07-13T14:28:07.571Z"}
{"level":"http","message":"GET /api/products/K18K 304 8.103 ms - {} - User: guest","timestamp":"2025-07-13T14:28:07.582Z"}
{"level":"http","message":"GET /api/cart 304 32.121 ms - {} - User: -","timestamp":"2025-07-13T14:28:07.585Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.904 ms - {} - User: guest","timestamp":"2025-07-13T14:28:07.597Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.460 ms - {} - User: guest","timestamp":"2025-07-13T14:28:07.612Z"}
{"level":"http","message":"GET /api/cart 304 26.807 ms - {} - User: -","timestamp":"2025-07-13T14:28:07.615Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.263 ms - {} - User: guest","timestamp":"2025-07-13T14:28:07.629Z"}
{"level":"http","message":"GET /api/cart 304 17.399 ms - {} - User: -","timestamp":"2025-07-13T14:28:07.636Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.894 ms - {} - User: guest","timestamp":"2025-07-13T14:28:07.651Z"}
{"level":"http","message":"GET /api/cart 304 21.197 ms - {} - User: -","timestamp":"2025-07-13T14:28:07.660Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.220 ms - {} - User: guest","timestamp":"2025-07-13T14:28:07.700Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.464 ms - {} - User: guest","timestamp":"2025-07-13T14:28:07.722Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.851 ms - {} - User: guest","timestamp":"2025-07-13T14:28:07.744Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.046 ms - {} - User: guest","timestamp":"2025-07-13T14:28:07.749Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 2.120 ms - {} - User: guest","timestamp":"2025-07-13T14:28:07.781Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.610 ms - {} - User: guest","timestamp":"2025-07-13T14:28:07.793Z"}
{"level":"http","message":"GET /api/products/K18K 304 4.091 ms - {} - User: guest","timestamp":"2025-07-13T14:28:07.811Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.996 ms - {} - User: guest","timestamp":"2025-07-13T14:28:07.828Z"}
{"level":"http","message":"GET /api/products?limit=100 304 3.313 ms - {} - User: guest","timestamp":"2025-07-13T14:28:09.530Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.818 ms - {} - User: guest","timestamp":"2025-07-13T14:28:09.534Z"}
{"level":"http","message":"GET /api/products?limit=100 304 3.112 ms - {} - User: guest","timestamp":"2025-07-13T14:28:09.546Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.988 ms - {} - User: guest","timestamp":"2025-07-13T14:28:09.550Z"}
{"level":"http","message":"GET /api/cart 304 43.963 ms - {} - User: -","timestamp":"2025-07-13T14:28:09.561Z"}
{"level":"http","message":"GET /api/collections 304 34.200 ms - {} - User: guest","timestamp":"2025-07-13T14:28:09.571Z"}
{"level":"http","message":"GET /api/cart 304 75.833 ms - {} - User: -","timestamp":"2025-07-13T14:28:09.648Z"}
{"level":"http","message":"GET /api/collections 304 38.490 ms - {} - User: guest","timestamp":"2025-07-13T14:28:09.654Z"}
{"level":"http","message":"GET /api/wishlist 304 61.252 ms - {} - User: -","timestamp":"2025-07-13T14:28:09.695Z"}
{"level":"http","message":"GET /api/cart 304 39.815 ms - {} - User: -","timestamp":"2025-07-13T14:28:09.703Z"}
{"level":"http","message":"GET /api/cart 304 34.023 ms - {} - User: -","timestamp":"2025-07-13T14:28:09.752Z"}
{"level":"http","message":"GET /api/wishlist 304 50.907 ms - {} - User: -","timestamp":"2025-07-13T14:28:09.761Z"}
{"level":"http","message":"GET /api/wishlist 304 26.256 ms - {} - User: -","timestamp":"2025-07-13T14:28:09.792Z"}
{"level":"http","message":"GET /api/wishlist 304 23.569 ms - {} - User: -","timestamp":"2025-07-13T14:28:09.819Z"}
{"level":"http","message":"GET /api/wishlist 304 25.296 ms - {} - User: -","timestamp":"2025-07-13T14:28:09.848Z"}
{"level":"http","message":"GET /api/wishlist 304 25.014 ms - {} - User: -","timestamp":"2025-07-13T14:28:09.876Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 3.834 ms - {} - User: guest","timestamp":"2025-07-13T14:28:13.355Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 0.908 ms - {} - User: guest","timestamp":"2025-07-13T14:28:13.359Z"}
{"level":"http","message":"GET /api/cart 304 45.986 ms - {} - User: -","timestamp":"2025-07-13T14:28:13.408Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 45.528 ms - {} - User: guest","timestamp":"2025-07-13T14:28:13.436Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 1.226 ms - {} - User: guest","timestamp":"2025-07-13T14:28:13.444Z"}
{"level":"http","message":"GET /api/cart 304 27.680 ms - {} - User: -","timestamp":"2025-07-13T14:28:13.450Z"}
{"level":"http","message":"GET /api/cart 304 18.957 ms - {} - User: -","timestamp":"2025-07-13T14:28:13.471Z"}
{"level":"http","message":"GET /api/cart 304 15.012 ms - {} - User: -","timestamp":"2025-07-13T14:28:13.488Z"}
{"level":"http","message":"POST /api/cart/add 200 57.845 ms - {\"productId\":\"NC10VNA1\",\"sizeIndex\":0,\"quantity\":2} - User: -","timestamp":"2025-07-13T14:28:19.883Z"}
{"level":"http","message":"GET /api/cart 200 24.023 ms - {} - User: -","timestamp":"2025-07-13T14:28:21.710Z"}
{"level":"http","message":"GET /api/cart 304 24.517 ms - {} - User: -","timestamp":"2025-07-13T14:28:23.704Z"}
{"level":"http","message":"GET /api/wishlist 304 49.177 ms - {} - User: -","timestamp":"2025-07-13T14:28:23.742Z"}
{"level":"http","message":"GET /api/cart 304 32.840 ms - {} - User: -","timestamp":"2025-07-13T14:28:23.748Z"}
{"level":"http","message":"GET /api/cart 304 33.562 ms - {} - User: -","timestamp":"2025-07-13T14:28:23.795Z"}
{"level":"http","message":"GET /api/wishlist 304 53.383 ms - {} - User: -","timestamp":"2025-07-13T14:28:23.803Z"}
{"level":"http","message":"GET /api/cart 304 23.747 ms - {} - User: -","timestamp":"2025-07-13T14:28:23.829Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 2.316 ms - {} - User: guest","timestamp":"2025-07-13T14:28:29.072Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.414 ms - {} - User: guest","timestamp":"2025-07-13T14:28:29.076Z"}
{"level":"http","message":"GET /api/cart 304 17.047 ms - {} - User: -","timestamp":"2025-07-13T14:28:29.097Z"}
{"level":"http","message":"GET /api/products/K18K 304 5.456 ms - {} - User: guest","timestamp":"2025-07-13T14:28:29.104Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.006 ms - {} - User: guest","timestamp":"2025-07-13T14:28:29.118Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.409 ms - {} - User: guest","timestamp":"2025-07-13T14:28:29.125Z"}
{"level":"http","message":"GET /api/cart 304 22.463 ms - {} - User: -","timestamp":"2025-07-13T14:28:29.130Z"}
{"level":"http","message":"GET /api/cart 304 19.854 ms - {} - User: -","timestamp":"2025-07-13T14:28:29.152Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.687 ms - {} - User: guest","timestamp":"2025-07-13T14:28:29.167Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.380 ms - {} - User: guest","timestamp":"2025-07-13T14:28:29.177Z"}
{"level":"http","message":"GET /api/cart 304 29.003 ms - {} - User: -","timestamp":"2025-07-13T14:28:29.184Z"}
{"level":"http","message":"GET /api/cart 304 16.565 ms - {} - User: -","timestamp":"2025-07-13T14:28:29.204Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.407 ms - {} - User: guest","timestamp":"2025-07-13T14:28:29.222Z"}
{"level":"http","message":"GET /api/products/K18K 304 2.084 ms - {} - User: guest","timestamp":"2025-07-13T14:28:29.226Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.513 ms - {} - User: guest","timestamp":"2025-07-13T14:28:29.236Z"}
{"level":"http","message":"GET /api/cart 304 35.952 ms - {} - User: -","timestamp":"2025-07-13T14:28:29.242Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.001 ms - {} - User: guest","timestamp":"2025-07-13T14:28:29.271Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.530 ms - {} - User: guest","timestamp":"2025-07-13T14:28:29.275Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.668 ms - {} - User: guest","timestamp":"2025-07-13T14:28:29.295Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.587 ms - {} - User: guest","timestamp":"2025-07-13T14:28:29.310Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.762 ms - {} - User: guest","timestamp":"2025-07-13T14:28:29.332Z"}
{"level":"http","message":"GET /api/products/K18K 304 3.349 ms - {} - User: guest","timestamp":"2025-07-13T14:28:29.351Z"}
{"level":"http","message":"GET /api/cart 304 25.779 ms - {} - User: -","timestamp":"2025-07-13T14:28:59.661Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.720 ms - {} - User: guest","timestamp":"2025-07-13T14:28:59.733Z"}
{"level":"http","message":"GET /api/products/K18K 304 3.575 ms - {} - User: guest","timestamp":"2025-07-13T14:28:59.792Z"}
{"level":"http","message":"GET /api/cart 304 11.606 ms - {} - User: -","timestamp":"2025-07-13T14:29:09.514Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.332 ms - {} - User: guest","timestamp":"2025-07-13T14:29:09.544Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.043 ms - {} - User: guest","timestamp":"2025-07-13T14:29:09.558Z"}
{"level":"http","message":"GET /api/products?limit=100 304 103.329 ms - {} - User: guest","timestamp":"2025-07-13T14:29:14.064Z"}
{"level":"http","message":"GET /api/collections 304 89.075 ms - {} - User: guest","timestamp":"2025-07-13T14:29:14.070Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 123.443 ms - {} - User: guest","timestamp":"2025-07-13T14:29:14.095Z"}
{"level":"http","message":"GET /api/products?limit=100 304 2.337 ms - {} - User: guest","timestamp":"2025-07-13T14:29:14.100Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 5.768 ms - {} - User: guest","timestamp":"2025-07-13T14:29:14.117Z"}
{"level":"http","message":"GET /api/collections 304 25.363 ms - {} - User: guest","timestamp":"2025-07-13T14:29:14.128Z"}
{"level":"info","message":"findByEmailOrUsername called with:","timestamp":"2025-07-13T14:29:32.053Z"}
{"level":"info","message":"Searching with identifier:","timestamp":"2025-07-13T14:29:32.054Z"}
{"level":"http","message":"POST /api/auth/login 200 216.955 ms - {\"userName\":\"nguyendao21012002@gmail.com\",\"password\":\"[REDACTED]\"} - User: guest","timestamp":"2025-07-13T14:29:32.268Z"}
{"level":"http","message":"GET /api/products?limit=100 304 2.830 ms - {} - User: guest","timestamp":"2025-07-13T14:29:33.831Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 4.510 ms - {} - User: guest","timestamp":"2025-07-13T14:29:33.841Z"}
{"level":"http","message":"GET /api/products?limit=100 304 2.489 ms - {} - User: guest","timestamp":"2025-07-13T14:29:33.858Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 2.516 ms - {} - User: guest","timestamp":"2025-07-13T14:29:33.868Z"}
{"level":"http","message":"GET /api/cart 304 61.340 ms - {} - User: -","timestamp":"2025-07-13T14:29:33.883Z"}
{"level":"http","message":"GET /api/collections 304 56.576 ms - {} - User: guest","timestamp":"2025-07-13T14:29:33.889Z"}
{"level":"http","message":"GET /api/wishlist 304 73.091 ms - {} - User: -","timestamp":"2025-07-13T14:29:33.917Z"}
{"level":"http","message":"GET /api/cart 304 43.855 ms - {} - User: -","timestamp":"2025-07-13T14:29:33.939Z"}
{"level":"http","message":"GET /api/collections 304 37.661 ms - {} - User: guest","timestamp":"2025-07-13T14:29:33.943Z"}
{"level":"http","message":"GET /api/wishlist 304 46.551 ms - {} - User: -","timestamp":"2025-07-13T14:29:33.974Z"}
{"level":"http","message":"GET /api/cart 304 31.571 ms - {} - User: -","timestamp":"2025-07-13T14:29:33.983Z"}
{"level":"http","message":"GET /api/cart 304 22.915 ms - {} - User: -","timestamp":"2025-07-13T14:29:34.019Z"}
{"level":"http","message":"GET /api/wishlist 304 40.048 ms - {} - User: -","timestamp":"2025-07-13T14:29:34.027Z"}
{"level":"http","message":"GET /api/wishlist 304 21.523 ms - {} - User: -","timestamp":"2025-07-13T14:29:34.051Z"}
{"level":"http","message":"GET /api/wishlist 304 19.346 ms - {} - User: -","timestamp":"2025-07-13T14:29:34.072Z"}
{"level":"http","message":"GET /api/wishlist 304 17.962 ms - {} - User: -","timestamp":"2025-07-13T14:29:34.093Z"}
{"level":"http","message":"GET /api/wishlist 304 15.503 ms - {} - User: -","timestamp":"2025-07-13T14:29:34.111Z"}
{"level":"http","message":"GET /api/wishlist 304 19.626 ms - {} - User: -","timestamp":"2025-07-13T14:29:34.133Z"}
{"level":"http","message":"GET /api/wishlist 304 20.311 ms - {} - User: -","timestamp":"2025-07-13T14:29:34.156Z"}
{"level":"http","message":"GET /api/wishlist 304 23.676 ms - {} - User: -","timestamp":"2025-07-13T14:29:34.182Z"}
{"level":"http","message":"GET /api/wishlist 304 20.263 ms - {} - User: -","timestamp":"2025-07-13T14:29:34.205Z"}
{"level":"http","message":"GET /api/wishlist 304 23.868 ms - {} - User: -","timestamp":"2025-07-13T14:29:34.232Z"}
{"level":"http","message":"GET /api/cart 304 16.650 ms - {} - User: -","timestamp":"2025-07-13T14:30:04.648Z"}
{"level":"http","message":"GET /api/cart 304 15.094 ms - {} - User: -","timestamp":"2025-07-13T14:30:34.635Z"}
{"level":"http","message":"GET /api/cart 304 16.695 ms - {} - User: -","timestamp":"2025-07-13T14:31:04.648Z"}
{"level":"http","message":"GET /api/cart 304 21.643 ms - {} - User: -","timestamp":"2025-07-13T14:31:34.638Z"}
{"level":"http","message":"GET /api/cart 304 21.464 ms - {} - User: -","timestamp":"2025-07-13T14:32:04.651Z"}
{"level":"http","message":"GET /api/cart 304 22.140 ms - {} - User: -","timestamp":"2025-07-13T14:32:22.833Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.536 ms - {} - User: guest","timestamp":"2025-07-13T14:32:33.083Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 2.354 ms - {} - User: guest","timestamp":"2025-07-13T14:32:33.090Z"}
{"level":"http","message":"GET /api/products/K18K 304 2.785 ms - {} - User: guest","timestamp":"2025-07-13T14:32:33.111Z"}
{"level":"http","message":"GET /api/products/K18K 304 2.162 ms - {} - User: guest","timestamp":"2025-07-13T14:32:33.116Z"}
{"level":"http","message":"GET /api/cart 304 26.496 ms - {} - User: -","timestamp":"2025-07-13T14:32:33.120Z"}
{"level":"http","message":"GET /api/cart 304 18.719 ms - {} - User: -","timestamp":"2025-07-13T14:32:33.141Z"}
{"level":"http","message":"GET /api/cart 304 15.878 ms - {} - User: -","timestamp":"2025-07-13T14:32:33.159Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.519 ms - {} - User: guest","timestamp":"2025-07-13T14:32:33.177Z"}
{"level":"http","message":"GET /api/cart 304 19.645 ms - {} - User: -","timestamp":"2025-07-13T14:32:33.187Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.373 ms - {} - User: guest","timestamp":"2025-07-13T14:32:33.204Z"}
{"level":"http","message":"GET /api/cart 304 17.758 ms - {} - User: -","timestamp":"2025-07-13T14:32:33.207Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 2.172 ms - {} - User: guest","timestamp":"2025-07-13T14:32:33.224Z"}
{"level":"http","message":"GET /api/products/K18K 304 2.861 ms - {} - User: guest","timestamp":"2025-07-13T14:32:33.233Z"}
{"level":"http","message":"GET /api/cart 304 27.139 ms - {} - User: -","timestamp":"2025-07-13T14:32:33.236Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.034 ms - {} - User: guest","timestamp":"2025-07-13T14:32:33.249Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.601 ms - {} - User: guest","timestamp":"2025-07-13T14:32:33.254Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.978 ms - {} - User: guest","timestamp":"2025-07-13T14:32:33.275Z"}
{"level":"http","message":"GET /api/products/K18K 304 2.121 ms - {} - User: guest","timestamp":"2025-07-13T14:32:33.288Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.001 ms - {} - User: guest","timestamp":"2025-07-13T14:32:33.304Z"}
{"level":"http","message":"GET /api/products/K18K 304 0.678 ms - {} - User: guest","timestamp":"2025-07-13T14:32:33.308Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.200 ms - {} - User: guest","timestamp":"2025-07-13T14:32:33.317Z"}
{"level":"http","message":"GET /api/products/K18K 304 1.595 ms - {} - User: guest","timestamp":"2025-07-13T14:32:33.320Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.634 ms - {} - User: guest","timestamp":"2025-07-13T14:32:36.529Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 4.066 ms - {} - User: guest","timestamp":"2025-07-13T14:32:36.536Z"}
{"level":"http","message":"GET /api/products?limit=100 304 2.309 ms - {} - User: guest","timestamp":"2025-07-13T14:32:36.548Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 2.327 ms - {} - User: guest","timestamp":"2025-07-13T14:32:36.553Z"}
{"level":"http","message":"GET /api/cart 304 44.953 ms - {} - User: -","timestamp":"2025-07-13T14:32:36.565Z"}
{"level":"http","message":"GET /api/collections 304 74.254 ms - {} - User: guest","timestamp":"2025-07-13T14:32:36.613Z"}
{"level":"http","message":"GET /api/cart 304 47.146 ms - {} - User: -","timestamp":"2025-07-13T14:32:36.663Z"}
{"level":"http","message":"GET /api/collections 304 42.712 ms - {} - User: guest","timestamp":"2025-07-13T14:32:36.674Z"}
{"level":"http","message":"GET /api/cart 304 43.815 ms - {} - User: -","timestamp":"2025-07-13T14:32:36.722Z"}
{"level":"http","message":"GET /api/wishlist 304 64.428 ms - {} - User: -","timestamp":"2025-07-13T14:32:36.754Z"}
{"level":"http","message":"GET /api/cart 304 39.314 ms - {} - User: -","timestamp":"2025-07-13T14:32:36.774Z"}
{"level":"http","message":"GET /api/wishlist 304 30.052 ms - {} - User: -","timestamp":"2025-07-13T14:32:36.791Z"}
{"level":"http","message":"GET /api/wishlist 304 21.302 ms - {} - User: -","timestamp":"2025-07-13T14:32:36.815Z"}
{"level":"http","message":"GET /api/wishlist 304 24.373 ms - {} - User: -","timestamp":"2025-07-13T14:32:36.842Z"}
{"level":"http","message":"GET /api/wishlist 304 26.732 ms - {} - User: -","timestamp":"2025-07-13T14:32:36.871Z"}
{"level":"http","message":"GET /api/wishlist 304 23.371 ms - {} - User: -","timestamp":"2025-07-13T14:32:36.899Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.133 ms - {} - User: guest","timestamp":"2025-07-13T14:32:38.086Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 2.295 ms - {} - User: guest","timestamp":"2025-07-13T14:32:38.093Z"}
{"level":"http","message":"GET /api/cart 304 24.372 ms - {} - User: -","timestamp":"2025-07-13T14:32:38.098Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 1.368 ms - {} - User: guest","timestamp":"2025-07-13T14:32:38.120Z"}
{"level":"http","message":"GET /api/cart 304 33.349 ms - {} - User: -","timestamp":"2025-07-13T14:32:38.137Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 0.810 ms - {} - User: guest","timestamp":"2025-07-13T14:32:38.154Z"}
{"level":"http","message":"GET /api/cart 304 14.083 ms - {} - User: -","timestamp":"2025-07-13T14:32:38.161Z"}
{"level":"http","message":"GET /api/cart 304 13.493 ms - {} - User: -","timestamp":"2025-07-13T14:32:38.177Z"}
{"level":"http","message":"GET /api/cart 304 18.697 ms - {} - User: -","timestamp":"2025-07-13T14:33:08.105Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 37.980 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-116\",\"items\":[{\"productId\":\"NC10VNA1\",\"nameProduct\":\"Nhẫn Kim cương Vàng 10K PNJ DDDDY000790\",\"quantity\":1,\"sizeIndex\":0,\"unitPrice\":19418760,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FnewImage%2FNC-10VNA1.png?alt=media&token=46037aba-0dbf-4314-85d7-046276eab5f6\"}],\"totalAmount\":19448760,\"paymentMethod\":\"cod\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"a\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T14:33:13.375Z"}
{"level":"http","message":"GET /api/cart 304 37.113 ms - {} - User: -","timestamp":"2025-07-13T14:33:14.740Z"}
{"level":"http","message":"GET /api/cart 304 54.264 ms - {} - User: -","timestamp":"2025-07-13T14:33:14.831Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 200 174.255 ms - {} - User: -","timestamp":"2025-07-13T14:33:14.890Z"}
{"level":"http","message":"GET /api/cart 304 89.834 ms - {} - User: -","timestamp":"2025-07-13T14:33:14.928Z"}
{"level":"http","message":"GET /api/cart 304 55.754 ms - {} - User: -","timestamp":"2025-07-13T14:33:14.996Z"}
{"level":"http","message":"GET /api/cart 304 24.272 ms - {} - User: -","timestamp":"2025-07-13T14:33:15.025Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 135.941 ms - {} - User: -","timestamp":"2025-07-13T14:33:15.040Z"}
{"level":"http","message":"GET /api/products?limit=100 304 3.391 ms - {} - User: guest","timestamp":"2025-07-13T14:33:27.150Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 2.457 ms - {} - User: guest","timestamp":"2025-07-13T14:33:27.155Z"}
{"level":"http","message":"GET /api/products?limit=100 304 3.514 ms - {} - User: guest","timestamp":"2025-07-13T14:33:27.171Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.358 ms - {} - User: guest","timestamp":"2025-07-13T14:33:27.177Z"}
{"level":"http","message":"GET /api/collections 304 70.035 ms - {} - User: guest","timestamp":"2025-07-13T14:33:27.227Z"}
{"level":"http","message":"GET /api/cart 304 68.294 ms - {} - User: -","timestamp":"2025-07-13T14:33:27.229Z"}
{"level":"http","message":"GET /api/collections 304 57.895 ms - {} - User: guest","timestamp":"2025-07-13T14:33:27.290Z"}
{"level":"http","message":"GET /api/cart 304 58.775 ms - {} - User: -","timestamp":"2025-07-13T14:33:27.295Z"}
{"level":"http","message":"GET /api/wishlist 304 63.935 ms - {} - User: -","timestamp":"2025-07-13T14:33:27.319Z"}
{"level":"http","message":"GET /api/cart 304 33.919 ms - {} - User: -","timestamp":"2025-07-13T14:33:27.336Z"}
{"level":"http","message":"GET /api/wishlist 304 68.404 ms - {} - User: -","timestamp":"2025-07-13T14:33:27.398Z"}
{"level":"http","message":"GET /api/cart 304 56.185 ms - {} - User: -","timestamp":"2025-07-13T14:33:27.403Z"}
{"level":"http","message":"GET /api/wishlist 304 26.150 ms - {} - User: -","timestamp":"2025-07-13T14:33:27.432Z"}
{"level":"http","message":"GET /api/wishlist 304 28.825 ms - {} - User: -","timestamp":"2025-07-13T14:33:27.463Z"}
{"level":"http","message":"GET /api/wishlist 304 26.523 ms - {} - User: -","timestamp":"2025-07-13T14:33:27.493Z"}
{"level":"http","message":"GET /api/wishlist 304 27.050 ms - {} - User: -","timestamp":"2025-07-13T14:33:27.525Z"}
{"level":"http","message":"GET /api/products/NB2 304 10.260 ms - {} - User: guest","timestamp":"2025-07-13T14:33:28.806Z"}
{"level":"http","message":"GET /api/cart 304 27.232 ms - {} - User: -","timestamp":"2025-07-13T14:33:28.812Z"}
{"level":"http","message":"GET /api/products/NB2 304 1.617 ms - {} - User: guest","timestamp":"2025-07-13T14:33:28.815Z"}
{"level":"http","message":"GET /api/cart 304 47.264 ms - {} - User: -","timestamp":"2025-07-13T14:33:28.865Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 38.005 ms - {} - User: guest","timestamp":"2025-07-13T14:33:28.872Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 1.334 ms - {} - User: guest","timestamp":"2025-07-13T14:33:28.890Z"}
{"level":"http","message":"GET /api/cart 304 24.214 ms - {} - User: -","timestamp":"2025-07-13T14:33:28.899Z"}
{"level":"http","message":"GET /api/cart 304 14.350 ms - {} - User: -","timestamp":"2025-07-13T14:33:28.917Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 27.975 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-828\",\"items\":[{\"productId\":\"NB2\",\"nameProduct\":\"Nhẫn nam Bạc đính đá PNJSilver XMXMW060196\",\"quantity\":1,\"sizeIndex\":0,\"unitPrice\":985500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-B2.1.png?alt=media&token=8f99e041-4f97-4ee1-9cc3-bd5f48146e08\"}],\"totalAmount\":1015500,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"a\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T14:33:44.654Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 767.226 ms - {\"orderId\":\"ORD-2025-828\",\"totalAmount\":1015500,\"items\":[{\"productId\":\"NB2\",\"nameProduct\":\"Nhn nam Bc nh  PNJSilver XMXMW060196\",\"quantity\":1,\"unitPrice\":985500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%252FTrang%2520s%E1%BB%A9c%252FNh%E1%BA%ABn%252FN-B2.1.png?alt=media&token=8f99e041-4f97-4ee1-9cc3-bd5f48146e08\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T14:33:45.434Z"}
{"level":"http","message":"GET /api/cart 304 42.203 ms - {} - User: -","timestamp":"2025-07-13T14:38:26.383Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 200 100.003 ms - {} - User: -","timestamp":"2025-07-13T14:38:26.454Z"}
{"level":"http","message":"GET /api/cart 304 42.497 ms - {} - User: -","timestamp":"2025-07-13T14:38:26.464Z"}
{"level":"http","message":"GET /api/cart 304 46.833 ms - {} - User: -","timestamp":"2025-07-13T14:38:26.530Z"}
{"level":"http","message":"GET /api/cart 304 23.769 ms - {} - User: -","timestamp":"2025-07-13T14:38:26.601Z"}
{"level":"http","message":"GET /api/purchase-history?page=1&limit=10 304 151.599 ms - {} - User: -","timestamp":"2025-07-13T14:38:26.618Z"}
{"level":"http","message":"GET /api/cart 304 75.327 ms - {} - User: -","timestamp":"2025-07-13T14:38:30.643Z"}
{"level":"http","message":"GET /api/products?limit=100 304 76.153 ms - {} - User: guest","timestamp":"2025-07-13T14:38:30.653Z"}
{"level":"http","message":"GET /api/collections 304 63.072 ms - {} - User: guest","timestamp":"2025-07-13T14:38:30.657Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 104.178 ms - {} - User: guest","timestamp":"2025-07-13T14:38:30.690Z"}
{"level":"http","message":"GET /api/products?limit=100 304 3.596 ms - {} - User: guest","timestamp":"2025-07-13T14:38:30.710Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 3.185 ms - {} - User: guest","timestamp":"2025-07-13T14:38:30.729Z"}
{"level":"http","message":"GET /api/cart 304 57.771 ms - {} - User: -","timestamp":"2025-07-13T14:38:30.751Z"}
{"level":"http","message":"GET /api/collections 304 44.088 ms - {} - User: guest","timestamp":"2025-07-13T14:38:30.758Z"}
{"level":"http","message":"GET /api/cart 304 24.261 ms - {} - User: -","timestamp":"2025-07-13T14:38:30.798Z"}
{"level":"http","message":"GET /api/wishlist 304 42.847 ms - {} - User: -","timestamp":"2025-07-13T14:38:30.806Z"}
{"level":"http","message":"GET /api/cart 304 41.337 ms - {} - User: -","timestamp":"2025-07-13T14:38:30.853Z"}
{"level":"http","message":"GET /api/wishlist 304 44.978 ms - {} - User: -","timestamp":"2025-07-13T14:38:30.870Z"}
{"level":"http","message":"GET /api/wishlist 304 34.526 ms - {} - User: -","timestamp":"2025-07-13T14:38:30.911Z"}
{"level":"http","message":"GET /api/wishlist 304 54.852 ms - {} - User: -","timestamp":"2025-07-13T14:38:30.977Z"}
{"level":"http","message":"GET /api/wishlist 304 25.087 ms - {} - User: -","timestamp":"2025-07-13T14:38:31.006Z"}
{"level":"http","message":"GET /api/wishlist 304 28.318 ms - {} - User: -","timestamp":"2025-07-13T14:38:31.037Z"}
{"level":"http","message":"GET /api/cart 304 28.515 ms - {} - User: -","timestamp":"2025-07-13T14:38:32.296Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 28.192 ms - {} - User: guest","timestamp":"2025-07-13T14:38:32.301Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 2.011 ms - {} - User: guest","timestamp":"2025-07-13T14:38:32.316Z"}
{"level":"http","message":"GET /api/cart 304 46.052 ms - {} - User: -","timestamp":"2025-07-13T14:38:32.352Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 63.951 ms - {} - User: guest","timestamp":"2025-07-13T14:38:32.399Z"}
{"level":"http","message":"GET /api/cart 304 29.767 ms - {} - User: -","timestamp":"2025-07-13T14:38:32.410Z"}
{"level":"http","message":"GET /api/cart 304 24.549 ms - {} - User: -","timestamp":"2025-07-13T14:38:32.437Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 1.896 ms - {} - User: guest","timestamp":"2025-07-13T14:38:32.462Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 32.672 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-926\",\"items\":[{\"productId\":\"NC10VNA1\",\"nameProduct\":\"Nhẫn Kim cương Vàng 10K PNJ DDDDY000790\",\"quantity\":1,\"sizeIndex\":0,\"unitPrice\":19418760,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FnewImage%2FNC-10VNA1.png?alt=media&token=46037aba-0dbf-4314-85d7-046276eab5f6\"}],\"totalAmount\":19448760,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"a\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T14:38:44.606Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 780.285 ms - {\"orderId\":\"ORD-2025-926\",\"totalAmount\":19448760,\"items\":[{\"productId\":\"NC10VNA1\",\"nameProduct\":\"Nhn Kim cng Vng 10K PNJ DDDDY000790\",\"quantity\":1,\"unitPrice\":19418760,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%252FnewImage%252FNC-10VNA1.png?alt=media&token=46037aba-0dbf-4314-85d7-046276eab5f6\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T14:38:45.402Z"}
{"header":"t=1752417533,v1=a8e4835e025edd79376e1c3b0cce374a12c9dd19fe20e2ab23368c9b145d46fa,v0=af2a3c0429b38ecbc56a4564b8b4a8f43ebc3b7e063fef3bd1b97c1696e5e802","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752417532,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":19448760,"amount_total":19448760,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-926","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752417524,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752503924,"id":"cs_test_b12HSD0ZaCHp9TL9zDFCDrdsshoPGh0o4rxeekPWbbCZBw6Pd48WSrOt2s","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-926","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkR3HBopfvfSoZm11LW98Mu","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-926","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkR3IBopfvfSoZmQ3ES406q","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T14:38:53.898Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T14:38:53.933Z"}
{"level":"http","message":"POST /api/payment/webhook 400 63.471 ms - {\"id\":\"evt_1RkR3IBopfvfSoZmQ3ES406q\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752417532,\"data\":{\"object\":{\"id\":\"cs_test_b12HSD0ZaCHp9TL9zDFCDrdsshoPGh0o4rxeekPWbbCZBw6Pd48WSrOt2s\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":19448760,\"amount_total\":19448760,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-926\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"name\":\"Nguyen Dao\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752417524,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":null,\"state\":\"Hà Nội\"},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyen Dao\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752503924,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-2025-926\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkR3HBopfvfSoZm11LW98Mu\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-926\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T14:38:53.956Z"}
{"header":"t=1752417533,v1=4264840ec685932502f417a515d20ce9bc54d9a50f0c831ebcd111b92520661e,v0=a2749b457ee7b621d45715a5cfba861486011c4c57b2ce259a68f1a7fddd3e82","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752417532,"data":{"object":{"amount":19448760,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":19448760,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkR3HBopfvfSoZm11LW98Mu_secret_1PaDW8yBE4MP7lTXSO64wxYSn","confirmation_method":"automatic","created":1752417531,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkR3HBopfvfSoZm11LW98Mu","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkR3HBopfvfSoZm1lRA7oIU","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkR3EBopfvfSoZmNgHhtiI1","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkR3HBopfvfSoZm1awmmhXz","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"5f6f287c-7cf7-4712-bcf2-989847203f5c"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T14:38:54.012Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:481:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T14:38:54.543Z"}
{"level":"http","message":"POST /api/payment/webhook 400 539.684 ms - {\"id\":\"evt_3RkR3HBopfvfSoZm1awmmhXz\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752417532,\"data\":{\"object\":{\"id\":\"pi_3RkR3HBopfvfSoZm11LW98Mu\",\"object\":\"payment_intent\",\"amount\":19448760,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":19448760,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkR3HBopfvfSoZm11LW98Mu_secret_1PaDW8yBE4MP7lTXSO64wxYSn\",\"confirmation_method\":\"automatic\",\"created\":1752417531,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkR3HBopfvfSoZm1lRA7oIU\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkR3EBopfvfSoZmNgHhtiI1\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"5f6f287c-7cf7-4712-bcf2-989847203f5c\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T14:38:54.546Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T14:43:42.891Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T14:43:42.895Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T14:43:42.896Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T14:43:42.896Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T14:43:43.248Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T14:43:43.254Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T14:43:43.536Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T14:43:43.541Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T14:43:43.542Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T14:43:43.544Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T14:43:43.545Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T14:43:43.545Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T14:43:43.546Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T14:43:43.547Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T14:43:43.547Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T14:44:17.566Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T14:44:17.575Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T14:44:17.577Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T14:44:17.579Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T14:44:18.042Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T14:44:18.047Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T14:44:18.325Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T14:44:18.330Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T14:44:18.331Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T14:44:18.332Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T14:44:18.334Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T14:44:18.334Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T14:44:18.335Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T14:44:18.335Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T14:44:18.336Z"}
{"header":"t=1752417859,v1=d7cc323396e23360786a9c2a9c7ff32d87e14d898edc325052e18f7d663e78ce,v0=533e1861f8c27b091990f5a3178cedbaf7adce9c9e2ef34714e07a6f01a427b5","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752407072,"data":{"object":{"amount":7646700,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":7646700,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkOKaBopfvfSoZm1Q9Vu1qk_secret_gLYbohI4rba6yjkn2oqgrQXca","confirmation_method":"automatic","created":1752407072,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkOKaBopfvfSoZm1Q9Vu1qk","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkOKaBopfvfSoZm1r5ahCYj","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkOKYBopfvfSoZmmyrgC5Xu","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkOKaBopfvfSoZm1bezWWJ8","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"1413cf07-7743-49b8-a925-4e0dbe576cb7"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T14:44:20.196Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T14:44:20.329Z"}
{"level":"http","message":"POST /api/payment/webhook 400 256.107 ms - {\"id\":\"evt_3RkOKaBopfvfSoZm1bezWWJ8\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752407072,\"data\":{\"object\":{\"id\":\"pi_3RkOKaBopfvfSoZm1Q9Vu1qk\",\"object\":\"payment_intent\",\"amount\":7646700,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":7646700,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkOKaBopfvfSoZm1Q9Vu1qk_secret_gLYbohI4rba6yjkn2oqgrQXca\",\"confirmation_method\":\"automatic\",\"created\":1752407072,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkOKaBopfvfSoZm1r5ahCYj\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkOKYBopfvfSoZmmyrgC5Xu\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"1413cf07-7743-49b8-a925-4e0dbe576cb7\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T14:44:20.440Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1537.516 ms - {} - User: guest","timestamp":"2025-07-13T14:44:26.669Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1531.168 ms - {} - User: guest","timestamp":"2025-07-13T14:44:26.682Z"}
{"level":"http","message":"GET /api/collections 304 1527.902 ms - {} - User: guest","timestamp":"2025-07-13T14:44:26.693Z"}
{"level":"http","message":"GET /api/cart 304 1527.640 ms - {} - User: -","timestamp":"2025-07-13T14:44:26.711Z"}
{"level":"http","message":"GET /api/products?limit=100 304 8.028 ms - {} - User: guest","timestamp":"2025-07-13T14:44:26.726Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 3.784 ms - {} - User: guest","timestamp":"2025-07-13T14:44:26.743Z"}
{"level":"http","message":"GET /api/collections 304 63.706 ms - {} - User: guest","timestamp":"2025-07-13T14:44:26.823Z"}
{"level":"http","message":"GET /api/cart 304 62.910 ms - {} - User: -","timestamp":"2025-07-13T14:44:26.830Z"}
{"level":"http","message":"GET /api/wishlist 304 1167.562 ms - {} - User: -","timestamp":"2025-07-13T14:44:27.949Z"}
{"level":"http","message":"GET /api/cart - - ms - {} - User: guest","timestamp":"2025-07-13T14:44:27.954Z"}
{"level":"http","message":"GET /api/products?limit=100 304 3.731 ms - {} - User: guest","timestamp":"2025-07-13T14:44:27.990Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 2.830 ms - {} - User: guest","timestamp":"2025-07-13T14:44:27.995Z"}
{"level":"http","message":"GET /api/products?limit=100 304 5.314 ms - {} - User: guest","timestamp":"2025-07-13T14:44:28.025Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 4.282 ms - {} - User: guest","timestamp":"2025-07-13T14:44:28.040Z"}
{"level":"http","message":"GET /api/cart 200 116.099 ms - {} - User: -","timestamp":"2025-07-13T14:44:28.076Z"}
{"level":"http","message":"GET /api/collections 304 104.494 ms - {} - User: guest","timestamp":"2025-07-13T14:44:28.102Z"}
{"level":"http","message":"GET /api/cart 304 710.790 ms - {} - User: -","timestamp":"2025-07-13T14:44:28.815Z"}
{"level":"http","message":"GET /api/wishlist 200 730.978 ms - {} - User: -","timestamp":"2025-07-13T14:44:28.822Z"}
{"level":"http","message":"GET /api/collections 304 708.166 ms - {} - User: guest","timestamp":"2025-07-13T14:44:28.826Z"}
{"level":"http","message":"GET /api/cart 304 53.019 ms - {} - User: -","timestamp":"2025-07-13T14:44:28.885Z"}
{"level":"http","message":"GET /api/wishlist 304 95.200 ms - {} - User: -","timestamp":"2025-07-13T14:44:28.940Z"}
{"level":"http","message":"GET /api/cart 304 56.703 ms - {} - User: -","timestamp":"2025-07-13T14:44:28.955Z"}
{"level":"http","message":"GET /api/products/NB12 304 17.960 ms - {} - User: guest","timestamp":"2025-07-13T14:44:29.582Z"}
{"level":"http","message":"GET /api/cart 304 38.345 ms - {} - User: -","timestamp":"2025-07-13T14:44:29.592Z"}
{"level":"http","message":"GET /api/products/NB12 304 2.098 ms - {} - User: guest","timestamp":"2025-07-13T14:44:29.597Z"}
{"level":"http","message":"GET /api/wishlist 304 649.975 ms - {} - User: -","timestamp":"2025-07-13T14:44:29.610Z"}
{"level":"http","message":"GET /api/cart 304 749.045 ms - {} - User: -","timestamp":"2025-07-13T14:44:30.362Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 748.714 ms - {} - User: guest","timestamp":"2025-07-13T14:44:30.374Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 3.022 ms - {} - User: guest","timestamp":"2025-07-13T14:44:31.470Z"}
{"level":"http","message":"GET /api/wishlist 304 1175.771 ms - {} - User: -","timestamp":"2025-07-13T14:44:31.496Z"}
{"level":"http","message":"GET /api/cart 304 1145.494 ms - {} - User: -","timestamp":"2025-07-13T14:44:31.527Z"}
{"level":"http","message":"GET /api/cart 304 30.939 ms - {} - User: -","timestamp":"2025-07-13T14:44:31.628Z"}
{"level":"http","message":"GET /api/wishlist 304 106.978 ms - {} - User: -","timestamp":"2025-07-13T14:44:31.644Z"}
{"level":"http","message":"GET /api/wishlist 304 62.597 ms - {} - User: -","timestamp":"2025-07-13T14:44:31.709Z"}
{"level":"http","message":"GET /api/cart 304 46.791 ms - {} - User: -","timestamp":"2025-07-13T14:44:35.396Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 81.449 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-090\",\"items\":[{\"productId\":\"NB12\",\"nameProduct\":\"Nhẫn Bạc đính đá STYLE By PNJ ZTXMW000032\",\"quantity\":1,\"sizeIndex\":1,\"unitPrice\":589500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-B1.2.1.png?alt=media&token=a9502595-0167-4a98-8f34-4eefd1f35ba8\"}],\"totalAmount\":619500,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"a\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T14:44:40.435Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 908.161 ms - {\"orderId\":\"ORD-2025-090\",\"totalAmount\":619500,\"items\":[{\"productId\":\"NB12\",\"nameProduct\":\"Nhn Bc nh  STYLE By PNJ ZTXMW000032\",\"quantity\":1,\"unitPrice\":589500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%252FTrang%2520s%E1%BB%A9c%252FNh%E1%BA%ABn%252FN-B1.2.1.png?alt=media&token=a9502595-0167-4a98-8f34-4eefd1f35ba8\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T14:44:41.362Z"}
{"header":"t=1752417888,v1=216e6ed3ac47415be217d101a9893ca842650e31b1ff44194491ab5b832c0b84,v0=fd332b86251dd89dea2cdfd9af52444f2a23d97cc29b03d7cfe04312002c7809","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752417887,"data":{"object":{"amount":619500,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":619500,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkR90BopfvfSoZm1B0um8m3_secret_IVuTGWHw6PrsgW1C0GdQnLxls","confirmation_method":"automatic","created":1752417886,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkR90BopfvfSoZm1B0um8m3","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkR90BopfvfSoZm1t2iW3IC","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkR8yBopfvfSoZmJBmfBfay","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkR90BopfvfSoZm1v5ua0E3","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"9ad04a45-f8c9-4672-8a16-5524b8f104ac"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T14:44:49.004Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T14:44:49.012Z"}
{"level":"http","message":"POST /api/payment/webhook 400 23.785 ms - {\"id\":\"evt_3RkR90BopfvfSoZm1v5ua0E3\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752417887,\"data\":{\"object\":{\"id\":\"pi_3RkR90BopfvfSoZm1B0um8m3\",\"object\":\"payment_intent\",\"amount\":619500,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":619500,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkR90BopfvfSoZm1B0um8m3_secret_IVuTGWHw6PrsgW1C0GdQnLxls\",\"confirmation_method\":\"automatic\",\"created\":1752417886,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkR90BopfvfSoZm1t2iW3IC\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkR8yBopfvfSoZmJBmfBfay\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"9ad04a45-f8c9-4672-8a16-5524b8f104ac\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T14:44:49.020Z"}
{"header":"t=1752417888,v1=b30f5b5370158774c81e23ee1dca55c57a9a7a551e75a4c0e27999e4aa9c0f34,v0=5fa524456f1c78c8653c5e50ba45189de96a605199444d7359faa65160d8ca02","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752417887,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":619500,"amount_total":619500,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-090","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752417880,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752504280,"id":"cs_test_b1KZf5on1picoiC7zFd6Bh7Olm7rYxFS8owFbcOOBuO9uffTwQQyh4fIi1","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-090","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkR90BopfvfSoZm1B0um8m3","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-090","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkR92BopfvfSoZmwUsXcXfL","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T14:44:49.130Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T14:44:49.139Z"}
{"level":"http","message":"POST /api/payment/webhook 400 16.726 ms - {\"id\":\"evt_1RkR92BopfvfSoZmwUsXcXfL\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752417887,\"data\":{\"object\":{\"id\":\"cs_test_b1KZf5on1picoiC7zFd6Bh7Olm7rYxFS8owFbcOOBuO9uffTwQQyh4fIi1\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":619500,\"amount_total\":619500,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-090\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"name\":\"Nguyen Dao\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752417880,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":null,\"state\":\"Hà Nội\"},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyen Dao\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752504280,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-2025-090\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkR90BopfvfSoZm1B0um8m3\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-090\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T14:44:49.141Z"}
{"header":"t=1752417941,v1=99b225b82f68357fbecec333686838d53a4dd591612aa4b3c12d76dc18605f49,v0=f8eedebdd1b547d7bd6beef5a1b62ca5a23e4ece5394c4c7aab161ea7a4b3a3b","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752407073,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":7646700,"amount_total":7646700,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-634","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752407065,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752493465,"id":"cs_test_b1uKGwc8kWJOpAiQjG2BP8gum27urD8kD8hYTYb6FYgQwmTxkHlvP1GZ9C","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-634","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkOKaBopfvfSoZm1Q9Vu1qk","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-634","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkOKbBopfvfSoZmU4zbio8d","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T14:45:42.217Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T14:45:42.250Z"}
{"level":"http","message":"POST /api/payment/webhook 400 54.634 ms - {\"id\":\"evt_1RkOKbBopfvfSoZmU4zbio8d\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752407073,\"data\":{\"object\":{\"id\":\"cs_test_b1uKGwc8kWJOpAiQjG2BP8gum27urD8kD8hYTYb6FYgQwmTxkHlvP1GZ9C\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":7646700,\"amount_total\":7646700,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-634\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"name\":\"Nguyen Dao\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752407065,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":null,\"state\":\"Hà Nội\"},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyen Dao\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752493465,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-2025-634\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkOKaBopfvfSoZm1Q9Vu1qk\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-634\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T14:45:42.268Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T14:45:45.554Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T14:45:45.557Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T14:45:45.558Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T14:45:45.560Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T14:45:45.866Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T14:45:45.871Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T14:45:46.165Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T14:45:46.170Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T14:45:46.171Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T14:45:46.172Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T14:45:46.173Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T14:45:46.173Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T14:45:46.174Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T14:45:46.174Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T14:45:46.174Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 450.214 ms - {} - User: guest","timestamp":"2025-07-13T14:46:39.556Z"}
{"level":"http","message":"GET /api/products?limit=100 304 513.438 ms - {} - User: guest","timestamp":"2025-07-13T14:46:39.582Z"}
{"level":"http","message":"GET /api/collections 304 467.651 ms - {} - User: guest","timestamp":"2025-07-13T14:46:39.591Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 3.459 ms - {} - User: guest","timestamp":"2025-07-13T14:46:39.599Z"}
{"level":"http","message":"GET /api/cart 304 449.687 ms - {} - User: -","timestamp":"2025-07-13T14:46:39.612Z"}
{"level":"http","message":"GET /api/products?limit=100 304 3.511 ms - {} - User: guest","timestamp":"2025-07-13T14:46:39.620Z"}
{"level":"http","message":"GET /api/collections 304 73.647 ms - {} - User: guest","timestamp":"2025-07-13T14:46:39.698Z"}
{"level":"http","message":"GET /api/cart 304 70.522 ms - {} - User: -","timestamp":"2025-07-13T14:46:39.705Z"}
{"level":"http","message":"GET /api/wishlist 304 60.694 ms - {} - User: -","timestamp":"2025-07-13T14:46:39.740Z"}
{"level":"http","message":"GET /api/cart 304 503.285 ms - {} - User: -","timestamp":"2025-07-13T14:46:40.249Z"}
{"level":"http","message":"GET /api/wishlist 304 73.103 ms - {} - User: -","timestamp":"2025-07-13T14:46:40.288Z"}
{"level":"http","message":"GET /api/cart 304 48.247 ms - {} - User: -","timestamp":"2025-07-13T14:46:40.310Z"}
{"level":"http","message":"GET /api/wishlist 304 37.341 ms - {} - User: -","timestamp":"2025-07-13T14:46:40.333Z"}
{"level":"http","message":"GET /api/wishlist 304 80.634 ms - {} - User: -","timestamp":"2025-07-13T14:46:40.417Z"}
{"level":"http","message":"GET /api/wishlist 304 28.239 ms - {} - User: -","timestamp":"2025-07-13T14:46:40.448Z"}
{"level":"http","message":"GET /api/wishlist 304 30.852 ms - {} - User: -","timestamp":"2025-07-13T14:46:40.484Z"}
{"level":"http","message":"GET /api/products/NB2 304 12.258 ms - {} - User: guest","timestamp":"2025-07-13T14:46:44.365Z"}
{"level":"http","message":"GET /api/cart 304 28.679 ms - {} - User: -","timestamp":"2025-07-13T14:46:44.372Z"}
{"level":"http","message":"GET /api/products/NB2 304 1.509 ms - {} - User: guest","timestamp":"2025-07-13T14:46:44.376Z"}
{"level":"http","message":"GET /api/cart 304 27.088 ms - {} - User: -","timestamp":"2025-07-13T14:46:44.405Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 50.778 ms - {} - User: guest","timestamp":"2025-07-13T14:46:44.445Z"}
{"level":"http","message":"GET /api/cart 304 31.991 ms - {} - User: -","timestamp":"2025-07-13T14:46:44.454Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 3.307 ms - {} - User: guest","timestamp":"2025-07-13T14:46:44.538Z"}
{"level":"http","message":"GET /api/cart 304 93.491 ms - {} - User: -","timestamp":"2025-07-13T14:46:44.550Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 82.061 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-696\",\"items\":[{\"productId\":\"NB2\",\"nameProduct\":\"Nhẫn nam Bạc đính đá PNJSilver XMXMW060196\",\"quantity\":1,\"sizeIndex\":1,\"unitPrice\":985500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-B2.1.png?alt=media&token=8f99e041-4f97-4ee1-9cc3-bd5f48146e08\"}],\"totalAmount\":1015500,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"a\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T14:46:55.373Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 883.218 ms - {\"orderId\":\"ORD-2025-696\",\"totalAmount\":1015500,\"items\":[{\"productId\":\"NB2\",\"nameProduct\":\"Nhn nam Bc nh  PNJSilver XMXMW060196\",\"quantity\":1,\"unitPrice\":985500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%252FTrang%2520s%E1%BB%A9c%252FNh%E1%BA%ABn%252FN-B2.1.png?alt=media&token=8f99e041-4f97-4ee1-9cc3-bd5f48146e08\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T14:46:56.266Z"}
{"header":"t=1752418022,v1=3c3546381cb47f10bdb39d0649c2fb85f6e22b8f55c61efb32bf324b3aa36257,v0=8a6020a5eef9dffc7bd7324235973b3d3f0871a5d289cd8b90e57cac6ecda24d","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752418022,"data":{"object":{"amount":1015500,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":1015500,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkRBBBopfvfSoZm3j7bNIlQ_secret_FNTut4SXaRtxMVQ62QT7nTJco","confirmation_method":"automatic","created":1752418021,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkRBBBopfvfSoZm3j7bNIlQ","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkRBBBopfvfSoZm3GSva9l4","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkRB8BopfvfSoZmh3N0hE7R","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkRBBBopfvfSoZm3X9aYe8y","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"cc9ba5b3-5b4c-4cf2-a579-180c6a6932a9"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T14:47:03.929Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T14:47:03.936Z"}
{"level":"http","message":"POST /api/payment/webhook 400 19.823 ms - {\"id\":\"evt_3RkRBBBopfvfSoZm3X9aYe8y\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752418022,\"data\":{\"object\":{\"id\":\"pi_3RkRBBBopfvfSoZm3j7bNIlQ\",\"object\":\"payment_intent\",\"amount\":1015500,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":1015500,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkRBBBopfvfSoZm3j7bNIlQ_secret_FNTut4SXaRtxMVQ62QT7nTJco\",\"confirmation_method\":\"automatic\",\"created\":1752418021,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkRBBBopfvfSoZm3GSva9l4\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkRB8BopfvfSoZmh3N0hE7R\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"cc9ba5b3-5b4c-4cf2-a579-180c6a6932a9\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T14:47:03.940Z"}
{"header":"t=1752418022,v1=3f00afc211c3e4b86b2fdc190dbe796d53af1cdd1b39ed0254f820b40b4a0824,v0=102b1aba7e314cd13fc0f66ea3d8f6716d9418a21a0263b8145c71168b8ea462","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752418022,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":1015500,"amount_total":1015500,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-696","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752418015,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752504415,"id":"cs_test_b1SxPniaIZeD7McSo35XUzo4iPmthZ3c2q5bRwDrZK4l5QM5lJUtqKAp82","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-696","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkRBBBopfvfSoZm3j7bNIlQ","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-696","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkRBCBopfvfSoZm3Be7PnHc","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T14:47:03.953Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T14:47:03.994Z"}
{"level":"http","message":"POST /api/payment/webhook 400 50.754 ms - {\"id\":\"evt_1RkRBCBopfvfSoZm3Be7PnHc\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752418022,\"data\":{\"object\":{\"id\":\"cs_test_b1SxPniaIZeD7McSo35XUzo4iPmthZ3c2q5bRwDrZK4l5QM5lJUtqKAp82\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":1015500,\"amount_total\":1015500,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-696\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"name\":\"Nguyen Dao\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752418015,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":null,\"state\":\"Hà Nội\"},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyen Dao\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752504415,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-2025-696\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkRBBBopfvfSoZm3j7bNIlQ\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-696\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T14:47:03.997Z"}
{"level":"http","message":"GET /api/products?limit=100 304 251.891 ms - {} - User: guest","timestamp":"2025-07-13T14:54:48.773Z"}
{"level":"http","message":"GET /api/cart 304 244.921 ms - {} - User: -","timestamp":"2025-07-13T14:54:48.777Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 246.272 ms - {} - User: guest","timestamp":"2025-07-13T14:54:48.789Z"}
{"level":"http","message":"GET /api/collections 304 253.775 ms - {} - User: guest","timestamp":"2025-07-13T14:54:48.810Z"}
{"level":"http","message":"GET /api/products?limit=100 304 2.845 ms - {} - User: guest","timestamp":"2025-07-13T14:54:48.819Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 4.250 ms - {} - User: guest","timestamp":"2025-07-13T14:54:48.896Z"}
{"level":"http","message":"GET /api/cart 304 75.971 ms - {} - User: -","timestamp":"2025-07-13T14:54:48.925Z"}
{"level":"http","message":"GET /api/collections 304 33.216 ms - {} - User: guest","timestamp":"2025-07-13T14:54:48.933Z"}
{"level":"http","message":"GET /api/cart 304 31.222 ms - {} - User: -","timestamp":"2025-07-13T14:54:48.987Z"}
{"level":"http","message":"GET /api/wishlist 304 53.388 ms - {} - User: -","timestamp":"2025-07-13T14:54:48.996Z"}
{"level":"http","message":"GET /api/cart 304 43.482 ms - {} - User: -","timestamp":"2025-07-13T14:54:49.042Z"}
{"level":"http","message":"GET /api/wishlist 304 41.927 ms - {} - User: -","timestamp":"2025-07-13T14:54:49.050Z"}
{"level":"http","message":"GET /api/cart 304 33.819 ms - {} - User: -","timestamp":"2025-07-13T14:54:49.090Z"}
{"level":"http","message":"GET /api/wishlist 304 54.329 ms - {} - User: -","timestamp":"2025-07-13T14:54:49.119Z"}
{"level":"http","message":"GET /api/cart 304 43.337 ms - {} - User: -","timestamp":"2025-07-13T14:54:49.142Z"}
{"level":"http","message":"GET /api/wishlist 304 32.718 ms - {} - User: -","timestamp":"2025-07-13T14:54:49.162Z"}
{"level":"http","message":"GET /api/wishlist 304 36.493 ms - {} - User: -","timestamp":"2025-07-13T14:54:49.203Z"}
{"level":"http","message":"GET /api/wishlist 304 49.489 ms - {} - User: -","timestamp":"2025-07-13T14:54:49.257Z"}
{"level":"http","message":"GET /api/cart 304 16.601 ms - {} - User: -","timestamp":"2025-07-13T14:55:18.556Z"}
{"level":"http","message":"GET /api/products?limit=1000 304 35.669 ms - {} - User: guest","timestamp":"2025-07-13T14:55:35.103Z"}
{"level":"http","message":"GET /api/cart 304 36.444 ms - {} - User: -","timestamp":"2025-07-13T14:55:38.281Z"}
{"level":"http","message":"GET /api/auth/profile 200 37.400 ms - {} - User: -","timestamp":"2025-07-13T14:55:38.291Z"}
{"level":"http","message":"GET /api/cart 304 26.826 ms - {} - User: -","timestamp":"2025-07-13T14:55:38.321Z"}
{"level":"http","message":"GET /api/auth/profile 304 20.091 ms - {} - User: -","timestamp":"2025-07-13T14:55:38.324Z"}
{"level":"http","message":"GET /api/cart 304 17.613 ms - {} - User: -","timestamp":"2025-07-13T14:55:38.344Z"}
{"level":"http","message":"GET /api/cart 304 17.646 ms - {} - User: -","timestamp":"2025-07-13T14:55:38.365Z"}
{"level":"http","message":"GET /api/products?limit=100 304 2.877 ms - {} - User: guest","timestamp":"2025-07-13T14:55:50.223Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 3.527 ms - {} - User: guest","timestamp":"2025-07-13T14:55:50.230Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.818 ms - {} - User: guest","timestamp":"2025-07-13T14:55:50.253Z"}
{"level":"http","message":"GET /api/products?limit=100 304 3.272 ms - {} - User: guest","timestamp":"2025-07-13T14:55:50.262Z"}
{"level":"http","message":"GET /api/collections 304 62.203 ms - {} - User: guest","timestamp":"2025-07-13T14:55:50.295Z"}
{"level":"http","message":"GET /api/cart 304 58.581 ms - {} - User: -","timestamp":"2025-07-13T14:55:50.302Z"}
{"level":"http","message":"GET /api/collections 304 39.944 ms - {} - User: guest","timestamp":"2025-07-13T14:55:50.350Z"}
{"level":"http","message":"GET /api/cart 304 37.182 ms - {} - User: -","timestamp":"2025-07-13T14:55:50.355Z"}
{"level":"http","message":"GET /api/cart 304 32.458 ms - {} - User: -","timestamp":"2025-07-13T14:55:50.403Z"}
{"level":"http","message":"GET /api/wishlist 304 52.120 ms - {} - User: -","timestamp":"2025-07-13T14:55:50.412Z"}
{"level":"http","message":"GET /api/cart 304 34.627 ms - {} - User: -","timestamp":"2025-07-13T14:55:50.449Z"}
{"level":"http","message":"GET /api/wishlist 304 34.505 ms - {} - User: -","timestamp":"2025-07-13T14:55:50.462Z"}
{"level":"http","message":"GET /api/wishlist 304 28.851 ms - {} - User: -","timestamp":"2025-07-13T14:55:50.494Z"}
{"level":"http","message":"GET /api/wishlist 304 27.015 ms - {} - User: -","timestamp":"2025-07-13T14:55:50.523Z"}
{"level":"http","message":"GET /api/wishlist 304 36.682 ms - {} - User: -","timestamp":"2025-07-13T14:55:50.562Z"}
{"level":"http","message":"GET /api/wishlist 304 23.934 ms - {} - User: -","timestamp":"2025-07-13T14:55:50.591Z"}
{"level":"http","message":"GET /api/cart 304 15.876 ms - {} - User: -","timestamp":"2025-07-13T14:56:20.642Z"}
{"level":"http","message":"GET /api/cart 304 19.583 ms - {} - User: -","timestamp":"2025-07-13T14:56:50.642Z"}
{"level":"http","message":"GET /api/cart 304 15.885 ms - {} - User: -","timestamp":"2025-07-13T14:57:20.639Z"}
{"level":"http","message":"GET /api/cart 304 21.179 ms - {} - User: -","timestamp":"2025-07-13T14:57:50.641Z"}
{"level":"http","message":"GET /api/cart 304 18.450 ms - {} - User: -","timestamp":"2025-07-13T14:58:20.646Z"}
{"level":"http","message":"GET /api/cart 304 19.385 ms - {} - User: -","timestamp":"2025-07-13T14:58:50.645Z"}
{"level":"http","message":"GET /api/cart 304 53.703 ms - {} - User: -","timestamp":"2025-07-13T14:59:20.169Z"}
{"level":"http","message":"GET /api/cart 304 39.883 ms - {} - User: -","timestamp":"2025-07-13T14:59:20.280Z"}
{"level":"http","message":"GET /api/cart 304 18.096 ms - {} - User: -","timestamp":"2025-07-13T14:59:50.641Z"}
{"level":"http","message":"GET /api/cart 304 17.534 ms - {} - User: -","timestamp":"2025-07-13T15:00:20.636Z"}
{"level":"http","message":"GET /api/cart 304 54.430 ms - {} - User: -","timestamp":"2025-07-13T15:00:37.429Z"}
{"level":"http","message":"GET /api/cart 304 20.908 ms - {} - User: -","timestamp":"2025-07-13T15:00:50.646Z"}
{"level":"http","message":"GET /api/cart 304 16.395 ms - {} - User: -","timestamp":"2025-07-13T15:01:20.633Z"}
{"level":"http","message":"GET /api/cart 304 11.121 ms - {} - User: -","timestamp":"2025-07-13T15:02:19.636Z"}
{"level":"http","message":"GET /api/cart 304 11.266 ms - {} - User: -","timestamp":"2025-07-13T15:03:19.630Z"}
{"level":"http","message":"GET /api/cart 304 13.204 ms - {} - User: -","timestamp":"2025-07-13T15:04:19.639Z"}
{"level":"http","message":"GET /api/cart 304 10.221 ms - {} - User: -","timestamp":"2025-07-13T15:05:19.634Z"}
{"level":"http","message":"GET /api/cart 304 11.239 ms - {} - User: -","timestamp":"2025-07-13T15:06:19.633Z"}
{"level":"http","message":"GET /api/cart 304 9.445 ms - {} - User: -","timestamp":"2025-07-13T15:07:19.624Z"}
{"level":"http","message":"GET /api/cart 304 10.126 ms - {} - User: -","timestamp":"2025-07-13T15:08:19.634Z"}
{"level":"http","message":"GET /api/cart 304 10.996 ms - {} - User: -","timestamp":"2025-07-13T15:09:19.626Z"}
{"level":"http","message":"GET /api/cart 304 11.128 ms - {} - User: -","timestamp":"2025-07-13T15:10:19.636Z"}
{"level":"http","message":"GET /api/cart 304 9.660 ms - {} - User: -","timestamp":"2025-07-13T15:11:19.634Z"}
{"level":"http","message":"GET /api/cart 304 12.365 ms - {} - User: -","timestamp":"2025-07-13T15:12:19.640Z"}
{"level":"http","message":"GET /api/cart 304 13.000 ms - {} - User: -","timestamp":"2025-07-13T15:13:19.640Z"}
{"level":"http","message":"GET /api/cart 304 11.025 ms - {} - User: -","timestamp":"2025-07-13T15:14:19.630Z"}
{"level":"http","message":"GET /api/cart 304 12.617 ms - {} - User: -","timestamp":"2025-07-13T15:15:19.630Z"}
{"level":"http","message":"GET /api/cart 304 9.175 ms - {} - User: -","timestamp":"2025-07-13T15:16:19.624Z"}
{"level":"http","message":"GET /api/cart 304 13.081 ms - {} - User: -","timestamp":"2025-07-13T15:17:19.642Z"}
{"level":"http","message":"GET /api/cart 304 12.844 ms - {} - User: -","timestamp":"2025-07-13T15:18:19.640Z"}
{"level":"http","message":"GET /api/cart 304 8.473 ms - {} - User: -","timestamp":"2025-07-13T15:19:19.627Z"}
{"level":"http","message":"GET /api/cart 304 9.839 ms - {} - User: -","timestamp":"2025-07-13T15:20:19.633Z"}
{"level":"http","message":"GET /api/cart 304 10.648 ms - {} - User: -","timestamp":"2025-07-13T15:21:19.637Z"}
{"level":"http","message":"GET /api/cart 304 12.329 ms - {} - User: -","timestamp":"2025-07-13T15:22:19.636Z"}
{"level":"http","message":"GET /api/cart 304 15.672 ms - {} - User: -","timestamp":"2025-07-13T15:23:19.636Z"}
{"level":"http","message":"GET /api/cart 304 10.367 ms - {} - User: -","timestamp":"2025-07-13T15:24:19.634Z"}
{"level":"http","message":"GET /api/cart 304 9.651 ms - {} - User: -","timestamp":"2025-07-13T15:25:19.626Z"}
{"level":"http","message":"GET /api/cart 304 7.330 ms - {} - User: -","timestamp":"2025-07-13T15:26:19.627Z"}
{"level":"http","message":"GET /api/cart 304 12.640 ms - {} - User: -","timestamp":"2025-07-13T15:27:19.627Z"}
{"level":"http","message":"GET /api/cart 304 11.284 ms - {} - User: -","timestamp":"2025-07-13T15:28:19.627Z"}
{"level":"http","message":"GET /api/cart 304 9.188 ms - {} - User: -","timestamp":"2025-07-13T15:29:19.625Z"}
{"level":"http","message":"GET /api/cart 304 11.668 ms - {} - User: -","timestamp":"2025-07-13T15:30:19.632Z"}
{"level":"http","message":"GET /api/cart 304 11.259 ms - {} - User: -","timestamp":"2025-07-13T15:31:19.638Z"}
{"level":"http","message":"GET /api/cart 304 8.339 ms - {} - User: -","timestamp":"2025-07-13T15:32:19.622Z"}
{"level":"http","message":"GET /api/cart 304 11.841 ms - {} - User: -","timestamp":"2025-07-13T15:33:19.626Z"}
{"level":"http","message":"GET /api/cart 304 12.976 ms - {} - User: -","timestamp":"2025-07-13T15:34:19.641Z"}
{"level":"http","message":"GET /api/cart 304 10.750 ms - {} - User: -","timestamp":"2025-07-13T15:35:19.630Z"}
{"level":"http","message":"GET /api/cart 304 10.293 ms - {} - User: -","timestamp":"2025-07-13T15:36:19.636Z"}
{"level":"http","message":"GET /api/cart 304 11.008 ms - {} - User: -","timestamp":"2025-07-13T15:37:19.626Z"}
{"header":"t=1752421078,v1=da8b7b2c9e288fa9e4018e839e2ca70fe161078de163babfafb24ffe20ade865,v0=c03eee2236da5ba74efcef7e3ccf09d34df4a6a1f9154198758d54c856ac098d","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752417532,"data":{"object":{"amount":19448760,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":19448760,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkR3HBopfvfSoZm11LW98Mu_secret_1PaDW8yBE4MP7lTXSO64wxYSn","confirmation_method":"automatic","created":1752417531,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkR3HBopfvfSoZm11LW98Mu","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkR3HBopfvfSoZm1lRA7oIU","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkR3EBopfvfSoZmNgHhtiI1","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkR3HBopfvfSoZm1awmmhXz","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"5f6f287c-7cf7-4712-bcf2-989847203f5c"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T15:37:59.284Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T15:37:59.287Z"}
{"level":"http","message":"POST /api/payment/webhook 400 7.346 ms - {\"id\":\"evt_3RkR3HBopfvfSoZm1awmmhXz\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752417532,\"data\":{\"object\":{\"id\":\"pi_3RkR3HBopfvfSoZm11LW98Mu\",\"object\":\"payment_intent\",\"amount\":19448760,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":19448760,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkR3HBopfvfSoZm11LW98Mu_secret_1PaDW8yBE4MP7lTXSO64wxYSn\",\"confirmation_method\":\"automatic\",\"created\":1752417531,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkR3HBopfvfSoZm1lRA7oIU\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkR3EBopfvfSoZmNgHhtiI1\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"5f6f287c-7cf7-4712-bcf2-989847203f5c\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T15:37:59.290Z"}
{"level":"http","message":"GET /api/cart 304 8.980 ms - {} - User: -","timestamp":"2025-07-13T15:38:19.635Z"}
{"level":"http","message":"GET /api/cart 304 11.711 ms - {} - User: -","timestamp":"2025-07-13T15:39:19.633Z"}
{"header":"t=1752421169,v1=061e684ef021560a06763faed0fe6f3c15d0b12c442fa0aa60daef1122b71bc9,v0=4e63aa34ea1ed23378421f886be3b78b11e0d4a36f158167bc63c8e1c241fbbc","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752417532,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":19448760,"amount_total":19448760,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-926","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752417524,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752503924,"id":"cs_test_b12HSD0ZaCHp9TL9zDFCDrdsshoPGh0o4rxeekPWbbCZBw6Pd48WSrOt2s","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-926","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkR3HBopfvfSoZm11LW98Mu","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-926","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkR3IBopfvfSoZmQ3ES406q","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T15:39:30.785Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T15:39:30.792Z"}
{"level":"http","message":"POST /api/payment/webhook 400 10.951 ms - {\"id\":\"evt_1RkR3IBopfvfSoZmQ3ES406q\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752417532,\"data\":{\"object\":{\"id\":\"cs_test_b12HSD0ZaCHp9TL9zDFCDrdsshoPGh0o4rxeekPWbbCZBw6Pd48WSrOt2s\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":19448760,\"amount_total\":19448760,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-926\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"name\":\"Nguyen Dao\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752417524,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":null,\"state\":\"Hà Nội\"},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyen Dao\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752503924,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-2025-926\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkR3HBopfvfSoZm11LW98Mu\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-926\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T15:39:30.794Z"}
{"level":"http","message":"GET /api/cart 304 8.570 ms - {} - User: -","timestamp":"2025-07-13T15:40:19.624Z"}
{"level":"http","message":"GET /api/cart 304 12.887 ms - {} - User: -","timestamp":"2025-07-13T15:41:19.635Z"}
{"level":"http","message":"GET /api/cart 304 13.440 ms - {} - User: -","timestamp":"2025-07-13T15:42:19.631Z"}
{"level":"http","message":"GET /api/cart 304 9.655 ms - {} - User: -","timestamp":"2025-07-13T15:43:19.632Z"}
{"header":"t=1752421454,v1=68445669358ccbd875daab29075b201b824be93c99560d2c575dc9f11e7272e7,v0=8a8e76a0c248b56ed59086dc8b406c67f2742420672148c3bc4272e614212ec9","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752417887,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":619500,"amount_total":619500,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-090","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752417880,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752504280,"id":"cs_test_b1KZf5on1picoiC7zFd6Bh7Olm7rYxFS8owFbcOOBuO9uffTwQQyh4fIi1","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-090","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkR90BopfvfSoZm1B0um8m3","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-090","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkR92BopfvfSoZmwUsXcXfL","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T15:44:15.021Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T15:44:15.027Z"}
{"level":"http","message":"POST /api/payment/webhook 400 11.072 ms - {\"id\":\"evt_1RkR92BopfvfSoZmwUsXcXfL\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752417887,\"data\":{\"object\":{\"id\":\"cs_test_b1KZf5on1picoiC7zFd6Bh7Olm7rYxFS8owFbcOOBuO9uffTwQQyh4fIi1\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":619500,\"amount_total\":619500,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-090\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"name\":\"Nguyen Dao\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752417880,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":null,\"state\":\"Hà Nội\"},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyen Dao\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752504280,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-2025-090\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkR90BopfvfSoZm1B0um8m3\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-090\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T15:44:15.029Z"}
{"level":"http","message":"GET /api/cart 304 8.661 ms - {} - User: -","timestamp":"2025-07-13T15:44:19.625Z"}
{"header":"t=1752421461,v1=684da4ea4511aa9e326264c96e4be72588a55aaee30dcde35c7c922a6d3dd135,v0=018d9925f0a0871ea9cc02ea57c48e03b0a55b7dd6813fca10ee754a901919e0","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752417887,"data":{"object":{"amount":619500,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":619500,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkR90BopfvfSoZm1B0um8m3_secret_IVuTGWHw6PrsgW1C0GdQnLxls","confirmation_method":"automatic","created":1752417886,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkR90BopfvfSoZm1B0um8m3","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkR90BopfvfSoZm1t2iW3IC","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkR8yBopfvfSoZmJBmfBfay","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkR90BopfvfSoZm1v5ua0E3","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"9ad04a45-f8c9-4672-8a16-5524b8f104ac"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T15:44:22.872Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T15:44:22.879Z"}
{"level":"http","message":"POST /api/payment/webhook 400 10.052 ms - {\"id\":\"evt_3RkR90BopfvfSoZm1v5ua0E3\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752417887,\"data\":{\"object\":{\"id\":\"pi_3RkR90BopfvfSoZm1B0um8m3\",\"object\":\"payment_intent\",\"amount\":619500,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":619500,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkR90BopfvfSoZm1B0um8m3_secret_IVuTGWHw6PrsgW1C0GdQnLxls\",\"confirmation_method\":\"automatic\",\"created\":1752417886,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkR90BopfvfSoZm1t2iW3IC\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkR8yBopfvfSoZmJBmfBfay\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"9ad04a45-f8c9-4672-8a16-5524b8f104ac\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T15:44:22.879Z"}
{"level":"http","message":"GET /api/cart 304 11.784 ms - {} - User: -","timestamp":"2025-07-13T15:45:19.634Z"}
{"level":"http","message":"GET /api/cart 304 12.976 ms - {} - User: -","timestamp":"2025-07-13T15:46:19.631Z"}
{"header":"t=1752421623,v1=8660fb7cbdac50031abb819c56a50e0acd59f5a2dc8f85cf55a2fc405fc9c67d,v0=ffec5116140aeb46a003a7df844fed616536db3fd5378e3ee93b71930194bfc4","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752418022,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":1015500,"amount_total":1015500,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-696","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752418015,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752504415,"id":"cs_test_b1SxPniaIZeD7McSo35XUzo4iPmthZ3c2q5bRwDrZK4l5QM5lJUtqKAp82","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-696","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkRBBBopfvfSoZm3j7bNIlQ","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-696","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkRBCBopfvfSoZm3Be7PnHc","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T15:47:03.977Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T15:47:03.986Z"}
{"level":"http","message":"POST /api/payment/webhook 400 14.136 ms - {\"id\":\"evt_1RkRBCBopfvfSoZm3Be7PnHc\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752418022,\"data\":{\"object\":{\"id\":\"cs_test_b1SxPniaIZeD7McSo35XUzo4iPmthZ3c2q5bRwDrZK4l5QM5lJUtqKAp82\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":1015500,\"amount_total\":1015500,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-696\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"name\":\"Nguyen Dao\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752418015,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":null,\"state\":\"Hà Nội\"},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyen Dao\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752504415,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-2025-696\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkRBBBopfvfSoZm3j7bNIlQ\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-696\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T15:47:03.989Z"}
{"level":"http","message":"GET /api/cart 304 10.103 ms - {} - User: -","timestamp":"2025-07-13T15:47:19.632Z"}
{"header":"t=1752421692,v1=c3e662cfb43ac287f0a813744013dc3c58148a698ea3ed986d173e3bfe7b2866,v0=3fdc931835644e40e8a3cb38fd8bf694610532db1c340f76f9e9d84ae5ccb2d2","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752418022,"data":{"object":{"amount":1015500,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":1015500,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkRBBBopfvfSoZm3j7bNIlQ_secret_FNTut4SXaRtxMVQ62QT7nTJco","confirmation_method":"automatic","created":1752418021,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkRBBBopfvfSoZm3j7bNIlQ","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkRBBBopfvfSoZm3GSva9l4","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkRB8BopfvfSoZmh3N0hE7R","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkRBBBopfvfSoZm3X9aYe8y","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"cc9ba5b3-5b4c-4cf2-a579-180c6a6932a9"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T15:48:13.603Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T15:48:13.605Z"}
{"level":"http","message":"POST /api/payment/webhook 400 5.381 ms - {\"id\":\"evt_3RkRBBBopfvfSoZm3X9aYe8y\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752418022,\"data\":{\"object\":{\"id\":\"pi_3RkRBBBopfvfSoZm3j7bNIlQ\",\"object\":\"payment_intent\",\"amount\":1015500,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":1015500,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkRBBBopfvfSoZm3j7bNIlQ_secret_FNTut4SXaRtxMVQ62QT7nTJco\",\"confirmation_method\":\"automatic\",\"created\":1752418021,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkRBBBopfvfSoZm3GSva9l4\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkRB8BopfvfSoZmh3N0hE7R\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"cc9ba5b3-5b4c-4cf2-a579-180c6a6932a9\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T15:48:13.606Z"}
{"level":"http","message":"GET /api/cart 304 7.719 ms - {} - User: -","timestamp":"2025-07-13T15:48:19.625Z"}
{"level":"http","message":"GET /api/cart 304 5.357 ms - {} - User: -","timestamp":"2025-07-13T15:49:19.617Z"}
{"level":"http","message":"GET /api/cart 304 8.959 ms - {} - User: -","timestamp":"2025-07-13T15:50:19.637Z"}
{"level":"http","message":"GET /api/cart 304 7.756 ms - {} - User: -","timestamp":"2025-07-13T15:51:19.630Z"}
{"level":"http","message":"GET /api/cart 304 7.660 ms - {} - User: -","timestamp":"2025-07-13T15:52:19.627Z"}
{"level":"http","message":"GET /api/cart 304 10.013 ms - {} - User: -","timestamp":"2025-07-13T15:53:19.629Z"}
{"level":"http","message":"GET /api/cart 304 11.183 ms - {} - User: -","timestamp":"2025-07-13T15:54:19.637Z"}
{"level":"http","message":"GET /api/cart 304 8.607 ms - {} - User: -","timestamp":"2025-07-13T15:55:19.632Z"}
{"level":"http","message":"GET /api/cart 304 10.089 ms - {} - User: -","timestamp":"2025-07-13T15:56:19.626Z"}
{"level":"http","message":"GET /api/cart 304 10.171 ms - {} - User: -","timestamp":"2025-07-13T15:57:19.632Z"}
{"level":"http","message":"GET /api/cart 304 10.593 ms - {} - User: -","timestamp":"2025-07-13T15:58:19.635Z"}
{"level":"http","message":"GET /api/cart 304 12.475 ms - {} - User: -","timestamp":"2025-07-13T15:59:19.629Z"}
{"level":"http","message":"GET /api/cart 304 7.574 ms - {} - User: -","timestamp":"2025-07-13T16:00:19.626Z"}
{"level":"http","message":"GET /api/cart 304 11.073 ms - {} - User: -","timestamp":"2025-07-13T16:01:19.628Z"}
{"level":"http","message":"GET /api/cart 304 10.657 ms - {} - User: -","timestamp":"2025-07-13T16:02:19.632Z"}
{"level":"http","message":"GET /api/cart 304 12.274 ms - {} - User: -","timestamp":"2025-07-13T16:03:19.640Z"}
{"level":"http","message":"GET /api/cart 304 13.646 ms - {} - User: -","timestamp":"2025-07-13T16:04:19.636Z"}
{"level":"http","message":"GET /api/cart 304 8.914 ms - {} - User: -","timestamp":"2025-07-13T16:05:19.630Z"}
{"level":"http","message":"GET /api/cart 304 9.623 ms - {} - User: -","timestamp":"2025-07-13T16:06:19.633Z"}
{"level":"http","message":"GET /api/cart 304 20.194 ms - {} - User: -","timestamp":"2025-07-13T16:07:19.650Z"}
{"level":"http","message":"GET /api/cart 304 14.337 ms - {} - User: -","timestamp":"2025-07-13T16:08:19.628Z"}
{"level":"http","message":"GET /api/cart 304 11.312 ms - {} - User: -","timestamp":"2025-07-13T16:09:19.639Z"}
{"level":"http","message":"GET /api/cart 304 11.630 ms - {} - User: -","timestamp":"2025-07-13T16:10:19.629Z"}
{"level":"http","message":"GET /api/cart 304 15.197 ms - {} - User: -","timestamp":"2025-07-13T16:11:19.631Z"}
{"level":"http","message":"GET /api/cart 304 16.947 ms - {} - User: -","timestamp":"2025-07-13T16:12:19.695Z"}
{"level":"http","message":"GET /api/cart 304 9.700 ms - {} - User: -","timestamp":"2025-07-13T16:13:19.633Z"}
{"level":"http","message":"GET /api/cart 304 10.731 ms - {} - User: -","timestamp":"2025-07-13T16:14:19.632Z"}
{"level":"http","message":"GET /api/cart 304 14.671 ms - {} - User: -","timestamp":"2025-07-13T16:15:19.633Z"}
{"level":"http","message":"GET /api/cart 304 14.428 ms - {} - User: -","timestamp":"2025-07-13T16:16:19.635Z"}
{"level":"http","message":"GET /api/cart 304 13.924 ms - {} - User: -","timestamp":"2025-07-13T16:17:19.638Z"}
{"level":"http","message":"GET /api/cart 304 10.013 ms - {} - User: -","timestamp":"2025-07-13T16:18:19.625Z"}
{"level":"info","message":"🛑 SIGINT received, shutting down gracefully","timestamp":"2025-07-13T16:19:15.317Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T16:24:12.771Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T16:24:12.774Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T16:24:12.775Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T16:24:12.775Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T16:24:12.961Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T16:24:12.964Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T16:24:13.135Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T16:24:13.142Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T16:24:13.142Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T16:24:13.143Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T16:24:13.143Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T16:24:13.144Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T16:24:13.144Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T16:24:13.144Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T16:24:13.144Z"}
{"level":"http","message":"GET /api/cart 304 23.065 ms - {} - User: -","timestamp":"2025-07-13T16:24:19.642Z"}
{"level":"http","message":"GET /api/cart 304 11.182 ms - {} - User: -","timestamp":"2025-07-13T16:25:19.636Z"}
{"level":"http","message":"GET /api/cart 304 14.941 ms - {} - User: -","timestamp":"2025-07-13T16:26:19.646Z"}
{"level":"http","message":"GET /api/products?limit=100 304 54.297 ms - {} - User: guest","timestamp":"2025-07-13T16:26:46.303Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 55.286 ms - {} - User: guest","timestamp":"2025-07-13T16:26:46.310Z"}
{"level":"http","message":"GET /api/collections 304 52.978 ms - {} - User: guest","timestamp":"2025-07-13T16:26:46.313Z"}
{"level":"http","message":"GET /api/cart 304 50.898 ms - {} - User: -","timestamp":"2025-07-13T16:26:46.315Z"}
{"level":"http","message":"GET /api/products?limit=100 304 2.385 ms - {} - User: guest","timestamp":"2025-07-13T16:26:46.322Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.537 ms - {} - User: guest","timestamp":"2025-07-13T16:26:46.326Z"}
{"level":"http","message":"GET /api/collections 304 13.811 ms - {} - User: guest","timestamp":"2025-07-13T16:26:46.341Z"}
{"level":"http","message":"GET /api/cart 304 14.493 ms - {} - User: -","timestamp":"2025-07-13T16:26:46.345Z"}
{"level":"http","message":"GET /api/cart 304 8.828 ms - {} - User: -","timestamp":"2025-07-13T16:26:46.355Z"}
{"level":"http","message":"GET /api/cart 304 11.671 ms - {} - User: -","timestamp":"2025-07-13T16:26:46.373Z"}
{"level":"http","message":"GET /api/wishlist 304 16.465 ms - {} - User: -","timestamp":"2025-07-13T16:26:46.427Z"}
{"level":"http","message":"GET /api/wishlist 304 11.010 ms - {} - User: -","timestamp":"2025-07-13T16:26:46.441Z"}
{"level":"http","message":"GET /api/wishlist 304 14.189 ms - {} - User: -","timestamp":"2025-07-13T16:26:46.457Z"}
{"level":"http","message":"GET /api/wishlist 304 16.020 ms - {} - User: -","timestamp":"2025-07-13T16:26:46.475Z"}
{"level":"http","message":"GET /api/wishlist 304 18.538 ms - {} - User: -","timestamp":"2025-07-13T16:26:46.496Z"}
{"level":"http","message":"GET /api/wishlist 304 15.275 ms - {} - User: -","timestamp":"2025-07-13T16:26:46.512Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 8.655 ms - {} - User: guest","timestamp":"2025-07-13T16:27:05.628Z"}
{"level":"http","message":"GET /api/products/NC10VNA1 304 1.212 ms - {} - User: guest","timestamp":"2025-07-13T16:27:05.635Z"}
{"level":"http","message":"GET /api/cart 304 14.522 ms - {} - User: -","timestamp":"2025-07-13T16:27:05.638Z"}
{"level":"http","message":"GET /api/cart 304 21.671 ms - {} - User: -","timestamp":"2025-07-13T16:27:05.662Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 20.100 ms - {} - User: guest","timestamp":"2025-07-13T16:27:05.665Z"}
{"level":"http","message":"GET /api/cart 304 7.056 ms - {} - User: -","timestamp":"2025-07-13T16:27:05.673Z"}
{"level":"http","message":"GET /api/cart 304 9.349 ms - {} - User: -","timestamp":"2025-07-13T16:27:05.685Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C%20C%C6%AF%E1%BB%9AI&limit=20 304 1.395 ms - {} - User: guest","timestamp":"2025-07-13T16:27:05.726Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 28.189 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-170\",\"items\":[{\"productId\":\"NC10VNA1\",\"nameProduct\":\"Nhẫn Kim cương Vàng 10K PNJ DDDDY000790\",\"quantity\":1,\"sizeIndex\":2,\"unitPrice\":19418760,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FnewImage%2FNC-10VNA1.png?alt=media&token=46037aba-0dbf-4314-85d7-046276eab5f6\"}],\"totalAmount\":19448760,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"a\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T16:27:17.993Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 862.705 ms - {\"orderId\":\"ORD-2025-170\",\"totalAmount\":19448760,\"items\":[{\"productId\":\"NC10VNA1\",\"nameProduct\":\"Nhn Kim cng Vng 10K PNJ DDDDY000790\",\"quantity\":1,\"unitPrice\":19418760,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%252FnewImage%252FNC-10VNA1.png?alt=media&token=46037aba-0dbf-4314-85d7-046276eab5f6\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T16:27:18.863Z"}
{"header":"t=1752424098,v1=e91313fd42b5b4885bb4b9ffc7097fbbae504a920d132572a2cd969eca45e5a6,v0=1923b26b3cce355db48d14cae85cd8d7f21005591e7e7d6065fe183f3f30de57","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752424097,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":19448760,"amount_total":19448760,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-170","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752424038,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752510438,"id":"cs_test_b1b9MWEuWfrGd11sFLzb56BquplvI1YT73kBdDL2vccoBS6Phhaz3Qvcs5","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-170","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkSlABopfvfSoZm2vRYeChJ","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-170","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkSlBBopfvfSoZmAh534wy0","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T16:28:18.761Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T16:28:18.763Z"}
{"level":"http","message":"POST /api/payment/webhook 400 5.741 ms - {\"id\":\"evt_1RkSlBBopfvfSoZmAh534wy0\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752424097,\"data\":{\"object\":{\"id\":\"cs_test_b1b9MWEuWfrGd11sFLzb56BquplvI1YT73kBdDL2vccoBS6Phhaz3Qvcs5\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":19448760,\"amount_total\":19448760,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-170\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"name\":\"Nguyen Dao\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752424038,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":null,\"state\":\"Hà Nội\"},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyen Dao\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752510438,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-2025-170\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkSlABopfvfSoZm2vRYeChJ\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-170\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T16:28:18.764Z"}
{"header":"t=1752424098,v1=f227baadce928a731eff3e0b0ee3fb6928a8eb0bcbae7f16b3000b2a7b58f362,v0=541569d40f9517dcfb7409b5033de5804222ce60d76498520a9db6268735d2a9","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752424097,"data":{"object":{"amount":19448760,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":19448760,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkSlABopfvfSoZm2vRYeChJ_secret_7GYoRCEZqJHZnniEaP7HTUlmF","confirmation_method":"automatic","created":1752424096,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkSlABopfvfSoZm2vRYeChJ","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkSlABopfvfSoZm2oKN4JKH","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkSlABopfvfSoZmDhZYUTF7","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkSlABopfvfSoZm2gMD9bfo","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"6fd3b15e-7328-4e81-b87b-dbdf15ae4ac5"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T16:28:18.867Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T16:28:18.868Z"}
{"level":"http","message":"POST /api/payment/webhook 400 3.705 ms - {\"id\":\"evt_3RkSlABopfvfSoZm2gMD9bfo\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752424097,\"data\":{\"object\":{\"id\":\"pi_3RkSlABopfvfSoZm2vRYeChJ\",\"object\":\"payment_intent\",\"amount\":19448760,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":19448760,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkSlABopfvfSoZm2vRYeChJ_secret_7GYoRCEZqJHZnniEaP7HTUlmF\",\"confirmation_method\":\"automatic\",\"created\":1752424096,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkSlABopfvfSoZm2oKN4JKH\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkSlABopfvfSoZmDhZYUTF7\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"6fd3b15e-7328-4e81-b87b-dbdf15ae4ac5\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T16:28:18.869Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T16:31:46.987Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T16:31:46.990Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T16:31:46.990Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T16:31:46.991Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T16:31:47.256Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T16:31:47.261Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T16:31:47.347Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T16:31:47.349Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T16:31:47.350Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T16:31:47.350Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T16:31:47.350Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T16:31:47.351Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T16:31:47.351Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T16:31:47.351Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T16:31:47.351Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T16:32:30.537Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T16:32:30.540Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T16:32:30.541Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T16:32:30.542Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T16:32:30.798Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T16:32:30.802Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T16:32:30.885Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T16:32:30.890Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T16:32:30.891Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T16:32:30.891Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T16:32:30.892Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T16:32:30.892Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T16:32:30.892Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T16:32:30.892Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T16:32:30.892Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T16:32:52.581Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T16:32:52.584Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T16:32:52.585Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T16:32:52.585Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T16:32:52.874Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T16:32:52.878Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T16:32:52.971Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T16:32:52.973Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T16:32:52.974Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T16:32:52.974Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T16:32:52.974Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T16:32:52.974Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T16:32:52.975Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T16:32:52.975Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T16:32:52.975Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T16:32:57.552Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T16:32:57.555Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T16:32:57.555Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T16:32:57.556Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T16:32:57.809Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T16:32:57.814Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T16:32:57.895Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T16:32:57.899Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T16:32:57.900Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T16:32:57.901Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T16:32:57.901Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T16:32:57.901Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T16:32:57.901Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T16:32:57.901Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T16:32:57.902Z"}
{"level":"http","message":"GET /api/cart 304 67.486 ms - {} - User: -","timestamp":"2025-07-13T16:33:00.661Z"}
{"level":"http","message":"GET /api/products?limit=100 304 58.173 ms - {} - User: guest","timestamp":"2025-07-13T16:33:00.666Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 55.325 ms - {} - User: guest","timestamp":"2025-07-13T16:33:00.670Z"}
{"level":"http","message":"GET /api/collections 304 53.796 ms - {} - User: guest","timestamp":"2025-07-13T16:33:00.674Z"}
{"level":"http","message":"GET /api/products?limit=100 304 0.900 ms - {} - User: guest","timestamp":"2025-07-13T16:33:00.681Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.353 ms - {} - User: guest","timestamp":"2025-07-13T16:33:00.685Z"}
{"level":"http","message":"GET /api/cart 304 19.164 ms - {} - User: -","timestamp":"2025-07-13T16:33:00.695Z"}
{"level":"http","message":"GET /api/collections 304 11.624 ms - {} - User: guest","timestamp":"2025-07-13T16:33:00.698Z"}
{"level":"http","message":"GET /api/cart 304 7.726 ms - {} - User: -","timestamp":"2025-07-13T16:33:00.707Z"}
{"level":"http","message":"GET /api/cart 304 8.296 ms - {} - User: -","timestamp":"2025-07-13T16:33:00.717Z"}
{"level":"http","message":"GET /api/wishlist 304 14.505 ms - {} - User: -","timestamp":"2025-07-13T16:33:00.752Z"}
{"level":"http","message":"GET /api/wishlist 304 10.874 ms - {} - User: -","timestamp":"2025-07-13T16:33:00.764Z"}
{"level":"http","message":"GET /api/wishlist 304 10.756 ms - {} - User: -","timestamp":"2025-07-13T16:33:00.778Z"}
{"level":"http","message":"GET /api/wishlist 304 11.832 ms - {} - User: -","timestamp":"2025-07-13T16:33:00.791Z"}
{"level":"http","message":"GET /api/wishlist 304 9.659 ms - {} - User: -","timestamp":"2025-07-13T16:33:00.802Z"}
{"level":"http","message":"GET /api/wishlist 304 8.077 ms - {} - User: -","timestamp":"2025-07-13T16:33:00.811Z"}
{"level":"http","message":"GET /api/cart 304 7.979 ms - {} - User: -","timestamp":"2025-07-13T16:33:00.937Z"}
{"level":"http","message":"GET /api/cart 304 13.120 ms - {} - User: -","timestamp":"2025-07-13T16:33:00.952Z"}
{"level":"http","message":"GET /api/products/NB2 304 4.218 ms - {} - User: guest","timestamp":"2025-07-13T16:33:03.572Z"}
{"level":"http","message":"GET /api/cart 304 9.012 ms - {} - User: -","timestamp":"2025-07-13T16:33:03.574Z"}
{"level":"http","message":"GET /api/products/NB2 304 0.965 ms - {} - User: guest","timestamp":"2025-07-13T16:33:03.577Z"}
{"level":"http","message":"GET /api/cart 304 6.525 ms - {} - User: -","timestamp":"2025-07-13T16:33:03.584Z"}
{"level":"http","message":"GET /api/cart 304 15.822 ms - {} - User: -","timestamp":"2025-07-13T16:33:03.602Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 15.223 ms - {} - User: guest","timestamp":"2025-07-13T16:33:03.606Z"}
{"level":"http","message":"GET /api/cart 304 8.012 ms - {} - User: -","timestamp":"2025-07-13T16:33:03.616Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 1.282 ms - {} - User: guest","timestamp":"2025-07-13T16:33:03.669Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 34.429 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-960\",\"items\":[{\"productId\":\"NB2\",\"nameProduct\":\"Nhẫn nam Bạc đính đá PNJSilver XMXMW060196\",\"quantity\":1,\"sizeIndex\":1,\"unitPrice\":985500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-B2.1.png?alt=media&token=8f99e041-4f97-4ee1-9cc3-bd5f48146e08\"}],\"totalAmount\":1015500,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"a\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T16:33:11.687Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 738.050 ms - {\"orderId\":\"ORD-2025-960\",\"totalAmount\":1015500,\"items\":[{\"productId\":\"NB2\",\"nameProduct\":\"Nhn nam Bc nh  PNJSilver XMXMW060196\",\"quantity\":1,\"unitPrice\":985500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%252FTrang%2520s%E1%BB%A9c%252FNh%E1%BA%ABn%252FN-B2.1.png?alt=media&token=8f99e041-4f97-4ee1-9cc3-bd5f48146e08\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T16:33:12.435Z"}
{"header":"t=1752424398,v1=ff5c927f3858b1c2c739e5320e7d384a473a36ba07d1338c4cee5f193af2e074,v0=60a9727cafddc1a60a7c7b5134c682ea79a72430b105c4a55c1d006e2f1187e6","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752424398,"data":{"object":{"amount":1015500,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":1015500,"application":null,"application_fee_amount":null,"automatic_payment_methods":null,"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic_async","client_secret":"pi_3RkSq1BopfvfSoZm2BxP1HUj_secret_NH8g2yDh3QoZ29AbVD1BlPNtO","confirmation_method":"automatic","created":1752424397,"currency":"vnd","customer":null,"description":null,"id":"pi_3RkSq1BopfvfSoZm2BxP1HUj","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RkSq1BopfvfSoZm28zLuL7s","livemode":false,"metadata":{},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RkSpzBopfvfSoZm5XYNpqQs","payment_method_configuration_details":null,"payment_method_options":{"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null}},"id":"evt_3RkSq1BopfvfSoZm2QZbVASq","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":"0ec2cca1-3919-4425-8c68-17e19ed0d301"},"type":"payment_intent.succeeded"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T16:33:19.387Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T16:33:19.389Z"}
{"level":"http","message":"POST /api/payment/webhook 400 6.024 ms - {\"id\":\"evt_3RkSq1BopfvfSoZm2QZbVASq\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752424398,\"data\":{\"object\":{\"id\":\"pi_3RkSq1BopfvfSoZm2BxP1HUj\",\"object\":\"payment_intent\",\"amount\":1015500,\"amount_capturable\":0,\"amount_details\":{\"tip\":{}},\"amount_received\":1015500,\"application\":null,\"application_fee_amount\":null,\"automatic_payment_methods\":null,\"canceled_at\":null,\"cancellation_reason\":null,\"capture_method\":\"automatic_async\",\"client_secret\":\"pi_3RkSq1BopfvfSoZm2BxP1HUj_secret_NH8g2yDh3QoZ29AbVD1BlPNtO\",\"confirmation_method\":\"automatic\",\"created\":1752424397,\"currency\":\"vnd\",\"customer\":null,\"description\":null,\"invoice\":null,\"last_payment_error\":null,\"latest_charge\":\"ch_3RkSq1BopfvfSoZm28zLuL7s\",\"livemode\":false,\"metadata\":{},\"next_action\":null,\"on_behalf_of\":null,\"payment_method\":\"pm_1RkSpzBopfvfSoZm5XYNpqQs\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"installments\":null,\"mandate_options\":null,\"network\":null,\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"processing\":null,\"receipt_email\":null,\"review\":null,\"setup_future_usage\":null,\"shipping\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"source\":null,\"statement_descriptor\":null,\"statement_descriptor_suffix\":null,\"status\":\"succeeded\",\"transfer_data\":null,\"transfer_group\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":\"0ec2cca1-3919-4425-8c68-17e19ed0d301\"},\"type\":\"payment_intent.succeeded\"} - User: guest","timestamp":"2025-07-13T16:33:19.391Z"}
{"header":"t=1752424398,v1=643b3779f1782eb0ff59a70802d8214a6eb1b1f58c6925ebe3ee505747ebbe29,v0=c3dfc91529f898bad6432848c658930204acb09f85f0980182a1abb362f19a61","level":"error","message":"Webhook signature validation failed: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n","payload":{"api_version":"2024-10-28.acacia","created":1752424398,"data":{"object":{"adaptive_pricing":{"enabled":true},"after_expiration":null,"allow_promotion_codes":null,"amount_subtotal":1015500,"amount_total":1015500,"automatic_tax":{"enabled":false,"liability":null,"provider":null,"status":null},"billing_address_collection":"required","cancel_url":"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-960","client_reference_id":null,"client_secret":null,"collected_information":{"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"name":"Nguyen Dao"}},"consent":null,"consent_collection":null,"created":1752424391,"currency":"vnd","currency_conversion":null,"custom_fields":[],"custom_text":{"after_submit":null,"shipping_address":null,"submit":null,"terms_of_service_acceptance":null},"customer":null,"customer_creation":"if_required","customer_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":null,"state":"Hà Nội"},"email":"nguyendao21012002@gmail.com","name":"Nguyen Dao","phone":null,"tax_exempt":"none","tax_ids":[]},"customer_email":"nguyendao21012002@gmail.com","discounts":[],"expires_at":1752510791,"id":"cs_test_b1HzNivQoI697VaSukOQ2EDsMVmI9EhxJJc9OgNpeFIc0fcjU3Y47Cx3OQ","invoice":null,"invoice_creation":{"enabled":false,"invoice_data":{"account_tax_ids":null,"custom_fields":null,"description":null,"footer":null,"issuer":null,"metadata":{},"rendering_options":null}},"livemode":false,"locale":null,"metadata":{"orderId":"ORD-2025-960","userId":"6870c70c1ca5164be10bb91d"},"mode":"payment","object":"checkout.session","origin_context":null,"payment_intent":"pi_3RkSq1BopfvfSoZm2BxP1HUj","payment_link":null,"payment_method_collection":"if_required","payment_method_configuration_details":null,"payment_method_options":{"card":{"request_three_d_secure":"automatic"}},"payment_method_types":["card"],"payment_status":"paid","permissions":null,"phone_number_collection":{"enabled":false},"recovered_from":null,"saved_payment_method_options":null,"setup_intent":null,"shipping_address_collection":{"allowed_countries":["VN"]},"shipping_cost":null,"shipping_details":{"address":{"city":"111","country":"VN","line1":"111","line2":null,"postal_code":"","state":"Hà Nội"},"carrier":null,"name":"Nguyen Dao","phone":null,"tracking_number":null},"shipping_options":[],"status":"complete","submit_type":null,"subscription":null,"success_url":"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-960","total_details":{"amount_discount":0,"amount_shipping":0,"amount_tax":0},"ui_mode":"hosted","url":null,"wallet_options":null}},"id":"evt_1RkSq2BopfvfSoZmmmnU9Xv8","livemode":false,"object":"event","pending_webhooks":1,"request":{"id":null,"idempotency_key":null},"type":"checkout.session.completed"},"raw":{"message":"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n"},"stack":"Error: Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature\n\n    at validateComputedSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:138:23)\n    at Object.verifyHeader (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:70:13)\n    at Object.constructEvent (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\stripe\\cjs\\Webhooks.js:15:32)\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:220:43)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)","timestamp":"2025-07-13T16:33:19.435Z","type":"StripeSignatureVerificationError"}
{"level":"error","message":"Webhook handler error: Invalid webhook signature","stack":"Error: Invalid webhook signature\n    at StripeService.validateWebhookSignature (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\stripe.service.js:228:19)\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:482:41)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at rawParser (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\types\\raw.js:58:7)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\index.js:284:15","timestamp":"2025-07-13T16:33:19.437Z"}
{"level":"http","message":"POST /api/payment/webhook 400 6.062 ms - {\"id\":\"evt_1RkSq2BopfvfSoZmmmnU9Xv8\",\"object\":\"event\",\"api_version\":\"2024-10-28.acacia\",\"created\":1752424398,\"data\":{\"object\":{\"id\":\"cs_test_b1HzNivQoI697VaSukOQ2EDsMVmI9EhxJJc9OgNpeFIc0fcjU3Y47Cx3OQ\",\"object\":\"checkout.session\",\"adaptive_pricing\":{\"enabled\":true},\"after_expiration\":null,\"allow_promotion_codes\":null,\"amount_subtotal\":1015500,\"amount_total\":1015500,\"automatic_tax\":{\"enabled\":false,\"liability\":null,\"provider\":null,\"status\":null},\"billing_address_collection\":\"required\",\"cancel_url\":\"http://localhost:3000/payment/result?status=canceled?order_id=ORD-2025-960\",\"client_reference_id\":null,\"client_secret\":null,\"collected_information\":{\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"name\":\"Nguyen Dao\"}},\"consent\":null,\"consent_collection\":null,\"created\":1752424391,\"currency\":\"vnd\",\"currency_conversion\":null,\"custom_fields\":[],\"custom_text\":{\"after_submit\":null,\"shipping_address\":null,\"submit\":null,\"terms_of_service_acceptance\":null},\"customer\":null,\"customer_creation\":\"if_required\",\"customer_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":null,\"state\":\"Hà Nội\"},\"email\":\"nguyendao21012002@gmail.com\",\"name\":\"Nguyen Dao\",\"phone\":null,\"tax_exempt\":\"none\",\"tax_ids\":[]},\"customer_email\":\"nguyendao21012002@gmail.com\",\"discounts\":[],\"expires_at\":1752510791,\"invoice\":null,\"invoice_creation\":{\"enabled\":false,\"invoice_data\":{\"account_tax_ids\":null,\"custom_fields\":null,\"description\":null,\"footer\":null,\"issuer\":null,\"metadata\":{},\"rendering_options\":null}},\"livemode\":false,\"locale\":null,\"metadata\":{\"orderId\":\"ORD-2025-960\",\"userId\":\"6870c70c1ca5164be10bb91d\"},\"mode\":\"payment\",\"origin_context\":null,\"payment_intent\":\"pi_3RkSq1BopfvfSoZm2BxP1HUj\",\"payment_link\":null,\"payment_method_collection\":\"if_required\",\"payment_method_configuration_details\":null,\"payment_method_options\":{\"card\":{\"request_three_d_secure\":\"automatic\"}},\"payment_method_types\":[\"card\"],\"payment_status\":\"paid\",\"permissions\":null,\"phone_number_collection\":{\"enabled\":false},\"recovered_from\":null,\"saved_payment_method_options\":null,\"setup_intent\":null,\"shipping_address_collection\":{\"allowed_countries\":[\"VN\"]},\"shipping_cost\":null,\"shipping_details\":{\"address\":{\"city\":\"111\",\"country\":\"VN\",\"line1\":\"111\",\"line2\":null,\"postal_code\":\"\",\"state\":\"Hà Nội\"},\"carrier\":null,\"name\":\"Nguyen Dao\",\"phone\":null,\"tracking_number\":null},\"shipping_options\":[],\"status\":\"complete\",\"submit_type\":null,\"subscription\":null,\"success_url\":\"http://localhost:3000/payment/result?session_id={CHECKOUT_SESSION_ID}&status=success?session_id={CHECKOUT_SESSION_ID}&order_id=ORD-2025-960\",\"total_details\":{\"amount_discount\":0,\"amount_shipping\":0,\"amount_tax\":0},\"ui_mode\":\"hosted\",\"url\":null,\"wallet_options\":null}},\"livemode\":false,\"pending_webhooks\":1,\"request\":{\"id\":null,\"idempotency_key\":null},\"type\":\"checkout.session.completed\"} - User: guest","timestamp":"2025-07-13T16:33:19.440Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T16:38:05.752Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T16:38:05.761Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T16:38:05.762Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T16:38:05.763Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T16:38:05.914Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T16:38:05.919Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T16:38:06.007Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T16:38:06.009Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T16:38:06.009Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T16:38:06.010Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T16:38:06.010Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T16:38:06.010Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T16:38:06.010Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T16:38:06.010Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T16:38:06.010Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T16:38:22.454Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T16:38:22.458Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T16:38:22.458Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T16:38:22.460Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T16:38:22.633Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T16:38:22.637Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T16:38:22.722Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T16:38:22.725Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T16:38:22.726Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T16:38:22.726Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T16:38:22.727Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T16:38:22.727Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T16:38:22.727Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T16:38:22.727Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T16:38:22.727Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T16:38:31.060Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T16:38:31.063Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T16:38:31.064Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T16:38:31.065Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T16:38:31.225Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T16:38:31.230Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T16:38:31.320Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T16:38:31.322Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T16:38:31.324Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T16:38:31.324Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T16:38:31.325Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T16:38:31.325Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T16:38:31.325Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T16:38:31.325Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T16:38:31.325Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T16:38:38.860Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T16:38:38.864Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T16:38:38.864Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T16:38:38.865Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T16:38:39.018Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T16:38:39.022Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T16:38:39.105Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T16:38:39.108Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T16:38:39.109Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T16:38:39.110Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T16:38:39.110Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T16:38:39.110Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T16:38:39.110Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T16:38:39.110Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T16:38:39.111Z"}
{"level":"info","message":"🛑 SIGINT received, shutting down gracefully","timestamp":"2025-07-13T16:38:45.284Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T16:38:48.761Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T16:38:48.764Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T16:38:48.765Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T16:38:48.766Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T16:38:48.909Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T16:38:48.913Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T16:38:48.998Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T16:38:49.001Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T16:38:49.001Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T16:38:49.002Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T16:38:49.002Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T16:38:49.003Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T16:38:49.003Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T16:38:49.003Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T16:38:49.003Z"}
{"level":"http","message":"GET /api/cart 304 65.390 ms - {} - User: -","timestamp":"2025-07-13T16:38:51.848Z"}
{"level":"http","message":"GET /api/products?limit=100 304 54.094 ms - {} - User: guest","timestamp":"2025-07-13T16:38:51.853Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 50.896 ms - {} - User: guest","timestamp":"2025-07-13T16:38:51.858Z"}
{"level":"http","message":"GET /api/collections 304 48.947 ms - {} - User: guest","timestamp":"2025-07-13T16:38:51.862Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.989 ms - {} - User: guest","timestamp":"2025-07-13T16:38:51.873Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.285 ms - {} - User: guest","timestamp":"2025-07-13T16:38:51.881Z"}
{"level":"http","message":"GET /api/cart 304 23.451 ms - {} - User: -","timestamp":"2025-07-13T16:38:51.887Z"}
{"level":"http","message":"GET /api/collections 304 8.109 ms - {} - User: guest","timestamp":"2025-07-13T16:38:51.890Z"}
{"level":"http","message":"GET /api/cart 304 7.020 ms - {} - User: -","timestamp":"2025-07-13T16:38:51.898Z"}
{"level":"http","message":"GET /api/cart 304 6.122 ms - {} - User: -","timestamp":"2025-07-13T16:38:51.906Z"}
{"level":"http","message":"GET /api/wishlist 304 13.171 ms - {} - User: -","timestamp":"2025-07-13T16:38:51.943Z"}
{"level":"http","message":"GET /api/wishlist 304 8.942 ms - {} - User: -","timestamp":"2025-07-13T16:38:51.953Z"}
{"level":"http","message":"GET /api/wishlist 304 8.819 ms - {} - User: -","timestamp":"2025-07-13T16:38:51.965Z"}
{"level":"http","message":"GET /api/wishlist 304 9.728 ms - {} - User: -","timestamp":"2025-07-13T16:38:51.976Z"}
{"level":"http","message":"GET /api/wishlist 304 8.623 ms - {} - User: -","timestamp":"2025-07-13T16:38:51.986Z"}
{"level":"http","message":"GET /api/wishlist 304 10.920 ms - {} - User: -","timestamp":"2025-07-13T16:38:51.998Z"}
{"level":"http","message":"GET /api/products?limit=100 304 0.851 ms - {} - User: guest","timestamp":"2025-07-13T16:38:54.019Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 0.943 ms - {} - User: guest","timestamp":"2025-07-13T16:38:54.021Z"}
{"level":"http","message":"GET /api/products?limit=100 304 1.372 ms - {} - User: guest","timestamp":"2025-07-13T16:38:54.029Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 0.770 ms - {} - User: guest","timestamp":"2025-07-13T16:38:54.032Z"}
{"level":"http","message":"GET /api/cart 304 21.503 ms - {} - User: -","timestamp":"2025-07-13T16:38:54.035Z"}
{"level":"http","message":"GET /api/collections 304 14.981 ms - {} - User: guest","timestamp":"2025-07-13T16:38:54.037Z"}
{"level":"http","message":"GET /api/cart 304 10.308 ms - {} - User: -","timestamp":"2025-07-13T16:38:54.048Z"}
{"level":"http","message":"GET /api/collections 304 8.255 ms - {} - User: guest","timestamp":"2025-07-13T16:38:54.051Z"}
{"level":"http","message":"GET /api/cart 304 8.676 ms - {} - User: -","timestamp":"2025-07-13T16:38:54.061Z"}
{"level":"http","message":"GET /api/cart 304 8.206 ms - {} - User: -","timestamp":"2025-07-13T16:38:54.071Z"}
{"level":"http","message":"GET /api/wishlist 304 12.638 ms - {} - User: -","timestamp":"2025-07-13T16:38:54.141Z"}
{"level":"http","message":"GET /api/wishlist 304 10.209 ms - {} - User: -","timestamp":"2025-07-13T16:38:54.154Z"}
{"level":"http","message":"GET /api/wishlist 304 11.666 ms - {} - User: -","timestamp":"2025-07-13T16:38:54.167Z"}
{"level":"http","message":"GET /api/wishlist 304 11.910 ms - {} - User: -","timestamp":"2025-07-13T16:38:54.181Z"}
{"level":"http","message":"GET /api/wishlist 304 9.862 ms - {} - User: -","timestamp":"2025-07-13T16:38:54.192Z"}
{"level":"http","message":"GET /api/wishlist 304 8.911 ms - {} - User: -","timestamp":"2025-07-13T16:38:54.203Z"}
{"level":"http","message":"GET /api/cart 304 6.402 ms - {} - User: -","timestamp":"2025-07-13T16:38:54.486Z"}
{"level":"http","message":"GET /api/cart 304 14.831 ms - {} - User: -","timestamp":"2025-07-13T16:38:54.503Z"}
{"level":"http","message":"GET /api/products/NB12 304 6.880 ms - {} - User: guest","timestamp":"2025-07-13T16:38:56.995Z"}
{"level":"http","message":"GET /api/products/NB12 304 0.832 ms - {} - User: guest","timestamp":"2025-07-13T16:38:56.999Z"}
{"level":"http","message":"GET /api/cart 304 10.361 ms - {} - User: -","timestamp":"2025-07-13T16:38:57.002Z"}
{"level":"http","message":"GET /api/cart 304 14.288 ms - {} - User: -","timestamp":"2025-07-13T16:38:57.019Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 21.534 ms - {} - User: guest","timestamp":"2025-07-13T16:38:57.035Z"}
{"level":"http","message":"GET /api/cart 304 13.279 ms - {} - User: -","timestamp":"2025-07-13T16:38:57.041Z"}
{"level":"http","message":"GET /api/cart 304 8.457 ms - {} - User: -","timestamp":"2025-07-13T16:38:57.054Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 1.931 ms - {} - User: guest","timestamp":"2025-07-13T16:38:57.062Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 29.114 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-216\",\"items\":[{\"productId\":\"NB12\",\"nameProduct\":\"Nhẫn Bạc đính đá STYLE By PNJ ZTXMW000032\",\"quantity\":1,\"sizeIndex\":2,\"unitPrice\":589500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-B1.2.1.png?alt=media&token=a9502595-0167-4a98-8f34-4eefd1f35ba8\"}],\"totalAmount\":619500,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"a\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T16:39:12.290Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 755.967 ms - {\"orderId\":\"ORD-2025-216\",\"totalAmount\":619500,\"items\":[{\"productId\":\"NB12\",\"nameProduct\":\"Nhn Bc nh  STYLE By PNJ ZTXMW000032\",\"quantity\":1,\"unitPrice\":589500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%252FTrang%2520s%E1%BB%A9c%252FNh%E1%BA%ABn%252FN-B1.2.1.png?alt=media&token=a9502595-0167-4a98-8f34-4eefd1f35ba8\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T16:39:13.053Z"}
{"level":"error","message":"Webhook handler error: Cannot read properties of undefined (reading 'handleCheckoutCompleted')","stack":"TypeError: Cannot read properties of undefined (reading 'handleCheckoutCompleted')\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:498:32)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\read.js:137:5\n    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\n    at invokeCallback (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\raw-body\\index.js:238:16)\n    at done (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\raw-body\\index.js:227:7)\n    at IncomingMessage.onEnd (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\raw-body\\index.js:287:7)\n    at IncomingMessage.emit (node:events:519:28)\n    at endReadableNT (node:internal/streams/readable:1696:12)","timestamp":"2025-07-13T16:39:19.627Z"}
{"level":"error","message":"Webhook handler error: Cannot read properties of undefined (reading 'handlePaymentSuccess')","stack":"TypeError: Cannot read properties of undefined (reading 'handlePaymentSuccess')\n    at handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:490:32)\n    at Layer.handle [as handle_request] (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\body-parser\\lib\\read.js:137:5\n    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\n    at invokeCallback (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\raw-body\\index.js:238:16)\n    at done (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\raw-body\\index.js:227:7)\n    at IncomingMessage.onEnd (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\node_modules\\raw-body\\index.js:287:7)\n    at IncomingMessage.emit (node:events:519:28)\n    at endReadableNT (node:internal/streams/readable:1696:12)","timestamp":"2025-07-13T16:39:19.649Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T16:44:11.586Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T16:44:11.589Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T16:44:11.589Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T16:44:11.590Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T16:44:11.743Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T16:44:11.748Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T16:44:11.831Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T16:44:11.833Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T16:44:11.833Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T16:44:11.834Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T16:44:11.834Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T16:44:11.834Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T16:44:11.835Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T16:44:11.835Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T16:44:11.835Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T16:44:32.757Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T16:44:32.759Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T16:44:32.760Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T16:44:32.761Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T16:44:32.901Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T16:44:32.907Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T16:44:33.000Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T16:44:33.003Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T16:44:33.003Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T16:44:33.004Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T16:44:33.004Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T16:44:33.005Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T16:44:33.005Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T16:44:33.005Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T16:44:33.005Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T16:44:45.427Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T16:44:45.429Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T16:44:45.430Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T16:44:45.431Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T16:44:45.565Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T16:44:45.569Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T16:44:45.653Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T16:44:45.660Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T16:44:45.660Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T16:44:45.661Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T16:44:45.661Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T16:44:45.661Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T16:44:45.661Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T16:44:45.661Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T16:44:45.661Z"}
{"level":"http","message":"GET /api/products?limit=100 304 61.673 ms - {} - User: guest","timestamp":"2025-07-13T16:44:55.245Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 57.328 ms - {} - User: guest","timestamp":"2025-07-13T16:44:55.249Z"}
{"level":"http","message":"GET /api/collections 304 55.842 ms - {} - User: guest","timestamp":"2025-07-13T16:44:55.252Z"}
{"level":"http","message":"GET /api/cart 304 54.229 ms - {} - User: -","timestamp":"2025-07-13T16:44:55.258Z"}
{"level":"http","message":"GET /api/products?limit=100 304 0.961 ms - {} - User: guest","timestamp":"2025-07-13T16:44:55.260Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 0.880 ms - {} - User: guest","timestamp":"2025-07-13T16:44:55.263Z"}
{"level":"http","message":"GET /api/collections 304 11.569 ms - {} - User: guest","timestamp":"2025-07-13T16:44:55.276Z"}
{"level":"http","message":"GET /api/cart 304 11.444 ms - {} - User: -","timestamp":"2025-07-13T16:44:55.278Z"}
{"level":"http","message":"GET /api/cart 304 5.954 ms - {} - User: -","timestamp":"2025-07-13T16:44:55.285Z"}
{"level":"http","message":"GET /api/cart 304 7.260 ms - {} - User: -","timestamp":"2025-07-13T16:44:55.294Z"}
{"level":"http","message":"GET /api/wishlist 304 15.603 ms - {} - User: -","timestamp":"2025-07-13T16:44:55.333Z"}
{"level":"http","message":"GET /api/wishlist 304 10.721 ms - {} - User: -","timestamp":"2025-07-13T16:44:55.345Z"}
{"level":"http","message":"GET /api/wishlist 304 11.159 ms - {} - User: -","timestamp":"2025-07-13T16:44:55.358Z"}
{"level":"http","message":"GET /api/wishlist 304 8.038 ms - {} - User: -","timestamp":"2025-07-13T16:44:55.368Z"}
{"level":"http","message":"GET /api/wishlist 304 10.460 ms - {} - User: -","timestamp":"2025-07-13T16:44:55.380Z"}
{"level":"http","message":"GET /api/wishlist 304 8.229 ms - {} - User: -","timestamp":"2025-07-13T16:44:55.389Z"}
{"level":"http","message":"GET /api/cart 304 12.047 ms - {} - User: -","timestamp":"2025-07-13T16:44:57.691Z"}
{"level":"http","message":"GET /api/cart 304 9.591 ms - {} - User: -","timestamp":"2025-07-13T16:44:57.704Z"}
{"level":"http","message":"GET /api/products/NB12 304 15.575 ms - {} - User: guest","timestamp":"2025-07-13T16:45:01.663Z"}
{"level":"http","message":"GET /api/cart 304 40.367 ms - {} - User: -","timestamp":"2025-07-13T16:45:01.665Z"}
{"level":"http","message":"GET /api/products/NB12 304 0.609 ms - {} - User: guest","timestamp":"2025-07-13T16:45:01.667Z"}
{"level":"http","message":"GET /api/cart 304 18.479 ms - {} - User: -","timestamp":"2025-07-13T16:45:01.686Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 24.643 ms - {} - User: guest","timestamp":"2025-07-13T16:45:01.704Z"}
{"level":"http","message":"GET /api/cart 304 12.516 ms - {} - User: -","timestamp":"2025-07-13T16:45:01.710Z"}
{"level":"http","message":"GET /api/cart 304 10.276 ms - {} - User: -","timestamp":"2025-07-13T16:45:01.722Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 0.948 ms - {} - User: guest","timestamp":"2025-07-13T16:45:01.767Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 30.907 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-529\",\"items\":[{\"productId\":\"NB12\",\"nameProduct\":\"Nhẫn Bạc đính đá STYLE By PNJ ZTXMW000032\",\"quantity\":1,\"sizeIndex\":2,\"unitPrice\":589500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-B1.2.1.png?alt=media&token=a9502595-0167-4a98-8f34-4eefd1f35ba8\"}],\"totalAmount\":619500,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"a\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T16:45:07.886Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 808.691 ms - {\"orderId\":\"ORD-2025-529\",\"totalAmount\":619500,\"items\":[{\"productId\":\"NB12\",\"nameProduct\":\"Nhn Bc nh  STYLE By PNJ ZTXMW000032\",\"quantity\":1,\"unitPrice\":589500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%252FTrang%2520s%E1%BB%A9c%252FNh%E1%BA%ABn%252FN-B1.2.1.png?alt=media&token=a9502595-0167-4a98-8f34-4eefd1f35ba8\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T16:45:08.703Z"}
{"level":"error","message":"Handle payment success error: Failed to update order status: Order not found","stack":"Error: Failed to update order status: Order not found\n    at PurchaseHistoryService.updateOrderStatus (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\services\\purchase-history.service.js:356:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async PaymentController.handlePaymentSuccess (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:518:13)\n    at async handleWebhook (C:\\Users\\ADMIN\\Desktop\\nodejs\\DaoShop\\src\\controllers\\payment.controller.js:487:21)","timestamp":"2025-07-13T16:45:15.240Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T16:46:35.892Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T16:46:35.895Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T16:46:35.896Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T16:46:35.897Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T16:46:36.092Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T16:46:36.096Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T16:46:36.192Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T16:46:36.195Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T16:46:36.196Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T16:46:36.197Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T16:46:36.197Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T16:46:36.197Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T16:46:36.197Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T16:46:36.198Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T16:46:36.198Z"}
{"level":"http","message":"GET /api/cart 304 61.478 ms - {} - User: -","timestamp":"2025-07-13T16:46:45.069Z"}
{"level":"http","message":"GET /api/products?limit=100 304 52.300 ms - {} - User: guest","timestamp":"2025-07-13T16:46:45.075Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 51.987 ms - {} - User: guest","timestamp":"2025-07-13T16:46:45.080Z"}
{"level":"http","message":"GET /api/collections 304 54.376 ms - {} - User: guest","timestamp":"2025-07-13T16:46:45.086Z"}
{"level":"http","message":"GET /api/products?limit=100 304 2.904 ms - {} - User: guest","timestamp":"2025-07-13T16:46:45.100Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.235 ms - {} - User: guest","timestamp":"2025-07-13T16:46:45.104Z"}
{"level":"http","message":"GET /api/cart 304 24.434 ms - {} - User: -","timestamp":"2025-07-13T16:46:45.114Z"}
{"level":"http","message":"GET /api/collections 304 11.006 ms - {} - User: guest","timestamp":"2025-07-13T16:46:45.116Z"}
{"level":"http","message":"GET /api/cart 304 8.650 ms - {} - User: -","timestamp":"2025-07-13T16:46:45.126Z"}
{"level":"http","message":"GET /api/cart 304 5.373 ms - {} - User: -","timestamp":"2025-07-13T16:46:45.134Z"}
{"level":"http","message":"GET /api/wishlist 304 58.106 ms - {} - User: -","timestamp":"2025-07-13T16:46:45.204Z"}
{"level":"http","message":"GET /api/wishlist 304 10.566 ms - {} - User: -","timestamp":"2025-07-13T16:46:45.216Z"}
{"level":"http","message":"GET /api/wishlist 304 17.812 ms - {} - User: -","timestamp":"2025-07-13T16:46:45.236Z"}
{"level":"http","message":"GET /api/wishlist 304 14.314 ms - {} - User: -","timestamp":"2025-07-13T16:46:45.253Z"}
{"level":"http","message":"GET /api/wishlist 304 10.881 ms - {} - User: -","timestamp":"2025-07-13T16:46:45.265Z"}
{"level":"http","message":"GET /api/wishlist 304 10.852 ms - {} - User: -","timestamp":"2025-07-13T16:46:45.277Z"}
{"level":"http","message":"GET /api/products?limit=100 304 0.920 ms - {} - User: guest","timestamp":"2025-07-13T16:46:47.822Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 1.078 ms - {} - User: guest","timestamp":"2025-07-13T16:46:47.825Z"}
{"level":"http","message":"GET /api/products?limit=100 304 0.716 ms - {} - User: guest","timestamp":"2025-07-13T16:46:47.831Z"}
{"level":"http","message":"GET /api/products?page=1&limit=10&sortBy=createdAt&sortOrder=desc 304 0.711 ms - {} - User: guest","timestamp":"2025-07-13T16:46:47.833Z"}
{"level":"http","message":"GET /api/cart 304 19.334 ms - {} - User: -","timestamp":"2025-07-13T16:46:47.836Z"}
{"level":"http","message":"GET /api/collections 304 11.770 ms - {} - User: guest","timestamp":"2025-07-13T16:46:47.838Z"}
{"level":"http","message":"GET /api/cart 304 8.845 ms - {} - User: -","timestamp":"2025-07-13T16:46:47.848Z"}
{"level":"http","message":"GET /api/collections 304 6.909 ms - {} - User: guest","timestamp":"2025-07-13T16:46:47.849Z"}
{"level":"http","message":"GET /api/cart 304 6.235 ms - {} - User: -","timestamp":"2025-07-13T16:46:47.857Z"}
{"level":"http","message":"GET /api/cart 304 5.487 ms - {} - User: -","timestamp":"2025-07-13T16:46:47.865Z"}
{"level":"http","message":"GET /api/wishlist 304 11.033 ms - {} - User: -","timestamp":"2025-07-13T16:46:47.960Z"}
{"level":"http","message":"GET /api/wishlist 304 10.138 ms - {} - User: -","timestamp":"2025-07-13T16:46:47.972Z"}
{"level":"http","message":"GET /api/wishlist 304 10.503 ms - {} - User: -","timestamp":"2025-07-13T16:46:47.984Z"}
{"level":"http","message":"GET /api/wishlist 304 10.899 ms - {} - User: -","timestamp":"2025-07-13T16:46:47.996Z"}
{"level":"http","message":"GET /api/wishlist 304 10.845 ms - {} - User: -","timestamp":"2025-07-13T16:46:48.009Z"}
{"level":"http","message":"GET /api/wishlist 304 9.590 ms - {} - User: -","timestamp":"2025-07-13T16:46:48.020Z"}
{"level":"http","message":"GET /api/cart 304 5.894 ms - {} - User: -","timestamp":"2025-07-13T16:46:48.254Z"}
{"level":"http","message":"GET /api/cart 304 11.451 ms - {} - User: -","timestamp":"2025-07-13T16:46:48.268Z"}
{"level":"http","message":"GET /api/products/NB2 304 4.959 ms - {} - User: guest","timestamp":"2025-07-13T16:46:51.490Z"}
{"level":"http","message":"GET /api/cart 304 11.292 ms - {} - User: -","timestamp":"2025-07-13T16:46:51.492Z"}
{"level":"http","message":"GET /api/products/NB2 304 1.480 ms - {} - User: guest","timestamp":"2025-07-13T16:46:51.495Z"}
{"level":"http","message":"GET /api/cart 304 6.925 ms - {} - User: -","timestamp":"2025-07-13T16:46:51.503Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 16.236 ms - {} - User: guest","timestamp":"2025-07-13T16:46:51.521Z"}
{"level":"http","message":"GET /api/cart 304 13.561 ms - {} - User: -","timestamp":"2025-07-13T16:46:51.524Z"}
{"level":"http","message":"GET /api/cart 304 7.853 ms - {} - User: -","timestamp":"2025-07-13T16:46:51.534Z"}
{"level":"http","message":"GET /api/products?category=TRANG%20S%E1%BB%A8C&limit=20 304 0.820 ms - {} - User: guest","timestamp":"2025-07-13T16:46:51.554Z"}
{"level":"http","message":"POST /api/purchase-history/create 201 19.978 ms - {\"userId\":\"6870c70c1ca5164be10bb91d\",\"orderId\":\"ORD-2025-851\",\"items\":[{\"productId\":\"NB2\",\"nameProduct\":\"Nhẫn nam Bạc đính đá PNJSilver XMXMW060196\",\"quantity\":1,\"sizeIndex\":1,\"unitPrice\":985500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%2FTrang%20sức%2FNhẫn%2FN-B2.1.png?alt=media&token=8f99e041-4f97-4ee1-9cc3-bd5f48146e08\"}],\"totalAmount\":1015500,\"paymentMethod\":\"stripe\",\"deliveryAddress\":{\"fullName\":\"Nguyen van a\",\"phone\":\"1212212121\",\"street\":\"sdasd\",\"ward\":\"a\",\"district\":\"a\",\"city\":\"áda\",\"zipCode\":\"1121212\"},\"shippingFee\":30000,\"discount\":0,\"notes\":\"a\"} - User: -","timestamp":"2025-07-13T16:46:59.664Z"}
{"level":"http","message":"POST /api/payment/create-checkout 200 753.857 ms - {\"orderId\":\"ORD-2025-851\",\"totalAmount\":1015500,\"items\":[{\"productId\":\"NB2\",\"nameProduct\":\"Nhn nam Bc nh  PNJSilver XMXMW060196\",\"quantity\":1,\"unitPrice\":985500,\"productImage\":\"https://firebasestorage.googleapis.com/v0/b/duan-4904c.appspot.com/o/flutter_pnj%252FTrang%2520s%E1%BB%A9c%252FNh%E1%BA%ABn%252FN-B2.1.png?alt=media&token=8f99e041-4f97-4ee1-9cc3-bd5f48146e08\"}],\"shippingFee\":30000,\"discount\":0} - User: -","timestamp":"2025-07-13T16:47:00.427Z"}
{"level":"warn","message":"PaymentIntent missing orderId metadata, skipping order update.","timestamp":"2025-07-13T16:47:07.821Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T16:57:53.928Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T16:57:53.931Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T16:57:53.931Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T16:57:53.932Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T16:57:54.089Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T16:57:54.094Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T16:57:54.187Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T16:57:54.190Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T16:57:54.191Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T16:57:54.192Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T16:57:54.192Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T16:57:54.193Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T16:57:54.193Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T16:57:54.193Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T16:57:54.193Z"}
{"level":"info","message":"Google OAuth Config:","timestamp":"2025-07-13T16:58:14.599Z"}
{"level":"info","message":"- CLIENT_ID:","timestamp":"2025-07-13T16:58:14.604Z"}
{"level":"info","message":"- CLIENT_SECRET:","timestamp":"2025-07-13T16:58:14.604Z"}
{"level":"info","message":"- CALLBACK_URL:","timestamp":"2025-07-13T16:58:14.605Z"}
{"level":"info","message":"✅ Swagger configured successfully","timestamp":"2025-07-13T16:58:14.849Z"}
{"level":"info","message":"✅ WebSocket server configured successfully","timestamp":"2025-07-13T16:58:14.853Z"}
{"level":"info","message":"✅ Database connected successfully","timestamp":"2025-07-13T16:58:14.946Z"}
{"level":"info","message":"🚀 Server running on port 8797","timestamp":"2025-07-13T16:58:14.948Z"}
{"level":"info","message":"📡 HTTP: http://localhost:8797","timestamp":"2025-07-13T16:58:14.948Z"}
{"level":"info","message":"📖 Docs: http://localhost:8797/api-docs","timestamp":"2025-07-13T16:58:14.949Z"}
{"level":"info","message":"🧪 Test: http://localhost:8797/test-google","timestamp":"2025-07-13T16:58:14.949Z"}
{"level":"info","message":"💓 Health: http://localhost:8797/health","timestamp":"2025-07-13T16:58:14.949Z"}
{"level":"info","message":"🔌 WebSocket: ws://localhost:8797","timestamp":"2025-07-13T16:58:14.949Z"}
{"level":"info","message":"💬 WebSocket Health: http://localhost:8797/api/websocket/health","timestamp":"2025-07-13T16:58:14.949Z"}
{"level":"info","message":"🌍 Environment: undefined","timestamp":"2025-07-13T16:58:14.949Z"}
